
let imgBaseUrl = 'https://chatclient-stg.ai.lgcns.com/singlex-ai-chatbot-contents-stg/3ace0979-8ff0-49f3-814b-84c500f5fbef';

let searchActive = false;
let searchActive2 = false;
let searchType = null;
let dictSearchTerm = '';
var systemItems = null;
let userIdFirst = null;
let checkChatHistory = false;

// Event
let employeeQueryEvent = "employeeQueryEvent";
let scheduleDeleteEvent = "scheduleDeleteEvent";
let scheduleAttendEvent = "scheduleAttendEvent";
let saveNotificationEvent = "saveNotificationEvent";
let readNotificationEvent = "readNotificationEvent";
let employeeSmsQueryEvent = "employeeSmsQueryEvent";
let teamSmsQueryEvent = "teamSmsQueryEvent";
let scheduleRegEvent = "scheduleRegEvent";
let dictDetailQueryEvent = "dictDetailQueryEvent";
let groupQueryEvent = "groupQueryEvent";
let employeeEmailQueryEvent = "employeeEmailQueryEvent";
let retrieveFacilityListEvent = "retrieveFacilityListEvent";

// Employee URL
let messengerUrl = "https://www.lgucap.com:9097/uCapLog/sso/ssoTalkId/GUC005/";
let profileUrl = " http://gportal.lgchem.com/support/profile/getProfile.do?docPopup=true&targetUserId=";
let smsUrl = "http://gportal.lgchem.com/support/sms/sms.do?gubun=1&receiverId=";

// G-포탈 URL
//let gportalEmployeeUrl = "http://gportal.lgchem.com/portal/main/listUserPopup.do?viewMode=main&searchWord=%search2323Word%&searchColumn=all";
//let gportalTotalUrl = "http://search.lgchem.com:8501/total_2013/search.jsp?query=%query%&Language=ko";
//let gportalScheduleUrl = "http://gportal.lgchem.com/lightpack/planner/calendar/viewSchedule.do?scheduleId=";
//let ecmUrl = "http://ecm.lgchem.com/ecm/fileSystem.do?searchText=%query%";
//let gportalPersonUrl = "http://gportal.lgchem.com/portal/main/listUserMain.do?hideOrgYN=true&rightFrameUrl=/support/profile/getProfile.do?targetUserId="
//let gPortalWeekScheduleUrl = "http://gportal.lgchem.com/lightpack/planner/calendar/popup/init.do?viewMode=agendaWeek&type=init&targetId=%query%&action=onClickTargetUser"

// EP 통합검색 
let epTotalUrl = "https://ep.lgcns.com/support/search/totalSearch.do?totalSearch=%query%";          

// Push 초기화 비활성화(챗봇창 오픈 시 push 시점 제어)
// chatSettings["initPush"] = "N";
var tempLogo = document.getElementsByClassName('bot-profile');
console.log(tempLogo);
if(tempLogo && tempLogo[0]) {
  tempLogo[0].style.display = "none";
}

//icons
var arrow ='<div class="arrow">'
    + '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
        + '<path d="M12 6L20.3979 15.331C20.7402 15.7113 20.7402 16.2887 20.3979 16.669L12 26" stroke-width="1.2" stroke-linecap="round"/>'
    + '</svg>'
  + '</div>';   

var arrow2 = '<svg width="9" height="21" viewBox="0 0 9 21" fill="none" xmlns="http://www.w3.org/2000/svg">'
          +'<path fill-rule="evenodd" clip-rule="evenodd" d="M7.57267 9.90216C7.87578 10.2432 7.87578 10.757 7.57267 11.098L0.458487 19.1015C0.238336 19.3491 0.260644 19.7284 0.508313 19.9485C0.755983 20.1687 1.13523 20.1464 1.35538 19.8987L8.46956 11.8953C9.17681 11.0996 9.17681 9.90059 8.46956 9.10493L1.35538 1.10147C1.13523 0.853804 0.755983 0.831495 0.508313 1.05165C0.260644 1.2718 0.238336 1.65104 0.458487 1.89871L7.57267 9.90216Z" fill="#2C2C2C"/>'
        +'</svg>';

var arrowRight = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.3815 7.60177C10.5835 7.8291 10.5835 8.17167 10.3815 8.399L5.63867 13.7346C5.4919 13.8998 5.50677 14.1526 5.67188 14.2994C5.837 14.4461 6.08983 14.4312 6.23659 14.2661L10.9794 8.9305C11.4509 8.40005 11.4509 7.60072 10.9794 7.07028L6.23659 1.73464C6.08983 1.56953 5.837 1.55466 5.67188 1.70142C5.50677 1.84819 5.4919 2.10102 5.63867 2.26613L10.3815 7.60177Z" fill="#A5A5A5"/>'
+'</svg>';


var listHeaderIcon = '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +'<circle cx="8.25" cy="9.25" r="0.75" fill="#333333" stroke="#333333"/>'
  +  '<path d="M12 9.25H24" stroke="#333333" stroke-linecap="round"/>'
  +  '<circle cx="8.25" cy="16.25" r="0.75" fill="#333333" stroke="#333333"/>'
  +  '<path d="M12 16.25H24" stroke="#333333" stroke-linecap="round"/>'
  +  '<circle cx="8.25" cy="23.25" r="0.75" fill="#333333" stroke="#333333"/>'
  +  '<path d="M12 23.25H24" stroke="#333333" stroke-linecap="round"/>'
  +'</svg>';


var listHeader = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.00004 13.8673C11.2401 13.8673 13.8667 11.2407 13.8667 8.00065C13.8667 4.76058 11.2401 2.13398 8.00004 2.13398C4.75997 2.13398 2.13337 4.76058 2.13337 8.00065C2.13337 11.2407 4.75997 13.8673 8.00004 13.8673ZM8.00004 14.6673C11.6819 14.6673 14.6667 11.6825 14.6667 8.00065C14.6667 4.31875 11.6819 1.33398 8.00004 1.33398C4.31814 1.33398 1.33337 4.31875 1.33337 8.00065C1.33337 11.6825 4.31814 14.6673 8.00004 14.6673Z" fill="#2C2C2C"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.9503 6.38447C11.1065 6.54068 11.1065 6.79395 10.9503 6.95016L7.61692 10.2835C7.46073 10.4397 7.2075 10.4397 7.05128 10.2835L5.05058 8.28354C4.89434 8.12736 4.8943 7.87409 5.05048 7.71786C5.20666 7.56162 5.45993 7.56158 5.61617 7.71776L7.33403 9.43502L10.3846 6.38447C10.5408 6.22827 10.794 6.22827 10.9503 6.38447Z" fill="#2C2C2C"/>'
+'</svg>';

var iconMail = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M12.6663 3.46602H3.33301C2.67027 3.46602 2.13301 4.00327 2.13301 4.66602V11.3327C2.13301 11.9954 2.67027 12.5327 3.33301 12.5327H12.6663C13.3291 12.5327 13.8663 11.9954 13.8663 11.3327V4.66602C13.8663 4.00327 13.3291 3.46602 12.6663 3.46602ZM3.33301 2.66602C2.22844 2.66602 1.33301 3.56145 1.33301 4.66602V11.3327C1.33301 12.4373 2.22844 13.3327 3.33301 13.3327H12.6663C13.7709 13.3327 14.6663 12.4373 14.6663 11.3327V4.66602C14.6663 3.56145 13.7709 2.66602 12.6663 2.66602H3.33301Z" fill="#898989"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M1.33301 4.66602C1.33301 3.56145 2.22844 2.66602 3.33301 2.66602H12.6663C13.7709 2.66602 14.6663 3.56145 14.6663 4.66602C14.6663 5.05329 14.5852 5.38551 14.3798 5.6913C14.1839 5.98288 13.8945 6.22031 13.5416 6.45933C12.9736 6.84398 9.85489 8.55927 8.66869 9.20925C8.2507 9.43829 7.74864 9.43829 7.33066 9.20925C6.1443 8.55918 3.02483 6.84348 2.45723 6.45904C2.10447 6.22011 1.81524 5.98267 1.6195 5.69108C1.41425 5.38533 1.33301 5.05315 1.33301 4.66602ZM3.33301 3.46602C2.67027 3.46602 2.13301 4.00327 2.13301 4.66602C2.13301 4.93051 2.1852 5.09843 2.28372 5.2452C2.39175 5.40613 2.57675 5.57376 2.90586 5.79667C3.43253 6.15339 6.49935 7.8415 7.71509 8.50767C7.89359 8.60548 8.10576 8.60548 8.28426 8.50767C9.49982 7.8416 12.5659 6.15388 13.093 5.79694C13.4224 5.57384 13.6076 5.40618 13.7157 5.24523C13.8143 5.09849 13.8663 4.93061 13.8663 4.66602C13.8663 4.00327 13.3291 3.46602 12.6663 3.46602H3.33301C3.33301 3.46602 3.333 3.46602 3.33301 3.46602Z" fill="#898989"/>'
+'</svg>';

var iconPhone = '<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M12.5842 10.5261L10.3746 9.14452C10.2925 9.09317 10.1745 9.10065 10.0918 9.18231C10.0131 9.26012 9.9358 9.33551 9.87193 9.39564C9.1487 10.0767 8.21307 9.93799 7.54251 9.66479C6.85048 9.38284 6.1788 8.8696 5.65588 8.34687C5.13291 7.82409 4.61899 7.15196 4.33668 6.45924C4.06308 5.78791 3.92438 4.85121 4.60668 4.12737C4.66788 4.06244 4.74239 3.98595 4.81898 3.90841C4.9012 3.82516 4.90827 3.70712 4.85718 3.62542L3.47542 1.41615L3.47137 1.40939C3.30654 1.1339 2.99922 1.03945 2.68408 1.24462C1.85645 1.78509 1.43723 2.37962 1.25418 2.971C1.06765 3.57363 1.09939 4.26136 1.33263 5.02227C1.80708 6.57004 3.05679 8.22718 4.41578 9.58568C5.77497 10.9444 7.43109 12.1933 8.97796 12.6675C9.7384 12.9006 10.4258 12.9324 11.0283 12.7461C11.6196 12.5632 12.2142 12.1443 12.7552 11.3174C12.9603 11.0029 12.867 10.6959 12.5904 10.5298L12.5842 10.5261ZM13.425 11.7548C10.922 15.5818 6.6355 12.9357 3.8502 10.1515C1.06491 7.3672 -1.58331 3.07544 2.24711 0.574501C2.95544 0.113007 3.76792 0.346919 4.15787 0.998626L5.53544 3.20121C5.78858 3.60595 5.72365 4.13091 5.38816 4.47058C5.31335 4.54632 5.24381 4.61776 5.18882 4.6761C4.46912 5.43963 5.2675 6.82747 6.22146 7.78108C7.17542 8.73469 8.56121 9.531 9.3235 8.81321C9.38036 8.75968 9.45232 8.68957 9.52946 8.61333C9.86892 8.27782 10.394 8.21314 10.7987 8.46619L13.0023 9.84394C13.6537 10.2351 13.887 11.0468 13.425 11.7548Z" fill="#898989"/>'
+'</svg>';

var iconCalendar = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path d="M11.6 9.73343L10.5954 9.73343C10.3744 9.73343 10.1953 9.55435 10.1953 9.33343C10.1953 9.11252 10.3744 8.93343 10.5953 8.93343L11.6 8.93343C11.8209 8.93343 12 9.11252 12 9.33343C12 9.55435 11.8209 9.73343 11.6 9.73343Z" fill="#6B6B6B"/>'
+'<path d="M8.58605 9.73344L7.41395 9.73344C7.19304 9.73344 7.01395 9.55435 7.01395 9.33344C7.01395 9.11252 7.19304 8.93344 7.41395 8.93344L8.58605 8.93344C8.80696 8.93343 8.98605 9.11252 8.98605 9.33344C8.98605 9.55435 8.80696 9.73344 8.58605 9.73344Z" fill="#6B6B6B"/>'
+'<path d="M5.40465 9.73344L4.4 9.73344C4.17909 9.73344 4 9.55436 4 9.33344C4 9.11253 4.17909 8.93344 4.4 8.93344L5.40465 8.93344C5.62556 8.93344 5.80465 9.11252 5.80465 9.33344C5.80465 9.55435 5.62557 9.73344 5.40465 9.73344Z" fill="#6B6B6B"/>'
+'<path d="M7.41395 11.7334L8.58605 11.7334C8.80696 11.7334 8.98605 11.5543 8.98605 11.3334C8.98605 11.1125 8.80696 10.9334 8.58605 10.9334L7.41395 10.9334C7.19304 10.9334 7.01395 11.1125 7.01395 11.3334C7.01395 11.5543 7.19304 11.7334 7.41395 11.7334Z" fill="#6B6B6B"/>'
+'<path d="M4.4 11.7334L5.40465 11.7334C5.62557 11.7334 5.80465 11.5543 5.80465 11.3334C5.80465 11.1125 5.62556 10.9334 5.40465 10.9334L4.4 10.9334C4.17909 10.9334 4 11.1125 4 11.3334C4 11.5544 4.17909 11.7334 4.4 11.7334Z" fill="#6B6B6B"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M5.73327 1.7335C5.73327 1.51258 5.55418 1.3335 5.33327 1.3335C5.11235 1.3335 4.93327 1.51258 4.93327 1.7335V2.66683H4C2.89543 2.66683 2 3.56226 2 4.66683V12.6668C2 13.7714 2.89543 14.6668 4 14.6668H12C13.1046 14.6668 14 13.7714 14 12.6668V4.66683C14 3.56226 13.1046 2.66683 12 2.66683H11.0666V1.7335C11.0666 1.51258 10.8875 1.3335 10.6666 1.3335C10.4457 1.3335 10.2666 1.51258 10.2666 1.7335V2.66683H5.73327L5.73327 1.7335ZM12 3.46683H4C3.33726 3.46683 2.8 4.00409 2.8 4.66683V6.00016L13.2 6.00016V4.66683C13.2 4.00409 12.6627 3.46683 12 3.46683ZM2.8 12.6668V6.80016L13.2 6.80016V12.6668C13.2 13.3296 12.6627 13.8668 12 13.8668H4C3.33726 13.8668 2.8 13.3296 2.8 12.6668Z" fill="#6B6B6B"/>'
+'</svg>';

var iconDelete = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path d="M6.66668 5.93343C6.8876 5.93343 7.06668 6.11252 7.06668 6.33343V11.3334C7.06668 11.5543 6.8876 11.7334 6.66668 11.7334C6.44577 11.7334 6.26668 11.5543 6.26668 11.3334L6.26668 6.33343C6.26668 6.11252 6.44577 5.93343 6.66668 5.93343Z" fill="#A5A5A5"/>'
+'<path d="M9.73335 6.33343C9.73335 6.11252 9.55426 5.93343 9.33335 5.93343C9.11244 5.93343 8.93335 6.11252 8.93335 6.33343V11.3334C8.93335 11.5543 9.11244 11.7334 9.33335 11.7334C9.55426 11.7334 9.73335 11.5543 9.73335 11.3334L9.73335 6.33343Z" fill="#A5A5A5"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M5.66675 2.3335C5.66675 1.78121 6.11446 1.3335 6.66675 1.3335H9.33341C9.8857 1.3335 10.3334 1.78121 10.3334 2.3335V3.2002L12.9334 3.20019C13.1543 3.20019 13.3334 3.37928 13.3334 3.60019C13.3334 3.82111 13.1543 4.00019 12.9334 4.00019H12.6667V12.5335C12.6667 13.6381 11.7713 14.5335 10.6667 14.5335H5.33341C4.22885 14.5335 3.33341 13.6381 3.33341 12.5335V4.0002H3.06675C2.84583 4.0002 2.66675 3.82111 2.66675 3.6002C2.66675 3.37928 2.84583 3.2002 3.06675 3.2002H5.66675V2.3335ZM6.66675 2.1335H9.33341C9.44387 2.1335 9.53341 2.22304 9.53341 2.3335V3.20016H6.46675V2.3335C6.46675 2.22304 6.55629 2.1335 6.66675 2.1335ZM4.13341 4.0002H11.8667V12.5335C11.8667 13.1963 11.3295 13.7335 10.6667 13.7335H5.33341C4.67067 13.7335 4.13341 13.1963 4.13341 12.5335V4.0002Z" fill="#A5A5A5"/>'
+'</svg>';

var iconMarker = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+ '<path fill-rule="evenodd" clip-rule="evenodd" d="M10.3334 6.66683C10.3334 7.95549 9.28875 9.00016 8.00008 9.00016C6.71142 9.00016 5.66675 7.95549 5.66675 6.66683C5.66675 5.37817 6.71142 4.3335 8.00008 4.3335C9.28875 4.3335 10.3334 5.37817 10.3334 6.66683ZM9.53341 6.66683C9.53341 7.51367 8.84692 8.20016 8.00008 8.20016C7.15324 8.20016 6.46675 7.51367 6.46675 6.66683C6.46675 5.81999 7.15324 5.1335 8.00008 5.1335C8.84692 5.1335 9.53341 5.81999 9.53341 6.66683Z" fill="#898989"/>'
+ '<path fill-rule="evenodd" clip-rule="evenodd" d="M11.7713 10.6668C11.1659 11.5683 9.65522 13.3353 8.74013 14.3853C8.34745 14.8359 7.65271 14.8359 7.26003 14.3853C6.34495 13.3353 4.83426 11.5683 4.22885 10.6668C3.33341 9.3335 2.66675 8.03175 2.66675 6.66684C2.66675 5.30192 3.18744 3.93699 4.22885 2.89559C6.31164 0.812797 9.68852 0.812797 11.7713 2.89559C12.8127 3.93699 13.3334 5.30192 13.3334 6.66684C13.3334 8.03175 12.6667 9.3335 11.7713 10.6668ZM4.79453 3.46128C6.56491 1.6909 9.43526 1.6909 11.2056 3.46128C12.091 4.34663 12.5334 5.50541 12.5334 6.66684C12.5334 7.77819 11.9882 8.90901 11.1072 10.2208C10.5361 11.0712 9.06426 12.7957 8.13702 13.8597C8.06318 13.9445 7.93698 13.9445 7.86314 13.8597C6.9359 12.7957 5.46407 11.0712 4.89298 10.2208C4.012 8.90901 3.46675 7.77819 3.46675 6.66684C3.46675 5.50541 3.90918 4.34663 4.79453 3.46128Z" fill="#898989"/>'
+ '</svg>';

var iconMember = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+ '<path fill-rule="evenodd" clip-rule="evenodd" d="M5.66676 6.2C6.32951 6.2 6.86676 5.66274 6.86676 5C6.86676 4.33726 6.32951 3.8 5.66676 3.8C5.00402 3.8 4.46676 4.33726 4.46676 5C4.46676 5.66274 5.00402 6.2 5.66676 6.2ZM5.66676 7C6.77133 7 7.66676 6.10457 7.66676 5C7.66676 3.89543 6.77133 3 5.66676 3C4.56219 3 3.66676 3.89543 3.66676 5C3.66676 6.10457 4.56219 7 5.66676 7Z" fill="#898989"/>'
+ '<path fill-rule="evenodd" clip-rule="evenodd" d="M1.3335 11.8667C1.3335 9.62074 3.1542 7.80003 5.40016 7.80003H5.93349C8.17945 7.80003 10.0002 9.62074 10.0002 11.8667V12.6C10.0002 12.8209 9.82108 13 9.60016 13C9.37925 13 9.20016 12.8209 9.20016 12.6V11.8667C9.20016 10.0626 7.73762 8.60003 5.93349 8.60003H5.40016C3.59603 8.60003 2.1335 10.0626 2.1335 11.8667V12.6C2.1335 12.8209 1.95441 13 1.7335 13C1.51258 13 1.3335 12.8209 1.3335 12.6V11.8667Z" fill="#898989"/>'
+ '<path fill-rule="evenodd" clip-rule="evenodd" d="M10.6668 6.86667C11.1454 6.86667 11.5334 6.47865 11.5334 6C11.5334 5.52135 11.1454 5.13333 10.6668 5.13333C10.1881 5.13333 9.8001 5.52135 9.8001 6C9.8001 6.47865 10.1881 6.86667 10.6668 6.86667ZM10.6668 7.66667C11.5872 7.66667 12.3334 6.92047 12.3334 6C12.3334 5.07953 11.5872 4.33333 10.6668 4.33333C9.74629 4.33333 9.0001 5.07953 9.0001 6C9.0001 6.92047 9.74629 7.66667 10.6668 7.66667Z" fill="#898989"/>'
+ '<path fill-rule="evenodd" clip-rule="evenodd" d="M9.8667 8.8667C9.8667 8.64578 10.0458 8.4667 10.2667 8.4667H10.9334C12.9953 8.4667 14.6668 10.1382 14.6668 12.2V12.6C14.6668 12.8209 14.4877 13 14.2668 13C14.0459 13 13.8668 12.8209 13.8668 12.6V12.2C13.8668 10.58 12.5535 9.2667 10.9334 9.2667H10.2667C10.0458 9.2667 9.8667 9.08761 9.8667 8.8667Z" fill="#898989"/>'
+ '</svg>';

var iconLock = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.40026 10.9293C8.84761 10.7661 9.16699 10.3368 9.16699 9.83301C9.16699 9.18868 8.64466 8.66634 8.00033 8.66634C7.35599 8.66634 6.83366 9.18868 6.83366 9.83301C6.83366 10.3368 7.15298 10.766 7.60026 10.9293V11.5996C7.60026 11.8205 7.77935 11.9996 8.00026 11.9996C8.22117 11.9996 8.40026 11.8205 8.40026 11.5996V10.9293ZM8.00033 10.1997C8.20283 10.1997 8.36699 10.0355 8.36699 9.83301C8.36699 9.6305 8.20283 9.46634 8.00033 9.46634C7.79782 9.46634 7.63366 9.6305 7.63366 9.83301C7.63366 10.0355 7.79782 10.1997 8.00033 10.1997Z" fill="#2C2C2C"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.00033 1.33301C6.15938 1.33301 4.66699 2.82539 4.66699 4.66634V5.99967C3.56242 5.99967 2.66699 6.8951 2.66699 7.99967V12.6663C2.66699 13.7709 3.56242 14.6663 4.66699 14.6663H11.3337C12.4382 14.6663 13.3337 13.7709 13.3337 12.6663V7.99967C13.3337 6.8951 12.4382 5.99967 11.3337 5.99967L11.3337 4.66634C11.3337 2.82539 9.84127 1.33301 8.00033 1.33301ZM10.5337 5.99967V4.66634C10.5337 3.26722 9.39945 2.13301 8.00033 2.13301C6.6012 2.13301 5.46699 3.26722 5.46699 4.66634V5.99967H10.5337ZM4.66699 6.79967C4.00425 6.79967 3.46699 7.33693 3.46699 7.99967V12.6663C3.46699 13.3291 4.00425 13.8663 4.66699 13.8663H11.3337C11.9964 13.8663 12.5337 13.3291 12.5337 12.6663V7.99967C12.5337 7.33693 11.9964 6.79967 11.3337 6.79967H4.66699Z" fill="#2C2C2C"/>'
+'</svg>';

var iconWarning = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
+ '<path fill-rule="evenodd" clip-rule="evenodd" d="M12 18.75C15.7279 18.75 18.75 15.7279 18.75 12C18.75 8.27208 15.7279 5.25 12 5.25C8.27208 5.25 5.25 8.27208 5.25 12C5.25 15.7279 8.27208 18.75 12 18.75ZM12 19.5C16.1421 19.5 19.5 16.1421 19.5 12C19.5 7.85786 16.1421 4.5 12 4.5C7.85786 4.5 4.5 7.85786 4.5 12C4.5 16.1421 7.85786 19.5 12 19.5Z" fill="#706B6B"/>'
+ '<path d="M11.6175 13.044H12.279L12.405 8.592L12.4365 7.5H11.46L11.4915 8.592L11.6175 13.044ZM11.943 15.501C12.3315 15.501 12.636 15.207 12.636 14.7765C12.636 14.346 12.3315 14.031 11.943 14.031C11.565 14.031 11.25 14.346 11.25 14.7765C11.25 15.207 11.565 15.501 11.943 15.501Z" fill="#706B6B"/>'
+ '</svg>';

var iconPrivate = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39977 10.9298C8.84712 10.7666 9.1665 10.3373 9.1665 9.8335C9.1665 9.18916 8.64417 8.66683 7.99984 8.66683C7.3555 8.66683 6.83317 9.18916 6.83317 9.8335C6.83317 10.3373 7.15249 10.7665 7.59977 10.9298V11.6001C7.59977 11.821 7.77886 12.0001 7.99977 12.0001C8.22069 12.0001 8.39977 11.821 8.39977 11.6001V10.9298ZM7.99984 10.2002C8.20234 10.2002 8.3665 10.036 8.3665 9.8335C8.3665 9.63099 8.20234 9.46683 7.99984 9.46683C7.79733 9.46683 7.63317 9.63099 7.63317 9.8335C7.63317 10.036 7.79733 10.2002 7.99984 10.2002Z" fill="#2C2C2C"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M7.99984 1.3335C6.15889 1.3335 4.6665 2.82588 4.6665 4.66683V6.00016C3.56193 6.00016 2.6665 6.89559 2.6665 8.00016V12.6668C2.6665 13.7714 3.56193 14.6668 4.6665 14.6668H11.3332C12.4377 14.6668 13.3332 13.7714 13.3332 12.6668V8.00016C13.3332 6.89559 12.4377 6.00016 11.3332 6.00016L11.3332 4.66683C11.3332 2.82588 9.84079 1.3335 7.99984 1.3335ZM10.5332 6.00016V4.66683C10.5332 3.26771 9.39896 2.1335 7.99984 2.1335C6.60072 2.1335 5.4665 3.26771 5.4665 4.66683V6.00016H10.5332ZM4.6665 6.80016C4.00376 6.80016 3.4665 7.33742 3.4665 8.00016V12.6668C3.4665 13.3296 4.00376 13.8668 4.6665 13.8668H11.3332C11.9959 13.8668 12.5332 13.3296 12.5332 12.6668V8.00016C12.5332 7.33742 11.9959 6.80016 11.3332 6.80016H4.6665Z" fill="#2C2C2C"/>'
+'</svg>';

var iconVideoMeeting = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M2.8348 5.3335C3.42686 3.03319 5.51499 1.3335 8.00011 1.3335C10.4852 1.3335 12.5734 3.03319 13.1654 5.3335H13.3335C14.0699 5.3335 14.6668 5.93045 14.6668 6.66683V8.66683C14.6668 9.40321 14.0699 10.0002 13.3335 10.0002H13.1654C12.7415 11.6471 11.5508 12.9857 9.99739 13.6135C9.95639 14.2021 9.46589 14.6669 8.86683 14.6669H7.1335C6.50757 14.6669 6.00016 14.1595 6.00016 13.5336C6.00016 12.9076 6.50757 12.4002 7.1335 12.4002H8.86683C9.23308 12.4002 9.55874 12.574 9.76593 12.8435C11.0149 12.3148 11.9771 11.2425 12.3569 9.92391C12.3771 9.93453 12.3979 9.94414 12.4192 9.95268C12.1736 9.85439 12.0002 9.6142 12.0002 9.3335V6.00016C12.0002 5.70617 12.1905 5.45661 12.4546 5.36797C12.4207 5.37934 12.3881 5.39334 12.3569 5.40975C11.8119 3.51759 10.0676 2.1335 8.00011 2.1335C5.93258 2.1335 4.18832 3.51758 3.64334 5.40972C3.85549 5.52128 4.00016 5.74383 4.00016 6.00016V9.3335C4.00016 9.70169 3.70169 10.0002 3.3335 10.0002H2.66683C1.93045 10.0002 1.3335 9.40321 1.3335 8.66683V6.66683C1.3335 5.93045 1.93045 5.3335 2.66683 5.3335H2.8348ZM2.66683 6.1335H3.20016V9.20016H2.66683C2.37228 9.20016 2.1335 8.96138 2.1335 8.66683V6.66683C2.1335 6.37228 2.37228 6.1335 2.66683 6.1335ZM12.8002 6.1335H13.3335C13.628 6.1335 13.8668 6.37228 13.8668 6.66683V8.66683C13.8668 8.96138 13.628 9.20016 13.3335 9.20016H12.8002V6.1335ZM7.1335 13.2002H8.86683C9.05092 13.2002 9.20016 13.3495 9.20016 13.5336C9.20016 13.7177 9.05092 13.8669 8.86683 13.8669H7.1335C6.9494 13.8669 6.80016 13.7177 6.80016 13.5336C6.80016 13.3495 6.9494 13.2002 7.1335 13.2002Z" fill="#2C2C2C"/>'
+'</svg>';

var iconTime = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path d="M7.99985 3.60059C8.22077 3.60059 8.39985 3.77967 8.39985 4.00059L8.39985 7.83497L10.1683 9.60343C10.3245 9.75964 10.3245 10.0129 10.1683 10.1691C10.0121 10.3253 9.75883 10.3253 9.60262 10.1691L7.71701 8.28349C7.67007 8.23656 7.63724 8.18086 7.61851 8.12166C7.60899 8.09167 7.60292 8.06014 7.60075 8.02755C7.6001 8.01793 7.59981 8.00829 7.59985 7.99866" fill="#6B6B6B"/>'
+'<path d="M7.59985 7.99866V4.00059C7.59985 3.77967 7.77894 3.60059 7.99985 3.60059" fill="#6B6B6B"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M7.99992 14.6673C11.6818 14.6673 14.6666 11.6825 14.6666 8.00065C14.6666 4.31875 11.6818 1.33398 7.99992 1.33398C4.31802 1.33398 1.33325 4.31875 1.33325 8.00065C1.33325 11.6825 4.31802 14.6673 7.99992 14.6673ZM7.99992 13.8673C11.24 13.8673 13.8666 11.2407 13.8666 8.00065C13.8666 4.76058 11.24 2.13398 7.99992 2.13398C4.75985 2.13398 2.13325 4.76058 2.13325 8.00065C2.13325 11.2407 4.75985 13.8673 7.99992 13.8673Z" fill="#6B6B6B"/>'
+'</svg>';

var iconNewWindow = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path d="M9.5345 2.0665C9.5345 1.84559 9.71359 1.6665 9.9345 1.6665H12.9345C13.7077 1.6665 14.3345 2.29331 14.3345 3.0665V6.0665C14.3345 6.28742 14.1554 6.4665 13.9345 6.4665C13.7136 6.4665 13.5345 6.28742 13.5345 6.0665V3.0665C13.5345 3.0553 13.5342 3.04416 13.5336 3.0331L7.95075 8.61595C7.79454 8.77216 7.54127 8.77216 7.38506 8.61595C7.22885 8.45974 7.22885 8.20647 7.38506 8.05026L12.9679 2.46742C12.9568 2.46681 12.9457 2.4665 12.9345 2.4665H9.9345C9.71359 2.4665 9.5345 2.28742 9.5345 2.0665Z" fill="#2C2C2C"/>'
+'<path d="M3.66797 3.13317C3.00523 3.13317 2.46797 3.67043 2.46797 4.33317V12.3332C2.46797 12.9959 3.00523 13.5332 3.66797 13.5332H11.668C12.3307 13.5332 12.868 12.9959 12.868 12.3332V8.99977C12.868 8.77886 13.0471 8.59977 13.268 8.59977C13.4889 8.59977 13.668 8.77886 13.668 8.99977V12.3332C13.668 13.4377 12.7725 14.3332 11.668 14.3332H3.66797C2.5634 14.3332 1.66797 13.4377 1.66797 12.3332V4.33317C1.66797 3.2286 2.5634 2.33317 3.66797 2.33317H7.0013C7.22222 2.33317 7.4013 2.51226 7.4013 2.73317C7.4013 2.95408 7.22222 3.13317 7.0013 3.13317H3.66797Z" fill="#2C2C2C"/>'
+'</svg>';

var wSunny = '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path d="M22 16C22 19.3137 19.3137 22 16 22C12.6863 22 10 19.3137 10 16C10 12.6863 12.6863 10 16 10C19.3137 10 22 12.6863 22 16Z" fill="#F3A73F"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M16 21C18.7614 21 21 18.7614 21 16C21 13.2386 18.7614 11 16 11C13.2386 11 11 13.2386 11 16C11 18.7614 13.2386 21 16 21ZM16 22C19.3137 22 22 19.3137 22 16C22 12.6863 19.3137 10 16 10C12.6863 10 10 12.6863 10 16C10 19.3137 12.6863 22 16 22Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M23.5 16C23.5 15.7239 23.7239 15.5 24 15.5H27C27.2761 15.5 27.5 15.7239 27.5 16C27.5 16.2761 27.2761 16.5 27 16.5H24C23.7239 16.5 23.5 16.2761 23.5 16Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 16C4.5 15.7239 4.72386 15.5 5 15.5H8C8.27614 15.5 8.5 15.7239 8.5 16C8.5 16.2761 8.27614 16.5 8 16.5H5C4.72386 16.5 4.5 16.2761 4.5 16Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M16 23.5C16.2761 23.5 16.5 23.7239 16.5 24L16.5 27C16.5 27.2761 16.2761 27.5 16 27.5C15.7239 27.5 15.5 27.2761 15.5 27L15.5 24C15.5 23.7239 15.7239 23.5 16 23.5Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M16 4.5C16.2761 4.5 16.5 4.72386 16.5 5L16.5 8C16.5 8.27614 16.2761 8.5 16 8.5C15.7239 8.5 15.5 8.27614 15.5 8L15.5 5C15.5 4.72386 15.7239 4.5 16 4.5Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M21.6464 21.6465C21.8417 21.4513 22.1583 21.4513 22.3536 21.6465L24.4749 23.7678C24.6701 23.9631 24.6701 24.2797 24.4749 24.4749C24.2796 24.6702 23.963 24.6702 23.7678 24.4749L21.6464 22.3536C21.4512 22.1584 21.4512 21.8418 21.6464 21.6465Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M7.64645 7.64652C7.84171 7.45126 8.15829 7.45126 8.35355 7.64652L10.4749 9.76784C10.6701 9.9631 10.6701 10.2797 10.4749 10.4749C10.2796 10.6702 9.96303 10.6702 9.76777 10.4749L7.64645 8.35363C7.45118 8.15837 7.45118 7.84178 7.64645 7.64652Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M21.6465 10.3536C21.4513 10.1583 21.4513 9.84171 21.6465 9.64645L23.7678 7.52513C23.9631 7.32986 24.2797 7.32986 24.4749 7.52513C24.6702 7.72039 24.6702 8.03697 24.4749 8.23223L22.3536 10.3536C22.1584 10.5488 21.8418 10.5488 21.6465 10.3536Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M7.64652 24.3536C7.45126 24.1583 7.45126 23.8417 7.64652 23.6464L9.76784 21.5251C9.9631 21.3299 10.2797 21.3299 10.4749 21.5251C10.6702 21.7204 10.6702 22.037 10.4749 22.2322L8.35363 24.3536C8.15837 24.5488 7.84178 24.5488 7.64652 24.3536Z" fill="#D69133"/>'
 +'</svg>';
 
 var wPartlyCloudy = '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M19.4998 19C21.9851 19 23.9999 16.7614 23.9999 14C23.9999 11.2386 21.9851 9 19.4998 9C17.3219 9 15.5053 10.7192 15.0894 13.0028C15.1426 13.0009 15.1961 13 15.2498 13C17.5971 13 19.4998 14.7909 19.4998 17C19.4998 17.7136 19.3013 18.3835 18.9534 18.9635C19.1325 18.9876 19.3149 19 19.4998 19Z" fill="#F3A73F"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M19.3076 9.5C17.6034 9.5 16.1163 10.5963 15.4633 12.2016C15.3592 12.4574 15.0675 12.5803 14.8117 12.4763C14.5559 12.3722 14.4329 12.0805 14.537 11.8247C15.3265 9.88411 17.1537 8.5 19.3076 8.5C22.2048 8.5 24.5001 10.9928 24.5001 14C24.5001 17.0072 22.2048 19.5 19.3076 19.5C19.0314 19.5 18.8076 19.2761 18.8076 19C18.8076 18.7239 19.0314 18.5 19.3076 18.5C21.5936 18.5 23.5001 16.5156 23.5001 14C23.5001 11.4844 21.5936 9.5 19.3076 9.5Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M25.8887 14.5752C25.8887 14.2991 26.1125 14.0752 26.3887 14.0752H28.3887C28.6648 14.0752 28.8887 14.2991 28.8887 14.5752C28.8887 14.8513 28.6648 15.0752 28.3887 15.0752H26.3887C26.1125 15.0752 25.8887 14.8513 25.8887 14.5752Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M19.4248 4.5C19.7009 4.5 19.9248 4.72386 19.9248 5L19.9248 7C19.9248 7.27614 19.7009 7.5 19.4248 7.5C19.1487 7.5 18.9248 7.27614 18.9248 7L18.9248 5C18.9248 4.72386 19.1487 4.5 19.4248 4.5Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M24.2939 19.4449C24.4892 19.2496 24.8058 19.2496 25.001 19.4449L26.4152 20.8591C26.6105 21.0543 26.6105 21.3709 26.4152 21.5662C26.22 21.7614 25.9034 21.7614 25.7081 21.5662L24.2939 20.152C24.0986 19.9567 24.0986 19.6401 24.2939 19.4449Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M12.1074 7.25785C12.3026 7.06259 12.6192 7.06259 12.8145 7.25785L14.2287 8.67206C14.424 8.86733 14.424 9.18391 14.2287 9.37917C14.0334 9.57443 13.7169 9.57443 13.5216 9.37917L12.1074 7.96496C11.9121 7.76969 11.9121 7.45311 12.1074 7.25785Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M24.2945 9.70609C24.0992 9.51083 24.0992 9.19425 24.2945 8.99899L25.7087 7.58477C25.9039 7.38951 26.2205 7.38951 26.4158 7.58477C26.6111 7.78003 26.6111 8.09662 26.4158 8.29188L25.0016 9.70609C24.8063 9.90135 24.4897 9.90135 24.2945 9.70609Z" fill="#D69133"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M9.02242 17C9.27504 14.1967 11.631 12 14.5 12C17.5376 12 20 14.4624 20 17.5C20 18.1009 19.9036 18.6793 19.7255 19.2206C21.0541 19.7173 22 20.9982 22 22.5C22 24.433 20.433 26 18.5 26C18.3899 26 18.2811 25.9949 18.1736 25.985C18.1172 25.9949 18.0592 26 18 26H9C8.94566 26 8.89233 25.9957 8.84034 25.9873C8.72799 25.9957 8.61449 26 8.5 26C6.01472 26 4 23.9853 4 21.5C4 19.0147 6.01472 17 8.5 17C8.61449 17 8.72799 17.0043 8.84034 17.0127C8.89233 17.0043 8.94566 17 9 17H9.02242Z" fill="#CBE9F0"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M9.93636 18H9C8.99926 18 8.99886 18 8.99875 18.0001L8.88285 18.0186L8.76577 18.0099C8.67821 18.0033 8.58959 18 8.5 18C6.567 18 5 19.567 5 21.5C5 23.433 6.567 25 8.5 25C8.58959 25 8.67821 24.9967 8.76577 24.9901L8.88285 24.9814L8.99875 24.9999C8.99885 25 8.99925 25 9 25H18C18.0007 25 18.0011 25 18.0012 25L18.1327 24.9769L18.2657 24.9892C18.3426 24.9963 18.4207 25 18.5 25C19.8807 25 21 23.8807 21 22.5C21 21.4288 20.3259 20.5126 19.3753 20.1572L18.4753 19.8207L18.7756 18.908C18.921 18.4663 19 17.9934 19 17.5C19 15.0147 16.9853 13 14.5 13C12.1532 13 10.225 14.7972 10.0184 17.0898L9.93636 18ZM19.7255 19.2206C19.9036 18.6793 20 18.1009 20 17.5C20 14.4624 17.5376 12 14.5 12C11.631 12 9.27504 14.1967 9.02242 17H9C8.94566 17 8.89233 17.0043 8.84034 17.0127C8.72799 17.0043 8.61449 17 8.5 17C6.01472 17 4 19.0147 4 21.5C4 23.9853 6.01472 26 8.5 26C8.61449 26 8.72799 25.9957 8.84034 25.9873C8.89233 25.9957 8.94566 26 9 26H18C18.0592 26 18.1172 25.9949 18.1736 25.985C18.2811 25.9949 18.3899 26 18.5 26C20.433 26 22 24.433 22 22.5C22 20.9982 21.0541 19.7173 19.7255 19.2206Z" fill="#66C4DA"/>'
 +'</svg>';
 
 var wCloudy = '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.4574 13.4286C10.7822 9.82439 13.8113 7 17.5 7C21.4054 7 24.5714 10.166 24.5714 14.0714C24.5714 14.844 24.4475 15.5877 24.2185 16.2836C25.9267 16.9222 27.1429 18.5691 27.1429 20.5C27.1429 22.9853 25.1281 25 22.6429 25C22.5613 25 22.4803 24.9978 22.3999 24.9936C22.3624 24.9978 22.3243 25 22.2857 25H10.1429C10.1075 25 10.0726 24.9982 10.0382 24.9946C9.95449 24.9982 9.87031 25 9.78571 25C6.59035 25 4 22.4096 4 19.2143C4 16.0189 6.59035 13.4286 9.78571 13.4286C9.87031 13.4286 9.95449 13.4304 10.0382 13.434C10.0726 13.4304 10.1075 13.4286 10.1429 13.4286H10.4574Z" fill="#EFEFF0"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M11.3713 14.4286H10.1429L10.1416 14.4286L10.0686 14.4362L9.9953 14.4331C9.92587 14.4301 9.856 14.4286 9.78571 14.4286C7.14264 14.4286 5 16.5712 5 19.2143C5 21.8574 7.14264 24 9.78571 24C9.856 24 9.92587 23.9985 9.9953 23.9955L10.0686 23.9924L10.1416 24L10.1429 24H22.2857L22.287 24L22.3698 23.9905L22.453 23.995C22.5158 23.9983 22.5791 24 22.6429 24C24.5759 24 26.1429 22.433 26.1429 20.5C26.1429 18.9997 25.1985 17.7175 23.8683 17.2203L22.9683 16.8838L23.2686 15.971C23.4649 15.3747 23.5714 14.7365 23.5714 14.0714C23.5714 10.7183 20.8532 8 17.5 8C14.3334 8 11.7321 10.4249 11.4534 13.5183L11.3713 14.4286ZM24.2185 16.2836C24.4475 15.5877 24.5714 14.844 24.5714 14.0714C24.5714 10.166 21.4054 7 17.5 7C13.8113 7 10.7822 9.82439 10.4574 13.4286H10.1429C10.1075 13.4286 10.0726 13.4304 10.0382 13.434C9.95449 13.4304 9.87031 13.4286 9.78571 13.4286C6.59035 13.4286 4 16.0189 4 19.2143C4 22.4096 6.59035 25 9.78571 25C9.87031 25 9.95449 24.9982 10.0382 24.9946C10.0726 24.9982 10.1075 25 10.1429 25H22.2857C22.3243 25 22.3624 24.9978 22.3999 24.9936C22.4803 24.9978 22.5613 25 22.6429 25C25.1281 25 27.1429 22.9853 27.1429 20.5C27.1429 18.5691 25.9267 16.9222 24.2185 16.2836Z" fill="#8E8A8A"/>'
 +'</svg>';
 
 var wRainy = '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.4574 10.4286C10.7822 6.82439 13.8113 4 17.5 4C21.4054 4 24.5714 7.16599 24.5714 11.0714C24.5714 11.844 24.4475 12.5877 24.2185 13.2836C25.9267 13.9222 27.1429 15.5691 27.1429 17.5C27.1429 19.9853 25.1281 22 22.6429 22C22.5613 22 22.4803 21.9978 22.3999 21.9936C22.3624 21.9978 22.3243 22 22.2857 22H10.1429C10.1075 22 10.0726 21.9982 10.0382 21.9946C9.95449 21.9982 9.87031 22 9.78571 22C6.59035 22 4 19.4096 4 16.2143C4 13.0189 6.59035 10.4286 9.78571 10.4286C9.87031 10.4286 9.95449 10.4304 10.0382 10.434C10.0726 10.4304 10.1075 10.4286 10.1429 10.4286H10.4574Z" fill="#EFEFF0"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M9.19276 23.7649C8.98922 23.679 8.91376 23.4543 9.02422 23.263L11.8193 18.4217C11.9298 18.2304 12.1843 18.1449 12.3878 18.2308C12.5914 18.3167 12.6668 18.5414 12.5564 18.7327L9.7613 23.5739C9.65085 23.7653 9.3963 23.8507 9.19276 23.7649Z" fill="#333333"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M16.0505 25.6766C15.8592 25.5661 15.7936 25.3215 15.9041 25.1302L18.4041 20.8C18.5146 20.6087 18.7592 20.5432 18.9505 20.6536C19.1418 20.7641 19.2074 21.0087 19.0969 21.2L16.5969 25.5302C16.4865 25.7215 16.2418 25.787 16.0505 25.6766Z" fill="#333333"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M13.4716 22.6487C13.268 22.5628 13.1926 22.3381 13.303 22.1468L16.803 16.0846C16.9135 15.8933 17.168 15.8078 17.3716 15.8937C17.5751 15.9795 17.6506 16.2042 17.5401 16.3956L14.0401 22.4577C13.9297 22.649 13.6751 22.7345 13.4716 22.6487Z" fill="#333333"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.1429 11.4286H11.3713L11.4534 10.5183C11.7321 7.42488 14.3334 5 17.5 5C20.8532 5 23.5714 7.71827 23.5714 11.0714C23.5714 11.7365 23.4649 12.3747 23.2686 12.971L22.9683 13.8838L23.8683 14.2203C25.1985 14.7175 26.1429 15.9997 26.1429 17.5C26.1429 19.433 24.5759 21 22.6429 21C22.5791 21 22.5158 20.9983 22.453 20.995L22.3698 20.9905L22.287 21L22.2857 21H21V22H22.2857C22.3243 22 22.3624 21.9978 22.3999 21.9936C22.4803 21.9978 22.5613 22 22.6429 22C25.1281 22 27.1429 19.9853 27.1429 17.5C27.1429 15.5691 25.9267 13.9222 24.2185 13.2836C24.4475 12.5877 24.5714 11.844 24.5714 11.0714C24.5714 7.16599 21.4054 4 17.5 4C13.8113 4 10.7822 6.82439 10.4574 10.4286H10.1429C10.1075 10.4286 10.0726 10.4304 10.0382 10.434C9.95449 10.4304 9.87031 10.4286 9.78571 10.4286C6.59035 10.4286 4 13.0189 4 16.2143C4 18.7865 5.67853 20.9667 8 21.7192V20.6557C6.24141 19.948 5 18.2261 5 16.2143C5 13.5712 7.14264 11.4286 9.78571 11.4286C9.856 11.4286 9.92587 11.4301 9.9953 11.4331L10.0686 11.4362L10.1416 11.4286L10.1429 11.4286Z" fill="#333333"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M9.19276 23.7649C8.98922 23.679 8.91376 23.4543 9.02422 23.263L11.8193 18.4217C11.9298 18.2304 12.1843 18.1449 12.3878 18.2308C12.5914 18.3167 12.6668 18.5414 12.5564 18.7327L9.7613 23.5739C9.65085 23.7653 9.3963 23.8507 9.19276 23.7649Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M16.0505 25.6766C15.8592 25.5661 15.7936 25.3215 15.9041 25.1302L18.4041 20.8C18.5146 20.6087 18.7592 20.5432 18.9505 20.6536C19.1418 20.7641 19.2074 21.0087 19.0969 21.2L16.5969 25.5302C16.4865 25.7215 16.2418 25.787 16.0505 25.6766Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M13.4716 22.6487C13.268 22.5628 13.1926 22.3381 13.303 22.1468L16.803 16.0846C16.9135 15.8933 17.168 15.8078 17.3716 15.8937C17.5751 15.9795 17.6506 16.2042 17.5401 16.3956L14.0401 22.4577C13.9297 22.649 13.6751 22.7345 13.4716 22.6487Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.1429 11.4286H11.3713L11.4534 10.5183C11.7321 7.42488 14.3334 5 17.5 5C20.8532 5 23.5714 7.71827 23.5714 11.0714C23.5714 11.7365 23.4649 12.3747 23.2686 12.971L22.9683 13.8838L23.8683 14.2203C25.1985 14.7175 26.1429 15.9997 26.1429 17.5C26.1429 19.433 24.5759 21 22.6429 21C22.5791 21 22.5158 20.9983 22.453 20.995L22.3698 20.9905L22.287 21L22.2857 21H21V22H22.2857C22.3243 22 22.3624 21.9978 22.3999 21.9936C22.4803 21.9978 22.5613 22 22.6429 22C25.1281 22 27.1429 19.9853 27.1429 17.5C27.1429 15.5691 25.9267 13.9222 24.2185 13.2836C24.4475 12.5877 24.5714 11.844 24.5714 11.0714C24.5714 7.16599 21.4054 4 17.5 4C13.8113 4 10.7822 6.82439 10.4574 10.4286H10.1429C10.1075 10.4286 10.0726 10.4304 10.0382 10.434C9.95449 10.4304 9.87031 10.4286 9.78571 10.4286C6.59035 10.4286 4 13.0189 4 16.2143C4 18.7865 5.67853 20.9667 8 21.7192V20.6557C6.24141 19.948 5 18.2261 5 16.2143C5 13.5712 7.14264 11.4286 9.78571 11.4286C9.856 11.4286 9.92587 11.4301 9.9953 11.4331L10.0686 11.4362L10.1416 11.4286L10.1429 11.4286Z" fill="#8E8A8A"/>'
 +'</svg>';
 
 var wSnowy = '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.4574 10.4286C10.7822 6.82439 13.8113 4 17.5 4C21.4054 4 24.5714 7.16599 24.5714 11.0714C24.5714 11.844 24.4475 12.5877 24.2185 13.2836C25.9267 13.9222 27.1429 15.5691 27.1429 17.5C27.1429 19.9853 25.1281 22 22.6429 22C22.5613 22 22.4803 21.9978 22.3999 21.9936C22.3624 21.9978 22.3243 22 22.2857 22H10.1429C10.1075 22 10.0726 21.9982 10.0382 21.9946C9.95449 21.9982 9.87031 22 9.78571 22C6.59035 22 4 19.4096 4 16.2143C4 13.0189 6.59035 10.4286 9.78571 10.4286C9.87031 10.4286 9.95449 10.4304 10.0382 10.434C10.0726 10.4304 10.1075 10.4286 10.1429 10.4286H10.4574Z" fill="#EFEFF0"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M7.57393 15.7136C7.68438 15.5223 7.92902 15.4567 8.12034 15.5672L12.2691 17.9625C12.4605 18.073 12.526 18.3176 12.4156 18.5089C12.3051 18.7002 12.0605 18.7658 11.8691 18.6553L7.72034 16.26C7.52902 16.1496 7.46347 15.9049 7.57393 15.7136Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M9.99453 14.3164C10.2154 14.3164 10.3945 14.4955 10.3945 14.7164L10.3945 19.507C10.3945 19.7279 10.2154 19.907 9.99453 19.907C9.77362 19.907 9.59453 19.7279 9.59453 19.507L9.59453 14.7164C9.59453 14.4955 9.77362 14.3164 9.99453 14.3164Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M7.57354 18.509C7.46308 18.3177 7.52863 18.0731 7.71995 17.9626L11.8688 15.5673C12.0601 15.4568 12.3047 15.5224 12.4152 15.7137C12.5256 15.905 12.4601 16.1496 12.2688 16.2601L8.11995 18.6554C7.92863 18.7659 7.68399 18.7003 7.57354 18.509Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M14.5739 18.7136C14.6844 18.5223 14.929 18.4567 15.1203 18.5672L19.2691 20.9625C19.4605 21.073 19.526 21.3176 19.4156 21.5089C19.3051 21.7002 19.0605 21.7658 18.8691 21.6553L14.7203 19.26C14.529 19.1496 14.4635 18.9049 14.5739 18.7136Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M16.9945 17.3164C17.2154 17.3164 17.3945 17.4955 17.3945 17.7164L17.3945 22.507C17.3945 22.7279 17.2154 22.907 16.9945 22.907C16.7736 22.907 16.5945 22.7279 16.5945 22.507L16.5945 17.7164C16.5945 17.4955 16.7736 17.3164 16.9945 17.3164Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M14.5735 21.509C14.4631 21.3177 14.5286 21.0731 14.7199 20.9626L18.8688 18.5673C19.0601 18.4568 19.3047 18.5224 19.4152 18.7137C19.5256 18.905 19.4601 19.1496 19.2688 19.2601L15.1199 21.6554C14.9286 21.7659 14.684 21.7003 14.5735 21.509Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.61055 22.7912C8.721 22.5999 8.96564 22.5344 9.15696 22.6448L13.4748 25.1377C13.6661 25.2482 13.7316 25.4928 13.6212 25.6841C13.5107 25.8754 13.2661 25.941 13.0748 25.8305L8.75696 23.3376C8.56564 23.2272 8.50009 22.9826 8.61055 22.7912Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M11.1156 21.3452C11.3365 21.3452 11.5156 21.5243 11.5156 21.7452L11.5156 26.731C11.5156 26.9519 11.3365 27.131 11.1156 27.131C10.8947 27.131 10.7156 26.9519 10.7156 26.731L10.7156 21.7452C10.7156 21.5243 10.8947 21.3452 11.1156 21.3452Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.61064 25.6843C8.50019 25.493 8.56574 25.2483 8.75705 25.1379L13.0749 22.645C13.2662 22.5346 13.5108 22.6001 13.6213 22.7914C13.7317 22.9827 13.6662 23.2274 13.4749 23.3378L9.15705 25.8307C8.96574 25.9412 8.7211 25.8756 8.61064 25.6843Z" fill="#4EAFC5"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.1429 11.4286H11.3713L11.4534 10.5183C11.7321 7.42488 14.3334 5 17.5 5C20.8532 5 23.5714 7.71827 23.5714 11.0714C23.5714 11.7365 23.4649 12.3747 23.2686 12.971L22.9683 13.8838L23.8683 14.2203C25.1985 14.7175 26.1429 15.9997 26.1429 17.5C26.1429 19.433 24.5759 21 22.6429 21C22.5791 21 22.5158 20.9983 22.453 20.995L22.3698 20.9905L22.287 21L22.2857 21H21V22H22.2857C22.3243 22 22.3624 21.9978 22.3999 21.9936C22.4803 21.9978 22.5613 22 22.6429 22C25.1281 22 27.1429 19.9853 27.1429 17.5C27.1429 15.5691 25.9267 13.9222 24.2185 13.2836C24.4475 12.5877 24.5714 11.844 24.5714 11.0714C24.5714 7.16599 21.4054 4 17.5 4C13.8113 4 10.7822 6.82439 10.4574 10.4286H10.1429C10.1075 10.4286 10.0726 10.4304 10.0382 10.434C9.95449 10.4304 9.87031 10.4286 9.78571 10.4286C6.59035 10.4286 4 13.0189 4 16.2143C4 18.7865 5.67853 20.9667 8 21.7192V20.6557C6.24141 19.948 5 18.2261 5 16.2143C5 13.5712 7.14264 11.4286 9.78571 11.4286C9.856 11.4286 9.92587 11.4301 9.9953 11.4331L10.0686 11.4362L10.1416 11.4286L10.1429 11.4286Z" fill="#8E8A8A"/>'
 +'</svg>';
 
 var wThunder = '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.4574 10.4286C10.7822 6.82439 13.8113 4 17.5 4C21.4054 4 24.5714 7.16599 24.5714 11.0714C24.5714 11.844 24.4475 12.5877 24.2185 13.2836C25.9267 13.9222 27.1429 15.5691 27.1429 17.5C27.1429 19.9853 25.1281 22 22.6429 22C22.5613 22 22.4803 21.9978 22.3999 21.9936C22.3624 21.9978 22.3243 22 22.2857 22H10.1429C10.1075 22 10.0726 21.9982 10.0382 21.9946C9.95449 21.9982 9.87031 22 9.78571 22C6.59035 22 4 19.4096 4 16.2143C4 13.0189 6.59035 10.4286 9.78571 10.4286C9.87031 10.4286 9.95449 10.4304 10.0382 10.434C10.0726 10.4304 10.1075 10.4286 10.1429 10.4286H10.4574Z" fill="#EFEFF0"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.1429 11.4286H11.3713L11.4534 10.5183C11.7321 7.42488 14.3334 5 17.5 5C20.8532 5 23.5714 7.71827 23.5714 11.0714C23.5714 11.7365 23.4649 12.3747 23.2686 12.971L22.9683 13.8838L23.8683 14.2203C25.1985 14.7175 26.1429 15.9997 26.1429 17.5C26.1429 19.433 24.5759 21 22.6429 21C22.5791 21 22.5158 20.9983 22.453 20.995L22.3698 20.9905L22.287 21L22.2857 21H21V22H22.2857C22.3243 22 22.3624 21.9978 22.3999 21.9936C22.4803 21.9978 22.5613 22 22.6429 22C25.1281 22 27.1429 19.9853 27.1429 17.5C27.1429 15.5691 25.9267 13.9222 24.2185 13.2836C24.4475 12.5877 24.5714 11.844 24.5714 11.0714C24.5714 7.16599 21.4054 4 17.5 4C13.8113 4 10.7822 6.82439 10.4574 10.4286H10.1429C10.1075 10.4286 10.0726 10.4304 10.0382 10.434C9.95449 10.4304 9.87031 10.4286 9.78571 10.4286C6.59035 10.4286 4 13.0189 4 16.2143C4 18.7865 5.67853 20.9667 8 21.7192V20.6557C6.24141 19.948 5 18.2261 5 16.2143C5 13.5712 7.14264 11.4286 9.78571 11.4286C9.856 11.4286 9.92587 11.4301 9.9953 11.4331L10.0686 11.4362L10.1416 11.4286L10.1429 11.4286Z" fill="#8E8A8A"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M16.7804 14.2068C16.7866 14.0115 16.5378 13.9241 16.4205 14.0804L10.9206 21.4137C10.8711 21.4796 10.9182 21.5737 11.0006 21.5737H12.9915L12.8207 26.9406C12.8145 27.136 13.0633 27.2234 13.1806 27.067L18.6806 19.7337C18.73 19.6678 18.683 19.5737 18.6006 19.5737H16.6097L16.7804 14.2068Z" fill="#F3A73F"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M14.0238 20.5737L13.9008 24.4401L16.8006 20.5737H15.5773L15.7004 16.7073L12.8006 20.5737H14.0238ZM11.0006 21.5737C10.9182 21.5737 10.8711 21.4796 10.9206 21.4137L16.4205 14.0804C16.5378 13.9241 16.7866 14.0115 16.7804 14.2068L16.6097 19.5737H18.6006C18.683 19.5737 18.73 19.6678 18.6806 19.7337L13.1806 27.067C13.0633 27.2234 12.8145 27.136 12.8207 26.9406L12.9915 21.5737H11.0006Z" fill="#D69133"/>'
 +'</svg>';

 var iconPlace = '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
 + '<path d="M10.0363 17.4746C6.97005 12.7458 10.3641 6.5 16 6.5C21.6359 6.5 25.0299 12.7458 21.9637 17.4747L17.1733 24.8624C16.9155 25.26 16.4739 25.5 16 25.5C15.5261 25.5 15.0845 25.26 14.8267 24.8624L10.0363 17.4746Z" stroke="#333333"/>'
 + '<circle cx="16" cy="14" r="2.5" stroke="#333333"/>'
 + '</svg>';

var iconPlaceSmall = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.3332 6.66683C10.3332 7.95549 9.2885 9.00016 7.99984 9.00016C6.71117 9.00016 5.6665 7.95549 5.6665 6.66683C5.6665 5.37817 6.71117 4.3335 7.99984 4.3335C9.2885 4.3335 10.3332 5.37817 10.3332 6.66683ZM9.53317 6.66683C9.53317 7.51367 8.84667 8.20016 7.99984 8.20016C7.153 8.20016 6.4665 7.51367 6.4665 6.66683C6.4665 5.81999 7.153 5.1335 7.99984 5.1335C8.84667 5.1335 9.53317 5.81999 9.53317 6.66683Z" fill="#898989"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M11.7711 10.6668C11.1657 11.5683 9.65497 13.3353 8.73989 14.3853C8.3472 14.8359 7.65247 14.8359 7.25979 14.3853C6.3447 13.3353 4.83401 11.5683 4.2286 10.6668C3.33317 9.3335 2.66651 8.03175 2.6665 6.66684C2.6665 5.30192 3.1872 3.93699 4.2286 2.89559C6.3114 0.812797 9.68828 0.812797 11.7711 2.89559C12.8125 3.93699 13.3332 5.30192 13.3332 6.66684C13.3332 8.03175 12.6665 9.3335 11.7711 10.6668ZM4.79429 3.46128C6.56466 1.6909 9.43501 1.6909 11.2054 3.46128C12.0907 4.34663 12.5332 5.50541 12.5332 6.66684C12.5332 7.77819 11.9879 8.90901 11.1069 10.2208C10.5358 11.0712 9.06402 12.7957 8.13678 13.8597C8.06294 13.9445 7.93674 13.9445 7.8629 13.8597C6.93566 12.7957 5.46383 11.0712 4.89273 10.2208C4.01175 8.90901 3.46651 7.77819 3.4665 6.66684C3.4665 5.50541 3.90894 4.34663 4.79429 3.46128Z" fill="#898989"/>'
+'</svg>';

 var iconPopupClose = '<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
 + '<path d="M5.74478 4.75483C5.47141 4.48146 5.0282 4.48146 4.75483 4.75483C4.48146 5.0282 4.48146 5.47141 4.75483 5.74478L13.01 13.9999L4.75506 22.2548C4.48169 22.5282 4.48169 22.9714 4.75506 23.2448C5.02843 23.5181 5.47164 23.5181 5.74501 23.2448L13.9999 14.9899L22.2548 23.2448C22.5282 23.5181 22.9714 23.5181 23.2448 23.2448C23.5181 22.9714 23.5181 22.5282 23.2448 22.2548L14.9899 13.9999L23.245 5.74478C23.5184 5.47141 23.5184 5.0282 23.245 4.75483C22.9716 4.48146 22.5284 4.48146 22.2551 4.75483L13.9999 13.01L5.74478 4.75483Z" fill="#2C2C2C"/>'
  + '</svg>';

var iconPeople = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M5.66676 6.2C6.32951 6.2 6.86676 5.66274 6.86676 5C6.86676 4.33726 6.32951 3.8 5.66676 3.8C5.00402 3.8 4.46676 4.33726 4.46676 5C4.46676 5.66274 5.00402 6.2 5.66676 6.2ZM5.66676 7C6.77133 7 7.66676 6.10457 7.66676 5C7.66676 3.89543 6.77133 3 5.66676 3C4.56219 3 3.66676 3.89543 3.66676 5C3.66676 6.10457 4.56219 7 5.66676 7Z" fill="#898989"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M1.3335 11.8667C1.3335 9.62074 3.1542 7.80003 5.40016 7.80003H5.93349C8.17945 7.80003 10.0002 9.62074 10.0002 11.8667V12.6C10.0002 12.8209 9.82108 13 9.60016 13C9.37925 13 9.20016 12.8209 9.20016 12.6V11.8667C9.20016 10.0626 7.73762 8.60003 5.93349 8.60003H5.40016C3.59603 8.60003 2.1335 10.0626 2.1335 11.8667V12.6C2.1335 12.8209 1.95441 13 1.7335 13C1.51258 13 1.3335 12.8209 1.3335 12.6V11.8667Z" fill="#898989"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.6668 6.86667C11.1454 6.86667 11.5334 6.47865 11.5334 6C11.5334 5.52135 11.1454 5.13333 10.6668 5.13333C10.1881 5.13333 9.8001 5.52135 9.8001 6C9.8001 6.47865 10.1881 6.86667 10.6668 6.86667ZM10.6668 7.66667C11.5872 7.66667 12.3334 6.92047 12.3334 6C12.3334 5.07953 11.5872 4.33333 10.6668 4.33333C9.74629 4.33333 9.0001 5.07953 9.0001 6C9.0001 6.92047 9.74629 7.66667 10.6668 7.66667Z" fill="#898989"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M9.8667 8.8667C9.8667 8.64579 10.0458 8.4667 10.2667 8.4667H10.9334C12.9953 8.4667 14.6668 10.1382 14.6668 12.2V12.6C14.6668 12.8209 14.4877 13 14.2668 13C14.0458 13 13.8668 12.8209 13.8668 12.6V12.2C13.8668 10.58 12.5535 9.2667 10.9334 9.2667H10.2667C10.0458 9.2667 9.8667 9.08761 9.8667 8.8667Z" fill="#898989"/>'
+'</svg>';
 
var iconRate = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path d="M7.99961 5.46536C7.47251 5.46536 7.06628 5.87669 7.06628 6.35849C7.06628 6.5794 6.88719 6.75849 6.66628 6.75849C6.44536 6.75849 6.26628 6.5794 6.26628 6.35849C6.26628 5.41195 7.05395 4.66536 7.99961 4.66536C8.94527 4.66536 9.73294 5.41195 9.73294 6.35849C9.73294 6.96811 9.4036 7.49749 8.91893 7.79409C8.76215 7.89003 8.62378 7.99732 8.52826 8.1102C8.43441 8.22113 8.39961 8.31546 8.39961 8.3987C8.39961 8.61961 8.22052 8.7987 7.99961 8.7987C7.7787 8.7987 7.59961 8.61961 7.59961 8.3987C7.59961 8.06933 7.74411 7.79845 7.91754 7.59347C8.0893 7.39046 8.3062 7.23114 8.50135 7.11172C8.76512 6.95031 8.93294 6.67059 8.93294 6.35849C8.93294 5.87669 8.52671 5.46536 7.99961 5.46536Z" fill="#2C2C2C"/>'
+'<path d="M8.66628 10.332C8.66628 10.7002 8.3678 10.9986 7.99961 10.9986C7.63142 10.9986 7.33294 10.7002 7.33294 10.332C7.33294 9.96378 7.63142 9.6653 7.99961 9.6653C8.3678 9.6653 8.66628 9.96378 8.66628 10.332Z" fill="#2C2C2C"/>'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M14.6663 7.9987C14.6663 11.6806 11.6816 14.6654 7.99967 14.6654C4.31778 14.6654 1.33301 11.6806 1.33301 7.9987C1.33301 4.3168 4.31778 1.33203 7.99967 1.33203C11.6816 1.33203 14.6663 4.3168 14.6663 7.9987ZM13.8663 7.9987C13.8663 11.2388 11.2397 13.8654 7.99967 13.8654C4.7596 13.8654 2.13301 11.2388 2.13301 7.9987C2.13301 4.75863 4.7596 2.13203 7.99967 2.13203C11.2397 2.13203 13.8663 4.75863 13.8663 7.9987Z" fill="#2C2C2C"/>'
+'</svg>';

var iconZero = '<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M18.8337 10.0013C18.8337 14.6037 15.1027 18.3346 10.5003 18.3346C5.89795 18.3346 2.16699 14.6037 2.16699 10.0013C2.16699 5.39893 5.89795 1.66797 10.5003 1.66797C15.1027 1.66797 18.8337 5.39893 18.8337 10.0013ZM8.35421 7.14767C8.15894 6.9524 7.84236 6.9524 7.6471 7.14767C7.45184 7.34293 7.45184 7.65951 7.6471 7.85477L9.79354 10.0012L7.6471 12.1477C7.45184 12.3429 7.45184 12.6595 7.6471 12.8548C7.84236 13.05 8.15894 13.05 8.35421 12.8548L10.5007 10.7083L12.6471 12.8548C12.8424 13.05 13.1589 13.05 13.3542 12.8548C13.5495 12.6595 13.5495 12.3429 13.3542 12.1477L11.2078 10.0012L13.3542 7.85477C13.5495 7.65951 13.5495 7.34293 13.3542 7.14767C13.1589 6.9524 12.8424 6.9524 12.6471 7.14767L10.5007 9.29411L8.35421 7.14767Z" fill="#F94B50"/>'
+'</svg>';

var iconOne = '<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M18.8337 10.0013C18.8337 14.6037 15.1027 18.3346 10.5003 18.3346C5.89795 18.3346 2.16699 14.6037 2.16699 10.0013C2.16699 5.39893 5.89795 1.66797 10.5003 1.66797C15.1027 1.66797 18.8337 5.39893 18.8337 10.0013ZM14.1884 8.68821C14.3837 8.49295 14.3837 8.17636 14.1884 7.9811C13.9932 7.78584 13.6766 7.78584 13.4813 7.9811L9.66813 11.7943L7.52081 9.64771C7.32551 9.45248 7.00893 9.45253 6.8137 9.64783C6.61847 9.84313 6.61853 10.1597 6.81383 10.3549L9.3147 12.8549C9.50998 13.0501 9.82651 13.0501 10.0217 12.8549L14.1884 8.68821Z" fill="#04B395"/>'
+'</svg>';

var iconTwo = '<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M18.8337 10.0013C18.8337 14.6037 15.1027 18.3346 10.5003 18.3346C5.89795 18.3346 2.16699 14.6037 2.16699 10.0013C2.16699 5.39893 5.89795 1.66797 10.5003 1.66797C15.1027 1.66797 18.8337 5.39893 18.8337 10.0013ZM9.33399 7.95104C9.33399 7.34879 9.84178 6.83464 10.5007 6.83464C11.1595 6.83464 11.6673 7.34879 11.6673 7.95104C11.6673 8.34117 11.4575 8.69081 11.1278 8.89258C10.8839 9.04186 10.6128 9.241 10.3981 9.49477C10.1813 9.75099 10.0007 10.0896 10.0007 10.5013C10.0007 10.7774 10.2245 11.0013 10.5007 11.0013C10.7768 11.0013 11.0007 10.7774 11.0007 10.5013C11.0007 10.3973 11.0441 10.2793 11.1615 10.1407C11.2809 9.99957 11.4538 9.86547 11.6498 9.74554C12.2556 9.3748 12.6673 8.71306 12.6673 7.95104C12.6673 6.76786 11.6827 5.83464 10.5007 5.83464C9.31858 5.83464 8.33398 6.76786 8.33398 7.95104C8.33398 8.22718 8.55784 8.45104 8.83398 8.45104C9.11013 8.45104 9.33399 8.22718 9.33399 7.95104ZM10.5007 13.7512C10.9609 13.7512 11.334 13.3781 11.334 12.9179C11.334 12.4577 10.9609 12.0846 10.5007 12.0846C10.0404 12.0846 9.66732 12.4577 9.66732 12.9179C9.66732 13.3781 10.0404 13.7512 10.5007 13.7512Z" fill="#FFAA00"/>'
+'</svg>';

// [퍼블 수정 및 추가] - iconTeam 추가
var iconTeam = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39792 5.29389C9.31181 5.10936 9.99992 4.30178 9.99992 3.3335C9.99992 2.22893 9.10449 1.3335 7.99992 1.3335C6.89535 1.3335 5.99992 2.22893 5.99992 3.3335C5.99992 4.30174 6.68796 5.10928 7.60179 5.29387C7.60051 5.30688 7.59985 5.32008 7.59985 5.33343V7.6001H5.33319C4.0077 7.6001 2.93319 8.67461 2.93319 10.0001V10.6668C2.93319 10.6802 2.93385 10.6934 2.93513 10.7065C2.0213 10.891 1.33325 11.6986 1.33325 12.6668C1.33325 13.7714 2.22868 14.6668 3.33325 14.6668C4.43782 14.6668 5.33325 13.7714 5.33325 12.6668C5.33325 11.6985 4.64514 10.891 3.73124 10.7064C3.73253 10.6934 3.73319 10.6802 3.73319 10.6668V10.0001C3.73319 9.11644 4.44953 8.4001 5.33319 8.4001H10.6665C11.5502 8.4001 12.2665 9.11644 12.2665 10.0001V10.6668C12.2665 10.6802 12.2672 10.6934 12.2685 10.7065C11.3546 10.891 10.6666 11.6986 10.6666 12.6668C10.6666 13.7714 11.562 14.6668 12.6666 14.6668C13.7712 14.6668 14.6666 13.7714 14.6666 12.6668C14.6666 11.6985 13.9785 10.891 13.0646 10.7064C13.0659 10.6934 13.0665 10.6802 13.0665 10.6668V10.0001C13.0665 8.67461 11.992 7.6001 10.6665 7.6001H8.39985L8.39985 5.33343C8.39985 5.32009 8.3992 5.3069 8.39792 5.29389ZM7.99992 4.5335C8.66266 4.5335 9.19992 3.99624 9.19992 3.3335C9.19992 2.67075 8.66266 2.1335 7.99992 2.1335C7.33718 2.1335 6.79992 2.67075 6.79992 3.3335C6.79992 3.99624 7.33718 4.5335 7.99992 4.5335ZM3.33325 13.8668C3.99599 13.8668 4.53325 13.3296 4.53325 12.6668C4.53325 12.0041 3.99599 11.4668 3.33325 11.4668C2.67051 11.4668 2.13325 12.0041 2.13325 12.6668C2.13325 13.3296 2.67051 13.8668 3.33325 13.8668ZM13.8666 12.6668C13.8666 13.3296 13.3293 13.8668 12.6666 13.8668C12.0038 13.8668 11.4666 13.3296 11.4666 12.6668C11.4666 12.0041 12.0038 11.4668 12.6666 11.4668C13.3293 11.4668 13.8666 12.0041 13.8666 12.6668Z" fill="#898989"/>'
+'</svg>';
 
 function selectWeatherIcon2(sky, pty) { //sky : 하늘상태 pty: 강수형태 //하늘상태(SKY) 코드 : 맑음(1), 구름많음(3), 흐림(4) - 강수형태(PTY) 코드 : (단기) 없음(0), 비(1), 비/눈(2), 눈(3), 소나기(4) 
   if(pty != 0 && pty != null) {
      switch (pty) {
         case '1':
            return wRainy;
         case '2' :
            return wRainy;
         case '3' :
            return wSnowy;
         case '4':
            return wRainy;
 
         default:
            return wRainy;
      }
   } else {
      switch(sky) {
         case '1':
         return wSunny;
   
         case '3':
         return wPartlyCloudy;
   
         case '4':
         return wCloudy;
   
         // case 'thunder':?
         // return wThunder;
   
         default:
         return wSunny;
      }
   }
   
 }

 function pm10Select(data) {
  var pm10G = data.pm10Grade;
  var pm10V = data.pm10Value;

  switch(pm10G) {
     case '1' :
        return '<span class="status-green">좋음 ' + pm10V + '</span>';
     case '2' :
        return '<span class="status-green">보통 ' + pm10V + '</span>';

     case '3' :
        return '<span class="status-red">나쁨 ' + pm10V + '</span>';
     
     case '4' :
        return '<span class="status-red">매우나쁨 ' + pm10V + '</span>';

     default :
        return '<span>-</span>';
  }

}

function pm25Select(data) {
  var pm25G = data.pm25Grade;
  var pm25V = data.pm25Value;

  switch(pm25G) {
     case '1' :
        return '<span class="status-green">좋음 ' + pm25V + '</span>';
     case '2' :
        return '<span class="status-green">보통 ' + pm25V + '</span>';

     case '3' :
        return '<span class="status-red">나쁨 ' + pm25V + '</span>';
     
     case '4' :
        return '<span class="status-red">매우나쁨 ' + pm25V + '</span>';

     default :
        return '<span>-</span>';
  }

}

function clearAllConversation() {
  chatui.deleteChatHistory();
  $("#divScroll").empty();
  $('.search-guide').css('display', 'none');
  $('.sendText').val('');
  $('.btn-send').removeClass('active');
}

function appendQueryText(message) {
  var chatMessage = $('<div class="chat-message right">'
  +'<div class="message">' + message + '</div>'
  +'<span class="time-stamp">' + moment().format("a h:mm") + '</span>');
  
  $('#divScroll').append(chatMessage);
}

function appendWelcomeText(message) {
    var chatMessage = '<div class="chat-message left">'
    +'<div class="profile"><img class="img-circle" src="'+imgBaseUrl+'/images/chem-profile.png"></div>'
    +'<div class="message caas-chat-response-message-back-color caas-chat-response-message-font-color"><div class="basic"><div class="message-content" style="white-space: pre-line">'
    +message
    +'</div></div></div>'
    +'<span class="message-date">' + moment().format("a h:mm") + '</span>'
    +'</div>';
    $('#divScroll').append(chatMessage);
    descendScroll();
}

function appendChatbotText(message) {
  var chatMessage = '<div class="chat-message left">'
  +'<div class="profile"><img class="img-circle" src="'+imgBaseUrl+'/images/chem-profile.png"></div>'
  + message
  +'<span class="message-date">' + moment().format("a h:mm") + '</span>';

  $('#divScroll').append(chatMessage);
  descendScroll();
}

function appendChatbotText2(message, customQuick) {
  var chatMessage = $('<div class="chat-message left"></div>');
  var profile = $('<div class="profile"><img class="img-circle" src="'+imgBaseUrl+'/images/chem-profile.png"></div>');
  chatMessage.append(profile);
  chatMessage.append(message);
  chatMessage.append(customQuick);
  var date = $('<span class="message-date">' + moment().format("a h:mm") + '</span>');
  chatMessage.append(date);

  $('#divScroll').append(chatMessage);
  
  descendScroll();
  setTimeout(function() {
    $('.btn-system').on('click', function() {
      var systemSelect = $(this).data('system');
  
      appendQueryText(systemSelect);
      var item = systemItems.find((o) => { return o["sysName"] === systemSelect })      
      
      var systemCardTop = makeSystemCardMoveCard(item); // [퍼블 수정 및 추가] - 시스템 접속 card 추가
      
      var systemCard = makeSystemCard(item);
      var customQuick = $('<div class="custom-quick-reply"></div>');
      systemItems.map(sysItem => {
        if(systemSelect != sysItem.sysName) {
          var sysbtn2 = $('<span class="btn-custom-reply btn-system" data-system="' + sysItem.sysName + '">' + sysItem.sysName +'</span>'); 
          customQuick.append(sysbtn2);
        }
      });

      $(this).parent().remove();

       appendChatbotText2(systemCard, customQuick);
    });
  
  }, 100);
  
}

// tempImage
var pAlternative = imgBaseUrl+'/images/tmp-profile.png';

function noImage(img) {
  img.onerror = null

  let url = new URL(imgBaseUrl+"/images/tmp.png");
  url.searchParams.set('reload', 'true')
  img.src = url.toString();
} 

function sendChatApi(requestParam, sessionId_notused, callback) {
	console.log("sendChatApi ::" + JSON.stringify(requestParam));
	
	chatui.getSetting("languageCode") && (requestParam.query.languageCode = chatui.getSetting("languageCode"));
	chatui.getSetting("userId") && (requestParam.userId = chatui.getSetting("userId"));

    if (chatui.getSetting("userId")) {
        if (!requestParam.tags) {
            requestParam.tags = {};
        }

        requestParam.tags.userId = chatui.getSetting("userId");
    }

    var sessionId = chatui.getSessionId();
    
    var reqHeader = {};
    reqHeader["Content-Type"] = "application/json",
    reqHeader.Authorization = "Bearer " + chatui.getSetting("apiToken"),
    sessionId && (reqHeader["X-CHATBOT-SESSION"] = sessionId);
    
	$.ajax({
	    type: 'POST'
	  , url: chatui.getSetting("chatApiUrl") + "/gateway"
	  , headers: reqHeader
	  , dataType: 'json'
	  , contentType: "application/json"
	  , data: JSON.stringify(requestParam)
	  , success: function(payload, textStatus, jqXHR) {
            var sessionIdNew = jqXHR.getResponseHeader("X-CHATBOT-SESSION");
            if (sessionIdNew && sessionIdNew != sessionId) {
                chatui.setSessionId(sessionIdNew);
            }

			if (callback) {
				callback(payload);
			}
    }
	});
}

function showSmallDialog(msg) {
  $('.test-panel').append('<div class="small-dialog"></div>');
  $('.small-dialog').text(msg);
  $('.small-dialog').addClass('show');
  setTimeout(function() {
    $('.small-dialog').removeClass('show');
  }, 2000);

  setTimeout(function() {
    $('.small-dialog').remove();
  }, 5000);
}

// 리스트 카드 아이템 클릭 시 Intent Event 호출 함수
function intentEvent(btn,type,param){
	console.log("intentEvent :: " + param);
	
	switch(type){
	
		// 임직원 조회 동명이인
		case "employee" :{
			
			chatui.sendEventMessage(employeeQueryEvent, {"targetId" : param });
			break;
		} 
		
		// 일정 조회 동명이인
		case "schedule" :{
			
			// var loginUserId = $(btn).closest(".profile-list").attr("data-loginUserId");
			var date = $(btn).closest(".profile-list").attr("data-date");
			var krname = $(btn).closest(".profile-list").attr("data-krname");
			chatui.sendEventMessage("scheduleQueryEvent", {"targetId" : param , "date" : date, "krname":krname});
			break;
		}
		
		
		case 'group' :{
			chatui.sendEventMessage(groupQueryEvent, {"targetId" : param });
			break;
		}
		
		// 임직원 카드 메일 발송
		case 'email' :{
      chatui.sendEventMessage(employeeEmailQueryEvent, {"Uid" : param });
      break;
		}
		
	    // mrc 기술문서 질문
		case "mrc" : {
		  //  chatui.sendEventMessage("mrcTechQeuryEvent", {"userId" : param });
		    chatui.sendEventMessage("mrcNoTextboxQuery", {"userId" : param });
		    break;
		}
		
		// RPA 프로세스 선택
		case "rpa" : {
		    var loginUserId = $(btn).closest(".dp-list-wrap").attr("data-userId");
		    var data_param = $(btn).closest(".dp-list-wrap>ul>li").attr("data-param");
		    chatui.sendEventMessage("rpaProcessSelect", {"process_id" : param, "userId" : loginUserId, "data_param" : data_param });
		    break;
		}

		// RPA 프로세스 실행
		case "processStart" : {
		    var loginUserId = $(btn).closest(".dp-list-wrap").attr("data-userId");
		    var dataParam = $(btn).closest(".dp-list-wrap").attr("data-param");
		    if(dataParam!=='') {
		        chatui.sendEventMessage("rpaProcessParamSending", {"process_id" : param, "userId" : loginUserId, "data_param" : dataParam });
		        break;
		    } else {
    		    pop.open('create', $(this), 'Pop_process_confirm', 'loadEl.pop_process_confirm("프로세스 실행","대상 프로세스를 실행 하시겠습니까?")');
    		    $("#btnConfirm").click(function(){
    		        chatui.sendEventMessage("rpaProcessStart", {"process_id" : param, "userId" : loginUserId,  "data_param" : dataParam  });
    		        pop.close($('#btnConfirm'));
    		    });
    		    break;
		    }
		}
		
		// RPA 프로세스 실행이력 조회
		case "processHistory" : {
		    var loginUserId = $(btn).closest(".dp-list-wrap").attr("data-userId");
		    chatui.sendEventMessage("rpaProcessHistory", {"process_id" : param, "userId" : loginUserId });
		    break;
		}
		
		case "rpaKill" : {
		    var loginUserId = $(btn).closest(".dp-list-wrap").attr("data-userId");
		    pop.open('create', $(this), 'Pop_process_confirm', 'loadEl.pop_process_confirm("프로세스 중단","대상 프로세스를 중단 하시겠습니까?")');
		    $("#btnConfirm").click(function(){
		        chatui.sendEventMessage("rpaAdminProcessKill", {"process_id" : param, "userId" : loginUserId });
		        pop.close($('#btnConfirm'));
		    });
		    break;
		    
		}
		
	}	
}

function isToday(date) {
  var today = new Date();
  var todayMonth = String(today.getMonth() + 1);
  if(todayMonth.length == 1) {
    todayMonth = '0'+todayMonth;
  }
  var todayMD = todayMonth + String(today.getDate());
  var dateTextArray = date.split('-');
  var dateWithoutMinus = dateTextArray.join('');
  if(dateWithoutMinus == String(todayMD)) {
    return '<span class="tag primary">TODAY</span>';
  } else {
    var d = dateWithoutMinus;
    var newDt = d.substring(0, 2) + "." + d.substring(2, d.length);
    return '<span class="tag">' + newDt +'</span>';
  }
}

function isBirthdayToday(date) {
  var today = new Date();
  var todayMonth = String(today.getMonth() + 1);
  if(todayMonth.length == 1) {
    todayMonth = '0'+todayMonth;
  }
  var todayMD = todayMonth + String(today.getDate());
  if(date == String(todayMD)) {
    return '<span class="tag primary">오늘 생일이에요!</span>';
  } else {
    return '';
  }
}

//Popup Module
const popup = function() {
  var $pop;
  var $btn;
  var popMode;
 
  function createPopup(popId) {
      var popWrap = '<div id="'+ popId +'" class="dialog-back" data-mode="create"><div class="dialog-overlay"></div></div>';
      $("body").append(popWrap);
  }
 
  var popupFn = {
      open: function(mode, btn, target, callback) {
          if (mode == "inline") {
              $btn = $(btn);
              popMode = mode;
              $pop = $(target);
 
              $pop.attr("data-mode","inline");
 
              $pop.stop().fadeIn('fast', function(){
                  if (callback){
                      eval(callback);
                  }
              });
 
          } else if (mode == "create") {
              $btn = $(btn);
              popMode = mode;
 
              if (target) {
                  createPopup(target);
 
                  $pop = $('#' + target);
 
                  $pop.attr("data-mode","create");
 
                  if (callback) {

                      var html = eval(callback);
                      $pop.find(".dialog-overlay").append(html);
                      $pop.stop().fadeIn('fast', function(){
 
                      });
                  }
              }
 
          }
      },
      close: function(closeBtn, target, callback) {
 
          if (closeBtn) {
              $pop = $(closeBtn).closest(".dialog-back");
          } else if (target) {
              $pop = $(target);
 
          } else {
              $pop = $(".dialog-back:visible:last-child");
          }
 
          $pop.stop().fadeOut('fast', function() {
              if (popMode == "create") {
                  $pop.remove();
              }
 
              if (callback){
                  eval(callback);
              }
          });
      }
  }
 
  $(document).on('click', '.btn-pop-open', function(e) {
      e.preventDefault();
  });
 
  $(document).on('click', '.btn-pop-close', function(e) {
      var $closePop = $(this).closest(".dialog-back");
 
      popupFn.close(this, $closePop);
  });
 
  // Click Overlay
  $(document).on('click', '.dialog-back', function(e){
      if ($(this).find(".pop-wrapper").has(e.target).length === 0){
          popupFn.close();
      };
  });
 
  // Esc Key Popup Close
  $(document).keydown(function(e){
      if (e.keycode == 27 || e.which == 27) {
          popupFn.close();
      }
  });
 
  return {
      open: popupFn.open,
      close: popupFn.close
  }
 };
 window.pop = popup();

 //Popup Event
 jQuery(document).ready(function(e){
     // Popup Open
      $(document).on('click', '[data-popup-open]', function(e) {
          var targeted_popup = $(this).attr('data-popup-open');
          var popup = $('[data-popup="' + targeted_popup + '"]');
     
          $(".chat-discussion").addClass("popmode");
     
          popup.fadeIn(350);
          popup.find('textarea').focus();
          e.preventDefault();
      });
 
      $(document).on('click', '[data-popup-close]', function(e) {
          var targeted_popup = $(this).attr('data-popup-close');
     
          $('[data-popup="' + targeted_popup + '"]').fadeOut(350, function(){
              $(".chat-discussion").removeClass("popmode");
          });
          e.preventDefault();
      });
 
      // Feedback Popup
      var feedbackEl = $('.feedback');
      feedbackEl.each(function (index, item) {
          var feedbackPop = $(item).find('.popup');
          $(item).find('.negative').attr('data-popup-open', 'feedback_popup_' + index);
          feedbackPop.attr('data-popup', 'feedback_popup_' + index);
          feedbackPop.find('[data-popup-close]').attr('data-popup-close', 'feedback_popup_' + index);
     
          index++;
      });
 
      // Images Popup
      var imageEl = $('.images');
      imageEl.each(function (index, item) {
          var imagePop = $(item).find('.popup');
          $(item).find('.img-container').attr('data-popup-open', 'image_' + index);
          imagePop.attr('data-popup', 'image_' + index);
          imagePop.find('.btn-close').attr('data-popup-close', 'image_' + index);
          imagePop.find('img').attr('id', 'image_' + index)
     
          index++;
      });
 
      // Video Popup
      var videoEl = $('.video');
      videoEl.each(function (index, item) {
          var videoPop = $(item).find('.popup');
          $(item).find('#video_overlays .btn-play').attr('data-popup-open', 'player_' + index);
          videoPop.attr('data-popup', 'player_' + index);
          videoPop.find('.btn-close').attr('data-popup-close', 'player_' + index);
          videoPop.find('video').attr('id', 'player_' + index)
     
          index++;
      });
 
      //video
      $("#video_overlays .btn-play").click(function() {
          var targeted_vid= $(this).attr('data-popup-open');
          var vid = $('[data-popup="' + targeted_vid + '"]').find('video').get(0);
     
          if (vid.paused) {
              vid.play();
              $('.video #video_overlays').fadeOut(350);
          } else {
              vid.pause();
          }
     
          vid.onended = function(e) {
              vid.load();
              $('.video #video_overlays').fadeIn(350);
          };
      });
 
      // Popup Notification Select All
      $(document).on('change','.pop-notification .check-alim-all', function(e){
          if ($(this).prop("checked") == true) {
              $(".check-alim").prop("checked", true);
          } else {
              $(".check-alim").prop("checked", false);
          }
      });
      $(document).on('change','.pop-notification .check-push-all', function(e){
          if ($(this).prop("checked") == true) {
              $(".check-push").prop("checked", true);
          } else {
              $(".check-push").prop("checked", false);
          }
      });
      $(document).on('change','.pop-notification .check-alim', function(e){
          $(".pop-notification .check-alim-all").prop("checked", false);
      });
      $(document).on('change','.pop-notification .check-push', function(e){
          $(".pop-notification .check-push-all").prop("checked", false);
      });
      
      $(document).on('change keyup keypress', 'textarea', function(){
 
          var $wrap;
          
          if ($(this).closest(".popup").length > 0) {
              $wrap = $(this).closest(".popup");
          } else if ($(this).closest(".pop-wrapper").length > 0) {
              $wrap = $(this).closest(".pop-wrapper");
          } else {
              $wrap = $(this).closest(".message");
          }
 
          if ($wrap) {
              var $btn = $wrap.find(".btn-primary, .btn.trans");
              var $rating = $wrap.find(".rating");
              var $notice = $wrap.find(".pop-error");
 
              if ($(this).val().length > 0) {
                  $btn.attr('disabled', false);
              } else {
                  $btn.attr('disabled', true);
              }
 
              if ($rating.length > 0 && $notice.length > 0) {
                  $notice.find("span").removeClass("show");
 
                  if ($(this).val().length > 0 && $rating.find('input[type=radio]:checked').length == 0) {
                      $notice.find("span.no-star").addClass("show");
                  } else if ($(this).val().length == 0 && $rating.find('input[type=radio]:checked').length > 0){
                      $notice.find("span.no-text").addClass("show");
                  } else {
                      $notice.find("span").removeClass("show");
                  }
              }
          }
      });
 
      // Rating Checking
 
      $(document).on('click', '.rating input[type=radio]', function(){
          var $wrap;
 
          if ($(this).closest(".popup").length > 0) {
              $wrap = $(this).closest(".popup");
          } else if ($(this).closest(".pop-wrapper").length > 0) {
              $wrap = $(this).closest(".pop-wrapper");
          }
 
          if ($wrap) {
              var $btn = $wrap.find(".btn-primary, .btn.trans");
              var $textarea = $wrap.find("textarea");
              var $rating = $wrap.find(".rating");
              var $notice = $wrap.find(".pop-error");
 
              if ($(this).prop("checked") == true) {
                  $btn.attr('disabled', false);
              } else {
                  $btn.attr('disabled', true);
              }
 
              if ($rating.length > 0 && $notice.length > 0) {
                  $notice.find("span").removeClass("show");
 
                  if ($textarea.val().length == 0 && $rating.find('input[type=radio]:checked').length > 0) {
                      $notice.find("span.no-text").addClass("show");
                  }
              }
          }
      });
 });
 
 // 모바일 감지 이벤트
 function Mobile() {
     return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
 }

/**
 * '알림설정' 함수
 * @param {object} data
 */
 function setNotification(data){
	var key = chatui.getSetting("userId") ? chatui.getSetting("userId").replace(/=/gi, "") : "";
	// if(data.hasOwnProperty('weather')) localStorage.setItem(key + "_weather", data.weather);
	if(data.hasOwnProperty('anniversary')) localStorage.setItem(key + "_anniversary", data.anniversary);
  if(data.hasOwnProperty('favorite')) localStorage.setItem(key + "_favorite", data.favorite);
  if(data.hasOwnProperty('myBirthday')) localStorage.setItem(key + "_myBirthday", data.myBirthday);
	if(data.hasOwnProperty('schedule')) localStorage.setItem(key + "_schedule", data.schedule);
	if(data.hasOwnProperty('message')) localStorage.setItem(key + "_message", data.message);
	if(data.hasOwnProperty('planner')) localStorage.setItem(key + "_planner", data.planner);
  if(data.hasOwnProperty('notice')) localStorage.setItem(key + "_notice", data.notice);
	if(data.hasOwnProperty('birthInfo')) localStorage.setItem(key + "_birthInfo", data.birthInfo);
  if(data.hasOwnProperty('learingBot')) localStorage.setItem(key + "_learingBot", data.learingBot);
	if(data.hasOwnProperty('lastAccessDate')) localStorage.setItem(key + "_lastAccessDate", data.lastAccessDate);
}

function searchActiveTrue() {
  searchActive = true;
  $('.test-sentence-input').autocomplete({disabled: true});
  $('.search-menu').removeClass('show');
  $('.btn-send').addClass('disp-none');
  $('.search-close').addClass('show');
  $('.sendText').val("");
 
  $('.search-guides').css('display', 'none');
}

function searchActiveEpTotal() {
  searchActiveTrue();
    searchType = 'ep-total';
  
    $('.search-desc').find('h1').html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
    +        '<path fill-rule="evenodd" clip-rule="evenodd" d="M16.0711 16.9199C14.5792 18.2157 12.6312 19 10.5 19C5.80558 19 2 15.1944 2 10.5C2 5.80558 5.80558 2 10.5 2C15.1944 2 19 5.80558 19 10.5C19 12.6313 18.2156 14.5794 16.9197 16.0714L21.824 20.9757C22.0583 21.21 22.0583 21.5899 21.824 21.8242C21.5897 22.0586 21.2098 22.0586 20.9755 21.8242L16.0711 16.9199ZM17.8 10.5C17.8 14.5317 14.5317 17.8 10.5 17.8C6.46832 17.8 3.2 14.5317 3.2 10.5C3.2 6.46832 6.46832 3.2 10.5 3.2C14.5317 3.2 17.8 6.46832 17.8 10.5Z" fill="#2C2C2C"/>'
    +        '</svg>'
    +         'EP 통합검색'
    );

    $('.search-desc').find('.desc').html(''
    +'EP 게시판 내용, 전자결재 문서, 뉴스 등을 검색할 수 있습니다.<br />'
    +'궁금하신 검색 키워드를 입력해 주세요.<br /><br />'
    +'예) G Cloud Mobile, 거점오피스'
    );
    $('.search-desc').addClass('show');
}

function searchActiveWhere() {
  searchActiveTrue();
  searchType = 'where';
  $('.search-desc').find('h1').html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +'<path fill-rule="evenodd" clip-rule="evenodd" d="M15.5 10C15.5 11.933 13.933 13.5 12 13.5C10.067 13.5 8.5 11.933 8.5 10C8.5 8.067 10.067 6.5 12 6.5C13.933 6.5 15.5 8.067 15.5 10ZM14.3 10C14.3 11.2703 13.2703 12.3 12 12.3C10.7297 12.3 9.7 11.2703 9.7 10C9.7 8.72974 10.7297 7.7 12 7.7C13.2703 7.7 14.3 8.72974 14.3 10Z" fill="#2C2C2C"/>'
  +'<path fill-rule="evenodd" clip-rule="evenodd" d="M17.6569 16C16.7487 17.3522 14.4827 20.0027 13.1101 21.5777C12.5211 22.2536 11.4789 22.2536 10.8899 21.5777C9.5173 20.0027 7.25126 17.3522 6.34315 16C5 14 4 12.0474 4 10C4 7.95263 4.78105 5.90525 6.34315 4.34315C9.46734 1.21895 14.5327 1.21895 17.6569 4.34315C19.219 5.90525 20 7.95263 20 10C20 12.0474 19 14 17.6569 16ZM7.19167 5.19167C9.84724 2.53611 14.1528 2.53611 16.8083 5.19167C18.1363 6.51969 18.8 8.25788 18.8 10C18.8 11.667 17.9821 13.3633 16.6607 15.331C15.804 16.6066 13.5963 19.1934 12.2054 20.7894C12.0946 20.9164 11.9054 20.9164 11.7946 20.7894C10.4037 19.1934 8.19599 16.6066 7.33934 15.331C6.01787 13.3633 5.2 11.667 5.2 10C5.2 8.25788 5.86365 6.51969 7.19167 5.19167Z" fill="#2C2C2C"/>'
  +'</svg>'
  +'장소검색 (/where)');

  $('.search-desc').find('.desc').html('검색어로 장소를 찾아드립니다.<br/>'
  +'궁금하신 장소명을 입력해 주세요.<br/><br/>'
  +'예) 발산역 맛집, 사이언스파크');

  $('.search-desc').addClass('show');
  $('.form-group').append('<span class="search-pre">/where </span>')
  $('.sendText').addClass('search-active-place');
  $('.sendText').attr("placeholder", "장소명을 입력해 주세요.");
}

function searchActiveDict() {
  searchActiveTrue();
 searchType = 'dict'
 $('.search-desc').find('h1').html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<circle cx="12" cy="12" r="9.4" stroke="#6B6B6B" stroke-width="1.2"/>'
 +'<path d="M17.4 12C17.4 14.6714 16.7491 17.0608 15.7281 18.7624C14.7 20.4759 13.3633 21.4 12 21.4C10.6367 21.4 9.29996 20.4759 8.27186 18.7624C7.25091 17.0608 6.6 14.6714 6.6 12C6.6 9.32862 7.25091 6.9392 8.27186 5.23763C9.29996 3.52412 10.6367 2.6 12 2.6C13.3633 2.6 14.7 3.52412 15.7281 5.23763C16.7491 6.9392 17.4 9.32862 17.4 12Z" stroke="#6B6B6B" stroke-width="1.2"/>'
 +'<rect x="11.4004" y="3" width="1.2" height="18" fill="#6B6B6B"/>'
 +'<rect x="3" y="12.5996" width="1.2" height="18" transform="rotate(-90 3 12.5996)" fill="#6B6B6B"/>'
 +'<rect x="4" y="8" width="1.2" height="16" transform="rotate(-90 4 8)" fill="#6B6B6B"/>'
 +'<rect x="4" y="17" width="1.2" height="16" transform="rotate(-90 4 17)" fill="#6B6B6B"/>'
 +'</svg>'
 +'용어 검색 (/dict)'
 );

 $('.search-desc').find('.desc').html('표준 용어, 약어 등 사내 업무용어 정보를 검색합니다. <br /> 궁금하신 용어명을 입력해 주세요.<br /><br />예) 양극재, 분리막');
 $('.sendText').val('/dict ');
 $('.search-desc').addClass('show');
 
 $('.form-group').append('<span class="search-pre">/dict </span>')
 $('.sendText').addClass('search-active-dict');
 $('.sendText').val("");
 $('.sendText').attr("placeholder", "용어명을 입력해 주세요.");
}

function searchActiveEcm() {
  searchActiveTrue();
  searchType = 'ecm';
 $('.search-desc').find('h1').html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
 + '<path fill-rule="evenodd" clip-rule="evenodd" d="M9.27906 5.2H5C4.00589 5.2 3.2 6.00589 3.2 7V17C3.2 17.9941 4.00589 18.8 5 18.8H19C19.9941 18.8 20.8 17.9941 20.8 17V9.5C20.8 8.50589 19.9941 7.7 19 7.7H12.7209C11.9007 7.7 11.125 7.32716 10.6126 6.68668L9.51332 5.31259C9.45639 5.24143 9.3702 5.2 9.27906 5.2ZM9.27906 4C9.73474 4 10.1657 4.20713 10.4504 4.56296L11.5496 5.93704C11.8343 6.29287 12.2653 6.5 12.7209 6.5H19C20.6569 6.5 22 7.84315 22 9.5V17C22 18.6569 20.6569 20 19 20H5C3.34315 20 2 18.6569 2 17V7C2 5.34315 3.34315 4 5 4H9.27906Z" fill="#2C2C2C"/>'
 + '</svg>'
 +'ECM 문서 검색'
 );

 $('.search-desc').find('.desc').html('ECM 내 문서 목록을 검색합니다.<br/>'
 +'궁금하신 검색어를 입력해 주세요.<br /><br />'
 +'예) 주간보고, 산출물, WBS');
 $('.search-desc').addClass('show');
};


function searchActiveSystem() {
  searchActiveTrue();
  searchType = 'system';
 $('.search-desc').find('h1').html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path d="M16.3276 6.07995C16.1753 6.22914 15.6186 6.97172 16.323 7.67696C17.0282 8.38137 17.7708 7.82471 17.92 7.6724C18.0692 7.52004 20.3084 5.28713 20.3084 5.28713C20.6048 4.9911 21.1006 5.05948 21.3024 5.42422C22.505 7.59778 22.1325 10.3397 20.3409 12.1324C18.9893 13.483 17.0183 14.0083 15.2057 13.6599C14.8441 13.5904 14.4619 13.6799 14.2007 13.9412L14.1726 13.9693C13.7133 14.4289 7.76313 20.3822 7.06347 21.0819C6.05322 22.0921 4.32417 22.5004 2.91191 21.0881L3.75921 20.2408C4.23123 20.7128 4.6811 20.8244 5.05419 20.7981C5.46206 20.7693 5.88551 20.5652 6.21614 20.2345C6.92235 19.5283 12.9802 13.4673 13.3367 13.1105L13.3533 13.0939C13.9409 12.5062 14.7474 12.3516 15.4318 12.4831C16.8837 12.7622 18.4437 12.334 19.4936 11.2851C20.7164 10.0612 21.0984 8.28102 20.5696 6.71911L20.0166 7.27082C19.4333 7.85298 18.8444 8.44118 18.7761 8.51092C18.589 8.70191 18.1761 9.02544 17.609 9.16134C16.948 9.31972 16.1486 9.1968 15.4757 8.52429C14.8032 7.85134 14.6802 7.05198 14.8386 6.39099C14.9745 5.82384 15.2981 5.41097 15.489 5.2239C15.5588 5.15558 16.147 4.56666 16.7291 3.98332L17.2808 3.43034C15.7189 2.90155 13.9387 3.28359 12.7149 4.50638C11.6659 5.55629 11.2378 7.11629 11.5168 8.56812C11.6484 9.25258 11.4938 10.0591 10.9061 10.6466L10.8894 10.6632C10.5327 11.0198 4.47163 17.0776 3.76542 17.7838C3.43478 18.1145 3.23061 18.5379 3.20186 18.9458C3.17557 19.3189 3.28718 19.7687 3.75921 20.2408L2.91191 21.0881C1.49965 19.6759 1.90783 17.9467 2.91808 16.9365C3.61808 16.2365 9.57683 10.2809 10.0313 9.82669L10.0587 9.79928C10.3201 9.53805 10.4095 9.15583 10.3401 8.79431C9.99165 6.98167 10.5169 5.01064 11.8675 3.65907C13.6603 1.8675 16.4022 1.49499 18.5757 2.69753C18.9405 2.89933 19.0089 3.39515 18.7128 3.69157C18.7128 3.69157 16.4799 5.93072 16.3276 6.07995Z" fill="#2C2C2C"/>'
 +'</svg>'
 +'시스템 담당자 검색'
 );

 $('.search-desc').find('.desc').html('시스템 담당자를 검색합니다.<br />'
 +'‘시스템명 + 담당자’ 로 검색해 보세요.<br /><br />'
 +'예) GERP 담당자, ecm 담당자');
 $('.search-desc').addClass('show');
};


function searchActiveSchedule() {
  searchActiveTrue();
  searchType = 'schedule';
 $('.search-desc').find('h1').html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path d="M17.4 14.5999L15.893 14.5999C15.5617 14.5999 15.293 14.3313 15.293 13.9999C15.293 13.6685 15.5617 13.3999 15.893 13.3999L17.4 13.3999C17.7314 13.3999 18 13.6685 18 13.9999C18 14.3313 17.7314 14.5999 17.4 14.5999Z" fill="#2C2C2C"/>'
 +'<path d="M12.8791 14.5999L11.1209 14.5999C10.7896 14.5999 10.5209 14.3313 10.5209 13.9999C10.5209 13.6685 10.7896 13.3999 11.1209 13.3999L12.8791 13.3999C13.2104 13.3999 13.4791 13.6685 13.4791 13.9999C13.4791 14.3313 13.2104 14.5999 12.8791 14.5999Z" fill="#2C2C2C"/>'
 +'<path d="M8.10698 14.5999L6.6 14.5999C6.26863 14.5999 6 14.3313 6 13.9999C6 13.6685 6.26863 13.3999 6.6 13.3999L8.10698 13.3999C8.43835 13.3999 8.70698 13.6685 8.70698 13.9999C8.70698 14.3313 8.43835 14.5999 8.10698 14.5999Z" fill="#2C2C2C"/>'
 +'<path d="M11.1209 17.5999L12.8791 17.5999C13.2104 17.5999 13.4791 17.3313 13.4791 16.9999C13.4791 16.6685 13.2104 16.3999 12.8791 16.3999L11.1209 16.3999C10.7896 16.3999 10.5209 16.6685 10.5209 16.9999C10.5209 17.3313 10.7896 17.5999 11.1209 17.5999Z" fill="#2C2C2C"/>'
 +'<path d="M6.6 17.5999L8.10698 17.5999C8.43835 17.5999 8.70698 17.3313 8.70698 16.9999C8.70698 16.6685 8.43835 16.3999 8.10698 16.3999L6.6 16.3999C6.26863 16.3999 6 16.6685 6 16.9999C6 17.3313 6.26863 17.5999 6.6 17.5999Z" fill="#2C2C2C"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.5999 2.6C8.5999 2.26863 8.33127 2 7.9999 2C7.66853 2 7.3999 2.26863 7.3999 2.6V4H6C4.34315 4 3 5.34315 3 7V19C3 20.6569 4.34315 22 6 22H18C19.6569 22 21 20.6569 21 19V7C21 5.34315 19.6569 4 18 4H16.5999V2.6C16.5999 2.26863 16.3313 2 15.9999 2C15.6685 2 15.3999 2.26863 15.3999 2.6V4H8.5999L8.5999 2.6ZM18 5.2H6C5.00589 5.2 4.2 6.00589 4.2 7V9L19.8 9V7C19.8 6.00589 18.9941 5.2 18 5.2ZM4.2 19V10.2L19.8 10.2V19C19.8 19.9941 18.9941 20.8 18 20.8H6C5.00589 20.8 4.2 19.9941 4.2 19Z" fill="#2C2C2C"/>'
 +'</svg>'
 +'일정 검색'
 );

 $('.search-desc').find('.desc').html('‘이름 + 일정’ 혹은 ‘이름 + 직책 + 일정’ 키워드로 화학 임직원 일정 정보를 검색해 보세요.<br />'
 +'검색일 기준 일정이 기본 안내되며, 주간일정 버튼을 통해 주단위 일정도 확인할 수 있습니다.<br /><br />'
 + '예) 홍길동 일정, 홍길동 선임 일정');
 $('.search-desc').addClass('show');
};


function searchActiveMrc() {
  searchActiveTrue();
  searchType = 'ai';
 $('.search-desc').find('h1').html('<svg width="24" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path d="M8 13.4C8 13.0687 8.26863 12.8 8.6 12.8H15.4C15.7314 12.8 16 13.0687 16 13.4C16 13.7314 15.7314 14 15.4 14H8.6C8.26863 14 8 13.7314 8 13.4Z" fill="#6B6B6B"/>'
 +'<path d="M8.6 15.8C8.26863 15.8 8 16.0687 8 16.4C8 16.7314 8.26863 17 8.6 17H13.4C13.7314 17 14 16.7314 14 16.4C14 16.0687 13.7314 15.8 13.4 15.8H8.6Z" fill="#6B6B6B"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M4 5C4 3.34315 5.34315 2 7 2H12.7574C13.553 2 14.3161 2.31607 14.8787 2.87868L19.1213 7.12132C19.6839 7.68393 20 8.44699 20 9.24264V19C20 20.6569 18.6569 22 17 22H7C5.34315 22 4 20.6569 4 19V5ZM17 20.8H7C6.00589 20.8 5.2 19.9941 5.2 19V5C5.2 4.00589 6.00589 3.2 7 3.2H12.7574C12.8051 3.2 12.8527 3.2019 12.8999 3.20565V7C12.8999 8.1598 13.8401 9.1 14.9999 9.1H18.7943C18.7981 9.14728 18.8 9.19486 18.8 9.24264V19C18.8 19.9941 17.9941 20.8 17 20.8ZM18.2029 7.9L14.0999 3.79696V7C14.0999 7.49706 14.5028 7.9 14.9999 7.9H18.2029Z" fill="#6B6B6B"/>'
 +'</svg>'
 +'AI 검색 (/AI)'
 );

 $('.search-desc').find('.desc').html('ECM 특정 문서함에 업로드 된 문서를 학습하고 안내합니다.<br />'
 +'케미를 직접 학습시키고 검색해 보세요.<br/><br />'
 +'예) 권장휴가 알려줘, 거점오피스가 뭐야<br />'
 +'* AI 검색 : AI 알고리즘이 스스로 문서를 학습하여 질문에 최적화된 답을 제공하는 검색 기능<br />'
 +'* 케미 학습 경로 :  ‘ECM > 공유문서함 > (AI검색) 전사공유 또는 담당문서함’<br />'
 +'* 파일 포맷 / 이미지 품질에 따라 인식률이 상이할 수 있으며, 관련 문의사항은 담당자에게 문의해 주세요.<br />'
 +'* ECM 문서 일반 검색은 ‘ECM 문서 검색’ 기능을 활용해 주세요.<br />');
 $('.search-desc').addClass('show');
 $('.form-group').append('<span class="search-pre">/AI </span>')
  $('.sendText').addClass('search-active-ai');
  $('.sendText').attr("placeholder", "검색어를 입력해 주세요.");
}

function searchActiveEmployee() {
  searchActiveTrue();
    searchType = 'employee';
    $('.search-desc').find('h1').html('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
    + '<path fill-rule="evenodd" clip-rule="evenodd" d="M8.4999 9.3C9.49401 9.3 10.2999 8.49411 10.2999 7.5C10.2999 6.50589 9.49401 5.7 8.4999 5.7C7.50579 5.7 6.6999 6.50589 6.6999 7.5C6.6999 8.49411 7.50579 9.3 8.4999 9.3ZM8.4999 10.5C10.1568 10.5 11.4999 9.15685 11.4999 7.5C11.4999 5.84315 10.1568 4.5 8.4999 4.5C6.84305 4.5 5.4999 5.84315 5.4999 7.5C5.4999 9.15685 6.84305 10.5 8.4999 10.5Z" fill="#2C2C2C"/>'
    + '<path fill-rule="evenodd" clip-rule="evenodd" d="M2 17.8C2 14.4311 4.73106 11.7 8.1 11.7H8.9C12.2689 11.7 15 14.4311 15 17.8V18.9C15 19.2314 14.7314 19.5 14.4 19.5C14.0686 19.5 13.8 19.2314 13.8 18.9V17.8C13.8 15.0939 11.6062 12.9 8.9 12.9H8.1C5.3938 12.9 3.2 15.0939 3.2 17.8V18.9C3.2 19.2314 2.93137 19.5 2.6 19.5C2.26863 19.5 2 19.2314 2 18.9V17.8Z" fill="#2C2C2C"/>'
    + '<path fill-rule="evenodd" clip-rule="evenodd" d="M15.9999 10.3C16.7179 10.3 17.2999 9.71797 17.2999 9C17.2999 8.28203 16.7179 7.7 15.9999 7.7C15.2819 7.7 14.6999 8.28203 14.6999 9C14.6999 9.71797 15.2819 10.3 15.9999 10.3ZM15.9999 11.5C17.3806 11.5 18.4999 10.3807 18.4999 9C18.4999 7.61929 17.3806 6.5 15.9999 6.5C14.6192 6.5 13.4999 7.61929 13.4999 9C13.4999 10.3807 14.6192 11.5 15.9999 11.5Z" fill="#2C2C2C"/>'
    + '<path fill-rule="evenodd" clip-rule="evenodd" d="M14.7998 13.3C14.7998 12.9687 15.0684 12.7 15.3998 12.7H16.3999C19.4927 12.7 21.9999 15.2073 21.9999 18.3V18.9C21.9999 19.2314 21.7313 19.5 21.3999 19.5C21.0685 19.5 20.7999 19.2314 20.7999 18.9V18.3C20.7999 15.87 18.83 13.9 16.3999 13.9H15.3998C15.0684 13.9 14.7998 13.6314 14.7998 13.3Z" fill="#2C2C2C"/>'
    +'</svg>'
    +'전자/그룹사 임직원 검색'
    );

    $('.search-desc').find('.desc').html('‘이름’ 혹은 ‘이름 + 직책’ 키워드로 전자 임직원 정보를 검색해 보세요.<br />'
    +'‘계열사명+이름’ 으로 LG 그룹사 임직원 정보를 검색해 보세요.<br /><br />'
    +'예) 홍길동 선임 (전자 임직원 검색) , CNS 김춘희 (그룹사 검색)<br />'
    +'검색 후 정보 확인 및 메신저 대화하기 / 메일 전송 / SMS 전송 / 일정 확인 등을 지원합니다.');
    $('.search-desc').addClass('show');
}

// 표준문서검색 버튼
function searchActiveStandard() {
  searchActiveTrue();
  searchType = 'standard';
 $('.search-desc').find('h1').html('<svg width="24" height="24" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">'
 +'<path d="M11.9242 9.02426C12.1585 8.78995 12.1585 8.41005 11.9242 8.17574C11.6899 7.94142 11.31 7.94142 11.0756 8.17574L7.1254 12.126L4.92409 9.92543C4.68974 9.69116 4.30984 9.69122 4.07556 9.92558C3.84129 10.1599 3.84136 10.5398 4.07571 10.7741L6.70129 13.3988C6.93562 13.633 7.31546 13.633 7.54974 13.3987L11.9242 9.02426Z" fill="#2C2C2C"/>'
 +'<path fill-rule="evenodd" clip-rule="evenodd" d="M4 1.5C4 0.671573 4.67157 0 5.5 0H10.5C11.3284 0 12 0.671573 12 1.5H13C13.0647 1.5 13.129 1.50205 13.1927 1.50609L13.2 1.50656C14.7636 1.60948 16 2.91035 16 4.5V17C16 18.6569 14.6569 20 13 20H3C1.34315 20 0 18.6569 0 17V4.5C0 2.9467 1.1805 1.66912 2.69327 1.51549C2.72867 1.51189 2.76425 1.50891 2.8 1.50656C2.8661 1.50221 2.93279 1.5 3 1.5H4ZM5.5 1.2H10.5C10.6657 1.2 10.8 1.33431 10.8 1.5V2.5C10.8 2.66569 10.6657 2.8 10.5 2.8H5.5C5.33431 2.8 5.2 2.66569 5.2 2.5V1.5C5.2 1.33431 5.33431 1.2 5.5 1.2ZM4.01205 2.69105C4.01243 2.69403 4.01282 2.69702 4.01322 2.7H3C2.93787 2.7 2.87647 2.70315 2.81596 2.70929L2.80811 2.71011C1.90422 2.80589 1.2 3.57071 1.2 4.5V17C1.2 17.9941 2.00589 18.8 3 18.8H13C13.9941 18.8 14.8 17.9941 14.8 17V4.5C14.8 3.63015 14.183 2.90441 13.3628 2.73657C13.3067 2.7251 13.2497 2.71623 13.1919 2.71011C13.1288 2.70343 13.0648 2.7 13 2.7H11.9868C11.889 3.43387 11.2606 4 10.5 4H5.5C4.73629 4 4.10589 3.42926 4.01205 2.69105Z" fill="#2C2C2C"/>'
 +'</svg>'
 +'표준문서검색'
 );

 $('.search-desc').find('.desc').html('표준문서시스템(사내표준+) 등록 문서를 검색합니다.<br />'
 +'검색하시고자 하는 문서명 또는 키워드를 입력해주세요.<br /><br />'
 +'검색 결과에서,<b>‘더 찾아보기’</b> 기능을 사용하시면 전체 검색 결과를 확인하실 수 있습니다<br /><br />'
 + '예) 전사 경영방침, 업무자율권, 여비규정');
 $('.search-desc').addClass('show');
};

function activeGptBot(text) {
    var useDiv = text.indexOf("popUp")>-1?"2":"1";
    
    if(useDiv == "1"){
        $('body').append('<div id="caas-chatbot-container"><iframe id="caas-chatbot-chat-iframe" name="caas-chatbot-chat-iframe" src="about:blank" allow="microphone; autoplay" allowusermedia="true" style="position: relative!important;height:100%!important;width: 100%!important;border: none!important;"></iframe></div>');
    
        if (!document.getElementById("caas-chatbot-chat-iframe").isLoaded) {
          document.getElementById("caas-chatbot-chat-iframe").isLoaded = true;
          openGptBotFrame(text);
        }
    } else{
        console.log("activeGptBot : "+text);
        var paramForm = document.createElement("form");
        var url = "https://chatclient-stg.ai.lgstation.com/53496e65-19e4-4d34-8469-c7b83263b588/chat";
        window.open("", "chatGptBot", "top=500, left=500, width=500, height=700, toolbar=1, scrollbars=1, resizable=1");
        
        $(paramForm).attr('action', url);
        $(paramForm).attr('target', "chatGptBot");
        $(paramForm).attr('method', 'post');
        // paramForm.setAttribute('action', url);
        // paramForm.setAttribute('target', "chatGptBot");
        // paramForm.setAttribute('method', 'post');
    
        paramForm.append('<input type="hidden" name="reqText" value='+text+'>');
        document.body.appendChild(paramForm);
        paramForm.submit();
    
    }
};

//Autocomplete Module
const setAutocomplete = function() {
  $('.test-sentence-input').autocomplete({disabled: false});
  // Reset Input Message
  function resetInputMsg() {
  // activeAutoComplete('N');
      $(".chat-footer-form").removeClass('search-where search-dict search-person search-total');
      $(".autocomplete-wrap .search-title").removeClass("keyword person on");
      $(".autocomplete-wrap .btn-goSearch").removeClass("show");
      $(".autocomplete-wrap .btn-goSearch span").text('');
      $(".chat-footer-form").attr('data-mode','message');
      $(".test-sentence-input").val('');
  }

  // Set Autocomplete
  $(".btn-search-where").on('click', function(e){
      resetInputMsg();
      $(".chat-footer-form").addClass("search-where");
      $(".test-sentence-input").val('/where '); //공백추가
      $(".test-sentence-input").focus();
 
  });
  $(".btn-search-dict").on('click', function(e){
      resetInputMsg();
      $(".chat-footer-form").addClass("search-dict");
      $(".test-sentence-input").val('/dict '); //공백추가
      $(".test-sentence-input").focus();
  });
   $(".btn-search-mrc").on('click', function(e){
      userId = chatui.getSetting("userId"); 
      intentEvent(null, 'mrc', "'"+userId+"'");
      e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          
  });
  
  // Close Autocomplete
  $(document).on('click', function(e){
      var $frmWrap = $(".chat-footer-form");
 
      if (!($frmWrap.hasClass("search-person") || $frmWrap.hasClass("search-total"))) {
        // 위치검색, 용어검색 메뉴 위치 변경으로 ".small-menu" 클래스로 변경.
          if ($(".form-group, .small-menu").has(e.target).length == 0) {
              resetInputMsg();
          }
      } else {
          $(".search-title").removeClass("on");
      }
  });
 
  $(".btn-person-search").on('click', function(e){
      resetInputMsg();
      $(".chat-footer-form").attr('data-mode','search').addClass("search-person");
      $(".test-sentence-input").focus();
  });
 
  $(".btn-total-search").on('click', function(e){
      resetInputMsg();
      $(".chat-footer-form").attr('data-mode','search').addClass("search-total");
      $(".test-sentence-input").focus();
  });
 
  $(".btn-form-reset").on('click', function(){
      resetInputMsg();
  });
 };
 

const autoSearchEmployees = function(inputVal) {
  // Reset Input Message
  function resetInputMsg() {
  // activeAutoComplete('N');
      $(".chat-footer-form").removeClass('search-where search-dict search-person search-total');
      $(".autocomplete-wrap .search-title").removeClass("keyword person on");
      $(".autocomplete-wrap .btn-goSearch").removeClass("show");
      $(".autocomplete-wrap .btn-goSearch span").text('');
      $(".chat-footer-form").attr('data-mode','message');
      $(".test-sentence-input").val('');
  }
    
  // Set Autocomplete
  var keyword = [];
 
      var $frmWrap = $(".chat-footer-form");
      //var inputVal = $(this).val();
      var searchVal = "'" + inputVal + "'";
 
      //console.log('searchVal : '+searchVal);
      if ($frmWrap.hasClass("search-where") || $frmWrap.hasClass("search-dict")) {
          if ($.trim(inputVal) == "") {
              resetInputMsg();
          }
      } else if (!$frmWrap.hasClass("search-total") || !$frmWrap.hasClass("search-total")) {
          if ($.trim(inputVal) == "") {
              $(".autocomplete-wrap .search-title").removeClass("keyword person on");
              searchVal = "";
          }
 
          $(".btn-goSearch:visible").find("span").text(searchVal);
      } 

    var options = {
      keyword: inputVal,
        limit: 10   
    };
    
    chatui.searchEmployees(options)
        .then(function (employees) {
          if(employees.length > 0){
            console.log("employees : " + JSON.stringify(employees));
              
            // autoComplete는 Label 기준으로 세팅하기 때문에 Label 값을 insert
            $.each(employees, function(index) {
              var employee = employees[index]
              var userKorName = employee.userKorName;
              employee.label = userKorName;
              employee.type = "person";
            });
              
              keyword = employees;
            $(".test-sentence-input").autocomplete("option", "source", keyword);
              $(".test-sentence-input").autocomplete("option", "appendTo", $(".test-sentence-input").closest(".form-group").find(".autocomplete-wrap"));
          }else{
            $.each(window.phrases, function(index) {
                keyword.push({
                    "type": "keyword",
                    "label": window.phrases[index]
                });
                
              if(index > 2000){
                return false;
              }
            });
            keyword = [];
          }
    });


  $(".test-sentence-input").autocomplete({
      appendTo: ".form-group .autocomplete-wrap",
      autofocus: true,
      delay: 300,
      source: keyword,
      create: function() {
        var htmlStr = '<div class="search-guides">' +
                    '<dl class="search-guide search-guide-where" onclick="searchActiveWhere()">' +
                    '    <dt>/where</dt>' +
                    '    <dd>키워드로 장소를 검색하고 추천합니다.</dd>' + 
                    '</dl>' +
                    '<dl class="search-guide search-guide-mrc" onclick="searchActiveMrc()">' +
                    '    <dt>/mrc</dt>' +
                    '    <dd>ECM 내 MRC 폴더의 문서를 키워드로 검색합니다.</dd>' + 
                    '</dl>' +
                    '<dl class="search-guide search-guide-dict" onclick="searchActiveDict()">' +
                    '    <dt>/dict</dt>' +
                    '    <dd>표준 용어, 약어 등 업무용어 정보를 검색합니다.</dd>' +
                    '</dl>'+
                    '<dl class="search-guide search-guide-dict" onclick="clearAllConversation()">' +
                    '    <dt>/clear</dt>' +
                    '    <dd>대화 기록을 삭제합니다.</dd>' +
                    '</dl>'
                    +'</div>'
        $(".chat-footer-form .autocomplete-wrap").append(htmlStr);
      },
      open: function(event, ui) {
          $('.ui-autocomplete').scrollTop();
      },
      focus: function(event, ui){
          //$(this).val(ui.item.label);
          return false;
      },
      select: function(event, ui){
          if (!($(".chat-footer-form").hasClass("search-person") || $(".chat-footer-form").hasClass("search-total"))) {
              resetInputMsg();
          }
          $(".search-title").removeClass("on");
          
          if(ui.item.type == "keyword"){
            chatui.sendMessage(ui.item.label);
          }else{
            chatui.sendEventMessage(employeeQueryEvent, {"targetId" : ui.item.emailId  });
          }

          return false;
      }
  }).focus(function(){
      $(".autocomplete-wrap .search-title").removeClass("keyword person on");
      $(".autocomplete-wrap .btn-goSearch").removeClass("show");
 
      $(this).data("uiAutocomplete").search($(this).val());
 
  }).autocomplete("instance")._renderItem = function( ul, item ) {
      var searchMask = this.element.val();
      var regEx = new RegExp(searchMask, "ig");
      var replaceMask = "<strong>$&</strong>";
      var labelStr = item.label.replace(regEx, replaceMask);
      var htmlStr;
 
      $(".autocomplete-wrap .search-title").removeClass("keyword person on");
      $(".autocomplete-wrap .btn-goSearch").removeClass("show");
 
      if (item.type == "keyword") {
          htmlStr = '<div class="keyword-info">'+ labelStr +'</div>';
 
          if (!$(".chat-footer-form").hasClass("search-person")) {
              $(".autocomplete-wrap .search-title").addClass("keyword");
          }
          $(".autocomplete-wrap .btn-goSearch").removeClass("show");
 
          if (searchMask.length >= 1) {
              $(".autocomplete-wrap .search-title.keyword").addClass("on");
 
              if ($(".chat-footer-form").hasClass("search-total") || $(".chat-footer-form").hasClass("search-person")) {
                  $(".autocomplete-wrap .btn-goSearch").removeClass("show");
              } else {
                  $(".autocomplete-wrap .btn-goSearch").addClass("show");
              }
          }
 
      } else if (item.type == "person") {
        
          var nameStr = item.label.split(' ');
          var searchStr = labelStr.split(' ');
 
          $(".autocomplete-wrap .search-title").addClass("person");
 
          if (searchMask.length >= nameStr[0].length) {
              $(".autocomplete-wrap .search-title.person").addClass("on");
 
              if ($(".chat-footer-form").hasClass("search-total") || $(".chat-footer-form").hasClass("search-person")) {
                  $(".autocomplete-wrap .btn-goSearch").removeClass("show");
              } else {
                  //$(".autocomplete-wrap .btn-goSearch").addClass("show");
              }
          }
 
          if ($.trim(item.imgUrl) == "") {
            item.imgUrl = imgBaseUrl+"/icon/img_user_none.png";
          }
 
          htmlStr = '<dl class="person-info">' +
                  '    <dt>'+ item.userKorName +' '+ item.jobTitle +' <span>'+ item.deptKorName +'</span></dt>' +
                  // '    <dd class="photo"><img src="'+ item.imgUrl +'" alt="'+ item.userKorName +'"></dd>' +
                  '    <dd class="phone">'+ item.mobilePhoneNo +'</div></dd>' +
                  '</dl>';
      }
 
      var listItem;
 
      if (item.type == "person" && searchMask.length < nameStr[0].length) {
          listItem = '<li style="display:none"></li>';
      } else if (item.type == "keyword" && $(".chat-footer-form").hasClass("search-person")) {
          listItem = '<li style="display:none"></li>';
      } else {
          listItem = '<li></li>';
      }
 
      return $(listItem)
              .data( "ui-autocomplete-item", item )
              .append(htmlStr)
              .appendTo(ul);
  };
    
};

function sendWelcomeEvent() {
  var key = chatui.getSetting("userId") ? chatui.getSetting("userId").replace(/=/gi, "") : "";
  var lastAccessDate = localStorage.getItem(key + "_lastAccessDate");
//   if(lastAccessDate == null || welcomeClick === true) { lastAccessDate=''; };
  if(lastAccessDate == null) { lastAccessDate=''; };
  var data = {
    "lastAccessDate": lastAccessDate
  }
  chatui.sendEventMessage("Welcome", data);

  var date = new Date();
  var year = date.getFullYear();
  var month = ("0" + (1 + date.getMonth())).slice(-2);
  var day = ("0" + date.getDate()).slice(-2);
  var today = year + "-" + month + "-" + day;
  localStorage.setItem(key + "_lastAccessDate", today);
}

var smsContent = '';

function smsCheck() {
  var memberInfos = $('.selected-members').find('.member-info');
  var deptInfos = $('.selected-members').find('.dept-info');

  if((memberInfos.length > 0 || deptInfos.length > 0) && smsContent) {
    $('#btn-sms').removeClass('btn-disabled');
  } else {
    $('#btn-sms').addClass('btn-disabled');
  }

  if(memberInfos.length > 0 || deptInfos.length > 0) {  
    $('#attendees').attr('placeholder', '');
    $('#department').attr('placeholder', '');
  } else {
    $('#attendees').attr('placeholder', '이름을 입력해 주세요.');
    $('#department').attr('placeholder', '조직명을 입력해 주세요.');
  }
}


// 일정등록 자동 완성 모듈
const setAutocompleteJoinMember = function(input) {
  // Test Item
  var keyword = [];   

  //var $autocompleteWrap;
  $(input).on('keyup', function(e) {
      var inputVal = $(input).val();
      var searchVal = "'" + inputVal + "'";
      var sessionId = $(input).closest(".form-schedule").attr("data-sessionId");
      
     // 임직원 검색
     var options = {
       keyword: inputVal, // 이름 또는 전화번호 (Ex. "홍길동", "1234")
         limit: 30    // default 30, max 100
     };

     chatui.searchEmployees(options)
         .then(function (employees) {
           if(employees){
             // autoComplete는 Label 기준으로 세팅하기 때문에 Label 값을 insert
             $.each(employees, function(index) {
               var employee = employees[index]
               var userKorName = employee.userKorName;
               employee.label = userKorName;
               employee.type = "person";
             });
               
               keyword = employees;
             $(input).autocomplete("option", "source", keyword);
               $(input).autocomplete("option", "appendTo", $(input).closest(".form-schedule").find(".autocomplete-member"));
           }
         });
      
  }).autocomplete({
      appendTo: ".form-schedule .autocomplete-member",
      autofocus: true,
      delay: 300,
      source: keyword,
      create: function() {
        
      },
      open: function(event, ui) {
          $('.form-schedule .ui-autocomplete').scrollTop();
      },
      focus: function(event, ui){
          $(this).val(ui.item.label);
         // return false;
      },
      select: function(event, ui){
          var $memList = $(this).closest(".form-schedule").find(".schedule-join-member").find(".selected-members");
          var htmlStr;

          $(this).val('').focus();

          var members = $memList.find('.member-info');
          for(var i=0; i<members.length; i++) {
              
              var empNo = $(members[i]).find('.person-empNo').val();
              
              if(empNo == ui.item.empNo) {
                  showSmallDialog("이미 선택된 참석자입니다.");
                  return false;
              }
              
          }
          
          htmlStr = '<div class="member-info">'
          + ui.item.userKorName
          + '<button type="button" class="btn btn-delete">' 
            +  '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
            +  '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
            +  '</svg>'
          + '</button>'
          +'<div class="auto-detail-tooltip">'+ui.item.deptKorName+'</div>'
          + '<input type="hidden" value="'+ui.item.mobilePhoneNo+'" class="person-mobile"/>'
          + '<input type="hidden" value="'+ui.item.email+'" class="person-email"/>'
          + '<input type="hidden" value="'+ui.item.userKorName+'" class="person-name"/>'
          + '<input type="hidden" value="'+ui.item.emailId+'" class="person-userId"/>'
          + '<input type="hidden" value="'+ui.item.empNo+'" class="person-empNo"/>'
          +'</div>';
          
          $memList.append(htmlStr);
          
          if($('.selected-members').height() > 110) {
            $('.selected-members').addClass('long');
            $('.member-open').addClass('show');
          } else {
            $('selected-members').removeClass('long');
            $('.member-open').removeClass('show');
          }

          $('.auto-detail-tooltip').tooltip({track: true});

          smsCheck();

          return false;
      }
  }).focus(function(){
      $(this).data("uiAutocomplete").search($(this).val());

  }).autocomplete("instance")._renderItem = function( ul, item ) {
      var searchMask = this.element.val();
      var regEx = new RegExp(searchMask, "ig");
      var replaceMask = "<strong>$&</strong>";
      var labelStr = item.label.replace(regEx, replaceMask);
      var htmlStr;

      if (item.type == "person") {
          htmlStr = 	'<div class="person-info">'+ item.userKorName +' '+ item.jobTitle +' <span>'+ item.deptKorName +'</span></div>';
      }

      var listItem;

      if (item.type == "keyword") {
          listItem = '<li style="display:none"></li>';
      } else {
          listItem = '<li></li>';
      }

      return $(listItem)
              .data( "ui-autocomplete-item", item )
              .append(htmlStr)
              .appendTo(ul);
  };

  $(document).on('click','.form-schedule .check-allDay', function() {
      var $schWrap = $(this).closest(".form-schedule");
      var $select = $schWrap.find("select");

      if ($(this).prop("checked")) {
          $select.prop("disabled", true);
      } else {
          $select.prop("disabled", false);
      }
  });
  
  // Delete Schedule Join Member
  $(document).on('click', '.member-info .btn-delete', function(){
      $(this).closest(".member-info").remove();
      smsCheck();
  })
};

// 일정등록 자동 완성 모듈
const setAutocompleteJoinGroup = function(input) {
  // Test Item
  var keyword = [];   

  //var $autocompleteWrap;
  $(input).on('keyup', function(e) {
      var inputVal = $(input).val();
      var searchVal = "'" + inputVal + "'";
      var sessionId = $(input).closest(".form-schedule").attr("data-sessionId");
      
     // 부서 검색
     var options = {
       keyword: inputVal, // 부서이름
        limit: 30    // default 30, max 100
     };

     var requestParam = {
      query: {
          "event": 'retrieveDeptInfo'
        },
      payload: {
        "deptName": inputVal
      }
    };     
    
    sendChatApi(requestParam, sessionId , function(payload) {
      if(payload && payload.queryResult && payload.queryResult.messages && payload.queryResult.messages.length>0){    
        var response = JSON.parse(payload.queryResult.messages[0].response);

        if(response) {
          var departments = response["deptInfo"];
        
          if(departments) {

          $.each(departments, function(index) {
            var department = departments[index]
            var deptKorName = department.deptKorName;
            department.label = deptKorName;
            department.type = "group";
          });
            
          keyword = departments;
          $(input).autocomplete("option", "source", keyword);
          $(input).autocomplete("option", "appendTo", $(input).closest(".form-schedule").find(".autocomplete-member"));
        }
        }
      }
     });
  }).autocomplete({
      appendTo: ".form-schedule .autocomplete-member",
      autofocus: true,
      delay: 300,
      source: keyword,
      create: function() {
        
      },
      open: function(event, ui) {
          $('.form-schedule .ui-autocomplete').scrollTop();
      },
      focus: function(event, ui){
          $(this).val(ui.item.label);
         // return false;
      },
      select: function(event, ui){
          var $memList = $(this).closest(".form-schedule").find(".schedule-join-member").find(".selected-members");
          var htmlStr;

          $(this).val('').focus();


          htmlStr = '<div class="dept-info">'
          + '<span class="name">' + ui.item.fullPathKor + '</span>'
          + '<button type="button" class="btn btn-delete">' 
            +  '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
            +  '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
            +  '</svg>'
          + '</button>'
          + '<div class="auto-detail-tooltip">'+ ui.item.fullPathKor +'</div>'
          + '<input type="hidden" value="'+ui.item.fullPathKor+'" class="dept-mobile"/>'
          + '<input type="hidden" value="'+ui.item.deptKorName+'" class="dept-name"/>'
          + '<input type="hidden" value="'+ui.item.deptId+'" class="dept-id"/>'
          +'</div>';
          
          $memList.append(htmlStr);
          if($('.selected-members').height() > 110) {
            $('.selected-members').addClass('long');
            $('.member-open').addClass('show');
          } else {
            $('selected-members').removeClass('long');
            $('.member-open').removeClass('show');
          }

          $('.auto-detail-tooltip').tooltip({track: true});
          smsCheck();

          return false;
      }
  }).focus(function(){
      $(this).data("uiAutocomplete").search($(this).val());

  }).autocomplete("instance")._renderItem = function( ul, item ) {
      var searchMask = this.element.val();
      var regEx = new RegExp(searchMask, "ig");
      var replaceMask = "<strong>$&</strong>";
      var labelStr = item.label.replace(regEx, replaceMask);
      var htmlStr;

      if (item.type == "group") {
          htmlStr = 	'<div class="person-info">'+ item.fullPathKor + '</div>';
      }

      var listItem;

      if (item.type == "keyword") {
          listItem = '<li style="display:none"></li>';
      } else {
          listItem = '<li></li>';
      }

      return $(listItem)
              .data( "ui-autocomplete-item", item )
              .append(htmlStr)
              .appendTo(ul);
  };
  
  // Delete Schedule Join group
  $(document).on('click', '.dept-info .btn-delete', function(){
      $(this).closest(".dept-info").remove();
      smsCheck();
  })
};

function closeSMSPopup() {
  $('#sendSms').removeClass('show');
  $('.plugin-dim').removeClass('show');
  setTimeout(function() {
    $('.plugin-dim').remove();
    $('#sendSms').remove();
  }, 300);
}

function sendSMSPopupOpen(data, targetName, targetDept, targetMobileNum) {

  var userId = null;

  if(data) {
    userId = data.userId;  
  } else {
    userId = chatui.getSetting("userId");
  }

  var pulginDim = $('<div class="plugin-dim"></div>');

  var smsPopup = $('<div class="plugins" id="sendSms"></div>');
  var smsPoupHeader = $('<div class="plugin-header">'
   +'<h1>SMS 발송</h1>'
   +'<span class="close-plugin" onclick="closeSMSPopup()">'
   +'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
   +'<path d="M5.74478 4.75483C5.47141 4.48146 5.0282 4.48146 4.75483 4.75483C4.48146 5.0282 4.48146 5.47141 4.75483 5.74478L13.01 13.9999L4.75506 22.2548C4.48169 22.5282 4.48169 22.9714 4.75506 23.2448C5.02843 23.5181 5.47164 23.5181 5.74501 23.2448L13.9999 14.9899L22.2548 23.2448C22.5282 23.5181 22.9714 23.5181 23.2448 23.2448C23.5181 22.9714 23.5181 22.5282 23.2448 22.2548L14.9899 13.9999L23.245 5.74478C23.5184 5.47141 23.5184 5.0282 23.245 4.75483C22.9716 4.48146 22.5284 4.48146 22.2551 4.75483L13.9999 13.01L5.74478 4.75483Z" fill="#2C2C2C"/>'
   + '</svg>'
   +'</span>'
   + '</div>'); 

  smsPopup.append(smsPoupHeader);

  var smsPopupContetns = $('<div class="plugin-contents"></div>');
  var smsPopUpForm = $('<div class="form-sms form-schedule" data-userId="' + userId +'"></div>');
 
  var smsPopUpType = $('<div class="input-box"><label>구분<b>*</b></label></div>');
  var smsPopUpTypeRadio = $('<ul class="radio-list"></ul>');
  var smsPopupTypePerson = $('<li>'
  +'<label class="input-radio">'
  +'<input type="radio" name="voice-select" id="person" value="person" checked="checked"  />'
  +'<span class="radiomark"></span>'
  +'개인'
  +'</label>'
  +'</li>');

  smsPopupTypePerson.on('click', function() {
    $('.selected-members').empty();
    $('#attendees').removeClass('hide');
    $('#department').addClass('hide');
  });

  smsPopUpTypeRadio.append(smsPopupTypePerson);
  var smsPopUpTypeGroup = $('<li>'
  +'<label class="input-radio">'
  +'<input type="radio" name="voice-select" id="group" value="group" />'
  +'<span class="radiomark"></span> 조직'
  +'</label>'
  +'</li>');

  smsPopUpTypeGroup.on('click', function() {
    $('.selected-members').empty();
    $('#attendees').addClass('hide');
    $('#department').removeClass('hide');
  });
  smsPopUpTypeRadio.append(smsPopUpTypeGroup);
  smsPopUpType.append(smsPopUpTypeRadio);
  smsPopUpForm.append(smsPopUpType);
  
  var smsPopupMemberInputBox = $('<div class="input-box"><label>받는 사람<b>*</b></label></div>');
  var memberList = $('<div class="schedule-join-member"></div>');
  var selectedMembersFold = $('<span class="member-open"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39823 5.61757C8.1709 5.4155 7.82833 5.4155 7.601 5.61757L2.26536 10.3604C2.10025 10.5071 1.84742 10.4923 1.70065 10.3271C1.55388 10.162 1.56875 9.9092 1.73387 9.76243L7.0695 5.01964C7.59995 4.54814 8.39928 4.54814 8.92972 5.01964L14.2654 9.76243C14.4305 9.9092 14.4453 10.162 14.2986 10.3271C14.1518 10.4923 13.899 10.5071 13.7339 10.3604L8.39823 5.61757Z" fill="#6B6B6B"/>'
  +'</svg></span>');

  selectedMembersFold.on('click',function() {
    if($(this).parent().find('.selected-members').hasClass('long')) {
      $(this).parent().find('.selected-members').removeClass('long');
      $(this).addClass('unfold');
    } else {
      $(this).parent().find('.selected-members').addClass('long');
      $(this).removeClass('unfold');
    }
  });
  memberList.append(selectedMembersFold);
  var selectedMembers = $('<div class="selected-members fold"></div>');

  if(targetName && targetDept && targetMobileNum) {
    var targetMemberInfo = $('<div class="member-info">'
    +targetName
          + '<button type="button" class="btn btn-delete">' 
            +  '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
            +  '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
            +  '</svg>'
          + '</button>'
        +'<div class="auto-detail-tooltip">'+targetDept+'</div>'
        + '<input type="hidden" value="'+targetMobileNum+'" class="person-mobile"/>'
        + '<input type="hidden" value="'+targetName+'" class="person-name"/>'
    +'</div>');
    selectedMembers.append(targetMemberInfo);
  };

  memberList.append(selectedMembers);
  var autocompleteMember = $('<div class="autocomplete-member"><ul id="ui-id-3" tabindex="0" class="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front" style="display: none;"></ul></div>');
  memberList.append(autocompleteMember);
  var memberInput = $('<input type="text" placeholder="이름을 입력해 주세요." id="attendees" class="search-input" />');
  setAutocompleteJoinMember(memberInput);
  memberList.append(memberInput);

  var groupInput = $('<input type="text" placeholder="조직명을 입력해 주세요." id="department" class="search-input hide" />');
  setAutocompleteJoinGroup(groupInput);
  memberList.append(groupInput);

  smsPopupMemberInputBox.append(memberList);
  smsPopUpForm.append(smsPopupMemberInputBox);

  var smsPopupContetnBox = $('<div class="input-box"><label>내용<b>*</b></label>');
  var smsPopupTextArea = $('<textarea placeholder="내용을 입력해 주세요" name="smsMessage" id="smsMessage"></textarea>');
  smsPopupTextArea.on('keyup', function() {
    smsContent = $(this).val();
    smsCheck();
  });
  smsPopupContetnBox.append(smsPopupTextArea);
  smsPopUpForm.append(smsPopupContetnBox);

  var isMobile = Mobile();

  if(!isMobile) {
    var smsDetailLink = $('<p class="detail-submit">'
    +'<a href="http://gportal.lgchem.com/support/sms/sms.do?gubun=&receiverId=" target="_blank">예약문자 등 상세 기능을 이용하려면 여기를 클릭해 주세요.</a>'
    + '</p>');
    smsPopUpForm.append(smsDetailLink);
  }
  
  var smsPopupSubmitButton = $('<button type="button" class="btn btn-plugin btn-apply btn-disabled" id="btn-sms">발송</button>');

  smsPopupSubmitButton.on('click', function(){
    if(!$(this).hasClass('btn-disabled')) {
      closeSMSPopup();
     
      var sendNumbers = '';
      var sendNames = '';
      
      var numberInputs = $(this).parents(".form-sms").find('.person-mobile');
      
      for(var i = 0; i<numberInputs.length; i++) {
        if(i == numberInputs.length-1) {
          sendNumbers += $(numberInputs[i]).val();
        } else {
          sendNumbers += $(numberInputs[i]).val() + ',';
        } 
      };
  
      var nameInputs = $(this).parents(".form-sms").find('.person-name');
     
      for(var k=0; k < nameInputs.length; k++) {
        if(k == nameInputs.length-1) {
          sendNames += $(nameInputs[k]).val()
        } else {
          sendNames += $(nameInputs[k]).val() + ','
        }
      }

      var targetType = $(this).closest('.form-sms').find("input[name='voice-select']:checked").val();
      var depNames = $(this).parent('.form-sms').find('.dept-name');

      for(var k=0; k < depNames.length; k++) {
        if(k == depNames.length-1) {
          sendNames += $(depNames[k]).val()
        } else {
          sendNames += $(depNames[k]).val() + ','
        }
      }
      
      smsNames = sendNames;

      if(targetType == 'group') {

        var depInputs = $(this).parent('.form-sms').find('.dept-id');
     
        for(var j=0; j<depInputs.length; j++) {
          var depId = $(depInputs[j]).val();
          var payload = 
            {
              "subject" : '',
              "targetList" : depId,
              "targetDiv" : targetType,
              "message": smsContent
            };
            
          chatui.sendEventMessage('sendSmsNew', payload);
        }
        
      } else {

        var payload = {
          "subject" : '',
          "targetList" : sendNumbers,
          "targetDiv" : targetType,
          "message": smsContent
        }
        
        chatui.sendEventMessage('sendSmsNew', payload);
      }

    } else {
      return;
    }
  });
  
  smsPopUpForm.append(smsPopupSubmitButton);
  smsPopupContetns.append(smsPopUpForm);
  smsPopup.append(smsPopupContetns);

  $('.test-panel').append(pulginDim);
  $('.test-panel').append(smsPopup);

  $('.plugin-dim').css('display', 'block');
  $('#sendSms').css('display', 'block');

  setTimeout(function() {
    $('.plugin-dim').addClass('show');
    $('#sendSms').addClass('show');
  }, 100);
};

function closeSettingPopup() {
  $('#notiSetting').removeClass('show');
  $('.plugin-dim').removeClass('show');
  setTimeout(function() {
    $('.plugin-dim').remove();
    $('#notiSetting').remove();
  }, 300);
}

function showNotiSettings() {
  var todayTodoSetting = 'Y';
  //var ecmUpdateSetting = 'Y';
  //var companyNoticeSetting = 'Y';
  //var teamBirthSetting = 'Y';
  //var myBirthSetting = 'Y';
  var push15BeforeSetting = 'Y';
  var pushEduBotSetting = 'Y';
  //var birthPrivacySetting = 'Y';
  //var ecmPushSetting = 'Y';
  //var noticePushSetting = 'Y';

  var pulginDim = $('<div class="plugin-dim"></div>');
  var notiSetting = $('<div class="plugins" id="notiSetting"></div>');
  var notiSettingHeader = $('<div class="plugin-header">'
  +'<h1>알림 설정</h1>'
  +'<span class="close-plugin" onclick="closeSettingPopup()">'
   +'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
   +'<path d="M5.74478 4.75483C5.47141 4.48146 5.0282 4.48146 4.75483 4.75483C4.48146 5.0282 4.48146 5.47141 4.75483 5.74478L13.01 13.9999L4.75506 22.2548C4.48169 22.5282 4.48169 22.9714 4.75506 23.2448C5.02843 23.5181 5.47164 23.5181 5.74501 23.2448L13.9999 14.9899L22.2548 23.2448C22.5282 23.5181 22.9714 23.5181 23.2448 23.2448C23.5181 22.9714 23.5181 22.5282 23.2448 22.2548L14.9899 13.9999L23.245 5.74478C23.5184 5.47141 23.5184 5.0282 23.245 4.75483C22.9716 4.48146 22.5284 4.48146 22.2551 4.75483L13.9999 13.01L5.74478 4.75483Z" fill="#2C2C2C"/>'
   + '</svg>'
   +'</span>'
   
  + '</div>'); 
  notiSetting.append(notiSettingHeader);

  var notiSettingContetns = $('<div class="plugin-contents"></div>');
  var dailytitle = $('<div class="sub-title">데일리 정보</div>');
  notiSettingContetns.append(dailytitle);

  var onOffBox = $('<div class="on-off-box"></div>');
  var onOffList = $('<ul></ul>');
  /*
  var dailyAll = $('<li><span class="a-text">전체</span></li>');
  var dailyAllSwitch = $('<label class="switch">'
               +'<input type="checkbox" id="dailyAll" checked="checked"/ >'
                +'<span class="slider round"></span>'
              +'</label>'
            +'</li>');
  dailyAllSwitch.on('click', function() {
    if($(this).find('#dailyAll').prop("checked")) {
      $('#todayTodo').prop('checked', true);
      todayTodoSetting = 'Y';
      $('#ecmUpdate').prop('checked', true);
      ecmUpdateSetting = 'Y';
      $('#companyNotice').prop('checked', true);
      companyNoticeSetting = 'Y';
      $('#teamBirth').prop('checked', true);
      teamBirthSetting = 'Y';
      $('#myBirth').prop('checked', true);
      myBirthSetting = 'Y';
    } else {
      $('#todayTodo').prop('checked', false);
      todayTodoSetting = 'N';
      $('#ecmUpdate').prop('checked', false);
      ecmUpdateSetting = 'N';
      $('#companyNotice').prop('checked', false);
      companyNoticeSetting = 'N';
      $('#teamBirth').prop('checked', false);
      teamBirthSetting = 'N';
      $('#myBirth').prop('checked', false);
      myBirthSetting = 'N'; 
    }
  });
  dailyAll.append(dailyAllSwitch);
  onOffList.append(dailyAll);
    */
    
  var todayTodo = $('<li><span class="a-text">오늘의 일정</span></li>');
  var todayTodoSwitch = $('<label class="switch">'
               +'<input type="checkbox" id="todayTodo" checked="checked" />'
                +'<span class="slider round"></span>'
              +'</label>'
            +'</li>');
  todayTodoSwitch.on('click', function() {
    if($(this).find('#todayTodo').prop("checked")) {
      todayTodoSetting = 'Y';  
    } else {
      todayTodoSetting = 'N';  
    }
  });
  todayTodo.append(todayTodoSwitch);
  onOffList.append(todayTodo);

  onOffBox.append(onOffList);
  notiSettingContetns.append(onOffBox);

  var pushTitle = $('<div class="sub-title">푸시 알림</div>');
  notiSettingContetns.append(pushTitle);

  var onOffBox2 =  $('<div class="on-off-box"></div>');
  var onOffList2 = $('<ul></ul>');

  var pushAll = $('<li><span class="a-text">전체</span></li>');
  var pushAllSwitch = $('<label class="switch">'
               +'<input type="checkbox" id="pushAll" checked="checked" />'
                +'<span class="slider round"></span>'
              +'</label>'
            +'</li>');
  pushAllSwitch.on('click', function() {
    if($(this).find('#pushAll').prop("checked")) {
      $('#push15Before').prop('checked', true);
      push15BeforeSetting = 'Y';
      $('#pushEduBot').prop('checked', true);
      pushEduBotSetting = 'Y';
    } else {
      $('#push15Before').prop('checked', false);
      push15BeforeSetting = 'N';
      $('#pushEduBot').prop('checked', false);
      pushEduBotSetting = 'N';
    }
  });
  pushAll.append(pushAllSwitch);
  onOffList2.append(pushAll);

  var push15Before =  $('<li><span class="a-text">일정 15분 전 알림</span></li>');
  var push15BeforeSwitch = $('<label class="switch">'
  +'<input type="checkbox" id="push15Before" checked="checked" />'
   +'<span class="slider round"></span>'
  +'</label>'
  +'</li>');
  push15BeforeSwitch.on('click', function() {
  if($(this).find('#push15Before').prop("checked")) {
    push15BeforeSetting = 'Y';  
  } else {
    push15BeforeSetting = 'N';  
  }
  });
  push15Before.append(push15BeforeSwitch);
  onOffList2.append(push15Before);

  var pushEduBot = $('<li><span class="a-text">학습봇 반영 완료 알림</span></li>');
  var pushEduBotSwitch = $('<label class="switch">'
  +'<input type="checkbox" id="pushEduBot" checked="checked" />'
   +'<span class="slider round"></span>'
  +'</label>'
  +'</li>');
  pushEduBotSwitch.on('click', function() {
  if($(this).find('#pushEduBot').prop("checked")) {
    pushEduBotSetting = 'Y';  
  } else {
    pushEduBotSetting = 'N';  
  }
  });
  pushEduBot.append(pushEduBotSwitch);
  onOffList2.append(pushEduBot);

  onOffBox2.append(onOffList2);
  
  notiSettingContetns.append(onOffBox2);

  var settingSaveBtn = $('<button type="button" class="btn btn-plugin btn-apply" id="btn-setting">저장</button>');
  settingSaveBtn.on('click', function() {
    var requestParam = {
      query: {
        "event": "registAlarmInfo"
      },
      payload:{
        "learningBot": pushEduBotSetting,
        "message": push15BeforeSetting,
        "planner": push15BeforeSetting,
        "schedule": todayTodoSetting,
        "userId": chatui.getSetting('userId')
      }
    };
  
    console.log('settingSaveBtn : ', requestParam);
    sendChatApi(requestParam, null, function(payload){
      console.log(payload);
    });

    closeSettingPopup();
  });

  notiSettingContetns.append(settingSaveBtn);
  notiSetting.append(notiSettingContetns);


  $('.test-panel').append(pulginDim);
  $('.test-panel').append(notiSetting);

  $('.plugin-dim').css('display', 'block');
  $('#notiSetting').css('display', 'block');


  var requestParam = {
    query: {
      "event": "retrieveAlarmInfo"
    },
    payload:{
      "userId" : chatui.getSetting("userId")
    }
  };

  sendChatApi(requestParam, null, function(payload){
    var key = chatui.getSetting("userId") ? chatui.getSetting("userId").replace(/=/gi, "") : "";
    var lastAccessDate = localStorage.getItem(key + "_lastAccessDate");
    if(lastAccessDate == null) { lastAccessDate=''; };

    var message = payload.queryResult.messages[0];
    var response = message.response;
    var result;
    if(response) result = JSON.parse(response);

    console.log('result : ', result);
    // 푸시 설정 Read 성공일 경우
    if(result) {
      var pushData = result.template.outputs[0].data;
      if(pushData) {
        var data = {
          "lastAccessDate": '',
          "learningBot": pushData.learningBot,
          "message": pushData.message,
          "planner": pushData.planner,
          "schedule": pushData.schedule
        }

        setNotification(data);    

        if(data.schedule == 'N') {
          $('#todayTodo').prop('checked', false);
          todayTodoSetting = 'N';
        }

        if(data.planner == 'N') {
          $('#push15Before').prop('checked', false);
          push15BeforeSetting = 'N';
        }

        if(data.learningBot == 'N') {
          $('#pushEduBot').prop('checked',false);
          pushEduBotSetting = 'N';
        }

        if(data.planner == 'Y' && data.learningBot == 'Y') {
          $('#pushAll').prop('checked', true);
        } else {
          $('#pushAll').prop('checked', false);
        }

      }
    }
  });

  setTimeout(function() {
    $('.plugin-dim').addClass('show');
    $('#notiSetting').addClass('show');
  }, 100)
}

var welcomeClick = false;
function welcomeAppend(welcomeMessage) {
    //console.log('welcomeMessage', welcomeMessage);
// if(welcomeMessage[0].response !== null) $('.chat-message.left').last().remove();
  $('.chat-message.left').last().remove();
  if(welcomeMessage[0].panelType === "error"){
    appendWelcomeText("안녕하세요, 스마트 업무비서 케미입니다. 오늘도 좋은 하루 보내세요!");
  }else{
  if(JSON.parse(welcomeMessage[0].response)) {
    var todaySchedule = JSON.parse(welcomeMessage[0].response).template.outputs[0];
  //var ecmUpdateCount = JSON.parse(welcomeMessage[3].response).template.outputs[0];
  //var notice  = JSON.parse(welcomeMessage[2].response).template.outputs[0];
  //var todayBirth  = JSON.parse(welcomeMessage[1].response).template.outputs[0];
  //var hrInfo  = JSON.parse(welcomeMessage[4].response).template.outputs[0];
  var userInfo = JSON.parse(welcomeMessage[1].response).template.outputs[0].data[0]; 

  //var birthDayYn = JSON.parse(welcomeMessage[5].response).template.outputs[0].birthdayYn;
  var alarmInfo = JSON.parse(welcomeMessage[2].response).template.outputs[0].data;

  var welcomeContent = $('<div class="welcome-contents"></div>');
  var timeNow = $('<h6>'+ dateToStr(new Date()) +'</h6>');
  welcomeContent.append(timeNow);

  var userName = $('<h1>' + userInfo.userKorName + ' ' + userInfo.jobTitle +'님, <br />오늘도 멋진 하루 보내세요!</h1>');
  var characterBox = $('<div class="welcome-img"><img src="'+imgBaseUrl+'/images/hello_big.gif" /></div>');
  var welcomeMessage = "";
  if(alarmInfo.openMessage == "Y") {
     userName = $('<h1>' + userInfo.userKorName + ' ' + userInfo.jobTitle +'님, 반가워요!<br />새로워진 엘지니와 대화해 보세요.</h1>');
     characterBox = $('<div class="welcome-img"><img src="'+imgBaseUrl+'/images/welcome.gif" /></div>');
     
     welcomeMessage = $(
        '<div class="message">'
        +   '<h2>✔<b>New 엘지니, 무엇이 달라졌을까요?</b></h2>'
        +    '<p>'
        +    '    · 일정 등록, 시스템 담당자 검색 등 기존 챗봇 기능을 더욱 편리하게 리뉴얼했어요.</br>'
        +    '    · 예산시스템과 수입진행현황 조회 기능을 새로 추가했어요. (ERP 관련 기능은 계속 업데이트 될 예정입니다.)</br>'
        +    '    · 학습봇 모드를 통해 새로운 정보 등록을 요청할 수 있어요.</br>'
        +    '    · 엘지전자 전용 Chat GPT 서비스를 연동했어요.</br>'
        +    '</p>'
        +    '</br>'
        +    '<h2>✔<b>엘지니를 100% 활용하는 Tip!</b></h2>'
        +    '<p>'
        +    '    · HR, 총무, IT 등 원하는 정보를 쉽게 찾아가도록 메뉴를 구성했어요. 정확한 검색어가 생각나지 않아도 버튼을 클릭해 답변을 확인해보세요.</br>'
        +    '    · 일상대화 기능으로 엘지니의 매력이 한층 업그레이드됐어요. 다정다감한 엘지니와 자주 대화 나눠요.😊</br>'
        +    '    ex) 사투리해봐, 퀴즈내줘</br>'
        +    '</p>'
        +'</div>' )
  }
  //else {
  //   if(alarmInfo.firstMessage == "N") userName = $('<h1>케미를 다시 찾아주셨네요.<br />무엇을 도와드릴까요?</h1>');
  //}

  welcomeContent.append(userName);
  welcomeContent.append(characterBox);
  
  if(alarmInfo.openMessage == "Y") {
      welcomeContent.append(welcomeMessage);
  }
  
  var welcomeList = $('<ul></ul>');
  var todayTodo = $('<li>'
  +'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
  + '<path d="M17.4 14.5999L15.893 14.5999C15.5617 14.5999 15.293 14.3313 15.293 13.9999C15.293 13.6685 15.5617 13.3999 15.893 13.3999L17.4 13.3999C17.7314 13.3999 18 13.6685 18 13.9999C18 14.3313 17.7314 14.5999 17.4 14.5999Z" fill="#6B6B6B"/>'
  +'<path d="M12.8791 14.5999L11.1209 14.5999C10.7896 14.5999 10.5209 14.3313 10.5209 13.9999C10.5209 13.6685 10.7896 13.3999 11.1209 13.3999L12.8791 13.3999C13.2104 13.3999 13.4791 13.6685 13.4791 13.9999C13.4791 14.3313 13.2104 14.5999 12.8791 14.5999Z" fill="#6B6B6B"/>'
  +'<path d="M8.10698 14.5999L6.6 14.5999C6.26863 14.5999 6 14.3313 6 13.9999C6 13.6685 6.26863 13.3999 6.6 13.3999L8.10698 13.3999C8.43835 13.3999 8.70698 13.6685 8.70698 13.9999C8.70698 14.3313 8.43835 14.5999 8.10698 14.5999Z" fill="#6B6B6B"/>'
  +'<path d="M11.1209 17.5999L12.8791 17.5999C13.2104 17.5999 13.4791 17.3313 13.4791 16.9999C13.4791 16.6685 13.2104 16.3999 12.8791 16.3999L11.1209 16.3999C10.7896 16.3999 10.5209 16.6685 10.5209 16.9999C10.5209 17.3313 10.7896 17.5999 11.1209 17.5999Z" fill="#6B6B6B"/>'
  +'<path d="M6.6 17.5999L8.10698 17.5999C8.43835 17.5999 8.70698 17.3313 8.70698 16.9999C8.70698 16.6685 8.43835 16.3999 8.10698 16.3999L6.6 16.3999C6.26863 16.3999 6 16.6685 6 16.9999C6 17.3313 6.26863 17.5999 6.6 17.5999Z" fill="#6B6B6B"/>'
  +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.5999 2.6C8.5999 2.26863 8.33127 2 7.9999 2C7.66853 2 7.3999 2.26863 7.3999 2.6V4H6C4.34315 4 3 5.34315 3 7V19C3 20.6569 4.34315 22 6 22H18C19.6569 22 21 20.6569 21 19V7C21 5.34315 19.6569 4 18 4H16.5999V2.6C16.5999 2.26863 16.3313 2 15.9999 2C15.6685 2 15.3999 2.26863 15.3999 2.6V4H8.5999L8.5999 2.6ZM18 5.2H6C5.00589 5.2 4.2 6.00589 4.2 7V9L19.8 9V7C19.8 6.00589 18.9941 5.2 18 5.2ZM4.2 19V10.2L19.8 10.2V19C19.8 19.9941 18.9941 20.8 18 20.8H6C5.00589 20.8 4.2 19.9941 4.2 19Z" fill="#6B6B6B"/>'
  +'</svg>'
   +'<span class="list-title">오늘의 일정</span>'
   +'<span class="count"><b>' + (todaySchedule.totalCnt ? todaySchedule.totalCnt : '0' )+ '</b>건</span>'
   +'<span class="arrow-right">' + arrowRight + '</span>'
   +'</li>');

   
   todayTodo.on('click', function() {
    chatui.sendMessage("오늘의 일정");
    welcomeClick = true;
   });

  if(alarmInfo["schedule"] == 'Y') {
    welcomeList.append(todayTodo); 
  }
  /*
   var ecmUpdate = $('<li>'
   +'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
   +'<path d="M8 13.4C8 13.0687 8.26863 12.8 8.6 12.8H15.4C15.7314 12.8 16 13.0687 16 13.4C16 13.7314 15.7314 14 15.4 14H8.6C8.26863 14 8 13.7314 8 13.4Z" fill="#6B6B6B"/>'
   +'<path d="M8.6 15.8C8.26863 15.8 8 16.0687 8 16.4C8 16.7314 8.26863 17 8.6 17H13.4C13.7314 17 14 16.7314 14 16.4C14 16.0687 13.7314 15.8 13.4 15.8H8.6Z" fill="#6B6B6B"/>'
   +'<path fill-rule="evenodd" clip-rule="evenodd" d="M4 5C4 3.34315 5.34315 2 7 2H12.7574C13.553 2 14.3161 2.31607 14.8787 2.87868L19.1213 7.12132C19.6839 7.68393 20 8.44699 20 9.24264V19C20 20.6569 18.6569 22 17 22H7C5.34315 22 4 20.6569 4 19V5ZM17 20.8H7C6.00589 20.8 5.2 19.9941 5.2 19V5C5.2 4.00589 6.00589 3.2 7 3.2H12.7574C12.8051 3.2 12.8527 3.2019 12.8999 3.20565V7C12.8999 8.1598 13.8401 9.1 14.9999 9.1H18.7943C18.7981 9.14728 18.8 9.19486 18.8 9.24264V19C18.8 19.9941 17.9941 20.8 17 20.8ZM18.2029 7.9L14.0999 3.79696V7C14.0999 7.49706 14.5028 7.9 14.9999 7.9H18.2029Z" fill="#6B6B6B"/>'
   +'</svg>'
   +'<span class="list-title">ECM 업데이트</span>'
   +'<span class="count"><b>' + ecmUpdateCount.totalCnt +'</b>건</span>' 
   +'<span class="arrow-right">' + arrowRight + '</span>'
   +'</li>'
   );

   ecmUpdate.on('click', function() {
    chatui.sendMessage("ECM 업데이트");
    welcomeClick = true;
   });

  if(alarmInfo["favorite"] == 'Y') {
    welcomeList.append(ecmUpdate);
  }

   var allNotice = $('<li>'
   +'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
   + '<path fill-rule="evenodd" clip-rule="evenodd" d="M12.4995 17.8474C11.3803 17.3306 10.219 16.9198 9.03082 16.6184C9.13589 18.3636 9.48754 19.7475 9.72656 20.5156C9.94447 21.2158 9.43883 22.0006 8.65011 22.0006H6.43325C5.99256 22.0006 5.57349 21.7335 5.41742 21.2874C5.15375 20.5336 4.56276 18.5754 4.50463 16.0085C4.37456 16.006 4.24441 16.0047 4.11419 16.0047H3.5C2.67157 16.0047 2 15.3331 2 14.5047V7.50468C2 6.67626 2.67157 6.00468 3.5 6.00468H4.09711C7.00105 6.00468 9.87016 5.3723 12.505 4.1515L16.6592 2.22675C17.9847 1.61261 19.5 2.58057 19.5 4.04143V8.04198C20.9188 8.28006 21.9999 9.51402 21.9999 11.0005C21.9999 12.487 20.9188 13.7209 19.5 13.959V17.9538C19.5 19.4135 17.9867 20.3815 16.6615 19.7695L12.4995 17.8474ZM4.11419 14.8047H3.5C3.33431 14.8047 3.2 14.6704 3.2 14.5047V7.50468C3.2 7.339 3.33431 7.20468 3.5 7.20468H4.09711C5.34204 7.20468 6.58093 7.09504 7.79981 6.87883L7.7998 15.1275C6.58642 14.9133 5.35329 14.8047 4.11419 14.8047ZM8.9998 15.3753C10.3729 15.7005 11.7141 16.1629 13.0027 16.758L17.1646 18.68C17.6947 18.9249 18.3 18.5377 18.3 17.9538V4.04143C18.3 3.45708 17.6939 3.0699 17.1637 3.31556L13.0095 5.24031C11.719 5.83823 10.3755 6.30299 8.9998 6.63L8.9998 15.3753ZM19.5 12.7301C20.2508 12.5134 20.7999 11.8211 20.7999 11.0005C20.7999 10.1799 20.2508 9.48757 19.5 9.27087V12.7301ZM5.70651 16.0682C6.41485 16.1247 7.11889 16.219 7.81569 16.3502C7.89754 18.3225 8.28433 19.9023 8.5587 20.8006H6.51893C6.27092 20.0694 5.76931 18.3285 5.70651 16.0682Z" fill="#6B6B6B"/>'
   + '</svg>'
   +'<span class="list-title">전사 공지사항</span>'
   +'<span class="count"><b>'+ notice.totalCnt + '</b>건</span>'
   +'<span class="arrow-right">' + arrowRight + '</span>'
   +'</li>');

   allNotice.on('click', function() {
    chatui.sendMessage("전사 공지사항");
    welcomeClick = true;
   });


  if(alarmInfo["notice"] == 'Y') {
    welcomeList.append(allNotice);
  }

   var todayBirthday = $('<li>'
   +'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
   +'<path fill-rule="evenodd" clip-rule="evenodd" d="M15.5921 8.87659C15.2009 8.81956 14.8629 8.57354 14.6884 8.21882L12.3178 3.39968C12.1868 3.13344 11.8124 3.13344 11.6814 3.39968L9.31081 8.21882C9.13632 8.57354 8.79833 8.81956 8.40715 8.87659L3.10634 9.64937C2.81897 9.69127 2.69307 10.0539 2.91011 10.2661L6.74581 14.0173C7.02752 14.2928 7.15603 14.689 7.08963 15.0774L6.18414 20.3742C6.13233 20.6773 6.44548 20.8893 6.69857 20.7559L11.4398 18.2551C11.7901 18.0703 12.2091 18.0703 12.5595 18.2551L17.3006 20.7559C17.5537 20.8893 17.8669 20.6773 17.8151 20.3742L16.9096 15.0774C16.8432 14.689 16.9717 14.2928 17.2534 14.0173L21.0891 10.2661C21.3061 10.0539 21.1803 9.69127 20.8929 9.64937L15.5921 8.87659ZM13.3946 2.87C12.824 1.71 11.1753 1.71 10.6046 2.87L8.23404 7.68914L2.93323 8.46193C1.65728 8.64794 1.1478 10.2211 2.07109 11.1241L5.90679 14.8752L5.0013 20.172C4.78334 21.4469 6.11718 22.4192 7.25842 21.8173L11.9996 19.3165L16.7408 21.8173C17.882 22.4192 19.2159 21.4469 18.9979 20.172L18.0924 14.8752L21.9281 11.124C22.8514 10.2211 22.3419 8.64794 21.066 8.46193L15.7652 7.68914L13.3946 2.87Z" fill="#6B6B6B"/>'
   +'</svg>'
   +'<span class="list-title">금주의 생일 소식</span>'
   +'<span class="count"><b>' + todayBirth.totalCnt +'</b>건</span>'
   +'<span class="arrow-right">' + arrowRight + '</span>'
   +'</li>');

   todayBirthday.on('click', function() {
    chatui.sendMessage("금주의 생일 소식");
    welcomeClick = true;
   });
   
  if(alarmInfo["anniversary"] == 'Y') {
   welcomeList.append(todayBirthday);
  }

   var hrInfo = $('<li>'
   +'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
   +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.4999 9.3C9.49401 9.3 10.2999 8.49411 10.2999 7.5C10.2999 6.50589 9.49401 5.7 8.4999 5.7C7.50579 5.7 6.6999 6.50589 6.6999 7.5C6.6999 8.49411 7.50579 9.3 8.4999 9.3ZM8.4999 10.5C10.1568 10.5 11.4999 9.15685 11.4999 7.5C11.4999 5.84315 10.1568 4.5 8.4999 4.5C6.84305 4.5 5.4999 5.84315 5.4999 7.5C5.4999 9.15685 6.84305 10.5 8.4999 10.5Z" fill="#6B6B6B"/>'
   +'<path fill-rule="evenodd" clip-rule="evenodd" d="M2 17.8C2 14.4311 4.73106 11.7 8.1 11.7H8.9C12.2689 11.7 15 14.4311 15 17.8V18.9C15 19.2314 14.7314 19.5 14.4 19.5C14.0686 19.5 13.8 19.2314 13.8 18.9V17.8C13.8 15.0939 11.6062 12.9 8.9 12.9H8.1C5.3938 12.9 3.2 15.0939 3.2 17.8V18.9C3.2 19.2314 2.93137 19.5 2.6 19.5C2.26863 19.5 2 19.2314 2 18.9V17.8Z" fill="#6B6B6B"/>'
   +'<path fill-rule="evenodd" clip-rule="evenodd" d="M15.9999 10.3C16.7179 10.3 17.2999 9.71797 17.2999 9C17.2999 8.28203 16.7179 7.7 15.9999 7.7C15.2819 7.7 14.6999 8.28203 14.6999 9C14.6999 9.71797 15.2819 10.3 15.9999 10.3ZM15.9999 11.5C17.3806 11.5 18.4999 10.3807 18.4999 9C18.4999 7.61929 17.3806 6.5 15.9999 6.5C14.6192 6.5 13.4999 7.61929 13.4999 9C13.4999 10.3807 14.6192 11.5 15.9999 11.5Z" fill="#6B6B6B"/>'
   +'<path fill-rule="evenodd" clip-rule="evenodd" d="M14.7998 13.3C14.7998 12.9687 15.0684 12.7 15.3998 12.7H16.3999C19.4927 12.7 21.9999 15.2073 21.9999 18.3V18.9C21.9999 19.2314 21.7313 19.5 21.3999 19.5C21.0685 19.5 20.7999 19.2314 20.7999 18.9V18.3C20.7999 15.87 18.83 13.9 16.3999 13.9H15.3998C15.0684 13.9 14.7998 13.6314 14.7998 13.3Z" fill="#6B6B6B"/>'
   +'</svg>'
   +'<span class="list-title">팀 휴가/FlexTime 정보</span>'
   +'<span class="count"><b>' + (hrInfo["totalCnt"] ? hrInfo["totalCnt"]: 0) +'</b>건</span>'
   +'<span class="arrow-right">' + arrowRight + '</span>'
   +'</li>');

   hrInfo.on('click', function() {
    chatui.sendMessage("HR 정보");
    welcomeClick = true;
   });
   
   welcomeList.append(hrInfo);
*/
   welcomeContent.append(welcomeList);


   
  $('#divScroll').append(welcomeContent);

  descendScroll();
  }
  }
}

var smsNames = '';

function sendSmsNewAppend(data) {

  var parameters = data.parameters;

    $('.chat-message.left').last().remove();
    
    var message = '<div class="custom-message"><div class="message category-list">'
      +'<div class="list-header-title">'
        +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
          +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.00004 13.8673C11.2401 13.8673 13.8667 11.2407 13.8667 8.00065C13.8667 4.76058 11.2401 2.13398 8.00004 2.13398C4.75997 2.13398 2.13337 4.76058 2.13337 8.00065C2.13337 11.2407 4.75997 13.8673 8.00004 13.8673ZM8.00004 14.6673C11.6819 14.6673 14.6667 11.6825 14.6667 8.00065C14.6667 4.31875 11.6819 1.33398 8.00004 1.33398C4.31814 1.33398 1.33337 4.31875 1.33337 8.00065C1.33337 11.6825 4.31814 14.6673 8.00004 14.6673Z" fill="#2C2C2C"/>'
          +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.9503 6.38447C11.1065 6.54068 11.1065 6.79395 10.9503 6.95016L7.61692 10.2835C7.46073 10.4397 7.2075 10.4397 7.05128 10.2835L5.05058 8.28354C4.89434 8.12736 4.8943 7.87409 5.05048 7.71786C5.20666 7.56162 5.45993 7.56158 5.61617 7.71776L7.33403 9.43502L10.3846 6.38447C10.5408 6.22827 10.794 6.22827 10.9503 6.38447Z" fill="#2C2C2C"/>'
        +'</svg>'
        +'<span>' + data.messages[0].message + '</span>'
      +'</div>'
      +'<div class="category-text">'
        +'<dl>'
          +'<dt>구분</dt>'
          +'<dd>' + ( parameters.targetDiv == 'person' ? '개인' : '그룹' ) + '</dd>'
        +'</dl>'
        +'<dl>'
          +'<dt>받는사람</dt>'
          +'<dd>' + smsNames + '</dd>'
        +'</dl>'
        +'<dl>'
          +'<dt>내용</dt>'
          +'<dd>' + parameters.message + '</dd>'
        +'</dl>'
      +'</div>'
    +'</div>'
    +'</div>';
    
    var sendMoreCustoms = $('<div class="custom-quick-reply"></div>');

    var sendMore = $('<span class="btn-custom-reply" data-message="추가 발송">추가발송</span>');
    sendMore.on('click', function() {
      sendSMSPopupOpen();
    })
    sendMoreCustoms.append(sendMore);
  

    var customMessage = $(message);
    customMessage.append(sendMoreCustoms);
    appendChatbotText2(customMessage);
}


function searchActiveFalse() {
  searchActive = false;
  searchType = null;
  $('.search-menu').removeClass('show');
  $('.faq-original').removeClass('show');
  $('.send-more').removeClass('active');
  $('.sendText').removeClass('search-active-dict');
  $('.sendText').removeClass('search-active-place');
  $('.sendText').removeClass('search-active-ai');
  $('.search-pre').remove();
  $('.search-close').removeClass('show');
  $('.search-prev').remove();
  $('.search-desc').removeClass('show');
  $('.btn-send').removeClass('disp-none');
  $('.sendText').val("");
  $('.btn-send').removeClass('active');
  $('.sendText').attr("placeholder", "메시지를 입력해 주세요.");
  setAutocomplete();
};

function openChatFrame() {
  var languageCode = "ko";
  var token = "test";
  var userId = chatui.getSetting('userId');

  var url = "https://chatclient-stg.ai.lgstation.com/459bac85-f58f-48eb-9c75-c6f17b73ac59/chat";

  var form = document.createElement("form");
  form.setAttribute("target", "caas-chatbot-chat-iframe");
  form.setAttribute("method", "POST");
  form.setAttribute("action", url);

  var param = null;

  obj = document.createElement("input");
  obj.setAttribute("type", "hidden");
  obj.setAttribute("name", "languageCode");
    obj.setAttribute("value", languageCode);
    form.appendChild(obj);

  obj = document.createElement("input");
  obj.setAttribute("type", "hidden");
  obj.setAttribute("name", "token");
    obj.setAttribute("value", token);
    form.appendChild(obj);

  if(targetParent != null) {
    obj = document.createElement("input");
    obj.setAttribute("type", "hidden");
    obj.setAttribute("name", "targetParent");
    obj.setAttribute("value", targetParent);
    form.appendChild(obj);
  }


    if (userId) {
    obj = document.createElement("input");
    obj.setAttribute("type", "hidden");
    obj.setAttribute("name", "userId");
      obj.setAttribute("value", userId);
      form.appendChild(obj);

      document.body.appendChild(form);
    }

  form.submit();

  setTimeout(function() { form.parentNode.removeChild(form); }, 1000);
  
}

function openGptBotFrame(queryText) {
  var languageCode = "ko";
  var token = "test";
  var userId = chatui.getSetting('userId');

  var url = "https://chatclient-stg.ai.lgstation.com/53496e65-19e4-4d34-8469-c7b83263b588/chat";

  var form = document.createElement("form");
  form.setAttribute("target", "caas-chatbot-chat-iframe");
  form.setAttribute("method", "POST");
  form.setAttribute("action", url);

  var param = null;

  obj = document.createElement("input");
  obj.setAttribute("type", "hidden");
  obj.setAttribute("name", "languageCode");
    obj.setAttribute("value", languageCode);
    form.appendChild(obj);

  obj = document.createElement("input");
  obj.setAttribute("type", "hidden");
  obj.setAttribute("name", "token");
    obj.setAttribute("value", token);
    form.appendChild(obj);

    if (queryText != "") {
    obj = document.createElement("input");
    obj.setAttribute("type", "hidden");
    obj.setAttribute("name", "queryText");
      obj.setAttribute("value", queryText);
      form.appendChild(obj);
    }

    if(targetParent != null) {
    obj = document.createElement("input");
    obj.setAttribute("type", "hidden");
    obj.setAttribute("name", "targetParent");
      obj.setAttribute("value", targetParent);
      form.appendChild(obj);
        
    }

    if (userId) {
    obj = document.createElement("input");
    obj.setAttribute("type", "hidden");
    obj.setAttribute("name", "userId");
      obj.setAttribute("value", userId);
      form.appendChild(obj);

      document.body.appendChild(form);
    }
    
//   document.body.appendChild(form);
  form.submit();

  setTimeout(function() { form.parentNode.removeChild(form); }, 1000);
  
}

function sendGptMsg(text) { 
    // iframe으로 메시지 전송 
    var targetWindow = document.getElementById("caas-chatbot-chat-iframe").contentWindow;
    console.log("targetWindow : "+targetWindow)
    var param = { 
        command: "search", 
        text: text 
    };
    targetWindow.postMessage(param, "*");
} 

var targetParent = null;
jQuery(document).ready(function(e){
    
    $('#divScroll').on('change', function() {
    if ($(this).find('.chat-message.right')) {
        console.log('아아아아', $('.chat-message.right').last().offset().top)
    }
});
    
    
    // 2023.11.21 GPT 팝업시 처리. 
    var paramInitMode = chatui.getParameter('initMode');
    
    //console.log('initMode : '+paramInitMode);
    
    // GPT봇으로 먼저 오픈해야 할 경우
    if(paramInitMode == "GPT") {    
        activeGptBot("");
    }
    // 학습봇으로 먼저 오픈해야 할 경우
    if(paramInitMode == "EDU") {
        
        $('body').append('<div id="caas-chatbot-container"><iframe id="caas-chatbot-chat-iframe" name="caas-chatbot-chat-iframe" src="about:blank" allow="microphone; autoplay" allowusermedia="true" style="position: relative!important;height:100%!important;width: 100%!important;border: none!important;"></iframe></div>');
    
        if (!document.getElementById("caas-chatbot-chat-iframe").isLoaded) {
          document.getElementById("caas-chatbot-chat-iframe").isLoaded = true;
          openChatFrame();
        };
        
    }
    
    // 2023.11.21 GPT 팝업시 처리. 

  var is_mobile = Mobile();
  var recoverBtn =  '<div class="recover" id="chatbot-recover">'
    +    '<img src="'+imgBaseUrl+'/images/img_resize3.png" title="기본사이즈로 돌아가기" onmouseover="this.src=\''+imgBaseUrl+'/images/img_resize_over3.png\';" onmouseout="this.src=\''+imgBaseUrl+'/images/img_resize3.png\';"/>'
    +'</div>';
  var winopenBtn =  '<div class="winopen" id="chatbot-winopen">'
    +    '<img src="'+imgBaseUrl+'/images/img_winopen3.png" title="팝업으로 보여주기" onmouseover="this.src=\''+imgBaseUrl+'/images/img_winopen_over3.png\';" onmouseout="this.src=\''+imgBaseUrl+'/images/img_winopen3.png\';"/>'
    +'</div>';

  
  $(".test-panel .panel-wrapper .chat-panel .info-area").empty().append('<div class="header-back"></div>'
  +'<div class="open-menu">'
  + '<svg width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +   '<path fill-rule="evenodd" clip-rule="evenodd" d="M0.500122 1.36678C0.500122 0.980179 0.813523 0.666779 1.20012 0.666779H20.8001C21.1867 0.666779 21.5001 0.980179 21.5001 1.36678C21.5001 1.75338 21.1867 2.06678 20.8001 2.06678H1.20012C0.813523 2.06678 0.500122 1.75338 0.500122 1.36678Z" />'
  +   '<path fill-rule="evenodd" clip-rule="evenodd" d="M0.500122 18.6332C0.500122 18.2466 0.813523 17.9332 1.20012 17.9332H20.8001C21.1867 17.9332 21.5001 18.2466 21.5001 18.6332C21.5001 19.0198 21.1867 19.3332 20.8001 19.3332H1.20012C0.813523 19.3332 0.500122 19.0198 0.500122 18.6332Z" />'
  +   '<path fill-rule="evenodd" clip-rule="evenodd" d="M0.500122 10C0.500122 9.6134 0.813523 9.3 1.20012 9.3H20.8001C21.1867 9.3 21.5001 9.6134 21.5001 10C21.5001 10.3866 21.1867 10.7 20.8001 10.7H1.20012C0.813523 10.7 0.500122 10.3866 0.500122 10Z" />'
  + '</svg>      '
  +'</div>'
  +'<div class="home">'
  + '<svg width="24" height="23" viewBox="0 0 24 23" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +   '<path fill-rule="evenodd" clip-rule="evenodd" d="M12.4537 0.500266C12.1922 0.277703 11.8079 0.277703 11.5463 0.500266L0.579674 9.8336C0.285264 10.0842 0.249718 10.5259 0.50028 10.8204C0.750842 11.1148 1.19263 11.1503 1.48704 10.8998L1.50001 10.8887V19C1.50001 20.933 3.06686 22.5 4.9999 22.5H7.91668C8.94761 22.5 9.78334 21.6643 9.78334 20.6333V16.7832C9.78334 15.559 10.7758 14.5666 12 14.5666C13.2242 14.5666 14.2167 15.559 14.2167 16.7832V20.6333C14.2167 21.6643 15.0524 22.5 16.0833 22.5H19C20.933 22.5 22.5 20.933 22.5 19V10.8887L22.513 10.8998C22.8074 11.1503 23.2492 11.1148 23.4998 10.8204C23.7503 10.5259 23.7148 10.0842 23.4204 9.8336L12.4537 0.500266ZM21.1 9.6972L12 1.95253L2.90001 9.69723V19C2.90001 20.1598 3.84014 21.1 4.9999 21.1H7.91668C8.17441 21.1 8.38334 20.8911 8.38334 20.6333V16.7832C8.38334 14.7858 10.0026 13.1666 12 13.1666C13.9974 13.1666 15.6167 14.7858 15.6167 16.7832V20.6333C15.6167 20.8911 15.8256 21.1 16.0833 21.1H19C20.1598 21.1 21.1 20.1598 21.1 19V9.6972Z" />'
  + '</svg>      '
  +'</div>'
  +'<div class="center">'
  +   '<img src="'+imgBaseUrl+'/images/hello_03.gif" />'
  +'</div>'
// 2023.11.13 추가 (팝업띄우기, 사이즈 원복 버튼...) Start

   + (!is_mobile? winopenBtn:'')
   

// 2023.11.13 추가 (팝업띄우기, 사이즈 원복 버튼...) End
  +'<div class="collapse backbutton" id="chatbot-collapse">'
  +  '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +    '<path d="M4.92465 4.07613C4.69034 3.84181 4.31044 3.84181 4.07613 4.07613C3.84181 4.31044 3.84181 4.69034 4.07613 4.92465L11.152 12.0005L4.07632 19.0761C3.84201 19.3104 3.84201 19.6903 4.07632 19.9247C4.31064 20.159 4.69054 20.159 4.92485 19.9247L12.0005 12.849L19.0761 19.9247C19.3104 20.159 19.6903 20.159 19.9247 19.9247C20.159 19.6903 20.159 19.3104 19.9247 19.0761L12.849 12.0005L19.9249 4.92465C20.1592 4.69034 20.1592 4.31044 19.9249 4.07613C19.6905 3.84181 19.3106 3.84181 19.0763 4.07613L12.0005 11.152L4.92465 4.07613Z" fill="#2C2C2C"/>'
  +  '</svg>'
  +'</div>'
  +'<div class="list-menu">'
  +'<div class="list-menu-back"></div>'
    +'<div class="list-menu-header">'
      +'<span class="menu-title">메뉴</span>'
      +'<span class="close">'
      + '<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +     '<path d="M1.92417 1.07564C1.68985 0.841324 1.30995 0.841324 1.07564 1.07564C0.841324 1.30995 0.841324 1.68985 1.07564 1.92417L8.15147 9L1.07583 16.0756C0.841519 16.31 0.841519 16.6899 1.07583 16.9242C1.31015 17.1585 1.69005 17.1585 1.92436 16.9242L9 9.84853L16.0756 16.9242C16.31 17.1585 16.6899 17.1585 16.9242 16.9242C17.1585 16.6899 17.1585 16.31 16.9242 16.0756L9.84853 9L16.9244 1.92417C17.1587 1.68985 17.1587 1.30995 16.9244 1.07564C16.69 0.841324 16.3101 0.841324 16.0758 1.07564L9 8.15147L1.92417 1.07564Z" />'
      +  '</svg>'
      +'</span>'
    +'</div>'
    +'<ul class="list-menu-body">'
      +'<li class="list-menu-first">도움말'
        + arrow2
      +'</li>'
      +'<li class="list-menu-second">대화내역 초기화'
      + arrow2
      +'</li>'
      +'<li class="list-menu-third">챗봇 평가 및 사용자 의견'
        + arrow2
      +'</li>'
      +'<li class="list-menu-fourth">학습봇 모드'
        + arrow2
    +'</li>'
      +'<li class="list-menu-fifth">GPT 모드'
        + arrow2
    +'</li>'
    +'<li class="list-menu-sixth">알림 설정'
        + arrow2
    +'</li>'
    +'</ul>'
  +'</div>'
  );

  $('.test-panel .panel-wrapper .chat-panel .popup.chat-feedback h4.pull-left').empty().append('사용자 평가');
  $('.test-panel .panel-wrapper .chat-panel .popup.feedback h4.pull-left').empty().append('사용자 평가');

  $('.test-panel .panel-wrapper .chat-panel .popup.chat-feedback .pop-content .text-area textarea').attr('placeholder', '불만사항이나 의견을 자유롭게 적어주세요');
  $('.test-panel .panel-wrapper .chat-panel .popup.feedback .pop-content textarea').attr('placeholder', '불만사항이나 의견을 자유롭게 적어주세요');

  $('.test-panel .panel-wrapper .chat-panel .popup.chat-feedback .pop-btn .btn-send').empty().append('평가 완료');
  $('.test-panel .panel-wrapper .chat-panel .popup.feedback .pop-btn .btn-send').empty().append('평가 완료');

  $('.home').on('click', function() {
    // welcomeClick = true;
    sendWelcomeEvent();
  });

  $('.test-panel .panel-wrapper .chat-panel .popup.chat-feedback .pop-btn .btn-send').on('click', function() {
    feedbackSendCheck = true;
  });

  $('.test-panel .panel-wrapper .chat-panel .popup.feedback .pop-btn .btn-send').on('click', function() {
    feedbackSendCheck = true;
  });

  $('.open-menu').on('click', function() {
    $('.list-menu').fadeIn();
  });

  $('.list-menu .close, .list-menu .list-menu-back').on('click', function() {
  $('.list-menu').fadeOut();
  });

  $('.list-menu-first').on('click', function() {
  chatui.sendEventMessage('menuHelpCard', {"text":"도움말"});
  $('.list-menu').fadeOut();
  });

  $('.list-menu-second').on('click', function() {
    //한번 확인 창 열려야함
    pop.open('create', $(this), 'Pop_Delete_History', 'loadEl.pop_del_confirm("대화 내역 삭제", "삭제된 대화내역은 복구할 수 없습니다.<br />계속 삭제하시겠습니까?")');

    $('#btnDelete').on('click', function() {
      clearAllConversation();

      pop.close($("#btnDelete"));                  
      setTimeout(function() {
        showSmallDialog('대화 내역이 삭제되었습니다.');
      }, 500);
            
    });
    $('.list-menu').fadeOut();
  });

  $('.list-menu-third').on('click', function() {
  $('.chat-feedback').fadeIn(300);

  setTimeout(function() {
    var popInH = $('.chat-feedback .pop-info').height()
    $('.chat-feedback .pop-info').css('top', window.innerHeight - popInH + 'px');
  }, 300);


  $('.feedback-sended .pop-content').html(
    '<p>챗봇창 상단 메뉴에서 챗봇 평가 및 사용자 의견을 선택해주시면 언제든 의견을 접수해주실 수 있습니다! <br />'
    +'더욱 똑똑하고 편리한 챗봇 서비스가 되도록 노력하겠습니다.</p>'
  );
  $('.list-menu').fadeOut();
  });


  $('.t-date').remove();

  $('.list-menu-fourth').on('click', function() {

    $('.list-menu').fadeOut();
    
    $('body').append('<div id="caas-chatbot-container"><iframe id="caas-chatbot-chat-iframe" name="caas-chatbot-chat-iframe" src="about:blank" allow="microphone; autoplay" allowusermedia="true" style="position: relative!important;height:100%!important;width: 100%!important;border: none!important;"></iframe></div>');

    if (!document.getElementById("caas-chatbot-chat-iframe").isLoaded) {
      document.getElementById("caas-chatbot-chat-iframe").isLoaded = true;
      openChatFrame();
    };
  });

  $('.list-menu-fifth').on('click', function() {
    activeGptBot("");
    $('.list-menu').fadeOut();
  });

  $('.list-menu-sixth').on('click', function() {
    showNotiSettings();
    $('.list-menu').fadeOut();
  });

  
  var isMobile = Mobile();
  $('.test-panel .panel-wrapper .chat-panel').append(
  '<div class="faq-menu search-menu">'
  +'<div class="faq-list">'
  + '<div class="faq-header">'
  +   '<h1>이런 검색 기능도 있어요!</h1>'
  +    '<div class="input-collapse">'
  +      '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +        '<path d="M1.74478 0.75483C1.47141 0.481463 1.0282 0.481463 0.75483 0.75483C0.481463 1.0282 0.481463 1.47141 0.75483 1.74478L9.00997 9.99992L0.755059 18.2548C0.481691 18.5282 0.481691 18.9714 0.755059 19.2448C1.02843 19.5181 1.47164 19.5181 1.74501 19.2448L9.99992 10.9899L18.2548 19.2448C18.5282 19.5181 18.9714 19.5181 19.2448 19.2448C19.5181 18.9714 19.5181 18.5282 19.2448 18.2548L10.9899 9.99992L19.245 1.74478C19.5184 1.47141 19.5184 1.0282 19.245 0.75483C18.9716 0.481463 18.5284 0.481463 18.2551 0.75483L9.99992 9.00997L1.74478 0.75483Z" fill="#2C2C2C"/>'
  +      '</svg>'
  +    '</div>'
  +  '</div>'
  +  '<div class="faq-body">'
  +     '<div class="btns">'

  + ( !isMobile ? '<button type="button" class="btn-s btn-icon btn-text search-ep-total">'
  +            '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +             '<path fill-rule="evenodd" clip-rule="evenodd" d="M10.7137 11.2806C9.71915 12.1444 8.42048 12.6673 6.99967 12.6673C3.87006 12.6673 1.33301 10.1303 1.33301 7.00065C1.33301 3.87104 3.87006 1.33398 6.99967 1.33398C10.1293 1.33398 12.6663 3.87104 12.6663 7.00065C12.6663 8.42154 12.1434 9.72028 11.2794 10.7149L14.549 13.9845C14.7052 14.1407 14.7052 14.3939 14.549 14.5501C14.3928 14.7064 14.1395 14.7064 13.9833 14.5501L10.7137 11.2806ZM11.8663 7.00065C11.8663 9.68844 9.68746 11.8673 6.99967 11.8673C4.31189 11.8673 2.13301 9.68844 2.13301 7.00065C2.13301 4.31287 4.31189 2.13398 6.99967 2.13398C9.68746 2.13398 11.8663 4.31287 11.8663 7.00065Z" fill="#E0205C"/>'
  +            '</svg>'
  +           'EP 통합 검색</button>' : '')

  +         '<button type="button" class="btn-s btn-icon btn-text search-employee">'
  +            '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +            '<path fill-rule="evenodd" clip-rule="evenodd" d="M5.66628 6.2C6.32902 6.2 6.86628 5.66274 6.86628 5C6.86628 4.33726 6.32902 3.8 5.66628 3.8C5.00353 3.8 4.46628 4.33726 4.46628 5C4.46628 5.66274 5.00353 6.2 5.66628 6.2ZM5.66628 7C6.77084 7 7.66628 6.10457 7.66628 5C7.66628 3.89543 6.77084 3 5.66628 3C4.56171 3 3.66628 3.89543 3.66628 5C3.66628 6.10457 4.56171 7 5.66628 7Z" fill="#E0205C"/>'
  +            '<path fill-rule="evenodd" clip-rule="evenodd" d="M1.33301 11.8667C1.33301 9.62074 3.15372 7.80003 5.39967 7.80003H5.933C8.17896 7.80003 9.99967 9.62074 9.99967 11.8667V12.6C9.99967 12.8209 9.82059 13 9.59967 13C9.37876 13 9.19967 12.8209 9.19967 12.6V11.8667C9.19967 10.0626 7.73714 8.60003 5.933 8.60003H5.39967C3.59554 8.60003 2.13301 10.0626 2.13301 11.8667V12.6C2.13301 12.8209 1.95392 13 1.73301 13C1.51209 13 1.33301 12.8209 1.33301 12.6V11.8667Z" fill="#E0205C"/>'
  +            '<path fill-rule="evenodd" clip-rule="evenodd" d="M10.6663 6.86667C11.1449 6.86667 11.5329 6.47865 11.5329 6C11.5329 5.52135 11.1449 5.13333 10.6663 5.13333C10.1876 5.13333 9.79961 5.52135 9.79961 6C9.79961 6.47865 10.1876 6.86667 10.6663 6.86667ZM10.6663 7.66667C11.5868 7.66667 12.3329 6.92047 12.3329 6C12.3329 5.07953 11.5868 4.33333 10.6663 4.33333C9.7458 4.33333 8.99961 5.07953 8.99961 6C8.99961 6.92047 9.7458 7.66667 10.6663 7.66667Z" fill="#E0205C"/>'
  +            '<path fill-rule="evenodd" clip-rule="evenodd" d="M9.86621 8.8667C9.86621 8.64579 10.0453 8.4667 10.2662 8.4667H10.9329C12.9948 8.4667 14.6663 10.1382 14.6663 12.2V12.6C14.6663 12.8209 14.4872 13 14.2663 13C14.0454 13 13.8663 12.8209 13.8663 12.6V12.2C13.8663 10.58 12.553 9.2667 10.9329 9.2667H10.2662C10.0453 9.2667 9.86621 9.08761 9.86621 8.8667Z" fill="#E0205C"/>'
  +            '</svg>'
  +         '전자/그룹사 임직원 검색</button>'

  +         '<button type="button" class="btn-s btn-icon btn-text search-schedule">'
  +            '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +'<path d="M17.4 14.5999L15.893 14.5999C15.5617 14.5999 15.293 14.3313 15.293 13.9999C15.293 13.6685 15.5617 13.3999 15.893 13.3999L17.4 13.3999C17.7314 13.3999 18 13.6685 18 13.9999C18 14.3313 17.7314 14.5999 17.4 14.5999Z" fill="#E0205C"/>'
  +'<path d="M12.8791 14.5999L11.1209 14.5999C10.7896 14.5999 10.5209 14.3313 10.5209 13.9999C10.5209 13.6685 10.7896 13.3999 11.1209 13.3999L12.8791 13.3999C13.2104 13.3999 13.4791 13.6685 13.4791 13.9999C13.4791 14.3313 13.2104 14.5999 12.8791 14.5999Z" fill="#E0205C"/>'
  +'<path d="M8.10698 14.5999L6.6 14.5999C6.26863 14.5999 6 14.3313 6 13.9999C6 13.6685 6.26863 13.3999 6.6 13.3999L8.10698 13.3999C8.43835 13.3999 8.70698 13.6685 8.70698 13.9999C8.70698 14.3313 8.43835 14.5999 8.10698 14.5999Z" fill="#E0205C"/>'
  +'<path d="M11.1209 17.5999L12.8791 17.5999C13.2104 17.5999 13.4791 17.3313 13.4791 16.9999C13.4791 16.6685 13.2104 16.3999 12.8791 16.3999L11.1209 16.3999C10.7896 16.3999 10.5209 16.6685 10.5209 16.9999C10.5209 17.3313 10.7896 17.5999 11.1209 17.5999Z" fill="#E0205C"/>'
  +'<path d="M6.6 17.5999L8.10698 17.5999C8.43835 17.5999 8.70698 17.3313 8.70698 16.9999C8.70698 16.6685 8.43835 16.3999 8.10698 16.3999L6.6 16.3999C6.26863 16.3999 6 16.6685 6 16.9999C6 17.3313 6.26863 17.5999 6.6 17.5999Z" fill="#E0205C"/>'
  +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.5999 2.6C8.5999 2.26863 8.33127 2 7.9999 2C7.66853 2 7.3999 2.26863 7.3999 2.6V4H6C4.34315 4 3 5.34315 3 7V19C3 20.6569 4.34315 22 6 22H18C19.6569 22 21 20.6569 21 19V7C21 5.34315 19.6569 4 18 4H16.5999V2.6C16.5999 2.26863 16.3313 2 15.9999 2C15.6685 2 15.3999 2.26863 15.3999 2.6V4H8.5999L8.5999 2.6ZM18 5.2H6C5.00589 5.2 4.2 6.00589 4.2 7V9L19.8 9V7C19.8 6.00589 18.9941 5.2 18 5.2ZM4.2 19V10.2L19.8 10.2V19C19.8 19.9941 18.9941 20.8 18 20.8H6C5.00589 20.8 4.2 19.9941 4.2 19Z" fill="#E0205C"/>'
  +'</svg>'
  +         '일정 검색</button>'
  +         '<button type="button" class="btn-s btn-icon btn-text search-system">'
  +           '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +             '<path d="M10.8837 4.05322C10.7822 4.15268 10.4111 4.64773 10.8807 5.11789C11.3509 5.5875 11.8459 5.21639 11.9454 5.11485C12.0449 5.01328 13.5376 3.52467 13.5376 3.52467C13.7352 3.32732 14.0658 3.3729 14.2003 3.61607C15.002 5.0651 14.7537 6.89305 13.5593 8.0882C12.6582 8.98861 11.3442 9.33879 10.1358 9.10652C9.89479 9.0602 9.63997 9.11984 9.46582 9.29407L9.4471 9.31279C9.1409 9.61916 5.17412 13.5881 4.70768 14.0545C4.03418 14.728 2.88148 15.0002 1.93997 14.0587L2.50484 13.4938C2.81952 13.8084 3.11943 13.8828 3.36816 13.8653C3.64007 13.8462 3.92237 13.71 4.14279 13.4896C4.6136 13.0188 8.65215 8.97809 8.88985 8.74026L8.90093 8.72918C9.29263 8.33739 9.83029 8.2343 10.2866 8.32201C11.2545 8.50805 12.2945 8.22261 12.9944 7.52329C13.8096 6.70742 14.0643 5.5206 13.7118 4.47933L13.3431 4.84713C12.9542 5.23524 12.5616 5.62737 12.5161 5.67387C12.3914 5.80119 12.1161 6.01688 11.738 6.10748C11.2974 6.21307 10.7644 6.13112 10.3158 5.68278C9.86747 5.23414 9.78552 4.70124 9.89111 4.26058C9.98171 3.88248 10.1974 3.60723 10.3247 3.48252C10.3712 3.43697 10.7634 3.04436 11.1515 2.65547L11.5193 2.28681C10.478 1.93429 9.29117 2.18898 8.4753 3.00417C7.77599 3.70411 7.49054 4.74411 7.67658 5.712C7.76429 6.1683 7.6612 6.70596 7.26941 7.09766L7.25833 7.10874C7.0205 7.34644 2.97978 11.385 2.50898 11.8558C2.28855 12.0762 2.15244 12.3585 2.13327 12.6304C2.11574 12.8792 2.19015 13.1791 2.50484 13.4938L1.93997 14.0587C0.998463 13.1172 1.27058 11.9644 1.94409 11.2909C2.41075 10.8242 6.38325 6.85387 6.68624 6.55105L6.70452 6.53277C6.87875 6.35862 6.93839 6.1038 6.89207 5.86279C6.6598 4.65436 7.00998 3.34035 7.91039 2.4393C9.10554 1.24492 10.9335 0.99658 12.3825 1.79827C12.6257 1.93281 12.6713 2.26335 12.4739 2.46096C12.4739 2.46096 10.9853 3.95373 10.8837 4.05322Z" fill="#E0205C"/>'
  +           '</svg>'
  +         '시스템 담당자 검색</button>'
  
  +         '<button type="button" class="btn-s btn-icon btn-text gpt-bot">'
  +         '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +'<path d="M8.5 14C9.05228 14 9.5 13.5523 9.5 13C9.5 12.4477 9.05228 12 8.5 12C7.94772 12 7.5 12.4477 7.5 13C7.5 13.5523 7.94772 14 8.5 14Z" fill="#E0205C"/>'
  +'<path d="M9.22287 15.4679C9.51436 15.3161 9.87319 15.4271 10.0284 15.7157C10.0295 15.7177 10.0326 15.7229 10.0376 15.7309C10.0487 15.7484 10.0691 15.7788 10.0998 15.8181C10.1614 15.8969 10.263 16.0094 10.4124 16.1242C10.7039 16.348 11.2017 16.6 12 16.6C12.7983 16.6 13.2962 16.348 13.5877 16.1242C13.7371 16.0094 13.8387 15.8969 13.9003 15.8181C13.931 15.7788 13.9514 15.7484 13.9624 15.7309C13.9675 15.7229 13.9705 15.7177 13.9717 15.7157C14.1269 15.4271 14.4857 15.3161 14.7772 15.4679C15.0711 15.6209 15.1852 15.9833 15.0322 16.2772L15.0315 16.2785L15.0307 16.28L15.029 16.2832L15.0248 16.291L15.0132 16.3118C15.004 16.3278 14.9918 16.3482 14.9766 16.3723C14.9462 16.4204 14.9031 16.4837 14.8459 16.5569C14.7317 16.7031 14.5598 16.8906 14.3186 17.0759C13.8289 17.452 13.0767 17.8 12 17.8C10.9233 17.8 10.1712 17.452 9.68144 17.0759C9.44022 16.8906 9.26838 16.7031 9.15416 16.5569C9.09698 16.4837 9.0539 16.4204 9.02345 16.3723C9.00821 16.3482 8.99608 16.3278 8.98689 16.3118L8.97527 16.291L8.97105 16.2832L8.96934 16.28L8.96857 16.2785C8.96759 16.2766 8.96788 16.2772 8.96788 16.2772C8.81481 15.9833 8.92897 15.6209 9.22287 15.4679Z" fill="#E0205C"/>'
  +'<path d="M16.5 13C16.5 13.5523 16.0523 14 15.5 14C14.9477 14 14.5 13.5523 14.5 13C14.5 12.4477 14.9477 12 15.5 12C16.0523 12 16.5 12.4477 16.5 13Z" fill="#E0205C"/>'
  +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10 4C10 4.89556 9.41137 5.65365 8.5999 5.90847L8.5999 7H15.3999V5.90841C14.5885 5.65353 14 4.89549 14 4C14 2.89543 14.8954 2 16 2C17.1046 2 18 2.89543 18 4C18 4.89556 17.4114 5.65365 16.5999 5.90847L16.5999 7H18C19.6569 7 21 8.34315 21 10V19C21 20.6569 19.6569 22 18 22H6C4.34315 22 3 20.6569 3 19V10C3 8.34315 4.34315 7 6 7H7.3999V5.90841C6.58853 5.65353 6 4.89549 6 4C6 2.89543 6.89543 2 8 2C9.10457 2 10 2.89543 10 4ZM8.8 4C8.8 4.44183 8.44183 4.8 8 4.8C7.55817 4.8 7.2 4.44183 7.2 4C7.2 3.55817 7.55817 3.2 8 3.2C8.44183 3.2 8.8 3.55817 8.8 4ZM16.8 4C16.8 4.44183 16.4418 4.8 16 4.8C15.5582 4.8 15.2 4.44183 15.2 4C15.2 3.55817 15.5582 3.2 16 3.2C16.4418 3.2 16.8 3.55817 16.8 4ZM6 8.2H18C18.9941 8.2 19.8 9.00589 19.8 10V19C19.8 19.9941 18.9941 20.8 18 20.8H6C5.00589 20.8 4.2 19.9941 4.2 19V10C4.2 9.00589 5.00589 8.2 6 8.2Z" fill="#E0205C"/>'
  +'</svg>'
  +           'GPT 모드</button>'
  +     '</div>'
  +   '</div>'
  + '</div>'
  +'</div>'

  );

  $('.test-panel .panel-wrapper .chat-panel').append(
  '<div class="faq-menu faq-original">'
  +'<div class="faq-list">'
  +   '<div class="faq-header">'
  +     '<h1>자주 묻는 질문을 모아봤어요.</h1>'
  +     '<div class="input-collapse">'
  +       '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +         '<path d="M1.74478 0.75483C1.47141 0.481463 1.0282 0.481463 0.75483 0.75483C0.481463 1.0282 0.481463 1.47141 0.75483 1.74478L9.00997 9.99992L0.755059 18.2548C0.481691 18.5282 0.481691 18.9714 0.755059 19.2448C1.02843 19.5181 1.47164 19.5181 1.74501 19.2448L9.99992 10.9899L18.2548 19.2448C18.5282 19.5181 18.9714 19.5181 19.2448 19.2448C19.5181 18.9714 19.5181 18.5282 19.2448 18.2548L10.9899 9.99992L19.245 1.74478C19.5184 1.47141 19.5184 1.0282 19.245 0.75483C18.9716 0.481463 18.5284 0.481463 18.2551 0.75483L9.99992 9.00997L1.74478 0.75483Z" fill="#2C2C2C"/>'
  +       '</svg>'
  +     '</div>'
  +   '</div>'
  +   '<div class="faq-body">'
  +     '<h2>주요업무</h2>'
  +     '<div class="btns">'
  +         '<button type="button" class="btn-s btn-text btn-sendtext">HR</button>'
  +         '<button type="button" class="btn-s btn-text btn-sendtext">정도경영</button>'
  +         '<button type="button" class="btn-s btn-text btn-sendtext">IT</button>'
  +         '<button type="button" class="btn-s btn-text btn-sendtext">DX</button>'
  +         '<button type="button" class="btn-s btn-text btn-sendtext">업무지원</button>'
  +         '<button type="button" class="btn-s btn-text btn-sendtext">회사일반</button>'
  +         '<button type="button" class="btn-s btn-text btn-sendtext">도움말</button>'
  +         '<button type="button" class="btn-s btn-text btn-sendtext">홍보자료</button>'
  +     '</div>'
  +     '<h2>IT 관련 문의가 있으신가요?</h2>'
  +     '<div class="btns">'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">Webex(화상회의)</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">PC 신청/반납</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">SW 신청</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">복합기 설치</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">GUAS</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">G Portal</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">메일</button>'
  +     '</div>'
  +     '<h2>업무에 필요한 정보를 안내해 드릴게요.</h2>'
  +     '<div class="btns">'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">출입/보안</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">출장</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">전임여비</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">차량 주차</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">사내 생활 안내</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">전화신청</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">사원증</button>'
  +     '</div>'
  +     '<h2>다양한 사내 복지 제도를 소개해 드릴게요!</h2>'
  +     '<div class="btns">'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">통근버스</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">주간 메뉴</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">주택자금</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">교육</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">의료비</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">자격증</button>'
  +     '<button type="button" class="btn-s btn-text btn-sendtext">휴양소</button>'
  +     '</div>'
  +   '</div>'
  +'</div>'
  +'</div>');

  $(".test-panel .panel-wrapper .chat-panel .form-group").empty();

  $(".test-panel .panel-wrapper .chat-panel .form-group").append('<div class="send-more">'
  + '<div class="set1">'
  +  '<svg width="31" height="30" viewBox="0 0 31 30" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +    '<path d="M8.75 14.9999C8.75 14.5028 9.15294 14.0999 9.65 14.0999H14.5999V9.15C14.5999 8.65294 15.0028 8.25 15.4999 8.25C15.9969 8.25 16.3999 8.65294 16.3999 9.15V14.0999H21.35C21.8471 14.0999 22.25 14.5028 22.25 14.9999C22.25 15.4969 21.8471 15.8999 21.35 15.8999H16.3999V20.85C16.3999 21.3471 15.9969 21.75 15.4999 21.75C15.0028 21.75 14.5999 21.3471 14.5999 20.85V15.8999H9.65C9.15294 15.8999 8.75 15.4969 8.75 14.9999Z" />'
  +    '<path fill-rule="evenodd" clip-rule="evenodd" d="M15.5 0C7.21573 0 0.5 6.71573 0.5 15C0.5 23.2843 7.21573 30 15.5 30C23.7843 30 30.5 23.2843 30.5 15V4.5C30.5 2.01472 28.4853 0 26 0H15.5ZM26 1.8H15.5C8.20984 1.8 2.3 7.70984 2.3 15C2.3 22.2902 8.20984 28.2 15.5 28.2C22.7902 28.2 28.7 22.2902 28.7 15V4.5C28.7 3.00883 27.4912 1.8 26 1.8Z"/>'
  +  '</svg>'
  +'</div>'
  +'<div class="set2">'
  +  '<svg width="31" height="30" viewBox="0 0 31 30" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +    '<path fill-rule="evenodd" clip-rule="evenodd" d="M15.5 0C7.21573 0 0.5 6.71573 0.5 15C0.5 23.2843 7.21573 30 15.5 30C23.7843 30 30.5 23.2843 30.5 15V4.5C30.5 2.01472 28.4853 0 26 0H15.5ZM11.6363 9.86346C11.2848 9.51199 10.7149 9.51199 10.3635 9.86346C10.012 10.2149 10.012 10.7848 10.3635 11.1363L14.2271 14.9999L10.3635 18.8635C10.012 19.2149 10.012 19.7848 10.3635 20.1362C10.7149 20.4877 11.2848 20.4877 11.6363 20.1362L15.4999 16.2726L19.3635 20.1363C19.7149 20.4877 20.2848 20.4877 20.6362 20.1363C20.9877 19.7848 20.9877 19.2149 20.6362 18.8635L16.7726 14.9999L20.6362 11.1363C20.9877 10.7848 20.9877 10.2149 20.6362 9.86346C20.2848 9.51199 19.7149 9.51199 19.3635 9.86346L15.4999 13.7271L11.6363 9.86346Z" fill="#2C2C2C"/>'
  +  '</svg>            '
  +'</div>'
  +'</div>');

  function checkMessageContents(val) {
    /*
    if(val.indexOf("/dict") != -1){
      appendQueryText(val);
      var searchTerm = val.replace("/dict ","");
      chatui.sendEventMessage("dictQueryEvent",{"searchTerm": searchTerm});
    } else if(val.indexOf("/where") != -1){
        appendQueryText(val);
        chatui.sendMessage(val);
    } else if(val.indexOf("/ai") != -1) {
      var findMessage = val;
      var payload = {
        question: findMessage,
        userId : chatui.getSetting('userId')
      }
      appendQueryText(val);
      chatui.sendEventMessage("MRC", payload);
    } else if(val.indexOf("/rpa") != -1){   
	    var rpaSubject = val.replace("/rpa ","");
	    if(rpaSubject.includes("help")) appendQueryText("RPA HELP");
	    else if(rpaSubject.includes("process kill")) appendQueryText("RPA ADMIN KILL");
	    else if(rpaSubject.includes("start")) appendQueryText("RPA START");
	    else if(rpaSubject.includes("hist")) appendQueryText("RPA HISTORY");
	    
	    if (rpaSubject.includes("help")){
	        chatui.sendEventMessage("rpaAdminHelp");
	    } else if (rpaSubject.includes("process kill")) {
	        chatui.sendEventMessage("rpaAdminKillList");
	    } else if (rpaSubject.includes("start")) {
	        var rpaProcessStart = rpaSubject.replace("start", "");
	        chatui.sendEventMessage("rpaAdminProcessStart",{"process_id": rpaProcessStart});
	    } else if(rpaSubject.includes("hist")) {
	        var rpaProcessHistory = rpaSubject.replace("hist", "");
	        chatui.sendEventMessage("rpaAdminProcessHistory",{"process_id": rpaProcessHistory});
	    } else {
	        pop.open('create', $(this), 'Pop_Alert', 'loadEl.pop_alert("입력 Command를 확인하세요.")');
	    }
    }
    // else if(val.toUpperCase().indexOf("/GPT") != -1){
    //     appendQueryText(val);
    //     // var reqText = val.replace("/GPT ","").replace("/gpt ","").replace("/GPT ","").replace("/GPT ","");
    //     var reqText = val.substr(4,val.length-1);
    //     activeGptBot(reqText);
        
    // }
    else {
    */
    chatui.sendMessage(val);
    //}

    $('.sendText').val("");
    $('.btn-send').removeClass('active');
    $('.search-guides').css('display', 'none');
  }

  var formGroup = $('<div data-mode="message" class="chat-footer-form">'
  +'<input type="text" class="sendText form-control test-sentence-input caas-input-placeholder-font-color caas-input-font-color chat-input-msg ui-autocomplete-input" placeholder="메시지를 입력해 주세요." autocomplete="off"/>'
  +'<div class="autocomplete-wrap"></div>'
  +'<button type="button" class="btn btn-trans btn-send"><svg width="29" height="28" viewBox="0 0 29 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +'<path d="M26.0676 4.79338C26.554 3.3341 25.1657 1.94578 23.7064 2.43221L4.10954 8.96451C2.53186 9.4904 2.37758 11.6613 3.86504 12.405L10.2305 15.5877C10.9042 15.9246 11.7179 15.7925 12.2505 15.2599L20.206 7.30442C20.4794 7.03106 20.9226 7.03106 21.1959 7.30442C21.4693 7.57779 21.4693 8.02101 21.1959 8.29437L13.2403 16.25C12.7077 16.7826 12.5756 17.5964 12.9125 18.2701L16.0948 24.6348C16.8386 26.1222 19.0094 25.968 19.5353 24.3903L26.0676 4.79338Z"/>'
  +'</svg></button></div>');


  formGroup.find("button").on('click', function() {
    let val = $('.sendText').val();
    if(val.length > 0) {
    checkMessageContents(val);
    };
  });

  const ignoreKeyArr = ['Enter','ShiftLeft','ShiftRight','ControlLeft','ControlRight','AltLeft','AltRight','ArrowLeft','ArrowRight','ArrowUp','ArrowDown', 'Space'];
  formGroup.find("input").on('keyup', function (e) {
    var val = $(this).val();
    
  if(searchActive) {
    
    if(searchType == null && val.length > 0) {
      searchActive = false;
      if($('.search-menu').hasClass('show')) {
        $('.search-menu').removeClass('show');
        setAutocomplete();
      }

    } 
    //else if(searchType == 'where' && (e.code == 'Enter' || e.keyCode == 13)) {
    //  var findMessage = '/where ' + val;
    //  appendQueryText(findMessage);
    //  chatui.sendMessage(findMessage);
    //  searchActiveFalse();
    //  return;
    //} 
    else if(searchType == 'ep-total' && (e.code == 'Enter' || e.keyCode == 13)) {
      var url = epTotalUrl.replace("%query%", $(e.target).val());
      window.open(url, "epTotalSearch", "width=1024,height=550,resizable=1,scrollbars=1");
      searchActiveFalse();
      return;
    } 
    //else if(searchType == 'dict' && (e.code == 'Enter' || e.keyCode == 13)) {
    //  var findMessage = '/dict ' + val;
    //  appendQueryText(findMessage);
    //  dictSearchTerm = val;
    //  chatui.sendEventMessage("dictQueryEvent", {"searchTerm":val});
    //  searchActiveFalse();
    //  return;
    //} 
    //else if(searchType == 'ecm' && (e.code == 'Enter' || e.keyCode == 13)) {
    //  var url = ecmUrl.replace("%query%", $(e.target).val());
    //  window.open(url, "ecmSearch", "width=1024,height=550,resizable=1,scrollbars=1");
    //  searchActiveFalse();
    //  return;
    //} 
    //else if(searchType == 'ai' && (e.code == 'Enter' || e.keyCode == 13)) {
    //  var findMessage = '/ai ' + val;
    //  var payload = {
    //    question: findMessage,
    //    userId : chatui.getSetting('userId')
    //  }
    //  appendQueryText(findMessage);
    //  chatui.sendEventMessage("MRC", payload);
    //  searchActiveFalse();
    //  return;
    //} 
    else if(searchType == 'employee' && (e.code == 'Enter' || e.keyCode == 13)) {
      var findMessage = val;
      chatui.sendMessage(findMessage);
      searchActiveFalse();
      return;
    } 
    else if(searchType == 'system' && (e.code == 'Enter' || e.keyCode == 13)) {
      var findMessage = val;
      chatui.sendMessage(findMessage);
      searchActiveFalse();
      return;
    } 
    //else if(searchType == 'standard' && (e.code == 'Enter' || e.keyCode == 13)) {
    //  var findMessage = val;
    //  appendQueryText(findMessage);
    //  chatui.sendEventMessage("standardQueryEvent", {"searchData":val});
    //  searchActiveFalse();
    //  return;
    //}
    else if(searchType == 'schedule' && (e.code == 'Enter' || e.keyCode == 13)) {
      var findMessage = val;
      chatui.sendMessage(findMessage);
      searchActiveFalse();
      return;
    }
    
    
  } else {
    
    if(searchType == null && val.length > 0) {
      searchActive = false;
      if($('.search-menu').hasClass('show')) {
        $('.search-menu').removeClass('show');
        setAutocomplete();
      }
    }
    if(val.length > 0) {

        //console.log('e.code : '+e.code);
        // 입력된 메시지에 대한 자동완성 기능. 
        if(!ignoreKeyArr.includes(e.code)) {
            autoSearchEmployees(val);
        }
      /*  
      if(val == '/') {
        $('.search-guides').css('display', 'block');
        $('.autocomplete-wrap li').css('display', 'none!important');
      } else {
        $('.search-guides').css('display', 'none');
        $('.autocomplete-wrap li').css('display', 'block');
      }*/
      
      $('.btn-send').addClass('active');
      if(e.code == 'Enter' || e.keyCode == 13) {
        checkMessageContents(val);      
      }
    } else {
        $('.btn-send').removeClass('active');
        $('.search-guides').css('display', 'none');
    }
  };
  
  });




  $('.test-panel .panel-wrapper .chat-panel .form-group').append(formGroup);


  $('.test-panel .panel-wrapper .chat-panel .form-group').append('<span class="search-close">'
  +'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
  + '<path d="M4.92417 4.07564C4.68985 3.84132 4.30995 3.84132 4.07564 4.07564C3.84132 4.30995 3.84132 4.68985 4.07564 4.92417L11.1515 12L4.07583 19.0756C3.84152 19.31 3.84152 19.6899 4.07583 19.9242C4.31015 20.1585 4.69005 20.1585 4.92436 19.9242L12 12.8485L19.0756 19.9242C19.31 20.1585 19.6899 20.1585 19.9242 19.9242C20.1585 19.6899 20.1585 19.31 19.9242 19.0756L12.8485 12L19.9244 4.92417C20.1587 4.68985 20.1587 4.30995 19.9244 4.07564C19.69 3.84132 19.3101 3.84132 19.0758 4.07564L12 11.1515L4.92417 4.07564Z" fill="#2C2C2C"/>'
  +'</svg>'
  +'</span>');

  $('.test-panel .panel-wrapper .chat-panel').append(
  '<div class="faq-menu search-desc">'
  +'<div class="faq-list">'
  +   '<div class="faq-header">'
  +     '<h1></h1>'
  +   '</div>'
  +   '<div class="faq-body">'
  +'<p class="desc">지포탈에서 통합검색 결과를 검색합니다.<br />'
  +'지난 게시판 내용, 전자결재 문서, 뉴스 등을 검색할 수 있습니다.<br />'
  +'궁금하신 검색 키워드를 입력해 주세요.<br /><br />'
  +'예) G Cloud Mobile, 거점오피스</p>'
  +     '</div>'
  +'</div>'
  + '</div>'
  );

  $('.send-more').on('click', function() {
      $('.faq-menu').removeClass('show'); // 퍼블 추가 내용
      
    if($(this).hasClass('active')) {
      $(this).removeClass('active');
      $('.faq-original').removeClass('show');
    } else {
      $(this).addClass('active');
      $('.faq-original').addClass('show');
    }
  });

  $('.sendText').on('click', function() {
  if(searchActive === false) {
    $('.search-menu').addClass('show');
    //  $(".sendText").autocomplete("disable");
  }
  });

  $("#divScroll, .input-collapse, #divHeader").on('click', function(){
        if($('.faq-original').hasClass('show')) {
          $('.faq-original').removeClass('show');
          $('.send-more').removeClass('active');  
        }

        if($('.search-menu').hasClass('show')) {
          $('.search-menu').removeClass('show');
        }

        if(searchActive === true && searchActive2 === false) {
          searchActiveFalse(); 
        };

        setAutocomplete();
  });

  function faqOriginalHide() {
    if($('.faq-original').hasClass('show')) {
      $('.faq-original').removeClass('show');
      $('.send-more').removeClass('active');
    }
  };

  $('.search-ep-total').on('click', function() {
    searchActiveEpTotal();
    faqOriginalHide();
  });

  $('.search-close').on('click', function() {
    searchActiveFalse();
    faqOriginalHide();
  });

  $('.search-place').on('click', function() {
    searchActiveWhere(); 
    faqOriginalHide();
  });

  $('.search-ai').on('click', function() {
    searchActiveMrc();
    faqOriginalHide(); 
  });

  $('.search-employee').on('click', function() {
    searchActiveEmployee();
    faqOriginalHide();
  });

  $('.search-ecm').on('click', function() {
    searchActiveEcm();
    faqOriginalHide();
  });

  $('.search-dict').on('click', function() {
    searchActiveDict();
    faqOriginalHide();
  });

  $('.search-system').on('click', function() {
    searchActiveSystem();
    faqOriginalHide();
  });

  $('.search-schedule').on('click', function() {
    searchActiveSchedule();
    faqOriginalHide();
  });
  
  $('.search-standard').on('click', function() {
    searchActiveStandard();
    faqOriginalHide();
  });

  $('.gpt-bot').on('click', function() {
    activeGptBot("");
    faqOriginalHide();
  });

  $('.btn-sendtext').each(function() {
    $(this).on('click', function() {
        $('.faq-menu').removeClass('show'); // 퍼블 추가 내용
      var sendText = $(this).text();
      chatui.sendMessage(sendText);
      $('.faq-original').removeClass('show');
      $('.send-more').removeClass('active');
      faqOriginalHide();
    });
  });


  //피드백 전송 완료 팝업
  $('.test-panel .panel-wrapper .chat-panel').append('<div class="popup feedback-sended" data-popup="feedback-sended" style="display: none;">'
  +'<div class="pop-info">'
  +'<div class="clear-float">'
    +'<h4 class="pull-left">사용자 평가</h4>'
    +'<button class="pull-right btn btn-xs btn-trans btn-close smooth" data-popup-close="feedback-sended" aria-label="Close">'
    +'<span class="icon icon-lg-close" aria-hidden="true"></span>'
    +'</button>'
    +'</div>'
    +'<div class="pop-content">'
    +'<p>소중한 의견 감사드립니다!</p>'
    +'<p>답변 우측에서 만족도를 선택해주시면 언제든 의견을 접수해주실 수 있습니다!<br/>'
    +'더욱 똑똑하고 편리한 챗봇 서비스가 되도록 노력하겠습니다.</p>'
    +'</div>'
    +'<div class="pop-btn pull-right">'
    +'<button class="btn btn-send fill-btn-dark large-style" data-popup-close="feedback-sended">대화 계속하기</button>'
    +'</div>'
    +'</div>'
  +'</div>');


  $('.feedback-sended .btn-close, .feedback-sended .btn-send').on('click', function() {
    $('.feedback-sended').fadeOut();
  });

  setAutocomplete();
    
  // Datepicker Module
  window.datepicker = setDatepicker();

  $(document).on('click', function(e) {
      if ($(".ui-input-date, .schedule-input-wrap").has(e.target).length == 0 && $(e.target).hasClass("ui-corner-all") == false) {
          datepicker.close();
      }
  });


  
//   var key = chatui.getSetting("userId") ? chatui.getSetting("userId").replace(/=/gi, "") : "";
//   var lastAccessDate = localStorage.getItem(key + "_lastAccessDate");
//       if(lastAccessDate == null) { lastAccessDate=''; };
//   console.log("lastAccessDate :: " + lastAccessDate);

//   var today = moment().format('YYYY-MM-DD');
  
//   if(lastAccessDate == today) {
//     $('.prev-msg a').trigger('click');
//     setTimeout(function() {
//      descendScroll();
//     }, 100);
//   } else {
    sendWelcomeEvent();
//   }

  //scroll event
  $('#divScroll').on("scroll", function () {
    let scrollPosition = $(this).scrollTop();
    if (scrollPosition != 0) {
      $('.info-area .center').addClass('on');
    }
  }).one("scroll", function goTop() {
      $('#divScroll').scrollTop(0);
  });


  // 페이지 로딩 숨김, 챗봇 화면 표시
  setTimeout(function() {
    $('.info-area').css('visibility', 'visible');
    $("#caas-chatbot").css("opacity", "1");
    $(".chatbot-skeleton").fadeOut(500);
    setTimeout(function() {
    $(".chatbot-skeleton").remove();
    }, 500)
  }, 500);

  var chatbotCollapse = document.getElementById("chatbot-collapse");

  chatbotCollapse.addEventListener('click', function(e) {
    //주소 수정 필요 : 챗봇이 iframe으로 들어가는 홈페이지 도메인 입력
    if(!window.opener) {
        //console.log('--iframe');
        window.parent.postMessage('bot_close', '*');
    }
    else{
        //console.log('--popup');
        window.close();
    }
    //23.02.07 챗봇창 close 상태에서 미확인 수신 메시지 noti 처리를 위해 Web Socket 연결 끊기
    wsService.disconnect();
  });
  
    // 2023.11.13 추가 (팝업띄우기, 사이즈 원복 버튼...) Start
    
    if(!is_mobile) {
        /*  기본사이즈 버튼 나중에 오픈 */ 
        //var chatbotRecover = document.getElementById("chatbot-recover");
        var chatbotWinopen = document.getElementById("chatbot-winopen");
        //console.log(chatbotWinopen);
        
        //chatbotRecover.style.display = "none";
        chatbotWinopen.style.display = "none"; 
        chatbotCollapse.style.display = "none";
    
        //chatbotRecover.addEventListener('click', function(e) {
            
        //   window.parent.postMessage('bot_Recover', '*');
        //}); 
        
        chatbotWinopen.addEventListener('click', function(e) {
        
           window.parent.postMessage('bot_Winopen', '*');
        });   
        
        if(!window.opener) {
            console.log('팝업 아님.');
            
            targetParent = "F";
            
            //chatbotRecover.style.display = "block";
            chatbotWinopen.style.display = "block";
            chatbotCollapse.style.display = "block";
        }
        else {
            targetParent = "P";
            console.log('팝업.');
        }
    }
    // 2023.11.13 추가 (팝업띄우기, 사이즈 원복 버튼...) End
  
});
//ready end


window.addEventListener("message", function (e) {
  if(e.data === 'bot_close') {
    $('#caas-chatbot-container').remove();
  };

  // if(e.data.evnet_id === 'messengser_open') {
  //   var userId = e.data.id.userId;
  //   var targetId = e.data.id.targetId;
  //   var uCapUri = 'LGUCAPL://';
  //   uCapUri += 'GUC005;CHAT;'+userId+';'+targetId+'@GUC005';
  //   window.protocolCheck(uCapUri, function() {
  //     window.open("http://www.lgucap.com", "width=1100,height=800, resizable=1,scrollbars=1");
  //   });
  // };

},false);



function dictDetailClose() {
  $('#dictDetail').removeClass('show');
  $('.plugin-dim').removeClass('show');
  setTimeout(function() {
    $('.plugin-dim').remove();
    $('#dictDetail').remove();
  }, 300);
} 

var loadingDict = false;

function dictDeatilOpen(btn, termId) {
  if(loadingDict) return;
  var sessionId = $(btn).closest(".dict-list").attr("data-sessionId");
  loadingDict = true;
  var requestParam = {
    query: {
        "event": dictDetailQueryEvent
      },
    payload: {
      "termId": termId
    }
  };
  sendChatApi(requestParam, sessionId, function(payload){
    
    var messages= payload.queryResult.messages[0];
    var response = messages.response;
    var result= JSON.parse(response);
    result.dictDesc = result.dictDesc.replace(/\n/gi, "<br>")
    result.dictDescEn = result.dictDescEn.replace(/\n/gi, "<br>")
    result.dictDescCh = result.dictDescCh.replace(/\r\n/gi, "<br>")

    var pulginDim = $('<div class="plugin-dim show"></div>');
    var dictDetail = $('<div class="plugins" id="dictDetail">'
    + ('<div class="plugin-header">'
      +'<h1>' + result.dictNm + '</h1>'
      +'<span class="close-plugin" onclick="dictDetailClose()">'
        +'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
          +'<path d="M5.74478 4.75483C5.47141 4.48146 5.0282 4.48146 4.75483 4.75483C4.48146 5.0282 4.48146 5.47141 4.75483 5.74478L13.01 13.9999L4.75506 22.2548C4.48169 22.5282 4.48169 22.9714 4.75506 23.2448C5.02843 23.5181 5.47164 23.5181 5.74501 23.2448L13.9999 14.9899L22.2548 23.2448C22.5282 23.5181 22.9714 23.5181 23.2448 23.2448C23.5181 22.9714 23.5181 22.5282 23.2448 22.2548L14.9899 13.9999L23.245 5.74478C23.5184 5.47141 23.5184 5.0282 23.245 4.75483C22.9716 4.48146 22.5284 4.48146 22.2551 4.75483L13.9999 13.01L5.74478 4.75483Z" fill="#2C2C2C"/>'
        +'</svg>          '
      +'</span>'
    +'</div>')
    + ('<div class="plugin-contents">' 
    + '<div class="dict-detail">'
      +'<ul>'
          +'<li><span class="item">영어명</span><p>' + ( result.dictNmEn ? result.dictNmEn : '-') + '</p></li>'
          +'<li><span class="item">중문명</span><p>' + (result.dictNmCh ? result.dictNmCh : '-') + '</p></li>'
          +'<li><span class="item">약어</span><p>'+ (result.dictAbbr ? result.dictAbbr : '-' )+'</p></li>'
          +'<li><span class="item">내용</span><p>' + (result.dictDesc ? result.dictDesc : '-') + '</p></li>'
          +'<li><span class="item">내용(영문)</span><p>' + (result.dictDescEn ? result.dictDescEn : '-') + '</p></li>'
          +'<li><span class="item">내용(중문)</span><p>'+ (result.dictDescCh ? result.dictDescCh : '-')+'</p></li>'
          +'<li><span class="item">카테고리</span><p>'+(result.category ? result.category : '-') +'</p></li>'
          +'<li><span class="item">등록자</span><p>' + (result.registNm ? result.registNm : '-') + '</p></li>'
          +'<li><span class="item">등록일</span><p>'+ (result.registDate ? result.registDate : '-')+'</p></li> '
      +'</ul>'
    +'</div>'
    +'<button type="button" class="btn btn-plugin btn-apply" id="btn-dict" onclick="dictDetailClose()">확인</button>'
    +'</div>')
    +'</div>');

    $('.test-panel').append(pulginDim);
    $('.test-panel').append(dictDetail);

    $('.plugin-dim').css('display', 'block');
    $('#dictDetail').css('display', 'block');

    setTimeout(function() {
      $('.plugin-dim').addClass('show');
      $('#dictDetail').addClass('show');
      loadingDict = false;
    }, 100);

  });
  
}


 

chatui.onReceiveResponse = function(resp, isHistory) {
   console.log("chatui.onReceiveResponse", resp, isHistory);
   
   
   setTimeout(function() {

    // if(resp.response.query.text =="GPT 모드"){
    //     activeGptBot("");
    // }
    if(resp.response.query.event == 'Welcome' || resp.response.queryResult.intent.name == 'Default Welcome Intent') {
      //welcomeAppend(resp.response.queryResult.messages);
      
      
        // [테스트 용으로 사용_시작점]

		//makeAnotherAccountOrderCard();

		// [테스트 용으로 사용_종료점]
      
      
      return;
    }

    if(resp.response.queryResult.intent.name == '기능_타계정주문_메뉴') {
        makeAnotherAccountOrderCard();
        
        //return;
    }
    
    if(resp.response.query.event == 'sendSmsNew') {
      sendSmsNewAppend(resp.response.queryResult);
      return;
    }

    for(var i = 0; i < resp.response.queryResult.messages.length; i++) {
      var message = resp.response.queryResult.messages[i];
      if(message.quickReply && message.quickReply.length > 0) {
        var quickButtons = $('<div class="btn-list"></div>');

        for(var k=0; k<message.quickReply.length; k++) {
          var button = message.quickReply[k];
          if(button.type == 'btn') {
            var sendMessageBtn = $('<span class="btn-custom-reply send-message" data-message="'+ button.value +'">' + button.label + '</span>');
            sendMessageBtn.on('click', function() {
              var mText = $(this).data('message');
              chatui.sendMessage(mText);
            });
      
            quickButtons.append(sendMessageBtn);
          }
          else if(button.type == 'callIntent') {
            var buttonParams = JSON.stringify(button.parameters);
            var callIntentBtn = $(`<span class="btn-custom-reply call-intent" data-message="` + button.label + `" data-intent="`+ button.value + `" data-parameters='`+ buttonParams + `'>` + button.label + `</span>`);
             
            callIntentBtn.on('click', function() {
              var callEvent = $(this).data('intent');
              if($(this).data('parameters')) {
                var intentParams = {};
                var parameters = $(this).data('parameters');
                parameters.forEach(function(e) {
                  intentParams[e.toParamName] = e.value
                });
                var callMessage = $(this).text();
                intentParams["text"] = callMessage;
                chatui.sendEventMessage(callEvent, intentParams);
              } else {
                var callMessage = $(this).text();
               chatui.sendEventMessage(callEvent, {"text": callMessage});
              }
              
            });
           
            
            quickButtons.append(callIntentBtn);
          }
          else if(button.type == 'link') {
            var linkBtn = $('<span class="btn-custom-reply web-link" data-weblink="'+ button.value +'">' + button.label + '</span>');
            linkBtn.on('click', function() {
              var weblink = $(this).data('weblink');
              window.parent.location.href = weblink;
            })
            quickButtons.append(linkBtn);
          }
          else if(button.type == 'outApp') {
          var outlinkBtn = $('<span class="btn-custom-reply out-link" data-outlink="'+ button.value +'">' 
          + button.label
          +'<svg width="20" height="20" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
          + '<path d="M18.0964 6.50024L24.097 6.50066C24.6493 6.5007 25.0969 6.9484 25.0969 7.50066L25.0969 13.5002" stroke="#333333" stroke-linecap="round"/>'
          + '<path d="M16.3394 14.9355L24.5962 7.00098" stroke="#333333" stroke-linecap="round"/>'
          + '<path d="M14 8H9C7.89543 8 7 8.89543 7 10V23C7 24.1046 7.89543 25 9 25H22C23.1046 25 24 24.1046 24 23V18" stroke="#333333" stroke-linecap="round"/>'
          + '</svg>'
            + '</span>');
            outlinkBtn.on('click', function(){
                var outlink = $(this).data('outlink');
                window.open(outlink, '_blank');
              });
              quickButtons.append(outlinkBtn);
      
        } else {
          var simpleBtn = $('<span class="send-message" data-message="'+ button.value +'">' + button.label + '</span>');
          simpleBtn.on('click', function() {
            var mText = $(this).data('message');
            chatui.sendMessage(mText);
          });
          quickButtons.append(simpleBtn);
        }
        }
    
        $('.quick-list').last().addClass('custom-quick-reply');

        $('.quick-list').last().html(quickButtons);
      }
    }

    
    if(welcomeClick == true && resp.response.queryResult.parameters["HR_Info"] == '') {
      var homeBtn = $('<span class="btn-custom-reply btn-emphasis">Home</span>')

      homeBtn.on('click', function() {
        sendWelcomeEvent();
      });
      $('.quick-list').last().find('.btn-list').append(homeBtn);
      welcomeClick = false;

    } else if(welcomeClick == true && resp.response.query.text =="오늘의 일정") {
      
      var homeBtn = $('<span class="btn-custom-reply btn-emphasis">Home</span>')

      homeBtn.on('click', function() {
        sendWelcomeEvent();
      });
      $('.custom-quick-reply').last().append(homeBtn);
      welcomeClick = false;

    } else if(welcomeClick == true) {
      var quickReply = $('<div class="quick-list custom-quick-reply"></div>');
      var homeBtn = $('<span class="btn-custom-reply btn-emphasis">Home</span>')

      homeBtn.on('click', function() {
        sendWelcomeEvent();
      });
      quickReply.append(homeBtn);
      var lastFeedback = $('.chat-message.left').last().find('.feedback');
      quickReply.insertBefore(lastFeedback); 
      welcomeClick = false;
    }


    $('.btn-system').on('click', function() {
      var systemSelect = $(this).data('system');

      appendQueryText(systemSelect);
      var item = systemItems.find((o) => { return o["sysName"] === systemSelect })    
      
      var systemCardTop = makeSystemCardMoveCard(item); // [퍼블 수정 및 추가] - 시스템 접속 card 추가
      
      var systemCard = makeSystemCard(item);
      var customQuick = $('<div class="custom-quick-reply"></div>');
      systemItems.map(sysItem => {
        if(systemSelect != sysItem.sysName) {
          var sysbtn2 = $('<span class="btn-custom-reply btn-system" data-system="' + sysItem.sysName + '">' + sysItem.sysName +'</span>'); 
          customQuick.append(sysbtn2);
        }
      });

      $(this).parent().remove();
      
      appendChatbotText3(systemCardTop, systemCard, customQuick); // [퍼블 수정 및 추가] - 시스템 접속 card 포함하여 생성
    });


    $('.list-system').on('click', function() {
      var systemSelect = $(this).data('system');

      console.log('systemSelect > '+systemSelect);
      appendQueryText(systemSelect);
      var item = systemItems.find((o) => { return o["sysName"] === systemSelect })    
      
      var systemCardTop = makeSystemCardMoveCard(item); // [퍼블 수정 및 추가] - 시스템 접속 card 추가
      
      var systemCard = makeSystemCard(item);

      //$(this).parent().remove();
      
      appendChatbotText2(systemCardTop, systemCard); // [퍼블 수정 및 추가] - 시스템 접속 card 포함하여 생성
    });

  }, 100)
  
    // 스크롤 이동_리뉴얼
    // [퍼블 수정_240528 (스크롤 이동_커스텀)]
    setTimeout(function() {
        var sclTarget = $('#divScroll');
        if (sclTarget.find('.chat-message').hasClass('right')) {
            var sclHeight = sclTarget.prop('scrollHeight');
            var lastLeftMsg = sclTarget.find('.chat-message.left').last().height();
            var lastRightMsg = sclTarget.find('.chat-message.right').last().height();
            console.log('스크롤', sclHeight, lastLeftMsg, lastRightMsg);
            sclTarget.scrollTop(sclHeight - lastLeftMsg - lastRightMsg - 230);
        }
    },100);

}

/**
 * '화면 스크롤 최하단으로 내리기' 함수
 */
 function descendScroll() {
	setTimeout(function() {
        var e = document.getElementById("divScroll");
        e.scrollTop = e.scrollHeight
        
    }, 50)
}


/********************************************************** element *************************************************************************************/
var loadEl = {
  'pop_reason': function() {
      var html = '<div class="pop-wrapper dialog">' +
                    '<h2>' +
                        '불참사유를 입력해주세요.' +
                    '</h2>' +
                    '<span class="dialog-close" onclick="pop.close(this);">' + 
                      iconPopupClose +
                    '</span>' +
                    '<div class="section-body">' +
                        '<textarea name="reason" id="reason" class="ui-textarea" placeholder="불참사유를 입력해주세요."></textarea>' +
                    '</div>' +
                    '<div class="dialog-btns">' +
                        '<button type="button" onclick="pop.close(this);" class="cencel">취소</button>' +
                        '<button type="button" id="reasonSave" class="primary" disabled="disabled">저장</button>' +
                    '</div>' +
                  '</div>';

      return html;
  },
  'pop_del_confirm': function(popTitle, msg) {
      var html = '<div class="pop-wrapper dialog">' +
                    '<h2>' + popTitle + '</h2>' +
                    '<span class="dialog-close" onclick="pop.close(this);">' + 
                      iconPopupClose +
                    '</span>' +
                    '<p class="section-message">' +
                      msg +
                    '</p>' +         
                    '<div class="dialog-btns">' +
                        '<button type="button" onclick="pop.close(this);" class="cancel">취소</button>' +
                        '<button type="button" id="btnDelete" class="delete">삭제</button>' +
                    '</div>' +
                  '</div>';
      return html;
  },'pop_reg_confirm': function(popTitle, msg) {
      var html = '<div class="pop-wrapper dialog">' +
                    '<h2>' + popTitle + '</h2>' +
                    '<span class="dialog-close" onclick="pop.close(this);">' + 
                      iconPopupClose +
                    '</span>' +
                    '<p class="section-message">' +
                      msg +
                    '</p>' +   
                    '<div class="dialog-btns">' +
                        '<button type="button" onclick="pop.close(this);" class="cancel">취소</button>' +
                        '<button type="button" id="btnReg" class="primary">등록</button>' +
                    '</div>' +
                  '</div>';
      return html;
  },'pop_process_confirm': function(popTitle, msg) {
      var html = '<div class="pop-wrapper dialog">' +
                    '<h2>' + popTitle + '</h2>' +
                    '<span class="dialog-close" onclick="pop.close(this);">' + 
                      iconPopupClose +
                    '</span>' +
                    '<p class="section-message">' +
                        msg +
                    '</p>' +
                    '<div class="dialog-btns">' +
                        '<button type="button" id="btnConfirm" class="primary">예</button>' +
                        '<button type="button" onclick="pop.close(this);" class="cancel">아니오</button>' 
                    '</div>' +
                  '</div>';

      return html;
  },'pop_process_confirm2': function(msg) {
      var html = '<div class="pop-wrapper dialog">' +
                    // '<h2>' + popTitle + '</h2>' +
                    '<span class="dialog-close" onclick="pop.close(this);">' + 
                      iconPopupClose +
                    '</span>' +
                    '<p class="section-message">' +
                        msg +
                    '</p>' +
                    '<div class="dialog-btns">' +
                        '<button type="button" id="btnConfirm" class="primary">예</button>' +
                        '<button type="button" onclick="pop.close(this);" class="cancel">아니오</button>' 
                    '</div>' +
                  '</div>';

      return html;
  },'pop_reg_sms': function(popTitle, msg) {
      var html = '<div class="pop-wrapper dialog">' +
                    '<h2>' + popTitle + '</h2>' +
                    '<span class="dialog-close" onclick="pop.close(this);">' + 
                      iconPopupClose +
                    '</span>' +
                    '<p class="section-message">' +
                      msg +
                    '</p>' +
                    '<div class="dialog-btns">' +
                        '<button type="button" onclick="pop.close(this);" class="cancel">취소</button>' +
                        '<button type="button" id="btnRegSms" class="primary">발송</button>' +
                      '</div>' +
                  '</div>';
      return html;
  },
  'pop_alert': function(msg) {
      var html = '<div class="pop-wrapper dialog">' +
                    '<span class="dialog-close" onclick="pop.close(this);">' + 
                      iconPopupClose +
                    '</span>' +
                    '<p class="section-message">' +
                      msg +
                    '</p>' +
                    '<div class="dialog-btns">' +
                      '<button type="button" onclick="pop.close(this);" class="primary">확인</button>' +
                    '</div>' +
                  '</div>';

      return html;
  }
}


/**
 * '일자별 스케줄 셋팅' 함수
 */
 function setScheduleDate(btn, date) {
  var checkBtnShow = $(btn).closest(".schedule-wrap").find(".check-attendView").prop("checked");
  var $listWrap = $(btn).closest(".schedule-wrap").find(".schedule-list-wrap");
  var $list;
  var sessionId = $(btn).closest(".schedule-wrap").attr("data-sessionId");
  var userId = $(btn).closest(".schedule-wrap").attr("data-userId");
  var loginUserId = $(btn).closest(".schedule-wrap").attr("data-loginUserId");
  var empNo = $(btn).closest(".schedule-wrap").attr("data-empNo");

  $listWrap.html('<ul class="schedule-list"></ul>');
  $list = $(btn).closest(".schedule-wrap").find(".schedule-list");

  date = moment(date).format('YYYYMMDD');

  /**********************************************************/
  var requestParam = {
    query: {
    "event": "scheduleQueryEvent"
  },
  payload: {
    "date": date,
    "targetId" : userId,
    "loginUserId" : loginUserId 
    //, "loginEmpNo" : empNo
  }
  };
  
  sendChatApi(requestParam, sessionId, function(payload){
    console.log("scheduleQueryEvent :: "+ JSON.stringify(payload));
    
    var data = JSON.parse(payload.queryResult.messages[1].response).template.outputs;
    
      var count = 0;

      $.each(data, function(index) {
        if (data[index].type == 'schedule') {
          if (moment(data[index].data.date).format('YYYYMMDD') == date) {
            makeScheduleItem(data[index].data, $list, checkBtnShow, data[index].data.date);
            count = count + 1;
          }
        }
      });

      $listWrap.addClass("show");

      if (count < 1) {
        $listWrap.html('<div class="schedule-noData">등록된 일정이 없습니다.</div>');
      }
  });
  /**********************************************************/
}

/**
* 스케줄 상세 보기 화면 
**/
function scheduleDetail(btn) {
  let scheduleId = $(btn).closest(".schedule-item").attr("data-scheduleid");
  window.open(gportalScheduleUrl+scheduleId, 'width=1100,height=800, resizable=1,scrollbars=1');
}

var scheduleTitle = '';
var allDayCheck = 'N';

function checkScheduleRequire() {
  var startDate = $('#start-date').val();
  var startTime = $('#start-time').val();
  var endDate = $('#end-date').val();
  var endTime = $('#end-time').val();
  var btnSchedule = $('#btn-schedule');

  if(scheduleTitle && (allDayCheck == 'Y' && startDate)) {
    btnSchedule.removeClass('btn-disabled');
  } else if(scheduleTitle && (allDayCheck == 'N' && startDate && startTime && endDate && endTime)) {
    btnSchedule.removeClass('btn-disabled');
  } else {
    btnSchedule.addClass('btn-disabled');
  }
}

//Datepicker Module
const setDatepicker = function() {
  var $initEl;

  // 날짜 한글 변환
  function fullDate(val, target) {
    var today;
    var strWeek = ["일요일","월요일","화요일", "수요일","목요일","금요일","토요일"]
    var fullDate;

    if (target) {
      today = new Date($(target).val());
    } else {
      today = new Date(val);
    }

    fullDate = today.getFullYear() +'년 ' + (today.getMonth() + 1) + '월 ' + today.getDate() + '일 ' + strWeek[today.getDay()]
    return fullDate;
  }

  // open
  function dpOpen(btn, target, callback){
    var $input;
    

    if ($(btn).closest(".schedule-input-wrap").length > 0) {
      $initEl = $(btn).closest(".schedule-input-wrap").find(".datepicker-chem");
      $(".datepicker-chem:visible").not($initEl).fadeOut('fast', function(){
        $(this).removeClass("show");
      });
    } else {
      $initEl = $(btn).closest(".ui-input-date").find(".datepicker-chem");
    }

    if (target) {
      $input = $(target);
    } else {
      if ($(btn).closest(".schedule-wrap")) {
        $input = $(btn).closest(".schedule-input-wrap").find(".input-schedule-date");
      } else {
        $input = $(btn).prev("input[type=text]");
      }
    }

    var minDate = '';

    if($(btn).hasClass('startdate')) {
      minDate = $(btn).val();
    }

    if($(btn).hasClass('enddate')) {
      minDate = $(btn).closest('.schedule-wrap').find('.startdate').val();
    }

    if ($initEl.is(':visible')) {
      dpClose();
    } else {
      $initEl.datepicker({
        formatDate: "ATOM",
        minDate: minDate,
        dateFormat: "yy.mm.dd",
        defaultDate: $input.val(),
        showOn: "",
        buttonImageOnly: true,
        showMonthAfterYear: true,
        monthNames: ["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],
        monthNamesShort: ["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],
        dayNamesMin: ['일','월','화','수','목','금','토'], 
        altField: target,
        showButtonPanel: true,
        closeText: "close",
        beforeShow: function() {
        },
        onChangeMonthYear: function() {

        },
        onSelect: function() {
          $initEl.find('.selected-date').text(this.value);
          $(btn).val(this.value);
          var endDt = moment($('.enddate').val()).format('YYYYMMDD');
          var startDt = moment($('.startdate').val()).format('YYYYMMDD');
          if(endDt < startDt) {
            $('.enddate').val($('.startdate').val());
          }
          checkScheduleRequire();

          // dpClose();

          if (callback){
            eval(callback);
          }
        },
        onClose: function() {
            $(btn).focus();
        }
    });

         
    if(!$initEl.find('.dp-header').text()) {
      $initEl.prepend('<div class="dp-header"><h3>날짜 선택</h3><p>날짜를 선택해주세요<b>*</b></p></div>');
    }
           
    if($initEl.find('.plugin-select-dim').length == 0) {
      $initEl.prepend('<div class="plugin-select-dim"></div>');
    }

    if($initEl.find('.selected-date').length == 0) {
      var selectedDate = new Date();
      $initEl.find('.dp-header').append('<div class="selected-date">' + moment(selectedDate).format('YYYY.MM.DD') + '</div>');
    }
        
    if($initEl.find('.dtpicker-refresh').length == 0) {
      $initEl.find('.dp-header').append('<div class="dtpicker-refresh">초기화</div>');
    }

    $('.dtpicker-refresh').on('click', function(){
      var newDt = new Date();
      var selectedDate = moment(newDt).format('YYYY.MM.DD');
      $initEl.datepicker("setDate", selectedDate);
      $initEl.find('.selected-date').text(selectedDate);
      $(btn).val(selectedDate);
    });

    if($initEl.find('.btn-datepicker').length == 0) {
      $initEl.append('<button type="button" class="btn-plugin btn-datepicker" onclick="datepicker.close();">확인</button>');  
    }
        

    $initEl.fadeIn('fast', function(){  
      $(this).find('.plugin-select-dim').addClass('show');
      $(this).addClass("show");
    });
        
  }
  }


  function dpClose() {
    $(".datepicker-chem").fadeOut('fast', function(){
      $(this).removeClass("show");
    })
  }

  return {
    open: dpOpen,
    close: dpClose,
    fulldate: fullDate
  }
};

window.datepicker = setDatepicker();

function setTimePicker(timeinput) {
  
  var startdate = moment($('#start-date').val()).format('YYYYMMDD');
  var enddate = moment($('#end-date').val()).format('YYYYMMDD');
  var today = moment().format('YYYYMMDD');
  $(timeinput).closest('.time-selector').find('.time-options').empty();
  $(timeinput).closest('.time-selector').find('.time-options').addClass('show');
 
 
  let hrStart = 0;
  if($(timeinput).hasClass('start-time') && startdate == today) {
    hrStart = moment().add(1, 'hours').format('HH')
    if(hrStart.indexOf('0') > 0) {
      hrStart = hrStart[1];
    }
  } else if($(timeinput).hasClass('end-time') && startdate == enddate) {
    var startVal = $('.start-time').val();
    startVal = startVal.split(':')[0];
    
    if(startVal.startsWith('0')) {
      hrStart = (Number(startVal[1]) + 1);
    } else {
      hrStart = Number(startVal) + 1;
    }
  } else {
    hrStart = 0;
  }   
 
  for (let hr = hrStart; hr <= 24; hr++) {
    let hrStr = hr.toString().padStart(2, "0") + ":";
    let val = hrStr + "00";
    var timeOption = $('<div data-val="' + val + '" class="time-option">' + val + '</div>');
   
    if(startdate == enddate && $(timeinput).hasClass('end-time')) {
      var startValue = $('.start-time').val();
      starTimetVal = moment(startValue, 'HH:mm');
      addtimeVal = moment(val, 'HH:mm');
      var duration = moment.duration(addtimeVal.diff(starTimetVal));
      var hours = parseInt(duration.asHours());
      var minutes = parseInt(duration.asMinutes()) % 60;
      var hourminite = (hours != 0 ? hours + '시간' : '') + (minutes != 0 ? minutes + '분' : '');
      timeOption = $('<div data-val="' + val + '" class="time-option">' + val + '(' + hourminite +')'+'</div>');
    }
    
    timeOption.on('click', function(){
      var timeValue = $(this).data('val');
      $(this).closest('.time-selector').find('.time-input').val(timeValue);
      checkScheduleRequire();
      if($(this).closest('.time-options').hasClass('show')) {
        $(this).closest('.time-options').removeClass('show');
      };

      if($(timeinput).hasClass('start-time') && $('#start-date').val() == $('#end-date').val()) {
        var endTime = timeValue.split(':')[0]+':30'
        $('.end-time').val(endTime);
      };
    })
    $(timeinput).closest('.time-selector').find('.time-options').append(timeOption);
    
    
    if(hr != 24) {
      val = hrStr + "30";
      var timeOption2 = $('<div data-val="' + val + '" class="time-option">' + val + '</div>');
      
      if(startdate == enddate && $(timeinput).hasClass('end-time')) {
        var startVal = $('.start-time').val();
        starTimetVal = moment(startVal, 'HH:mm');
        addtimeVal = moment(val, 'HH:mm');
        var duration = moment.duration(addtimeVal.diff(starTimetVal));
        var hours = parseInt(duration.asHours());
        var minutes = parseInt(duration.asMinutes()) % 60;
        var hourminite = (hours != 0 ? hours + '시간' : '') + (minutes != 0 ? minutes + '분' : '');

        timeOption2 = $('<div data-val="' + val + '" class="time-option">' + val + '(' +hourminite+')'+'</div>');
      }

      timeOption2.on('click', function() {
        var timeValue = $(this).data('val');
        $(this).closest('.time-selector').find('.time-input').val(timeValue);
        checkScheduleRequire();
        if($(this).closest('.time-options').hasClass('show')) {
          $(this).closest('.time-options').removeClass('show');
        };

        if($(timeinput).hasClass('start-time') && $('#start-date').val() == $('#end-date').val()) {
          var endTime = (Number(timeValue.split(':')[0])+1) + ':00'
          $('.end-time').val(endTime);
        };
      });
      $(timeinput).closest('.time-selector').find('.time-options').append(timeOption2);    
    }
  }
    
  
}


function addSchedulePopupClose() {
  $('#addSchedule').removeClass('show');
  $('.plugin-dim').removeClass('show');
  setTimeout(function() {
    $('.plugin-dim').remove();
    $('#addSchedule').remove();
  }, 300);
}

var scheduleTitle = '';
var scheduleSaveLoading = false;

function setTimeToFour(timeText) {
  if(timeText.length == 0) {
    return '00:00';
  } else if(timeText.length == 1) {
    return '0' + timeText + ':00';
  } else if(timeText.length == 2) {
    return timeText+':00;'
  } else {
    return timeText;
  }
}

/////////////////////////////////////////// popup 생성 함수 ///////////////////////////////////////////
function addSchedulePopupOpen(data) {
  var videoMeeting = 'N';
  var privateSchedule = 'N';
  var checkAttendance = 'N';
  var webxYnErrorMessage = data.errMsg;

  console.log(data);
  var pulginDim = $('<div class="plugin-dim show"></div>');
  var addScheduleBox = $('<div class="plugins" id="addSchedule"></div>');

  var addScheduleHeader = $('<div class="plugin-header"><h1>일정 등록</h1><p class="small">※ 지포탈에서 예약된 회의실만 사용 가능합니다</p></div>');
  var addShceduleClose = $('<span class="close-plugin">'
    +'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
    + '<path d="M5.74478 4.75483C5.47141 4.48146 5.0282 4.48146 4.75483 4.75483C4.48146 5.0282 4.48146 5.47141 4.75483 5.74478L13.01 13.9999L4.75506 22.2548C4.48169 22.5282 4.48169 22.9714 4.75506 23.2448C5.02843 23.5181 5.47164 23.5181 5.74501 23.2448L13.9999 14.9899L22.2548 23.2448C22.5282 23.5181 22.9714 23.5181 23.2448 23.2448C23.5181 22.9714 23.5181 22.5282 23.2448 22.2548L14.9899 13.9999L23.245 5.74478C23.5184 5.47141 23.5184 5.0282 23.245 4.75483C22.9716 4.48146 22.5284 4.48146 22.2551 4.75483L13.9999 13.01L5.74478 4.75483Z" fill="#2C2C2C"/>'
    +'</svg>          '
  +'</span>');
  addShceduleClose.on('click', function() {
    addSchedulePopupClose();
  })
  addScheduleHeader.append(addShceduleClose);
  addScheduleBox.append(addScheduleHeader);

  var addScheduleContents = $('<div class="plugin-contents"></div>');
  var addScheduleForm = $('<form data-sessionId="'+ data.chatSessionId.split("sessions/")[1] +'"' + 'data-userId="'+data.userId+'" class="form-schedule"></form>');
  
  /* ###[ 제목 ]### */
  var titleInputBox = $('<div class="input-box"><label>제목<b>*</b></label></div>');   
  var titleInput = $('<input type="text" placeholder="제목을 입력해주세요." name="sch_title" id="sch_title" max-length="50" />');
  titleInput.on('keyup', function(e) {
    scheduleTitle = e.target.value;
    checkScheduleRequire();
  });
  titleInputBox.append(titleInput);    
  addScheduleForm.append(titleInputBox);
  
  /* ###[ 일시 ]### */
  var placeholderToday = moment().format('YYYY.MM.DD');
  var placeholderNowTime = '';
  if(moment().minute()<30) {
    placeholderNowTime = moment().minute(30).second(0);
  } else {
    placeholderNowTime= moment().add(1, 'hours').minute(0).second(0);
  }
 
  var placeholderNowTimeHourMinutes = moment(placeholderNowTime).format('HH:mm');
  var placeholderNowPlus30 = moment(placeholderNowTime).add(30, 'minutes').format('HH:mm');

  var timeInputBox = $('<div class="input-box"><label>일시<b>*</b></label></div>');
  var allDayBox = $('<div class="on-off-box"></div>');
  var allDayUl = $('<ul></ul>');
  var allDayLi = $('<li></li>');
  var allDayText = $('<span class="a-text">종일일정</span>');
  allDayLi.append(allDayText);
  var allDaySwitch = $('<label class="switch">'
    +'<input type="checkbox" id="allDay" />'
    +'<span class="slider round"></span>'
    +'</label>');
  allDaySwitch.on('click', function() {
    if($(this).find('#allDay').is(':checked')) {
      allDayCheck = 'Y';
      $('.schedule-input-wrap').find('.time-selector').css('display', 'none');
      $('.schedule-input-wrap').find('.input-schedule-date').addClass('all-day');
      $('.time-input').val('');
    } else {
      allDayCheck = 'N';
      $('.schedule-input-wrap').find('.time-selector').css('display', 'unset');
      $('.schedule-input-wrap').find('.input-schedule-date').removeClass('all-day');
      $('#start-time').val(placeholderNowTimeHourMinutes);
      $('#end-time').val(placeholderNowPlus30);
    }
  });
  allDayLi.append(allDaySwitch);
  allDayUl.append(allDayLi);
  allDayBox.append(allDayUl);
  timeInputBox.append(allDayBox);

  var dateTimeWrap = $('<div class="schedule-wrap"></div>');
  var dateTimeStartBox = $('<div class="schedule-input-wrap schedule-date-wrap" id="start-date-box"></div>');
  var dateStartInput = $('<input type="text" placeholder="'+placeholderToday+'" value="'+placeholderToday+'" id="start-date" class="input-schedule-date startdate" onclick="datepicker.open(this)" />');
  dateTimeStartBox.append(dateStartInput);
  var timeStartSelect = $('<div class="time-selector">'
    +'<input type="text" placeholder="'+placeholderNowTimeHourMinutes+'" value="'+placeholderNowTimeHourMinutes+'" id="start-time" class="time-input start-time" onclick="setTimePicker(this)"/>'
    +'<div class="time-options"></div>'
  +'</div>');
 
  dateTimeStartBox.append(timeStartSelect);
  dateTimeWrap.append(dateTimeStartBox);
  var dateTimeEndBox = $('<div class="schedule-input-wrap schedule-date-wrap" id="end-date-box"></div>');
  var dateEndInput = $('<input type="text" placeholder="'+placeholderToday+'"  value="'+placeholderToday+'" id="end-date" class="input-schedule-date enddate" onclick="datepicker.open(this)" />');
  dateTimeEndBox.append(dateEndInput);
  var timeEndBox = $('<div class="time-selector">'
    +'<input type="text" placeholder="'+placeholderNowPlus30+'" value="'+placeholderNowPlus30+'" id="end-time" class="time-input end-time" onclick="setTimePicker(this)"/>'
    +'<div class="time-options"></div>'
  +'</div>');
  
  dateTimeEndBox.append(timeEndBox);
  dateTimeWrap.append(dateTimeEndBox);
  timeInputBox.append(dateTimeWrap);
  addScheduleForm.append(timeInputBox);




  // [퍼블 수정 및 추가] - 참석자 영역과 장소 위치 변경
  /* ###[ 장소 ]### */
  var placeInputBox = $('<div class="input-box add-schedule-place"><label>장소</label></div>');
  var placeSelectBox = $('<div class="place-select"></div>');
  var placedSelected = $('<div class="selected-place"></div>');
  placeSelectBox.append(placedSelected);
  var placeTooltip = $('<div class="place-tooltip">설정된 일시에 예약된 회의실만 불러올 수 있어요.<br />먼저 지포탈에서 회의실을 예약해 주세요!</div>');
  placeSelectBox.append(placeTooltip);

  var meetingRoomList;
  var startDate = moment(dateStartInput.val()).format('YYYYMMDD') + (placeholderNowTimeHourMinutes ? placeholderNowTimeHourMinutes.split(':').join('') : '0000');
  if(!startDate || startDate == 'Invalid date') {
    startDate = moment().format('YYYYMMDD') + '0000';
  }
  var endDate = moment(dateEndInput.val()).format('YYYYMMDD') + (placeholderNowPlus30 ? placeholderNowPlus30.split(':').join('') : '2400');
  if(!endDate || endDate == 'Invalid date') {
    endDate = moment().format('YYYYMMDD') + '2400';
  }
  var userId = data.userId;
  
  var placeInput = $('<input type="text" placeholder="회의실 선택 또는 장소를 입력해 주세요." id="schedule-place" />'); // [퍼블 수정 및 추가] - placeholder 텍스트 수정
  var placeList = $('<div class="place-list"></div>');
  var placeByText = $('<div class="place-text"><p class="texted"></p><p class="small">입력한 이 위치 사용하기</p></div>');
  var placeValue = '';
  placeList.append(placeByText);
  
  var isMobile = Mobile();

  // [퍼블 수정 및 추가] - 미사용으로 인한 제거
  /*
  if(!isMobile) {
    var addPlace = $('<div class="add-place"><a href="http://gportal.lgchem.com/lightpack/facility/mettingRoomSelect.do?mandatorId=&userIds=&facilityIds=" target="_blank">+ 지포탈에서 새로운 회의실 예약하기</a></div>');
    addPlace.on('click', function() {
      $('.place-list').removeClass('show');
    });
    placeList.append(addPlace);
  }
  */

  placeInput.on('keyup', function() {
    placeValue = $(this).val();
    if(placeValue.length > 0) {
      $('.place-text').addClass('show');
      $('.place-text .texted').text(placeValue); 
    } else {
      $('.place-text').removeClass('show');
      $('.place-text .texted').text(''); 
    }
  });

  placeByText.on('click', function() {
    var placeInfo = $('<div class="place-info">'
      + placeValue
      + '<button type="button" class="btn btn-delete">' 
        +  '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
        +  '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
        +  '</svg>'
      + '</button>'
      + '<input type="hidden" value="'+ placeValue +'" class="place-name"/>'
      +'</div>');

      placedSelected.empty();
      placeInput.val('');
      $('.place-text').removeClass('show');
      $('.place-text .texted').text(''); 
      placedSelected.append(placeInfo);
      $('.place-list').removeClass('show');
      $('.place-list').css('top', '82px'); // [퍼블 수정 및 추가] - 125px -> 82px 수정
      $('#schedule-place').attr('placeholder', '');
  });
 
  var plcaeListTitle = $('<span>예약된 회의실 목록</span>');
  placeList.append(plcaeListTitle);
  
  var placeUl = $('<ul></ul>');
  placeInput.on('focus', function() {
    $('.place-list').addClass('show');
    placeUl.empty();


    // [퍼블 수정 및 추가] - 확인 불가로 인하여 임시로 주석처리(바로 밑에 샘플 작업)
    /*
    startDate =  moment(dateStartInput.val()).format('YYYYMMDD') + ($('#start-time').val() ? $('#start-time').val().split(':').join('') : '0000');
    endDate = moment(dateEndInput.val()).format('YYYYMMDD') + ($('#end-time').val() ? $('#end-time').val().split(':').join('') : '2400');
    if(startDate && endDate) {
      var requestParam = {
        query: {
          "event": retrieveFacilityListEvent
        },
        payload: {
          searchStartDt: startDate, 
          searchEndDt: endDate, 
          userId: userId
        }
      };
      
      sendChatApi(requestParam, null, function(payload){
        var result = JSON.parse(payload.queryResult.messages[1].response);
        meetingRoomList = result.result;

        if(meetingRoomList.length == 0) {
          var placeLi = $('<li class="no-res">예약된 회의실이 없습니다.</li>');
          placeUl.append(placeLi);
          placeList.append(placeUl);
        } else {
          meetingRoomList.map(meetingRoom => {
            
            
            var placeLi = $('<li><p>'+ meetingRoom.schFacilityName +'</p><p class="small">'+ meetingRoom.schStartDate +'~'+ meetingRoom.schEndDate +' · ' + meetingRoom.schFacilityName+'</p></li>');
  
            placeLi.on('click', function() {
                var placeInfo = $('<div class="place-info">'
                  + meetingRoom.schTitle
                  + '<button type="button" class="btn btn-delete">' 
                    +  '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
                    +  '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
                    +  '</svg>'
                  + '</button>'
                  + '<input type="hidden" value="'+ meetingRoom.schFacilityName +'" class="facility-name"/>'
                  + '<input type="hidden" value="'+ meetingRoom.schFacilityId +'" class="facility-id"/>'
                  +'</div>');
  
                  placedSelected.empty();
                  placedSelected.append(placeInfo);
                  $('.place-list').removeClass('show');
                  $('.place-list').css('top', '125px');
                  $('#schedule-place').attr('placeholder', '');
              });
  
            placeUl.append(placeLi);
          });
          placeList.append(placeUl);
        }
      });
    }
    */

    // [퍼블 수정 및 추가] - 확인 불가로 인하여 임시 샘플 작업
    var placeLi = $(
        '<li>'
            +'<p>'+ '회의실 호수'+'(회의실 이름)' +'</p>'
            +'<p class="small">'
            + '시작시간' +'~'+ '종료시간' +' · ' + '회의실 상세위치'
            +'</p>'
        +'</li>'
    );
    placeLi.on('click', function() {
        var placeInfo = $(
            '<div class="place-info">'
                + '회의실 호수' + '(회의실 위치)'
                + '<button type="button" class="btn btn-delete">' 
                    + '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
                        + '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
                    + '</svg>'
                + '</button>'
            +'</div>'
        );
        placedSelected.empty();
        placedSelected.append(placeInfo);
        $('.place-list').removeClass('show');
        $('.place-list').css('top', '82px');
        $('#schedule-place').attr('placeholder', '');
        schedulePlaceWidth();
    });
    placeUl.append(placeLi);
    placeList.append(placeUl);


  });

  placeSelectBox.append(placeInput);
  placeSelectBox.append(placeList);
  placeInputBox.append(placeSelectBox);
  addScheduleForm.append(placeInputBox);

  $(document).on('click', '.place-info .btn-delete', function(){
    $(this).closest(".place-info").remove();
    $('#schedule-place').attr('placeholder', '장소를 입력해 주세요.');
    $('.place-list').css('top', '82px');

    schedulePlaceWidth(); // [퍼블 수정 및 추가] - 추가
  });

  // [퍼블 수정 및 추가] - place-select외 클릭 시, place-list 닫힘
  $(document).on('click', function(e) {
    if ($('.place-select').has(e.target).length === 0) {
        $('.place-list').removeClass('show');
    }
  });

  // [퍼블 수정 및 추가] - 브라우저 창 리사이즈 반응 input 가로 사이즈 변경
  $(window).resize(function() {
      schedulePlaceWidth();
  });

  // [퍼블 수정 및 추가] - 장소 입력 input width 반응
  function schedulePlaceWidth() {
      let placeSelectWidth = $('.place-select').width();
      let selectedPlaceWidth = $('.selected-place').width();
      let schedulePlaceWidth = placeSelectWidth - selectedPlaceWidth;
      $('#schedule-place').css('width', schedulePlaceWidth + "px");
      if ($('#schedule-place').width() === 0) {
          $('#schedule-place').attr('style', '');
      };
  };


  // [퍼블 수정 및 추가] - 참석자 영역과 장소 위치 변경
  /* ###[ 참석자 ]### */
  var memberInputBox = $('<div class="input-box"><label>참석자</label></div></div>');
  var memberList = $('<div class="schedule-join-member"></div>');


  // [퍼블 수정 및 추가] - 미사용으로 인한 삭제
  /*
  var selectedMembersFold = $('<span class="member-open"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
    +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39823 5.61757C8.1709 5.4155 7.82833 5.4155 7.601 5.61757L2.26536 10.3604C2.10025 10.5071 1.84742 10.4923 1.70065 10.3271C1.55388 10.162 1.56875 9.9092 1.73387 9.76243L7.0695 5.01964C7.59995 4.54814 8.39928 4.54814 8.92972 5.01964L14.2654 9.76243C14.4305 9.9092 14.4453 10.162 14.2986 10.3271C14.1518 10.4923 13.899 10.5071 13.7339 10.3604L8.39823 5.61757Z" fill="#6B6B6B"/>'
    +'</svg></span>');
  selectedMembersFold.on('click',function() {
    if($(this).parent().find('.selected-members').hasClass('long')) {
      $(this).parent().find('.selected-members').removeClass('long');
      $(this).addClass('unfold');
    } else {
      $(this).parent().find('.selected-members').addClass('long');
      $(this).removeClass('unfold');
    }
  });
  memberList.append(selectedMembersFold);
  */


  var selectedMembers = $('<div class="selected-members fold"></div>');
  memberList.append(selectedMembers);
  var autocompleteMember = $('<div class="autocomplete-member"><ul id="ui-id-2" tabindex="0" class="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front" style="display: none;"></ul></div>');
  memberList.append(autocompleteMember);
  var memberInput = $('<input type="text" placeholder="직원명을 입력해 주세요" id="attendees" class="search-input" />');
  setAutocompleteJoinMember(memberInput);
  memberList.append(memberInput);
  memberInputBox.append(memberList);
  addScheduleForm.append(memberInputBox);
  

/* ###[ 기타 옵션 ]### */
  var otherOptionsBox = $('<div class="input-box"><p>기타 옵션</p></div>');
  var otherOptions = $('<div class="on-off-box"></div>');
  var otherOptionsUl = $('<ul></ul>');


  // [퍼블 수정 및 추가] - 미사용으로 인한 삭제
  /*
  var videoMeetingLi = $('<li><span class="a-text">화상 회의</span></li>');
  if(webxYnErrorMessage) {
    videoMeetingLi = $('<li><span class="a-text">화상 회의</span><p class="small primary">※'+ webxYnErrorMessage +'</p></li>');
  }
  var videoMeetingSwitch = $('<label class="switch">'
    +'<input type="checkbox" id="videoMeeting"/>'
    +'<span class="slider round"></span>'
    +'</label>');
  if(data.webexYn == 'N') {
    videoMeetingSwitch = $('<label class="switch disabled">'
    +'<input type="checkbox" id="videoMeeting" disabled />'
    +'<span class="slider round"></span>'
    +'</label>');
  }
  videoMeetingSwitch.on('click', function() {
    if($(this).find('#videoMeeting').is(':checked')) {
      videoMeeting = 'Y';
    } else {
      videoMeeting = 'N';
    }   
  });
  videoMeetingLi.append(videoMeetingSwitch);
  otherOptionsUl.append(videoMeetingLi);
  */
  
  var privateLi = $('<li><span class="a-text">비공개 일정</span></li>');
  var privateSwitch = $('<label class="switch">'
    +'<input type="checkbox" id="privateSchedule" value="Y" name="private" />'
    +'<span class="slider round"></span>'
  +'</label>');
  privateSwitch.on('click', function() {
    if($(this).find('#privateSchedule').is(':checked')) {
      privateSchedule = 'Y';
    } else {
      privateSchedule = 'N';
    }   
  });
  privateLi.append(privateSwitch);
  otherOptionsUl.append(privateLi);


  var checkAttendanceLi = $('<li><span class="a-text">참여 여부 확인</span></li>');
  var checkAttendanceSwitch = $('<label class="switch">'
    +'<input type="checkbox" id="checkAttendance"/>'
    +'<span class="slider round"></span>'
  +'</label>');
  checkAttendanceSwitch.on('click', function() {
    if($(this).find('#checkAttendance').is(':checked')) {
      checkAttendance = 'Y';
    } else {
      checkAttendance = 'N';
    } 
  });
  checkAttendanceLi.append(checkAttendanceSwitch);
  otherOptionsUl.append(checkAttendanceLi);
  otherOptions.append(otherOptionsUl);
  otherOptionsBox.append(otherOptions);
  addScheduleForm.append(otherOptionsBox);

  /* ###[ etc ]### */
  var detailSubmitLink = $('<p class="detail-submit"><a href="http://gportal.lgchem.com/lightpack/planner/calendar/init.do#">반복일정 등의 상세 일정 등록은 여기를 클릭해 주세요.</a></p>');
  addScheduleForm.append(detailSubmitLink);

  var addScheduleSubmit = $('<button type="button" class="btn btn-plugin btn-apply btn-disabled" id="btn-schedule">저장</button>');
  addScheduleForm.append(addScheduleSubmit);
  addScheduleSubmit.on('click', function() {
    if(scheduleSaveLoading) return;
    scheduleSaveLoading = true;
    $(this).addClass('btn-loading');
    var attends = '';
    var idInputs = $(this).parents(".form-schedule").find('.person-userId');
    for(var k=0; k < idInputs.length; k++) {
      if(k == idInputs.length-1) {
        attends += $(idInputs[k]).val()
      } else {
        attends += $(idInputs[k]).val() + ','
      }
    };

    var attnedsName = '';
    var nameInputs = $(this).parents(".form-schedule").find('.person-name');
    for(var k=0; k < nameInputs.length; k++) {
      if(k == nameInputs.length-1) {
        attnedsName += $(nameInputs[k]).val()
      } else {
        attnedsName += $(nameInputs[k]).val() + ','
      }
    };

    var webxIds = '';
    var emailInputs = $(this).parents(".form-schedule").find('.person-email');
    for(var k=0; k < emailInputs.length; k++) {
      if(k == emailInputs.length-1) {
        webxIds += $(emailInputs[k]).val()
      } else {
        webxIds += $(emailInputs[k]).val() + ','
      }
    };

    var schedule = {
      title : scheduleTitle,
      allDayCheck : allDayCheck,
      startDate : $('#start-date').val(),
      startTime : $('#start-time').val(),
      endDate: $('#end-date').val(),
      endTime: $('#end-time').val(),
      attend: attends,
      location: $('.facility-name').val(),
      placeName: placeValue,
      videoMeeting: videoMeeting,
      privateSchedule : privateSchedule,
      checkAttendance : checkAttendance,
      attnedsName: attnedsName
    }
  
    var startDate = $('#start-date').val().split('.').join('');
    if($('#start-time').val()) {
      startDate += $('#start-time').val().split(':').join('')
    }
    var endDate = $('#end-date').val().split('.').join('');
    if($('#end-time').val()) {
      endDate +=  $('#end-time').val().split(':').join('');
    }

    var requestParam = {
      query: {
        "event": scheduleRegEvent
      },
      payload: {
        userId:userId,
        title : scheduleTitle,
        wholeDay : allDayCheck,
        startDate :startDate,
        endDate:endDate,
        place: $('.place-name').val(),
        meetingRoomId: $('.facility-id').val(),
        videoMeeting: videoMeeting,
        publicYn : privateSchedule,
        webexYn : data.webexYn,
        shareList: attends,
        webexShareList: webxIds,
        isAttendance: checkAttendance
      }
    };

    
  
    if($('#btn-schedule').hasClass('btn-disabled')) {
      return;
    } else {
      sendChatApi(requestParam, userId, function(payload) {

        scheduleSaveLoading = false;
        $('#btn-schedule').removeClass('btn-loading');

        var savedInfo = '';
        
        if(payload && payload.queryResult && payload.queryResult.messages.length > 1 && payload.queryResult.messages[1].response) {
          var saveResponse = JSON.parse(payload.queryResult.messages[1].response);

          if(saveResponse["successYn"] == 'N') {
            showSmallDialog(payload.queryResult.messages[0].message);
            return;
          }
          else{
            if(savedResponse.template && savedResponse.template.outputs.length > 0 && savedResponse.template.outputs[0] && savedResponse.template.outputs[0].data && savedResponse.template.outputs[0].data.elements) {
                savedInfo = savedResponse.template.outputs[0].data.elements;
              }  
          }
        }

        addSchedulePopupClose();
        // var savedInfo = '';
        // if(payload && payload.queryResult && payload.queryResult.messages.length > 1 && payload.queryResult.messages[1].response) {
        //   var savedResponse = JSON.parse(payload.queryResult.messages[1].response);
        //   console.log(savedResponse);
        //   if(savedResponse.template && savedResponse.template.outputs.length > 0 && savedResponse.template.outputs[0] && savedResponse.template.outputs[0].data && savedResponse.template.outputs[0].data.elements) {
        //     savedInfo = savedResponse.template.outputs[0].data.elements;
        //   } 
        // }

        var isMobile = Mobile();
        var scheduleResult = '<div class="message schedule-wrap">'
        +'<div class="s-header"><span class="s-date">'+ iconCalendar +'<h1><b>새로운 일정</b>이 등록되었어요</h1></span></div>'
        +'<ul class="schedule-list s-list">'
        +'<li class="added-schedule">'
        +'<div class="detail-box">'
          +'<div class="time">'
            +'<h3>'+ (schedule.allDayCheck == 'Y' ? "종일" : schedule.startTime) + '</h3>'
            +'<h5>'+ (schedule.allDayCheck == 'Y' ? "" : schedule.endTime) + '</h5>'
          +'</div>'
          +'<div class="s-detail">'
            + '<h2>' + (schedule.privateSchedule == 'Y' ? iconPrivate : '') + (schedule.videoMeeting == 'Y' ? iconVideoMeeting : '') + schedule.title +'</h2>'
            
            // [퍼블 수정 및 추가] - 내용 변경으로 인한 삭제
            // + '<p>' + iconCalendar + schedule.startDate +' - ' + schedule.endDate + '</p>'
            // + (schedule.location ? '<p>' + iconPlaceSmall + schedule.location + '</p>' : '')
            // + (schedule.placeName ? '<p>' + iconPlaceSmall + schedule.placeName + '</p>' : '')
            // + (schedule.attnedsName ? '<p>' + iconPeople + schedule.attnedsName + '<p>' : '')
            
            // [퍼블 수정 및 추가] - 내용 변경으로 인한 추가
            + '<p class="date-box">' + iconCalendar + schedule.startDate +' - ' + schedule.endDate + '</p>'
            + (schedule.location ? '<p class="place-box">' + iconPlaceSmall + schedule.location + '</p>' : '')
            + (schedule.placeName ? '<p class="place-box">' + iconPlaceSmall + schedule.placeName + '</p>' : '')
            + (schedule.attnedsName ? '<p class="people-box">' + iconPeople + '<strong class="people-list">' + schedule.attnedsName + '</strong></p>' : '')
                            
          + '</div>'
        +'</div>'
          + (savedInfo.meetingNo ? '<div class="webx-info">'
          + '<p><span class="webx-label">미팅번호</span><span class="webx-desc">'+ savedInfo.meetingNo +'</span></p>'
          + '<p><span class="webx-label">비밀번호</span><span class="webx-desc">'+ savedInfo.meetingPw +'</span></p>'
          + '<p><span class="webx-label">호스트키</span><span class="webx-desc">'+ savedInfo.meetingHost +'</span></p>'
          + (!isMobile ? '<a class="btn-default" href="'+ savedInfo.meetingUrl +'" target="_blank"><span class="btns-desc">웹엑스 바로가기</span>'+ iconNewWindow +'</a>':'')
          + '</div>' : '')
        +'</li>'
        +'</ul">'
        +'</div>'
        
        appendChatbotText(scheduleResult);

        // [퍼블 수정 및 추가] - 사원 split
        function peopleSplit() {
          let peopleItemData;
          let peopleList = schedule.attnedsName;
              console.log(peopleList);
          peopleList = peopleList.split(",");
              console.log(peopleList);
          $('strong.people-list').empty();
          for (let i = 0; i < peopleList.length; i++ ) {
              peopleItemData = $('<span>' + peopleList[i] + '</span>');
              console.log(peopleItemData);
              $('strong.people-list').append(peopleItemData);
          }
          let peoplesNum;
          let peoplesCount;
          $('.people-list > span').each(function(index, item) {
              peoplesNum = index - 1;
              if (index > 1) {
                  if ($(this).parents('.people-list').find('b').length) {
                      $(this).parents('.people-list').find('b span').text(peoplesNum)
                  } else {
                      peoplesCount = $('<b>외 <span>' + peoplesNum + '</span>명</b>');
                      $('.people-list').append(peoplesCount);
                  };
                  $(this).remove();
              };
          });
        }; peopleSplit()

        // [퍼블 수정 및 추가] - 같은날짜 제거
        function dateCompare() {
            if (schedule.startDate == schedule.endDate) {
                $('.date-box').empty();
                $('.date-box').append(iconCalendar + schedule.startDate);
            };
        }; dateCompare();


      });
    }
  });

  addScheduleContents.append(addScheduleForm);
  addScheduleBox.append(addScheduleContents);

  $('.test-panel').append(pulginDim);
  $('.test-panel').append(addScheduleBox);

  $('.plugin-dim').css('display', 'block');
  $('#addSchedule').css('display', 'block');

  setTimeout(function() {
    $('.plugin-dim').addClass('show');
    $('#addSchedule').addClass('show');
  }, 100);

  var datepicker = $('<div class="datepicker-chem"></div>');
  $('.schedule-input-wrap').append(datepicker);        
}



$(document).on('click', function(e) {
  var container = $('.time-selector');

    // if the target of the click isn't the container nor a descendant of the container
    if (!container.is(e.target) && container.has(e.target).length === 0) 
    {
        container.find('.time-options').removeClass('show');
    }  
})


function attendChangeClose() {
  $('#attendChange').removeClass('show');
  $('.plugin-dim').removeClass('show');
  setTimeout(function() {
    $('.plugin-dim').remove();
    $('#attendChange').remove();
  }, 300);
}


function attendChangeOpen(target, attendText, scheduleId, sessionId, userId) {
  var attendStatus = '';
  var notAttendReason = '';
  
  var pulginDim = $('<div class="plugin-dim show"></div>');
  var attendChange = $('<div class="plugins plugin-select" id="attendChange"></div>');
  var attendChangeHeader = $(
    '<div class="plugin-header">'
        +'<h1>참석여부 설정</h1>' // [퍼블 수정 및 추가] - 텍스트 수정
        +'<span class="close-plugin" onclick="attendChangeClose()">'
            +'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
                +'<path d="M5.74478 4.75483C5.47141 4.48146 5.0282 4.48146 4.75483 4.75483C4.48146 5.0282 4.48146 5.47141 4.75483 5.74478L13.01 13.9999L4.75506 22.2548C4.48169 22.5282 4.48169 22.9714 4.75506 23.2448C5.02843 23.5181 5.47164 23.5181 5.74501 23.2448L13.9999 14.9899L22.2548 23.2448C22.5282 23.5181 22.9714 23.5181 23.2448 23.2448C23.5181 22.9714 23.5181 22.5282 23.2448 22.2548L14.9899 13.9999L23.245 5.74478C23.5184 5.47141 23.5184 5.0282 23.245 4.75483C22.9716 4.48146 22.5284 4.48146 22.2551 4.75483L13.9999 13.01L5.74478 4.75483Z" fill="#2C2C2C"/>'
            +'</svg>'
        +'</span>'
    +'</div>'
  );
  attendChange.append(attendChangeHeader);
  var attendChangeBody = $('<div class="plugin-contents"><p>일정 참석여부를 설정해 주세요.<b>*</b></p></div>'); // [퍼블 수정 및 추가] - 텍스트 수정
  var selectList = $('<ul class="select-list"></ul>');

  var selectLiFirst = $('<li></li>');
  var selectFirstSwitch = $(
    '<label class="input-radio">'
        +'미정'
        +'<input type="radio" name="attend-select" id="attend-undi" value="0"/>'
        +'<span class="radiomark"></span>'
    +'</label>'
  );
  selectFirstSwitch.on('click', function() {
    if($(this).find('#attend-undi').prop('checked')) {
      attendStatus = 0;  
    }
  });
  selectLiFirst.append(selectFirstSwitch);
  selectList.append(selectLiFirst);

  var selectLiSecond = $('<li></li>');
  var selectSecondSwitch = $(
      '<label class="input-radio">'
          +'참석'
          +'<input type="radio" name="attend-select" id="attend" value="1"/>'
          +'<span class="radiomark"></span>'
      +'</label>'
  );
  selectSecondSwitch.on('click', function() {
    if($(this).find('#attend').prop('checked')) {
      attendStatus = 1;  
    }
  });
  selectLiSecond.append(selectSecondSwitch);
  selectList.append(selectLiSecond);

  var selectLiThird = $('<li></li>');
  var selectThirdSwitch = $(
    '<label class="input-radio">'
        +'불참'
        +'<input type="radio" name="attend-select" id="not-attend" value="2" />'
        +'<span class="radiomark"></span>'
    +'</label>'
  );
  var notAttendReasonBox = $('<div class="input-box not-attend hide"></div>');
  var notAttendReasonInput = $('<input type="text" placeholder="불참 사유를 입력해 주세요.(선택 사항)" />'); // [퍼블 수정 및 추가] - 텍스트 수정
  
  notAttendReasonInput.on('keyup',function() {
    notAttendReason = $(this).val();
  });
  notAttendReasonBox.append(notAttendReasonInput);

  selectLiThird.append(selectThirdSwitch);
  selectLiThird.append(notAttendReasonBox);

    // [퍼블 수정 및 추가] - 불참 radio 스크립트 재작업으로 인한 삭제
    // selectThirdSwitch.on('click', function() {
    //   if($(this).find('#not-attend').prop('checked')) {
    //     attendStatus = 2;  
    //     $('.not-attend').removeClass('hide');
    //   } else {
    //     $('.not-attend').removeClass('hide');
    //   }
    // });

  
  selectList.append(selectLiThird);
  attendChangeBody.append(selectList);


  // [퍼블 수정 및 추가] - 불참 radio 스크립트 재작업으로 인한 추가
  selectList.find('.input-radio').on('click', function() {
    if ($(this).find('#not-attend').is(':checked')) {
      attendStatus = 2;  
      $('.not-attend').removeClass('hide');
    } else {
      $('.not-attend').addClass('hide');
    }
  });
  

  var attendChangeButton = $('<button type="button" class="btn btn-plugin btn-apply" id="btn-attend">저장</button>');
  if(attendText == '미정') {
    attendStatus = 0;
    $('#attend-undi').prop('checked', true);
  } else if(attendText == '참석') {
    attendStatus = 1;
    $('#attend').prop('checked', true);
  } else if(attendText == '불참') {
    attendStatus = 2;
    $('#not-attend').prop('checked', true);
  } else {
    attendStatus = 0;
    $('#attend-undi').prop('checked', true);
  };
  attendChangeButton.on('click', function() {
    var selectedText = '';
    if(attendStatus == 0) {
      selectedText = '미정';
    } else if(attendStatus == 1) {
      selectedText = '참석';
    } else if(attendStatus == 2) {
      selectedText = '불참';
    }
    $(target).find('.attend-text').text(selectedText);
    if (attendStatus == 2 && notAttendReason.length > 0) {
      var requestParam = {
          query: {
          "event": "scheduleAttendEvent"
        },
        payload: {
          "scheduleId": scheduleId,
          "isAccept": attendStatus,
          "reason" : notAttendReason,
          "userId" : userId
        }
      };
      sendChatApi(requestParam, sessionId, function(payload){
        console.log("schedule Attend :: " + JSON.stringify(payload));
        attendChangeClose();
      });
    } else {      
      var requestParam = {
          query: {
          "event": "scheduleAttendEvent"
        },
        payload: {
          "scheduleId": scheduleId,
          "isAccept": attendStatus,
          "userId" : userId
        }
      };
      sendChatApi(requestParam, sessionId, function(payload){
        console.log(payload);
        attendChangeClose();
      });
    }
    
    // [퍼블 수정 및 추가] - dialog 추가
    setTimeout(function() {
      showSmallDialog("참석여부가 " + "'" + selectedText + "'" + "으로 변경되었습니다.");
    }, 500);
    
  });
  attendChangeBody.append(attendChangeButton);
  attendChange.append(attendChangeBody);
    
  $('.test-panel').append(pulginDim);
  $('.test-panel').append(attendChange);

  $('.plugin-dim').css('display', 'block');
  $('#attendChange').css('display', 'block');

  setTimeout(function() {
    $('.plugin-dim').addClass('show');
    $('#attendChange').addClass('show');
  }, 100);
}


/////////////////////////////////////////// Messae 생성 함수 ///////////////////////////////////////////


/**
 * '문자열 카드 생성' 함수
 * @param {string} text 텍스트형 응답 데이터
 */
 function makeText(text, isHistory) {
	var textCon = $('<div class="message simple-text"></div>');
  var textP = $('<p></p>');
  textP.html(text);
	textCon.append(textP);
	return textCon;
}

/**
 * '리스트 아이템 항목 생성' 함수
 * @param {object} item 형 응답 데이터
 */
 function makeListItem(listUl, item){
	var listLi = $('<li class="list-box"></li>');
	
	listUl.append(listLi);
	
	var title = $('<h1">' + item.title + '</h1>');
	listLi.append(title);
	
	if (item.hasOwnProperty('description')) {
		var desc = $('<p class="desc">' + item.description + '</p]>');
		listLi.append(desc);
	}
	
	if (item.hasOwnProperty('button')) {
		listLi.click(function() {
      if (item.button.type == 'url') {
        window.open(item.button.link, '_blank');
      } else if (item.button.type == 'phases') {
        chatui.sendMessage(item.button.message);
      }
    });
	}
	listLi.append(arrow);
}


/**
 * '리스트 카드 생성' 함수
 * @param {list} items 리스트형 응답 데이터
 */
 function makeListCard(items, titleBoldYn, type){
	var listCon = $('<div class="message text-list"></div>');
	
	var listUl = $('<ul></ul>');
	listCon.append(listUl);
	
	var moreItemList = [];
	if (items instanceof Array && items.length > 0) {
		items.forEach(function(item,index) {
			if(index < 4){
				makeListItem(listUl, item);
			} else {
				moreItemList.push(item);
			}
		});
		
		if(items.length > 4 ){
			var listLi = $('<li class="see-more"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
      + '</svg>더보기</li>');
			listUl.append(listLi);
			
			listLi.click(function() {
				listLi.remove();
				moreItemList.forEach(function(item,index) {
					makeListItem(listUl, item);
				});
        descendScroll();
      });			
    }
  }

	return listCon;
}

/**
 * '리스트 카드(용어검색) 생성' 함수
 * @param {list} items 리스트형 응답 데이터
 */
 function makeListDictCard(data, isHistory){
	var listCon = $('<div class="message"></div>');
	
	
	var listWrap = $('<div class="text-list dict-list"></div>');
	listWrap.attr("data-sessionId", data.chatSessionId.split("sessions/")[1]);
	listCon.append(listWrap);

  var listHeader = $('<div class="list-header-title">' + listHeaderIcon + '<b>' + data.searchTerm + '</b> 용어 검색 결과</div>')
  listWrap.append(listHeader);
	
	var listUl = $('<ul></ul>');
	listWrap.append(listUl);

  var searchTerm = data.searchTerm;
	
	var moreItemList = [];
	if (data.items instanceof Array && data.items.length > 0) {
		data.items.forEach(function(item,index) {
			if( index < 4 ){
				makeListDictItem(listUl, item, searchTerm);
			} else {
				moreItemList.push(item);
			}
		});

		if(data.items.length > 4 ){
			var seeMore = $('<div class="see-more"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
      + '</svg>더보기</div>');
			listWrap.append(seeMore);
			
			seeMore.on('click', function() {
				moreItemList.forEach(function(item,index) {
					makeListDictItem(listUl, item, searchTerm);
				});
        $(this).remove();
				descendScroll();
      });			
		}
  } else {
    var noResult = $('<li class="list-box no-result">검색결과가 없습니다.</li>');
    listUl.append(noResult);
  }

	return listCon;
}

/**
 * '리스트(용어검색) 아이템 항목 생성' 함수
 * @param {object} item 형 응답 데이터
 */
function makeListDictItem(listUl, item, searchTerm){
	var listLi = $('<li class="list-box" onClick="dictDeatilOpen(this,\''+item.termId+'\')"></li>');
	listUl.append(listLi);


  var dictNm = item.dictNm.replace(searchTerm, '<b>'+searchTerm+'</b>');
	
	var title = $('<h1>' + dictNm + '</h1>');
	listLi.append(title);
	
	if (item.hasOwnProperty('dictDesc')) {
		var desc = $('<p class="desc">' + item.dictDesc + '</p>');
		listLi.append(desc);
	}

	listLi.append(arrow);
}

// RPA 프로세스 조회 (리스트)
function makeRpaProcessList(data, isHistory) {
    var listCon = $('<div class="message bubble-list"></div>');
    var listWrap = $('<div class="dp-list-wrap"></div>');
    listWrap.attr("data-userId", data.loginUserId);
    listWrap.attr("data-sessionId", data.chatSessionId.split("sessions/")[1]);
    listCon.append(listWrap);

   var listUl = $('<ul></ul>');
    listWrap.append(listUl);

    var moreItemList = [];
    if (data.items instanceof Array && data.items.length > 0) {
        data.items.forEach(function(item,index) {
            if( index < 5 ){
                makeListRpaItem(listUl, item);
            } else {
                moreItemList.push(item);
            }
        });

        if(data.items.length > 5 ){
            var listLi = $('<li class="see-more"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
            +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
            + '</svg>더보기</li>');
            listUl.append(listLi);

            listLi.click(function() {
                listLi.remove();
                moreItemList.forEach(function(item,index) {
                    makeListRpaItem(listUl, item);
                });
                descendScroll();
            });
        }
    }
    return listCon;
}

// RPA 리스트 아이템 생성 함수
function makeListRpaItem(listUl, item) {

    var data_param = item.param;
    data_param = data_param.replace(/, /gi, "|");

    var listLi = $('<li data-param='+data_param+'></li>');
    listUl.append(listLi);

    var listAtag = $('<a href="#" onClick="intentEvent(this,\'rpa\',\''+item.process_id+'\')"></a>');
    listLi.append(listAtag);

    var title = $('<span class="title font-bold">' + item.process_nm + '</span>');
    listAtag.append(title);

    var btn = $('<span class="arrow-right"><img src="' + imgBaseUrl + '/assets/arrow-right.png" alt=""></span>');
    listAtag.append(btn);
}

// RPA 프로세스 선택
function selectRpaProcess(data, isHistory) {

    var listCon = $('<div class="message bubble-list"></div>');

    var listWrap = $('<div class="dp-list-wrap"></div>');
    listWrap.attr("data-userId", data.loginUserId);
    listWrap.attr("data-param", data.data_param);

    listCon.append(listWrap);

    var listUl = $('<ul></ul>');
    listWrap.append(listUl);

    var listLi = '<li><a href="#" onClick="intentEvent(this,\'processStart\',\''+data.process_id+'\')"><span class="title font-bold">프로세스 실행</span><span class="arrow-right"><img src="' + imgBaseUrl + '/assets/arrow-right.png" alt=""></span></a></li>';
    listLi +=  '<li><a href="#" onClick="intentEvent(this,\'processHistory\',\''+data.process_id+'\')"><span class="title font-bold">프로세스 실행이력 조회</span><span class="arrow-right"><img src="' + imgBaseUrl + '/assets/arrow-right.png" alt=""></span></a></li>';
    listUl.append(listLi);

    return listCon;
}

// 관리자 rpa kill 목록
function makeRpaProcessKillList(data, isHistory) {
    var listCon = $('<div class="message bubble-list"></div>');

    var listWrap = $('<div class="dp-list-wrap"></div>');
    listWrap.attr("data-userId", data.loginUserId);

    listCon.append(listWrap);

    var listUl = $('<ul></ul>');
    listWrap.append(listUl);

    var moreItemList = [];
    if (data.items instanceof Array && data.items.length > 0) {
        data.items.forEach(function(item,index) {
            if( index < 5 ){
                makeKillListRpaItem(listUl, item);
            } else {
                moreItemList.push(item);
            }
        });

        if(data.items.length > 5 ){
            var listLi = $('<li class="see-more"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
            +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
            + '</svg>더보기</li>');
            listUl.append(listLi);

            listLi.click(function() {
                listLi.remove();
            moreItemList.forEach(function(item,index) {
                    makeKillListRpaItem(listUl, item);
                });
                descendScroll();
            });
        }
    }

    return listCon;
}

// 관리자 rpa kill 아이템 생성
function makeKillListRpaItem(listUl, item) {
    var listLi = $('<li></li>');
    listUl.append(listLi);

    var listAtag = $('<a href="#" onClick="intentEvent(this,\'rpaKill\',\''+item.process_id+'\')"></a>');
    listLi.append(listAtag);

    var title = $('<span class="title font-bold">' + item.process_nm + '</span>');
    listAtag.append(title);

    var btn = $('<span class="arrow-right"><img src="' + imgBaseUrl + '/assets/arrow-right.png" alt=""></span>');
    listAtag.append(btn);
}

// RPA 관련 외부 팝업
function makeRpaPopup(data) {

    window.open(data.popupUrl, data.systemName, 'resizable=yes, scrollbars=yes');
    var message = $('<div class="message caas-chat-response-message-back-color caas-chat-response-message-font-color"></div>');
    var messageBasic = $('<div class="basic"></div>');
    message.append(messageBasic);

    var contents = $('<div class="message-content" style="white-space: pre-line">'+data.message+'</div>');
    messageBasic.append(contents)

    return message;

}

//시스템담당자 Card 생성 함수
function makeSystemCardFirst(items) {
    systemItems = items;
    
    var systemContetns = $('<div class="system-contents" style="width:300px;"></div>'); // [퍼블 수정 및 추가] - width 값 수정 ( 400 -> 300 )
    var msgCon = $('<div class="message simple-text"></div>');
    var text = '';
    if (items instanceof Array && items.length > 0) {
        text = $('<p>아래에서 상세 분야를 선택해 주세요.</p>'); // [퍼블 수정 및 추가] - 텍스트 수정
        //   text = $('<p>아래에서 상세 분야 담당자를 선택해주시면 안내해 드릴게요.</p>');
    } else {
        // [퍼블 수정 및 추가] - 내용 수정
        text  = $(
            '<p>'
                +'<b>' + item.sysName + '</b>에 대한 검색 결과가 없습니다.<br>'
                + '검색어가 정확한지 다시 한 번 확인해 주세요.'
            +'</p>'
        );
        // text  = $('<p>담당자에 대한 검색 결과가 없습니다. 검색어가 정확한지 다시 한 번 확인해 주세요.</p>');
    }
    msgCon.append(text);
    systemContetns.append(msgCon);

    if (items instanceof Array && items.length > 0) {
        let sysListCount = 0; 
        //var custCon = $('<div class="custom-message"></div>');    
    	var listCon = $('<div class="message profile-list system" style="margin-left:0px;"></div>');
    	
    	//custCon.append(listCon);
    	var listWrap = $('<div class="p-box"></div>');
    	listCon.append(listWrap);
    
        var title = $('<div class="list-header-title">' + listHeaderIcon +'<b>'+items[0].operName+'</b> 관련 시스템</div>'); 
        listWrap.append(title);
    	
    	var listUl = $('<ul class="profile-list-wrap"></ul>'); // [퍼블 수정 및 추가] - 클래스(profile-list-wrap) 추가
    	listWrap.append(listUl);
        
        items.map(item => {
            sysListCount++;
            var listLi = $('<li class="list-box list-system" data-system="' + item.sysName + '"></li>');
            listUl.append(listLi);
          
            var sysInfo = $('<div class="text-box"></div>');
            listLi.append(sysInfo);
    
            sysInfo.append(
                '<div class="name">'
                    +'<h1 class="system">'
                        + item.sysName 
                    +'</h1>'
                +'</div">'
            );
            
            var sysInfoList = $('<ul class="profile-info system"></ul>');
            
            // [퍼블 수정 및 추가] - 아이콘 수정
            // sysInfoList.append($('<li><span class="profile-icon icon-mail">' + iconMail + '</span>' + (item.deptName ? item.deptName : '-' )+ '</li>'));
            // sysInfoList.append($('<li><span class="profile-icon icon-phone">' + iconPhone + '</span>' + (item.empName ? item.empName : '-') + '</li>'));
            sysInfoList.append($('<li><span class="profile-icon icon-mail">' + iconTeam + '</span>' + (item.deptName ? item.deptName : '-' )+ '</li>'));
            sysInfoList.append($('<li><span class="profile-icon icon-phone">' + iconMember + '</span>' + (item.empName ? item.empName : '-') + '</li>'));
          
            sysInfo.append(sysInfoList);
            
            if (sysListCount > 3){
                listLi.addClass('hide');
            }
            
            
            arrowHtml =	'<span class="arrow">'
            +'<svg width="7" height="14" viewBox="0 0 7 14" fill="none" xmlns="http://www.w3.org/2000/svg">'
              +'<path fill-rule="evenodd" clip-rule="evenodd" d="M5.3817 6.60128C5.58377 6.82861 5.58377 7.17119 5.3817 7.39852L0.63891 12.7342C0.492143 12.8993 0.507015 13.1521 0.672128 13.2989C0.837241 13.4456 1.09007 13.4308 1.23684 13.2656L5.97963 7.93001C6.45113 7.39957 6.45113 6.60023 5.97962 6.06979L1.23684 0.734153C1.09007 0.56904 0.837241 0.554168 0.672128 0.700936C0.507015 0.847703 0.492143 1.10053 0.63891 1.26565L5.3817 6.60128Z" fill="#A5A5A5"/>'
            +'</svg>'
          +'</span>';    
          
          listLi.append(arrowHtml);
            
        });
        
        if (sysListCount > 3){
            var seeMoreBtn = $(
                '<div class="see-more">'
                    +'<svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
                        +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
                    +'</svg>'
                    +'더보기'
                +'</div>'
            );
            seeMoreBtn.click(function() {
                $(this).parents('.profile-list').find(".list-box").removeClass('hide');
                $(this).remove();
            });
            listWrap.append(seeMoreBtn);
        }
        
        
        systemContetns.append(listCon);
    }
    
    /*if (items instanceof Array && items.length > 0) {
        var quickReplies = $('<div class="custom-quick-reply"></div>');
        items.map(item => {
            var systemBtn = $('<span class="btn-custom-reply btn-system" data-system="' + item.sysName + '">' + item.sysName +'</span>');
            quickReplies.append(systemBtn);
        });
        systemContetns.append(quickReplies);
    }*/
    return systemContetns;
}
/**
 * '시스템 업무 담당자 리스트 카드 생성' 함수
 * @param {list} items 리스트형 응답 데이터
 */
 function makeSystemCard(item, isHistory){
	var listCon = $('<div class="message profile-list system"></div>');
	var listWrap = $('<div class="p-box"></div>');
	listCon.append(listWrap);

    var title = $('<div class="list-header-title">' + listHeaderIcon +'<b>' + item.sysName + '</b> 담당자</div>'); // [퍼블 수정 및 추가] - 내용 수정
    // var title = $('<div class="list-header-title">' + listHeaderIcon +'<span>' + item.sysName + '</span></div>');
    listWrap.append(title);
	
    // var listUl = $('<ul></ul>');
	var listUl = $('<ul class="profile-list-wrap"></ul>'); // [퍼블 수정 및 추가] - 클래스(profile-list-wrap) 추가
	listWrap.append(listUl);

    if (item.userList instanceof Array && item.userList.length > 0) {
        let userListCount = 0; // [퍼블 수정 및 추가] - 더보기 관련 코드 추가
        
        item.userList.forEach(function(user,index) {
            userListCount++; // [퍼블 수정 및 추가] - 더보기 관련 코드 추가
            
            var listLi = $('<li class="list-box"></li>');
            listUl.append(listLi);
          
            var userId = user.empMail.split("@");
            var userInfo = $('<div class="text-box"></div>');
            listLi.append(userInfo);
    
            var contactTag = ''
            if(user.contactType == 'I') {
                contactTag = 'IT';
            }
            else if(user.contactType == 'U') {
                contactTag = '현업';
            }
            else if(user.contactType == 'S') {
                contactTag = 'SM';
            }

            var empName = user.userName; 
            var damdangNames = empName.split('외');
            var damdangName = (damdangNames.length > 0)? damdangNames[0]:'-';
            //console.log('damdangName: '+damdangName);
            
            userInfo.append(
                '<div class="name">'
                    +'<h1 class="system">'
                        + damdangName + ' ' //+ user.jobTitle
                        +'<span class="tag">' + contactTag + '</span>'
                    +'</h1>'
                +'</div">'
            );
    
            var userInfoList = $('<ul class="profile-info system"></ul>');
            userInfoList.append($('<li><span class="profile-icon icon-mail">' + iconMail + '</span>' + (user.empMail ? user.empMail : '-' )+ '</li>'));
            userInfoList.append($('<li><span class="profile-icon icon-phone">' + iconPhone + '</span>' + (user.empTelNo ? user.empTelNo : '-') + '</li>'));
          
            userInfo.append(userInfoList);
            
            // [퍼블 수정 및 추가] - 더보기 관련 코드 추가
            if (userListCount > 3){
                listLi.addClass('hide');
            }
            
        });
        
        // [퍼블 수정 및 추가] - 더보기 관련 코드 추가
        if (userListCount > 3){
            var seeMoreBtn = $(
                '<div class="see-more">'
                    +'<svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
                        +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
                    +'</svg>'
                    +'더보기'
                +'</div>'
            );
            seeMoreBtn.click(function() {
                $(this).parents('.profile-list').find(".list-box").removeClass('hide');
                $(this).remove();
            });
            listWrap.append(seeMoreBtn);
        }
    }
	return listCon;
}
/**
 * '스케줄 셋팅' 함수
 */
 function makeScheduleItem(scheduleCard, scheduleList, checkBtnShow, schedueDate){
  var $listWrap = scheduleList.closest(".schedule-wrap").find(".schedule-list-wrap");
  
  console.log('scheduleCard : ', scheduleCard);
  var today = new Date();
  var cDate = new Date(scheduleCard.date);
  today = new Date(today.getFullYear(), today.getMonth()+1, today.getDate());
  cDate = new Date(cDate.getFullYear(), cDate.getMonth()+1, cDate.getDate());
  
  var dataDisabled;

//console.log(today+' @ '+cDate);
  if (cDate < today) {
      dataDisabled = ' data-disabled="disabled"';
  } else {
      dataDisabled = "";
  }
  
if (scheduleCard.items instanceof Array && scheduleCard.items.length > 0) {
  var isMobile = Mobile();
  scheduleCard.items.forEach(function(item,index) {
      if (scheduleCard.loginUserId==scheduleCard.userId && scheduleCard.isMobile!='Y' && !isMobile) {
        var scheduleItem = $( item.wholeDay == '1' ? '<li class="schedule-item schedule-wholeTime" onclick="scheduleDetail(this)"></li>' : '<li class="schedule-item schedule-notwholeTime" onclick="scheduleDetail(this)"></li>' );
    } else {
        var scheduleItem = $( item.wholeDay == '1' ? '<li class="schedule-item schedule-wholeTime mobile schedule-not-me"></li>' : '<li class="schedule-item schedule-notwholeTime mobile schedule-not-me"></li>' );
    }
    scheduleItem.attr("data-scheduleId", item.scheduleId);
    scheduleItem.attr("data-repeatYn", item.repeatYn);
    scheduleList.append(scheduleItem);
      var now = false;
    if(scheduleCard.date) {
      var nowTime = moment().format('YYYY-MM-DDHH:mm');
      var scheduleStart = scheduleCard.date + item.stTime;
      var scheduleEndTime = scheduleCard.date + item.edTime;
      if(scheduleStart <  nowTime && scheduleEndTime > nowTime) {
        now = true;
      }
    }
    
    var scheduleTime = $('<div class="time"></div>');
    if(now) {
      scheduleTime.append( item.wholeDay == '1' ? '<h3>종일</h3>' : '<h3 class="now">' + item.stTime + '</h3><h5>' + item.edTime + '</h5>');
    } else {
      scheduleTime.append( item.wholeDay == '1' ? '<h3>종일</h3>' : '<h3>' + item.stTime + '</h3><h5>' + item.edTime + '</h5>');
    }
    scheduleItem.append(scheduleTime);
    
    var scheduleDetail = $('<div class="s-detail"></div>');
    var scheduleTitle = $('<h2 class="schedule-todo"></h2>');

    if(now) {
      var nowTag = $('<span class="tag primary">진행중</span>');
      scheduleTitle.append(nowTag);
    }
    
    var privateTag = "N";                // 비공개 타인 일정.
    if(item.publicYn != 'Y' )  {
      if(scheduleCard.mySelfYn == 'Y') {
        var private = iconLock;
        scheduleTitle.append(private);
      } else {
        privateTag = 'Y';
        var private = iconLock + '<span>비공개 </span>';
        scheduleTitle.append(private);
      }
    }

    if(item.interfaceType == 'C' || item.title.indexOf("[화상회의_케미등록]")>-1) {
      if(scheduleCard.mySelfYn == 'Y') {
        var videoMeeting = iconVideoMeeting;
        scheduleTitle.append(videoMeeting);
      }
      if(scheduleCard.mySelfYn == 'N' && item.publicYn == 'Y') {
        var videoMeeting = iconVideoMeeting;
        scheduleTitle.append(videoMeeting);
      }
    };

    var title = $('<span>' +item.title+'</span>');
    
    if(privateTag == 'N')     scheduleTitle.append(title);

    scheduleDetail.append(scheduleTitle);
    
    
    if(item.facility) {
      var schedulePlace = $('<p>' + iconMarker + '<span>' + item.facilityFullName + ' ' + item.facility + '</span></p>');
      if(privateTag == 'N') scheduleDetail.append(schedulePlace);
    }
    if(item.place) {
      var schedulePlace = $('<p>' + iconMarker + '<span>' + item.place + '</span></p>');
      if(privateTag == 'N') scheduleDetail.append(schedulePlace);
    }


    // [퍼블 수정 및 추가] - 주석처리 해제
    if(item.members) {
      var scheduleMembers = $('<p>' + iconMember + '<span>' + item.members + '</span></p>');
      scheduleDetail.append(scheduleMembers);
    }
    scheduleItem.append(scheduleDetail);
    
    
    // registFg ( 1:내가 등록한 일정일 경우, 2:참여자로 등록된 경우이지만 참여여부 미정일 경우, 3:참여일정인 경우, 4:불참일정인 경우 )
    // registFg가 Empty인 경우 '참여요청' 없이 일정을 등록했기 때문에 렌더링 X
    // regEnv == 'chatbot' 인 경우에만 삭제버튼 렌더링
    //if(item.registFg == '1' && item.regEnv == 'chatbot'){
    if(item.registFg == '1') {
              
        // 본인이 등록한  일정일 경우 무조건 일정 삭제 이벤트 (scheduleDeleteEvent)
        var deleteBtn = $('<button type="button" class="s-delete" onclick="event.cancelBubble=true;">' + iconDelete + '</button>');
        deleteBtn.on('click', function(){  
            if( item.repeatYn == "Y" ){
                pop.open('create', $(this), 'Pop_Alert', 'loadEl.pop_alert("반복일정은 케미에서 삭제하실 수 없습니다.")');
            } else {
                
                var popMsg = "일정";
                if(item.facilityId) {
                    popMsg = "일정 및 회의실";
                }
                pop.open(
                    'create',
                    $(this),
                    'Pop_Delete_Schedule',
                    'loadEl.pop_del_confirm("'+popMsg+' 삭제", "삭제된 '+popMsg+'은 복구할 수 없어요.<br />'+popMsg+'을 삭제할까요?")' // [퍼블 수정 및 추가] - 텍스트 수정
                );
                $("#btnDelete").click(function(){
                    // 본인이 등록한 일정에 한해서만 일정 삭제 이벤트로 설정
                    var sessionId = deleteBtn.closest(".schedule-wrap").attr("data-sessionId");
                    var userId = deleteBtn.closest(".schedule-wrap").attr("data-userId");
                    var requestParam = {
                        query: {
                            "event": scheduleDeleteEvent
                        },
                        payload: {
                            "scheduleId": item.scheduleId ,
                            "deleteTarget" : 0, // ( 일정 삭제 : 0 / 회의실 삭제 : 1)
                            "isAccept" : 0,     // ( 일정 참여 : 1/ 일정 불참 : 2 )
                            "userId" : userId
                        }
                    };
                    if (item.webexMeetingNumber) {
                        requestParam.payload["webexMeetingKey"] = item.webexMeetingNumber;
                    }
                    sendChatApi(requestParam, sessionId, function(payload){
                        console.log("schedule Delete :: ", JSON.stringify(payload));
        
                        if (payload && payload.queryResult && payload.queryResult.messages.length > 1 && payload.queryResult.messages[1].response) {
                            var deleteResponse = JSON.parse(payload.queryResult.messages[1].response);
                            if (deleteResponse["restSuccessYn"] == 'N') {
                                
                                pop.close($("#btnDelete"));
                
                                setTimeout(function() {
                                    showSmallDialog(payload.queryResult.messages[0].message); // [퍼블 수정 및 추가] - 텍스트 수정
                                }, 500);
                            }
                            else{
                                // scheduleItem.remove(); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 코드 삭제
                                scheduleItem.addClass('cancel-line'); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 추가
                                scheduleItem.find('.attend-check').attr('disabled', true); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 추가
                                scheduleItem.find('.s-delete').remove(); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 추가
                
                                pop.close($("#btnDelete"));
                
                                // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 코드 삭제
                                // if( scheduleList.closest(".schedule-wrap").find(".schedule-item").length < 1 ){
                                //     $listWrap.html('<div class="schedule-noData">등록된 일정이 없습니다.</div>');
                                // }
                
                                setTimeout(function() {
                                    showSmallDialog('일정이 삭제되었습니다.');
                                }, 500);
                            }
                        }
                    });
                }); 
            }
        });
        scheduleItem.append(deleteBtn);

    } else {

      //if(item.registFg && item.regEnv == 'chatbot') {
        if(item.registFg) {
          
         // 본인이 등록한  일정일 경우 무조건 일정 삭제 이벤트 (scheduleDeleteEvent)
        var deleteBtn = $('<button type="button" class="s-delete" onclick="event.cancelBubble=true;">' + iconDelete + '</button>');
        deleteBtn.on('click', function(){
            if( item.repeatYn == "Y" ){
                pop.open('create', $(this), 'Pop_Alert', 'loadEl.pop_alert("반복일정은 케미에서 삭제하실 수 없습니다.")');
            } else {
                pop.open(
                    'create',
                    $(this),
                    'Pop_Delete_Schedule',
                    'loadEl.pop_del_confirm("참석자로 초대된 일정 삭제", "삭제된 일정은 복구할 수 없어요.<br />참석자로 초대된 일정을 삭제할까요?")' // [퍼블 수정 및 추가] - 텍스트 수정
                );
                $("#btnDelete").click(function(){
                    // 본인이 등록한 일정에 한해서만 일정 삭제 이벤트로 설정
                    var sessionId = deleteBtn.closest(".schedule-wrap").attr("data-sessionId");
                    var userId = deleteBtn.closest(".schedule-wrap").attr("data-userId");
                    var requestParam = {
                        query: {
                            "event": scheduleDeleteEvent
                        },
                        payload: {
                            "scheduleId": item.scheduleId ,
                            "deleteTarget" : 0, // ( 일정 삭제 : 0 / 회의실 삭제 : 1)
                            "isAccept" : 3,     // ( 일정 참여 : 1/ 일정 불참 : 2 )
                            "userId" : userId
                        }
                    };
                    if(item.webexMeetingNumber) {
                        requestParam.payload["webexMeetingKey"] = item.webexMeetingNumber;
                    }
                    sendChatApi(requestParam, sessionId, function(payload){
                        console.log("schedule Delete :: ", payload);
        
        
                        if (payload && payload.queryResult && payload.queryResult.messages.length > 1 && payload.queryResult.messages[1].response) {
                            var deleteResponse = JSON.parse(payload.queryResult.messages[1].response);
                            if (deleteResponse["restSuccessYn"] == 'N') {
                                
                                pop.close($("#btnDelete"));
                
                                setTimeout(function() {
                                    showSmallDialog(payload.queryResult.messages[0].message); // [퍼블 수정 및 추가] - 텍스트 수정
                                }, 500);
                            }
                            else{
                                scheduleItem.addClass('cancel-line'); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 추가
                                scheduleItem.find('.attend-check').attr('disabled', true); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 추가
                                scheduleItem.find('.s-delete').remove(); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 추가
                
                                pop.close($("#btnDelete"));
                
                                setTimeout(function() {
                                    showSmallDialog('참석자로 초대된 일정이 삭제되었습니다.'); // [퍼블 수정 및 추가] - 텍스트 수정
                                }, 500);
                            }
                        }
                        // scheduleItem.remove(); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 코드 삭제
                    });
                }); 
            }
        });
        scheduleItem.append(deleteBtn);
    }
      
      // attendanceRequest = 1 (타인등록 일정인데 참여확인 O)
      // attendanceRequest = 0 (타인등록 일정인데 참여확인 X) 
      if(item.attendanceRequest != 0){
        var attendGroup = $('<div class="attend-check"'+ dataDisabled +'></div>');
        if (checkBtnShow == true) {
          attendGroup = $('<div class="attend-check show"'+ dataDisabled +'></div>');
        } 
        scheduleDetail.append(attendGroup);
        
        var attendText = '미정';

          if(item.registFg == '2') {
            attendText = '미정';
          }
              
          else if (item.registFg == '3') {
            attendText = '참석';
              
          } else if (item.registFg == '4') {
            attendText = '불참';    
          }

          var attendBtn = $('<button class="attend-button">'
            + '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="check"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.9121 3.18797C11.0293 3.30512 11.0293 3.49507 10.9121 3.61223L5.56814 8.95622C5.15814 9.36622 4.49342 9.36628 4.08335 8.95635L1.08791 5.96196C0.970727 5.84482 0.970694 5.65487 1.08783 5.53769C1.20497 5.42052 1.39492 5.42048 1.51209 5.53762L4.50754 8.53201C4.68328 8.70769 4.96816 8.70767 5.14388 8.53196L10.4879 3.18797C10.605 3.07081 10.795 3.07081 10.9121 3.18797Z" fill="#6B6B6B"/></svg>'
            + '<span class="attend-text">' + attendText +'</span>'
            + '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="down-arrow"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.70133 7.78633C5.87183 7.93789 6.12876 7.93789 6.29925 7.78633L10.301 4.22924C10.4248 4.11917 10.6144 4.13032 10.7245 4.25416C10.8346 4.37799 10.8234 4.56761 10.6996 4.67769L6.69787 8.23478C6.30004 8.58841 5.70054 8.58841 5.30271 8.23478L1.30098 4.67769C1.17715 4.56761 1.16599 4.37799 1.27607 4.25416C1.38614 4.13032 1.57576 4.11917 1.6996 4.22924L5.70133 7.78633Z" fill="#6B6B6B"/></svg>'
          +'</button>');

          attendBtn.on('click', function(event) {
            event.stopPropagation();

            var sessionId = $(this).closest(".schedule-wrap").attr("data-sessionId");
            var userId = $(this).closest(".schedule-wrap").attr("data-userId");
            var scheduleId = $(this).closest(".schedule-item").data("scheduleid");

            console.log('userId : '+userId+', scheduleId : '+scheduleId);
            attendChangeOpen(this, attendText, scheduleId, sessionId, userId);
          });
          
          attendGroup.append(attendBtn);
      }

      scheduleItem.append(deleteBtn);
    } 

    
    // '종일' 인 경우 스케쥴 맨 상단에 위치하도록 함
      $(this).closest(".schedule-wholeTime").prependTo(".schedule-list");
  });
  } else {
    $listWrap.html('<div class="schedule-noData">등록된 일정이 없습니다.</div>');
  }

}

/**
 * '일정 조회 공통 카드 생성' 함수
 * @param {object} scheduleCard 형 응답 데이터
 */
 function makeScheduleCard(scheduleCard, isHistory){
	var customMessage = $('<div class="custom-message"></div>');
  var scheduleCon = $('<div class="message"></div>');
  
  var scheduleWrap = $('<div class="schedule-wrap schedule-person"></div>');
  scheduleWrap.attr("data-sessionId", scheduleCard.chatSessionId.split("sessions/")[1]);
  scheduleWrap.attr("data-userId", scheduleCard.userId);
  scheduleWrap.attr("data-loginUserId", scheduleCard.loginUserId);
  scheduleWrap.attr("data-mySelf", scheduleCard.mySelfYn);
  scheduleWrap.attr("data-empNo", scheduleCard.empNo);
  scheduleCon.append(scheduleWrap);

	
	var scheduleHeader = $('<div class="s-header"></div>');
  var dateCheck = moment(scheduleCard.date);
  if(!dateCheck.isValid()) {
    scheduleCard.date = moment();
  }
	var scheduleDate = $('<div class="s-date">'+ iconCalendar + '<h1><b>' + moment(scheduleCard.date).format('YYYY년 M월 DD일') + '</b> 일정</h1></div>')
  scheduleHeader.append(scheduleDate);
	
	var btnSchedulePrev = $('<a href="#" class="prev"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.28456 7.60128C6.08249 7.82861 6.08249 8.17119 6.28456 8.39852L11.0273 13.7342C11.1741 13.8993 11.1592 14.1521 10.9941 14.2989C10.829 14.4456 10.5762 14.4308 10.4294 14.2656L5.68663 8.93001C5.21513 8.39957 5.21513 7.60023 5.68663 7.06979L10.4294 1.73415C10.5762 1.56904 10.829 1.55417 10.9941 1.70094C11.1592 1.8477 11.1741 2.10053 11.0273 2.26564L6.28456 7.60128Z" fill="#2C2C2C"/></svg></a>');
	btnSchedulePrev.click(function() {
        var cDate = new Date(scheduleCard.date);
        cDate.setDate(cDate.getDate() - 1);
        scheduleCard.date = cDate;
        scheduleDate.html(iconCalendar + '<h1><b>' + moment(scheduleCard.date).format('YYYY년 M월 DD일') + '</b> 일정</h1>');
        setScheduleDate($(this), cDate);
  });
  scheduleHeader.append(btnSchedulePrev);
	
	var btnScheduleNext = $('<a href="#" class="next"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.3815 7.60128C10.5835 7.82861 10.5835 8.17119 10.3815 8.39852L5.63867 13.7342C5.4919 13.8993 5.50677 14.1521 5.67188 14.2989C5.837 14.4456 6.08983 14.4308 6.23659 14.2656L10.9794 8.93001C11.4509 8.39957 11.4509 7.60023 10.9794 7.06979L6.23659 1.73415C6.08983 1.56904 5.837 1.55417 5.67188 1.70094C5.50677 1.8477 5.4919 2.10053 5.63867 2.26565L10.3815 7.60128Z" fill="#2C2C2C"/></svg></a>');
	btnScheduleNext.click(function() {
        var cDate = new Date(scheduleCard.date);
        cDate.setDate(cDate.getDate() + 1);
        scheduleCard.date = cDate;
        scheduleDate.html(iconCalendar + '<h1><b>' + moment(scheduleCard.date).format('YYYY년 M월 DD일') + '</b> 일정</h1>');
        setScheduleDate($(this), cDate);
    });
	scheduleHeader.append(btnScheduleNext);

  scheduleWrap.append(scheduleHeader);

	// schedule-body
	var scheduleBody = $('<div class="schedule-body"></div>');
	scheduleWrap.append(scheduleBody);

	
	// schedule-list-wrap
	var scheduleListWrap = $('<div class="schedule-list-wrap show"></div>');
	scheduleBody.append(scheduleListWrap);
	
	var scheduleList = $('<ul class="schedule-list"></ul>');
	scheduleListWrap.append(scheduleList);
		
	makeScheduleItem(scheduleCard, scheduleList, false, scheduleCard.date);
// 	makeScheduleItemSample(scheduleList, scheduleBody); // [퍼블 수정 및 추가] - 퍼블 확인용
	
    // schedule-list-header
    if( scheduleCard.mySelfYn == 'Y' ){
        var attednCheck = $('<div class="schedule-list-header attend"></div>');
        scheduleBody.append(attednCheck);
        
        var scheduleListHeaderLabel = $('<span class="a-text">참석여부 보기</span>');
        attednCheck.append(scheduleListHeaderLabel);
        
        var scheduleListHeaderSwitch = $('<label class="switch"></label>');
        attednCheck.append(scheduleListHeaderSwitch);
        
    
        var switchCheckbox = $('<input type="checkbox" cname="attendView" class="check-attendView" />');
        scheduleListHeaderSwitch.append(switchCheckbox);
        scheduleListHeaderSwitch.append($('<span class="slider round"></span>'));
        
        scheduleListHeaderSwitch.on('click', function() {
            var $scheduleWrap = $(this).closest(".schedule-wrap");
            
            $(this).find(".check-attendView").prop("checked", !$(this).find(".check-attendView").prop("checked"));
            if ($(this).find(".check-attendView").prop("checked") == true) {
                $scheduleWrap.find(".attend-check").addClass("show");
            } else {
                $scheduleWrap.find(".attend-check").removeClass("show");
            }
        });
    }

    customMessage.append(scheduleCon);
	return customMessage;
}

/**
 * '회의실 취소 카드 생성' 함수
 * @param {object} scheduleCard 형 응답 데이터
 */
 function makeMeetingRoomCard(data, isHistory){
	var meetingRoomCon = $('<div class="message"></div>');
	var meetingRoomWrap = $('<div class="schedule-wrap schedule-person schedule-meeting"></div>');
	meetingRoomWrap.attr("data-sessionId", data.chatSessionId.split("sessions/")[1]);
	meetingRoomWrap.attr("data-userId", data.userId);
	meetingRoomCon.append(meetingRoomWrap);
	// schedule-header
	var meetingRoomHeader = $('<div class="s-header"></div>');
	
	
	var meetingRoomDate = $('<div class="s-date"></div>');
	meetingRoomDate.html(iconCalendar + '<h1><b>' + moment(data.date).format('YYYY년 M월 DD일') + '</b> 예약 회의실</h1>');

  meetingRoomHeader.append(meetingRoomDate);
	
	var btnMeetingRoomPrev = $('<a class="prev"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.28456 7.60128C6.08249 7.82861 6.08249 8.17119 6.28456 8.39852L11.0273 13.7342C11.1741 13.8993 11.1592 14.1521 10.9941 14.2989C10.829 14.4456 10.5762 14.4308 10.4294 14.2656L5.68663 8.93001C5.21513 8.39957 5.21513 7.60023 5.68663 7.06979L10.4294 1.73415C10.5762 1.56904 10.829 1.55417 10.9941 1.70094C11.1592 1.8477 11.1741 2.10053 11.0273 2.26564L6.28456 7.60128Z" fill="#2C2C2C"/></svg></a>');
	btnMeetingRoomPrev.click(function() {
        var cDate = new Date(data.date);
        cDate.setDate(cDate.getDate() - 1);
        data.date = cDate;
        meetingRoomDate.html(iconCalendar + '<h1><b>' + moment(data.date).format('YYYY년 M월 DD일') + '</b> 예약 회의실</h1>');
        setMeetingRoomDate($(this), cDate);
    });
	meetingRoomHeader.append(btnMeetingRoomPrev);
	
	var btnMeetingRoomNext = $('<a class="next"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.3815 7.60128C10.5835 7.82861 10.5835 8.17119 10.3815 8.39852L5.63867 13.7342C5.4919 13.8993 5.50677 14.1521 5.67188 14.2989C5.837 14.4456 6.08983 14.4308 6.23659 14.2656L10.9794 8.93001C11.4509 8.39957 11.4509 7.60023 10.9794 7.06979L6.23659 1.73415C6.08983 1.56904 5.837 1.55417 5.67188 1.70094C5.50677 1.8477 5.4919 2.10053 5.63867 2.26565L10.3815 7.60128Z" fill="#2C2C2C"/></svg></a>');
	btnMeetingRoomNext.click(function() {
      var cDate = new Date(data.date);
      cDate.setDate(cDate.getDate() + 1);
      data.date = cDate;
      meetingRoomDate.html(iconCalendar + '<h1><b>' + moment(data.date).format('YYYY년 M월 DD일') + '</b> 예약 회의실</h1>');
      setMeetingRoomDate($(this), cDate);
    });
	meetingRoomHeader.append(btnMeetingRoomNext);

  meetingRoomWrap.append(meetingRoomHeader);

	// schedule-body
	var meetingRoomBody = $('<div class="schedule-body"></div>');
	meetingRoomWrap.append(meetingRoomBody);

	// schedule-list-wrap
	var meetingRoomListWrap = $('<div class="schedule-list-wrap show"></div>');
	meetingRoomBody.append(meetingRoomListWrap);
	
	var meetingRoomList = $('<ul class="schedule-list s-list"></ul>');
	meetingRoomListWrap.append(meetingRoomList);
		
	makeMeetingRoomItem(data, meetingRoomList);

	return meetingRoomCon;
}

/**
 * '회의실 항목 셋팅' 함수
 */
function makeMeetingRoomItem(data, meetingRoomList){
    var $listWrap = meetingRoomList.closest(".schedule-wrap").find(".schedule-list-wrap");
    
    var today = new Date();
    var cDate = new Date(data.date);
    today = new Date(today.getFullYear(), today.getMonth()+1, today.getDate());
    cDate = new Date(cDate.getFullYear(), cDate.getMonth()+1, cDate.getDate());
    
    var dataDisabled;

    if (cDate < today) {
        dataDisabled = ' data-disabled="disabled"';
    } else {
        dataDisabled = "";
    }
		
	if (data.items instanceof Array && data.items.length > 0) {
		data.items.forEach(function(item,index) {
			var meetingRoomItem = $('<li class="schedule-item"></li>');
			meetingRoomItem.attr("data-scheduleId", item.scheduleId);
			meetingRoomItem.attr("data-repeatYn", item.repeatYn);
			meetingRoomList.append(meetingRoomItem);

      var meetingRoomTime = $('<div class="time">'
          +'<h3>'+ ( item.wholeDay == '1' ? '종일' : item.stTime) + '</h3>'
          +'<h5>'+ ( item.wholeDay == '1' ? '' : item.edTime ) + '</h5>'
        +'</div>');
        
			
      meetingRoomItem.append(meetingRoomTime);

      var meetingRoomItemBody = $('<div class="s-detail"></div>');
			
			var meetingRoomTodo = $('<h2>' +  (item.publicYn == 'N' ? '<span class="private">'+ iconLock +'</span>' + item.title : item.title ) + '</h2>');
			meetingRoomItemBody.append(meetingRoomTodo);

      if(item.place) {
        var meetingRoomPlace = $('<p>' + iconMarker + '<span>' + item.place + '</span></p>');
        meetingRoomItemBody.append(meetingRoomPlace);
      }


        // [퍼블 수정 및 추가] - 주석처리 해제
        if(item.members) {
            var meetingRoomMembers = $('<p>' + iconMember + '<span>' + item.members + '</span></p>');
            meetingRoomItemBody.append(meetingRoomMembers);
        }
        meetingRoomItem.append(meetingRoomItemBody);
        
			
			var meetingRoomBtn = $('<dd class="schedule-btn show"></dd>');
			meetingRoomItem.append(meetingRoomBtn);
						
            var deleteBtn = $('<button type="button" class="s-delete" onclick="event.cancelBubble=true;">' + iconDelete + '</button>'); // [퍼블 수정 및 추가] - onclick="event.cancelBubble=true; 추가
            deleteBtn.on('click', function(){
                pop.open(
                    'create',
                    $(this),
                    'Pop_Delete_Schedule',
                    'loadEl.pop_del_confirm("일정 및 회의실 삭제", "삭제된 일정 및 회의실은 복구할 수 없어요.<br />일정 및 회의실을 삭제할까요?")' // [퍼블 수정 및 추가] - 텍스트 수정
                );
                $("#btnDelete").click(function(){            	    
                    var sessionId = deleteBtn.closest(".schedule-wrap").attr("data-sessionId");
                    var userId = deleteBtn.closest(".schedule-wrap").attr("data-userId");
                    var requestParam = {
                        query: {
                            "event": "meetingRoomDeleteEvent"
                        },
                        payload: {
                            "userId" : userId,
                            "scheduleId": item.scheduleId,
                            "deleteTarget" : 1 // ( 일정 삭제 : 0 / 회의실 삭제 : 1)
                        }
                    };
                    sendChatApi(requestParam, sessionId, function(payload){
                        console.log("meetingRoomDeleteEvent :: "+ JSON.stringify(payload));
                        
                        // meetingRoomItem.remove(); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 코드 삭제
                        meetingRoomItem.addClass('cancel-line'); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 추가
                        meetingRoomItem.find('.attend-check').attr('disabled', true); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 추가
                        meetingRoomItem.find('.s-delete').remove(); // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 추가
            
                        pop.close($("#btnDelete"));
                        
                        // [퍼블 수정 및 추가] - 리스트삭제 미사용으로 인한 코드 삭제
                        // if ( meetingRoomList.closest(".schedule-wrap").find(".schedule-item").length < 1 ){
                        //     $listWrap.html('<div class="schedule-noData">취소가능한 회의실이 없습니다.</div>');
                        // }
                        
                        // [퍼블 수정 및 추가] - showSmallDialog() 미 설정으로 인한 추가
                        setTimeout(function() {
                            showSmallDialog('일정 및 회의실이 삭제되었습니다.');
                        }, 500);
                    });
                });
            });
			meetingRoomBtn.append(deleteBtn);
		});
    } else {
    	$listWrap.html('<div class="schedule-noData">취소가능한 회의실이 없습니다.</div>');
    }
}

/**
 * '일자별 회의실 셋팅' 함수
 */
function setMeetingRoomDate(btn, date) {
    var $listWrap = $(btn).closest(".schedule-wrap").find(".schedule-list-wrap");
    var $list;
    var sessionId = $(btn).closest(".schedule-wrap").attr("data-sessionId");
    var userId = $(btn).closest(".schedule-wrap").attr("data-userId");

    date = moment(date).format('YYYYMMDD');
    $listWrap.html('<ul class="schedule-list s-list"></ul>');
    $list = $(btn).closest(".schedule-wrap").find(".schedule-list");

    /**********************************************************/
    var requestParam = {
	    query: {
			"event": "meetingRoomQueryEvent"
		},
		payload: {
			"date": date,
			"userId":userId
		}
    };
    
    sendChatApi(requestParam, sessionId, function(payload){
    	console.log("meetingRoomQueryEvent :: " + JSON.stringify(payload));
      if(payload.queryResult.messages instanceof Array && payload.queryResult.messages.length > 1 && payload.queryResult.messages[1].response) {
        var data = JSON.parse(payload.queryResult.messages[1].response).template.outputs;
        var count = 0;

        $.each(data, function(index) {
            if (data[index].type == 'meetingRoom') {
                if (moment(data[index].data.date).format('YYYYMMDD') == date) {
        			    makeMeetingRoomItem(data[index].data, $list);
        			
                    count = count + 1;
                }
            }
        });

        $listWrap.addClass("show");

        if (count < 1) {
          $listWrap.html('<div class="schedule-noData">취소가능한 회의실이 없습니다.</div>');
      }
      } else {
        $listWrap.html('<div class="schedule-noData">취소가능한 회의실이 없습니다.</div>'); 
      }
	    

        
    });
    /**********************************************************/
}


/**
 * '메신저 연결' 함수
 * @param {string} userId 수신자 아이디
 * 		   {string} targerId 발신자 아이디
 */
function connectMessenger(userId, targetId){
    console.log(userId + " : " + targetId);
  var e = window.event;
  e.preventDefault ? e.preventDefault() : (e.returnValue = false);
  
  if(!window.opener) {
      var messengerEvent = {
        event_id: 'messengser_open',
        id: {
            userId: userId, 
            targetId: targetId
        }
      }
      window.parent.postMessage(messengerEvent, '*');
  }
  else{
       var uCapUri = 'LGUCAPL://';
       uCapUri += 'GUC005;CHAT;'+userId+';'+targetId+'@GUC005';
       window.protocolCheck(uCapUri, function() {
           window.open("http://www.lgucap.com", "width=1100,height=800, resizable=1,scrollbars=1");
       });
  }
}


/**
 * '임직원 조회 카드' 생성 함수
 * @param {JSON} item 임직원 조회 응답 데이터
 */
 function makeEmployeeCard(data, isHistory){
	console.log(data);

	var dprofile = $('<div class="message profile-one"></div>');
  var dprofileList = $('<ul></ul>')
	
	// dpWrap
	var listBox  = $('<li class="list-box"></li>');
  var profileImg = $(data.profilePicture ? '<div class="profile-img">' + `<img src="' + data.profilePicture +'" onerror="this.src='` + pAlternative + `';"></div>` : '<div class="profile-img">' + '<img src="' + pAlternative +'"></div>');
  listBox.append(profileImg);
		
	// name
	var textBox = $('<div class="text-box"></div>');
  var nameWrap = $('<div class="name"></div>');
  var title = $('<h1>'+ data.userNm + ' ' + data.titleNm + isBirthdayToday(data.birth) + '</h1>');

  nameWrap.append(title);
  textBox.append(nameWrap);
 

  var descList = $('<ul class="profile-info"></ul>');
  var team = $('<li>'
  +'<span class="profile-icon icon-team">'
    +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39792 5.29389C9.31181 5.10936 9.99992 4.30178 9.99992 3.3335C9.99992 2.22893 9.10449 1.3335 7.99992 1.3335C6.89535 1.3335 5.99992 2.22893 5.99992 3.3335C5.99992 4.30174 6.68796 5.10928 7.60179 5.29387C7.60051 5.30688 7.59985 5.32008 7.59985 5.33343V7.6001H5.33319C4.0077 7.6001 2.93319 8.67461 2.93319 10.0001V10.6668C2.93319 10.6802 2.93385 10.6934 2.93513 10.7065C2.0213 10.891 1.33325 11.6986 1.33325 12.6668C1.33325 13.7714 2.22868 14.6668 3.33325 14.6668C4.43782 14.6668 5.33325 13.7714 5.33325 12.6668C5.33325 11.6985 4.64514 10.891 3.73124 10.7064C3.73253 10.6934 3.73319 10.6802 3.73319 10.6668V10.0001C3.73319 9.11644 4.44953 8.4001 5.33319 8.4001H10.6665C11.5502 8.4001 12.2665 9.11644 12.2665 10.0001V10.6668C12.2665 10.6802 12.2672 10.6934 12.2685 10.7065C11.3546 10.891 10.6666 11.6986 10.6666 12.6668C10.6666 13.7714 11.562 14.6668 12.6666 14.6668C13.7712 14.6668 14.6666 13.7714 14.6666 12.6668C14.6666 11.6985 13.9785 10.891 13.0646 10.7064C13.0659 10.6934 13.0665 10.6802 13.0665 10.6668V10.0001C13.0665 8.67461 11.992 7.6001 10.6665 7.6001H8.39985L8.39985 5.33343C8.39985 5.32009 8.3992 5.3069 8.39792 5.29389ZM7.99992 4.5335C8.66266 4.5335 9.19992 3.99624 9.19992 3.3335C9.19992 2.67075 8.66266 2.1335 7.99992 2.1335C7.33718 2.1335 6.79992 2.67075 6.79992 3.3335C6.79992 3.99624 7.33718 4.5335 7.99992 4.5335ZM3.33325 13.8668C3.99599 13.8668 4.53325 13.3296 4.53325 12.6668C4.53325 12.0041 3.99599 11.4668 3.33325 11.4668C2.67051 11.4668 2.13325 12.0041 2.13325 12.6668C2.13325 13.3296 2.67051 13.8668 3.33325 13.8668ZM13.8666 12.6668C13.8666 13.3296 13.3293 13.8668 12.6666 13.8668C12.0038 13.8668 11.4666 13.3296 11.4666 12.6668C11.4666 12.0041 12.0038 11.4668 12.6666 11.4668C13.3293 11.4668 13.8666 12.0041 13.8666 12.6668Z" fill="#898989"/>'
    +'</svg>'
  +'</span>' + (data.deptNm ? data.deptNm : '-') + '</li>');
  descList.append(team);

  var mobile = $('<li>'
  +'<span class="profile-icon icon-phone">'
    +'<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +'<path fill-rule="evenodd" clip-rule="evenodd" d="M12.5842 10.5261L10.3746 9.14452C10.2925 9.09317 10.1745 9.10065 10.0918 9.18231C10.0131 9.26012 9.9358 9.33551 9.87193 9.39564C9.1487 10.0767 8.21307 9.93799 7.54251 9.66479C6.85048 9.38284 6.1788 8.8696 5.65588 8.34687C5.13291 7.82409 4.61899 7.15196 4.33668 6.45924C4.06308 5.78791 3.92438 4.85121 4.60668 4.12737C4.66788 4.06244 4.74239 3.98595 4.81898 3.90841C4.9012 3.82516 4.90827 3.70712 4.85718 3.62542L3.47542 1.41615L3.47137 1.40939C3.30654 1.1339 2.99922 1.03945 2.68408 1.24462C1.85645 1.78509 1.43723 2.37962 1.25418 2.971C1.06765 3.57363 1.09939 4.26136 1.33263 5.02227C1.80708 6.57004 3.05679 8.22718 4.41578 9.58568C5.77497 10.9444 7.43109 12.1933 8.97796 12.6675C9.7384 12.9006 10.4258 12.9324 11.0283 12.7461C11.6196 12.5632 12.2142 12.1443 12.7552 11.3174C12.9603 11.0029 12.867 10.6959 12.5904 10.5298L12.5842 10.5261ZM13.425 11.7548C10.922 15.5818 6.6355 12.9357 3.8502 10.1515C1.06491 7.3672 -1.58331 3.07544 2.24711 0.574501C2.95544 0.113007 3.76792 0.346919 4.15787 0.998626L5.53544 3.20121C5.78858 3.60595 5.72365 4.13091 5.38816 4.47058C5.31335 4.54632 5.24381 4.61776 5.18882 4.6761C4.46912 5.43963 5.2675 6.82747 6.22146 7.78108C7.17542 8.73469 8.56121 9.531 9.3235 8.81321C9.38036 8.75968 9.45232 8.68957 9.52946 8.61333C9.86892 8.27782 10.394 8.21314 10.7987 8.46619L13.0023 9.84394C13.6537 10.2351 13.887 11.0468 13.425 11.7548Z" fill="#898989"/>'
    +'</svg>'
  +'</span>' + (data.empMobile ? data.empMobile : '-') + '</li>');
  descList.append(mobile);
  textBox.append(descList);

  listBox.append(textBox);
  dprofileList.append(listBox);
  dprofile.append(dprofileList);


  var moreInfos = $('<div class="more-infos"></div>');
  var moreInfoList = $('<ul class="p-info"></ul>');
  var email = $('<li><span class="info-label">E-mail</span><span class="info">'+ (data.empMail ? data.empMail : '-') + '</span></li>');
  moreInfoList.append(email);
  var office = $('<li><span class="info-label">Office</span><span class="info">'+ (data.empTelNo ? data.empTelNo : '-') + '</span></li>');
  moreInfoList.append(office);
  moreInfos.append(moreInfoList);

  var isMobile = Mobile();

	
	var userId = data.empMail.split("@");
    //console.log('data.userId : '+data.userId+', data.targetId : '+data.targetId+', userId : '+userId[0]);	
    
		if ( data.isMobile != 'Y') {  
		// dpContact
   
		var dpContactHtml = '<div class="p-btns">';
    if(!isMobile && data.group != 'Y') {
      dpContactHtml += '<button type="button" class="icon-btn" onClick="connectMessenger(\''+data.userId+'\',\''+userId[0]+'\');">'
      +'<span class="b-icon">'
        +('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
        +'<path fill-rule="evenodd" clip-rule="evenodd" d="M20.2912 20.3478L18.2929 18.3411C18.1053 18.1526 17.8503 18.0467 17.5843 18.0467H9.99979C9.52323 18.0467 9.07261 17.9356 8.67245 17.7378C7.94451 17.3781 7.38352 16.7317 7.13695 15.9461C7.04009 15.6375 7.22544 15.3549 7.50873 15.2467C7.58741 15.2166 7.67363 15.2 7.76346 15.2C7.83698 15.2 7.90632 15.2169 7.96967 15.2467C8.10822 15.3119 8.21807 15.4391 8.28008 15.5873C8.28267 15.5935 8.28517 15.5997 8.28759 15.606C8.28873 15.6089 8.28986 15.6119 8.29096 15.6149C8.29311 15.6206 8.29518 15.6264 8.29719 15.6322C8.54017 16.3389 9.21068 16.8467 9.99979 16.8467H17.5843C18.1694 16.8467 18.7304 17.0797 19.1433 17.4943L20.7998 19.1579V10C20.7998 9.00589 19.9939 8.2 18.9998 8.2H18.8C18.4699 8.2 18.202 7.93339 18.2 7.60374C18.2 7.6025 18.2 7.60125 18.2 7.6C18.2 7.59875 18.2 7.5975 18.2 7.59625C18.202 7.26661 18.4699 7 18.8 7C18.7998 7 18.8002 7 18.8 7H18.9998C20.6567 7 21.9998 8.34315 21.9998 10V19.6422C21.9998 20.5341 20.9205 20.9798 20.2912 20.3478ZM14 14.0467C15.6569 14.0467 17 12.7035 17 11.0467V6C17 4.34315 15.6569 3 14 3H5C3.34315 3 2 4.34314 2 6V15.6422C2 16.5341 3.07925 16.9798 3.7086 16.3478L5.70685 14.3411C5.89451 14.1526 6.1495 14.0467 6.41545 14.0467H14ZM5 4.2C4.00589 4.2 3.2 5.00589 3.2 6V15.1579L4.85653 13.4943C5.26937 13.0797 5.83036 12.8467 6.41545 12.8467H14C14.9941 12.8467 15.8 12.0408 15.8 11.0467V6C15.8 5.00589 14.9941 4.2 14 4.2H5Z" fill="#6B6B6B"/>'
        +'</svg>')
      +'</span><span class="b-text">메신저</span></button>';
    }
		
     dpContactHtml +=	'<button type="button" class="icon-btn" onClick="sendSMSPopupOpen(null,\''+data.userNm+'\',\''+data.deptNm+'\',\''+data.empMobile+'\')">'
     +'<span class="b-icon">'
     +('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
     +'<path fill-rule="evenodd" clip-rule="evenodd" d="M5 4.2C4.00703 4.2 3.2 5.0061 3.2 6.00304V19.4955C3.2 19.7664 3.52435 19.8967 3.7117 19.7091L6.81171 16.606C7.31813 16.099 8.0053 15.8142 8.72186 15.8142H19C19.993 15.8142 20.8 15.0081 20.8 14.0111V6.00304C20.8 5.0061 19.993 4.2 19 4.2H5ZM2 6.00304C2 4.34451 3.34315 3 5 3H19C20.6569 3 22 4.34451 22 6.00304V14.0111C22 15.6697 20.6569 17.0142 19 17.0142H8.72186C8.32377 17.0142 7.94201 17.1724 7.66067 17.4541L4.56066 20.5572C3.61571 21.5031 2 20.8332 2 19.4955V6.00304Z" fill="#6B6B6B"/>'
     +'</svg>')
      +'</span><span class="b-text">문자</span></button>';
			
    if(!isMobile) {
     dpContactHtml +=	'<button type="button" class="icon-btn" onClick="intentEvent(null, \'email\', \''+data.empMail+'\');">'
      +'<span class="b-icon">'
          +('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
          +'<path fill-rule="evenodd" clip-rule="evenodd" d="M19 5.2H5C4.00589 5.2 3.2 6.00589 3.2 7V17C3.2 17.9941 4.00589 18.8 5 18.8H19C19.9941 18.8 20.8 17.9941 20.8 17V7C20.8 6.00589 19.9941 5.2 19 5.2ZM5 4C3.34315 4 2 5.34315 2 7V17C2 18.6569 3.34315 20 5 20H19C20.6569 20 22 18.6569 22 17V7C22 5.34315 20.6569 4 19 4H5Z" fill="#6B6B6B"/>'
          +'<path fill-rule="evenodd" clip-rule="evenodd" d="M2 7C2 5.34315 3.34315 4 5 4H19C20.6569 4 22 5.34315 22 7C22 7.58091 21.8783 8.07924 21.5702 8.53793C21.2764 8.9753 20.8423 9.33144 20.3129 9.68998C19.4609 10.267 14.7828 12.8399 13.0035 13.8149C12.3765 14.1584 11.6235 14.1584 10.9965 13.8149C9.21694 12.8397 4.53774 10.2662 3.68633 9.68954C3.15719 9.33114 2.72334 8.97498 2.42973 8.5376C2.12186 8.07897 2 7.5807 2 7ZM5 5.2C4.00589 5.2 3.2 6.00589 3.2 7C3.2 7.39675 3.27829 7.64863 3.42607 7.86878C3.58811 8.11017 3.86561 8.36162 4.35928 8.69598C5.14928 9.23106 9.74951 11.7632 11.5731 12.7625C11.8409 12.9092 12.1591 12.9092 12.4269 12.7625C14.2502 11.7634 18.8494 9.2318 19.64 8.69639C20.1341 8.36174 20.4119 8.11025 20.574 7.86883C20.7219 7.64872 20.8 7.3969 20.8 7C20.8 6.00589 19.9941 5.2 19 5.2H5C5.00001 5.2 4.99999 5.2 5 5.2Z" fill="#6B6B6B"/>'
          +'</svg>')
      +'</span>'
      +'<span class="b-text">메일</span></button>';
    }

      if(data.group != 'Y' ) {
        dpContactHtml +='<button type="button" class="icon-btn" onClick="intentEvent(null, \'schedule\', \''+data.targetId+'\');">'
        +'<span class="b-icon">'
          +('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
          +'<path d="M17.4 14.5999L15.893 14.5999C15.5617 14.5999 15.293 14.3313 15.293 13.9999C15.293 13.6685 15.5617 13.3999 15.893 13.3999L17.4 13.3999C17.7314 13.3999 18 13.6685 18 13.9999C18 14.3313 17.7314 14.5999 17.4 14.5999Z" fill="#6B6B6B"/>'
          +'<path d="M12.8791 14.5999L11.1209 14.5999C10.7896 14.5999 10.5209 14.3313 10.5209 13.9999C10.5209 13.6685 10.7896 13.3999 11.1209 13.3999L12.8791 13.3999C13.2104 13.3999 13.4791 13.6685 13.4791 13.9999C13.4791 14.3313 13.2104 14.5999 12.8791 14.5999Z" fill="#6B6B6B"/>'
          +'<path d="M8.10698 14.5999L6.6 14.5999C6.26863 14.5999 6 14.3313 6 13.9999C6 13.6685 6.26863 13.3999 6.6 13.3999L8.10698 13.3999C8.43835 13.3999 8.70698 13.6685 8.70698 13.9999C8.70698 14.3313 8.43835 14.5999 8.10698 14.5999Z" fill="#6B6B6B"/>'
          +'<path d="M11.1209 17.5999L12.8791 17.5999C13.2104 17.5999 13.4791 17.3313 13.4791 16.9999C13.4791 16.6685 13.2104 16.3999 12.8791 16.3999L11.1209 16.3999C10.7896 16.3999 10.5209 16.6685 10.5209 16.9999C10.5209 17.3313 10.7896 17.5999 11.1209 17.5999Z" fill="#6B6B6B"/>'
          +'<path d="M6.6 17.5999L8.10698 17.5999C8.43835 17.5999 8.70698 17.3313 8.70698 16.9999C8.70698 16.6685 8.43835 16.3999 8.10698 16.3999L6.6 16.3999C6.26863 16.3999 6 16.6685 6 16.9999C6 17.3313 6.26863 17.5999 6.6 17.5999Z" fill="#6B6B6B"/>'
          +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.5999 2.6C8.5999 2.26863 8.33127 2 7.9999 2C7.66853 2 7.3999 2.26863 7.3999 2.6V4H6C4.34315 4 3 5.34315 3 7V19C3 20.6569 4.34315 22 6 22H18C19.6569 22 21 20.6569 21 19V7C21 5.34315 19.6569 4 18 4H16.5999V2.6C16.5999 2.26863 16.3313 2 15.9999 2C15.6685 2 15.3999 2.26863 15.3999 2.6V4H8.5999L8.5999 2.6ZM18 5.2H6C5.00589 5.2 4.2 6.00589 4.2 7V9L19.8 9V7C19.8 6.00589 18.9941 5.2 18 5.2ZM4.2 19V10.2L19.8 10.2V19C19.8 19.9941 18.9941 20.8 18 20.8H6C5.00589 20.8 4.2 19.9941 4.2 19Z" fill="#6B6B6B"/>'
          +'</svg>')
      +'</span>'
        +'<span class="b-text">일정</span></button>';
      }
			
			dpContactHtml +='</div>';
    		
    	var dpContact = $(dpContactHtml);
    	moreInfos.append(dpContact);

      dprofile.append(moreInfos);
	
	}

	return dprofile;
}

/**
 * '임직원 리스트' 함수 (일정조회 동명이인)' 생성 함수
 * @param {JSON List} item 임직원 리스트 응답 데이터
 */
function makeEmployeeListCard(data,isHistory){
	
	var dList = $('<div class="message profile-list"></div>');
	dList.attr("data-sessionId", data.chatSessionId.split("sessions/")[1]);
	
	//일정조회 동명이인 전용 파라미터
	dList.attr("data-loginUserId", data.loginUserId);
	dList.attr("data-date", data.date);
	dList.attr("data-krname", data.krname);

  var dListWrap = $('<ul></ul>');
	
	
	if (data.items instanceof Array && data.items.length > 0) {
		data.items.forEach(function(item,index) {
			var type = data.type;
			var empMail = item.empMail.split('@');
			var userId = empMail[0];
			var display = (index > 4)? "none":"flex";
			
			var liHtml = '<li class="list-box" style="display:'+display+'" onclick="intentEvent(this , \''+ type +'\', \''+ userId +'\')">';
			
			if(data.group == 'Y'){
				liHtml = '<li class="list-box" style="display:'+display+'" onclick="intentEvent(this , \'group\', \''+ item.empMail +'\')">';
			}
			
				liHtml += 	(item.profilePicture ? '<div class="profile-img">' + `<img src="' + item.profilePicture + '" onerror="this.src='` + pAlternative + `';"></div>` : '<div class="profile-img"><img class="img-circle" src="'+ pAlternative +'"></div>');
				liHtml += 	'<div class="text-box">';
        liHtml +=	'<div class="name">'
                    + '<h1>' + item.userNm + ' ' + item.titleNm +'</h1>'
                    +'</div">';

        liHtml += '</div>';

        liHtml += '<ul class="profile-info">'
        liHtml += ('<li><span class="profile-icon icon-team">'
        +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
            +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39792 5.29389C9.31181 5.10936 9.99992 4.30178 9.99992 3.3335C9.99992 2.22893 9.10449 1.3335 7.99992 1.3335C6.89535 1.3335 5.99992 2.22893 5.99992 3.3335C5.99992 4.30174 6.68796 5.10928 7.60179 5.29387C7.60051 5.30688 7.59985 5.32008 7.59985 5.33343V7.6001H5.33319C4.0077 7.6001 2.93319 8.67461 2.93319 10.0001V10.6668C2.93319 10.6802 2.93385 10.6934 2.93513 10.7065C2.0213 10.891 1.33325 11.6986 1.33325 12.6668C1.33325 13.7714 2.22868 14.6668 3.33325 14.6668C4.43782 14.6668 5.33325 13.7714 5.33325 12.6668C5.33325 11.6985 4.64514 10.891 3.73124 10.7064C3.73253 10.6934 3.73319 10.6802 3.73319 10.6668V10.0001C3.73319 9.11644 4.44953 8.4001 5.33319 8.4001H10.6665C11.5502 8.4001 12.2665 9.11644 12.2665 10.0001V10.6668C12.2665 10.6802 12.2672 10.6934 12.2685 10.7065C11.3546 10.891 10.6666 11.6986 10.6666 12.6668C10.6666 13.7714 11.562 14.6668 12.6666 14.6668C13.7712 14.6668 14.6666 13.7714 14.6666 12.6668C14.6666 11.6985 13.9785 10.891 13.0646 10.7064C13.0659 10.6934 13.0665 10.6802 13.0665 10.6668V10.0001C13.0665 8.67461 11.992 7.6001 10.6665 7.6001H8.39985L8.39985 5.33343C8.39985 5.32009 8.3992 5.3069 8.39792 5.29389ZM7.99992 4.5335C8.66266 4.5335 9.19992 3.99624 9.19992 3.3335C9.19992 2.67075 8.66266 2.1335 7.99992 2.1335C7.33718 2.1335 6.79992 2.67075 6.79992 3.3335C6.79992 3.99624 7.33718 4.5335 7.99992 4.5335ZM3.33325 13.8668C3.99599 13.8668 4.53325 13.3296 4.53325 12.6668C4.53325 12.0041 3.99599 11.4668 3.33325 11.4668C2.67051 11.4668 2.13325 12.0041 2.13325 12.6668C2.13325 13.3296 2.67051 13.8668 3.33325 13.8668ZM13.8666 12.6668C13.8666 13.3296 13.3293 13.8668 12.6666 13.8668C12.0038 13.8668 11.4666 13.3296 11.4666 12.6668C11.4666 12.0041 12.0038 11.4668 12.6666 11.4668C13.3293 11.4668 13.8666 12.0041 13.8666 12.6668Z" fill="#898989"/>'
        +'</svg>'
        + '</span><span class="team-name">' + (item.deptNm ? item.deptNm : '-') + '</span></li>');
        
				liHtml += ('<li><span class="profile-icon icon-phone">'
         + '<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">'
            +'<path fill-rule="evenodd" clip-rule="evenodd" d="M12.5842 10.5261L10.3746 9.14452C10.2925 9.09317 10.1745 9.10065 10.0918 9.18231C10.0131 9.26012 9.9358 9.33551 9.87193 9.39564C9.1487 10.0767 8.21307 9.93799 7.54251 9.66479C6.85048 9.38284 6.1788 8.8696 5.65588 8.34687C5.13291 7.82409 4.61899 7.15196 4.33668 6.45924C4.06308 5.78791 3.92438 4.85121 4.60668 4.12737C4.66788 4.06244 4.74239 3.98595 4.81898 3.90841C4.9012 3.82516 4.90827 3.70712 4.85718 3.62542L3.47542 1.41615L3.47137 1.40939C3.30654 1.1339 2.99922 1.03945 2.68408 1.24462C1.85645 1.78509 1.43723 2.37962 1.25418 2.971C1.06765 3.57363 1.09939 4.26136 1.33263 5.02227C1.80708 6.57004 3.05679 8.22718 4.41578 9.58568C5.77497 10.9444 7.43109 12.1933 8.97796 12.6675C9.7384 12.9006 10.4258 12.9324 11.0283 12.7461C11.6196 12.5632 12.2142 12.1443 12.7552 11.3174C12.9603 11.0029 12.867 10.6959 12.5904 10.5298L12.5842 10.5261ZM13.425 11.7548C10.922 15.5818 6.6355 12.9357 3.8502 10.1515C1.06491 7.3672 -1.58331 3.07544 2.24711 0.574501C2.95544 0.113007 3.76792 0.346919 4.15787 0.998626L5.53544 3.20121C5.78858 3.60595 5.72365 4.13091 5.38816 4.47058C5.31335 4.54632 5.24381 4.61776 5.18882 4.6761C4.46912 5.43963 5.2675 6.82747 6.22146 7.78108C7.17542 8.73469 8.56121 9.531 9.3235 8.81321C9.38036 8.75968 9.45232 8.68957 9.52946 8.61333C9.86892 8.27782 10.394 8.21314 10.7987 8.46619L13.0023 9.84394C13.6537 10.2351 13.887 11.0468 13.425 11.7548Z" fill="#898989"/>'
          +'</svg>'
          + '</span>' + (item.empMobile ? item.empMobile : '') + '</li>');
				
				liHtml += '</ul>';
        liHtml +=	'<span class="arrow">'
        +'<svg width="7" height="14" viewBox="0 0 7 14" fill="none" xmlns="http://www.w3.org/2000/svg">'
          +'<path fill-rule="evenodd" clip-rule="evenodd" d="M5.3817 6.60128C5.58377 6.82861 5.58377 7.17119 5.3817 7.39852L0.63891 12.7342C0.492143 12.8993 0.507015 13.1521 0.672128 13.2989C0.837241 13.4456 1.09007 13.4308 1.23684 13.2656L5.97963 7.93001C6.45113 7.39957 6.45113 6.60023 5.97962 6.06979L1.23684 0.734153C1.09007 0.56904 0.837241 0.554168 0.672128 0.700936C0.507015 0.847703 0.492143 1.10053 0.63891 1.26565L5.3817 6.60128Z" fill="#A5A5A5"/>'
        +'</svg>'
      +'</span>';    
        liHtml += '</li>';
			var li = $(liHtml);
			dListWrap.append(li);
		});

    dList.append(dListWrap);
		
		if(data.items.length > 4){
			var btnHtml = 	'<div class="see-more">'
      + '<svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
        +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
      + '</svg>더보기</div>';

			var btn = $(btnHtml);
			btn.click(function() {
			    $(this).parents('.profile-list').find(".list-box").css("display","flex");
			    $(this).css({"display":"none"});
		    });
      dList.append(btn);
		}
		
	}

	return dList;
}


/**
 * '기념일 카드' 생성 함수
 * @param {List} item 리스트형 응답 데이터
 */
function makeAnniversaryCard(items){	
  var mobileCheck = Mobile();
  var anniversaryFirst = $('<div class="message-in">생일을 맞이하는 팀원이 <b>' + (items.length) + '</b>명 있습니다. 팀원을 선택하여 축하 메시지를 남겨 주세요!</div>"');

  if(items.length == 0) { anniversaryFirst = $('<div class="message-in">생일을 맞이하는 팀원이 없네요. 따뜻한 마음으로 챙겨주셔서 감사합니다:)</div>"'); }
	
  var dpListWrap = $('<div class="anniversary profile-list"></div>');
  var dpTitle = $('<div class="list-header-title">' + listHeaderIcon +'<span><b>최근</b> 생일을 맞이한 팀원</span></div>')
  dpListWrap.append(dpTitle);
	var ul = $('<ul></ul>');
	dpListWrap.append(ul);
	
	if (items instanceof Array && items.length > 0) {
		items.forEach(function(item,index) {
			var liHtml = (mobileCheck ? '<li class="list-box mobile">': '<li class="list-box">');
        liHtml += (item.profilePicture ? '<div class="profile-img">' +'<img src="' + item.profilePicture +  '"/></div>' : '<div class="profile-img"><img src="' + pAlternative + '"/></div>');
				liHtml += '<div class="text-box">';
        liHtml += '<div class="name"><h1>' + item.name + ' ' + item.jobTitle + (item.birthDate ? isToday(item.birthDate) : '') + '</h1></div">'
        liHtml += '<ul class="profile-info">'
				liHtml += ('<li><span class="profile-icon icon-phone">'
                  + '<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">'
                      +'<path fill-rule="evenodd" clip-rule="evenodd" d="M12.5842 10.5261L10.3746 9.14452C10.2925 9.09317 10.1745 9.10065 10.0918 9.18231C10.0131 9.26012 9.9358 9.33551 9.87193 9.39564C9.1487 10.0767 8.21307 9.93799 7.54251 9.66479C6.85048 9.38284 6.1788 8.8696 5.65588 8.34687C5.13291 7.82409 4.61899 7.15196 4.33668 6.45924C4.06308 5.78791 3.92438 4.85121 4.60668 4.12737C4.66788 4.06244 4.74239 3.98595 4.81898 3.90841C4.9012 3.82516 4.90827 3.70712 4.85718 3.62542L3.47542 1.41615L3.47137 1.40939C3.30654 1.1339 2.99922 1.03945 2.68408 1.24462C1.85645 1.78509 1.43723 2.37962 1.25418 2.971C1.06765 3.57363 1.09939 4.26136 1.33263 5.02227C1.80708 6.57004 3.05679 8.22718 4.41578 9.58568C5.77497 10.9444 7.43109 12.1933 8.97796 12.6675C9.7384 12.9006 10.4258 12.9324 11.0283 12.7461C11.6196 12.5632 12.2142 12.1443 12.7552 11.3174C12.9603 11.0029 12.867 10.6959 12.5904 10.5298L12.5842 10.5261ZM13.425 11.7548C10.922 15.5818 6.6355 12.9357 3.8502 10.1515C1.06491 7.3672 -1.58331 3.07544 2.24711 0.574501C2.95544 0.113007 3.76792 0.346919 4.15787 0.998626L5.53544 3.20121C5.78858 3.60595 5.72365 4.13091 5.38816 4.47058C5.31335 4.54632 5.24381 4.61776 5.18882 4.6761C4.46912 5.43963 5.2675 6.82747 6.22146 7.78108C7.17542 8.73469 8.56121 9.531 9.3235 8.81321C9.38036 8.75968 9.45232 8.68957 9.52946 8.61333C9.86892 8.27782 10.394 8.21314 10.7987 8.46619L13.0023 9.84394C13.6537 10.2351 13.887 11.0468 13.425 11.7548Z" fill="#898989"/>'
                  +'</svg>'
                + '</span>' + (item.mobole  ? item.mobole  : '') + '</li>')
				liHtml +=		arrow;
        liHtml += '</ul>' 
				liHtml += 	'</div>';
				liHtml += '</li>';
			var li = $(liHtml);


      if(mobileCheck == false) {
        li.on('click', function() {
          window.open(gportalPersonUrl + item.emailId, "_blank");
        });
      }
      

			ul.append(li);
	
		});
	} else {
    var liHtml = $('<li class="list-box no-result">임직원 검색 결과가 없습니다.</li>');
    ul.append(liHtml);
  }
	

  var anniversary = $('<div class="message trans"></div>');

  anniversary.append(anniversaryFirst);
  anniversary.append(dpListWrap); 

	return anniversary;
}

// RPA Param Message Card
function makeRpaParamMessageCard(data, isHistory) {
    var rpaParamCon = $('<div class="message message-form-sms caas-message-color caas-message-font-color"></div>');
	
	var rpaParamWrap = $('<div class="form-sms"></div>');
	rpaParamWrap.attr("data-processId", data.process_id);
	rpaParamWrap.attr("data-userId", data.loginUserId);
	
	rpaParamCon.append(rpaParamWrap);
	
	var rpaParamContent = $('<div class="param-content"></div>');
	rpaParamWrap.append(rpaParamContent);
	
	var rpaParamTextarea = $('<textarea name="paramMessage" id="paramMessage" rows="6" placeholder="내용을 작성해주세요." style="resize:none;"></textarea>');
	rpaParamContent.append(rpaParamTextarea);
	
	//btn-wrap
	var rpaParamBtnWrap = $('<div class="btn-wrap"></div>');
	rpaParamWrap.append(rpaParamBtnWrap);
	
	var rpaParamButton = $('<button type="button" id="paramBtnSend" onClick="sendParam(this);" class="btn btn-primary" disabled>완료</button>');
	rpaParamBtnWrap.append(rpaParamButton);

	return rpaParamCon;
}

// RPA Param Message 
function sendParam(btn) {

    var process_id = $(btn).closest(".form-sms").attr("data-processId");
    var loginUserId = $(btn).closest(".form-sms").attr("data-userId");
    var data_param = $(btn).closest(".form-sms").find("#paramMessage").val();
    process_id = process_id + "|" + data_param;

    pop.open('create', $(this), 'Pop_process_confirm', 'loadEl.pop_process_confirm("프로세스 실행","대상 프로세스를 실행 하시겠습니까?")');
    $("#btnConfirm").click(function(){
        chatui.sendEventMessage("rpaProcessStart", {"process_id" : process_id, "userId" : loginUserId, "data_param" : data_param });
        $(btn).closest(".form-sms").find("#paramMessage").attr("disabled", true);
		$(btn).closest(".form-sms").find(".btn-wrap").css("display", "none");
        pop.close($('#btnConfirm'));
    });

}

// 화상장비 이름 변경 프로세스 입력 카드
function makeVideoEquipChngCard(data, isHistory) {
    var equipChgCon = $('<div class="message message-form-sms caas-message-color caas-message-font-color"></div>');
	
	var equipChgWrap = $('<div class="form-sms"></div>');
	equipChgWrap.attr("data-userId", data.loginUserId);
	
	equipChgCon.append(equipChgWrap);
	
	var equipChgContent = $('<div class="param-content"></div>');
	equipChgWrap.append(equipChgContent);
	
	var equipChgTextarea = $('<textarea name="equipChng" id="equipChgMessage" rows="6" placeholder="내용을 작성해주세요." style="resize:none;"></textarea>');
	equipChgContent.append(equipChgTextarea);
	
	//btn-wrap
	var equipChgBtnWrap = $('<div class="btn-wrap"></div>');
	equipChgWrap.append(equipChgBtnWrap);
	
	var equipChgButton = $('<button type="button" id="equipChgBtnSend" onClick="sendEquipNameChange(this);" class="btn btn-primary" disabled>완료</button>');
	equipChgBtnWrap.append(equipChgButton);

	return equipChgCon;
}


function sendEquipNameChange(btn) {
    
    var loginUserId = $(btn).closest(".form-sms").attr("data.loginUserId");
    var data_param = $(btn).closest(".form-sms").find("#equipChgMessage").val();

    pop.open('create', $(this), 'Pop_process_confirm2', 'loadEl.pop_process_confirm2("화상장비 이름 변경 프로세스를 실행 하시겠습니까?")');

    $("#btnConfirm").click(function(){
        chatui.sendEventMessage("videoEquipNameChange", {"userId" : loginUserId, "data_param" : data_param });
        $(btn).closest(".form-sms").find("#equipChgMessage").attr("disabled", true);
		$(btn).closest(".form-sms").find(".btn-wrap").css("display", "none");
        pop.close($('#btnConfirm'));
    });
}

//일정등록 Card 생성 함수
function makeScheduleRegCard(data) {
  var scheduleRegCard = $('<div class="message simple-text"></div>');
  var scheduleRegText = $('<p>새로운 일정을 등록하시려면 아래 버튼을 눌러주세요!</p>'
    + '<h6>※ 일정 등록 화면에서 회의실을 예약할 수 있어요.</h6>');
  scheduleRegCard.append(scheduleRegText);
  var regBtnWrap = $('<div class="btn"></div>');
  var regBtn = $('<button type="button" class="btn btn-emphasis add-schedule">일정 등록</button>');
  regBtn.on('click', function() {
    // addSchedulePopupOpen(data); // [퍼블 수정 및 추가] - 원본(데이터 없음으로 확인이 어려워 addSchedulePopupOpenRenew로 샘플작업)
    addSchedulePopupOpenRenew(data) // [퍼블 수정 및 추가] - 퍼블 작업용 샘플
  });
  regBtnWrap.append(regBtn);
  scheduleRegCard.append(regBtnWrap);

  if(checkChatHistory == false) {
    // addSchedulePopupOpen(data); // [퍼블 수정 및 추가] - 원본(데이터 없음으로 확인이 어려워 addSchedulePopupOpenRenew로 샘플작업)
    addSchedulePopupOpenRenew(data) // [퍼블 수정 및 추가] - 퍼블 작업용 샘플
  }
  
  return scheduleRegCard;
}

function makeLearningBotModeCard(data) {
  var learningBotCard = $('<div class="message simple-text"></div>');
  var learingBotText = $('<p>'+data.text+'</p>');
  learningBotCard.append(learingBotText);
  var regBtnWrap = $('<div class="btn"></div>');
  var regBtn = $('<button type="button" class="btn btn-emphasis add-schedule">학습봇 모드</button>');
  regBtn.on('click', function() {
    $('body').append('<div id="caas-chatbot-container"><iframe id="caas-chatbot-chat-iframe" name="caas-chatbot-chat-iframe" src="about:blank" allow="microphone; autoplay" allowusermedia="true" style="position: relative!important;height:100%!important;width: 100%!important;border: none!important;"></iframe></div>');

    if (!document.getElementById("caas-chatbot-chat-iframe").isLoaded) {
      document.getElementById("caas-chatbot-chat-iframe").isLoaded = true;
      openChatFrame();
    };
  });
  regBtnWrap.append(regBtn);
  learningBotCard.append(regBtnWrap);
  
  return learningBotCard;
}

function makeGptBotModeCard(data) {
  var learningBotCard = $('<div class="message simple-text"></div>');
  var learingBotText = $('<p>'+data.text+'</p>');
  learningBotCard.append(learingBotText);
  var regBtnWrap = $('<div class="btn"></div>');
  var regBtn = $('<button type="button" class="btn btn-emphasis add-schedule">GPT 모드</button>');
  regBtn.on('click', function() {
    activeGptBot("");
    
    // $('body').append('<div id="caas-chatbot-container"><iframe id="caas-chatbot-chat-iframe" name="caas-chatbot-chat-iframe" src="about:blank" allow="microphone; autoplay" allowusermedia="true" style="position: relative!important;height:100%!important;width: 100%!important;border: none!important;"></iframe></div>');
    
    // if (!document.getElementById("caas-chatbot-chat-iframe").isLoaded) {
    //   document.getElementById("caas-chatbot-chat-iframe").isLoaded = true;
    //   openChatFrame();
    // };
  });
  regBtnWrap.append(regBtn);
  learningBotCard.append(regBtnWrap);
  
  return learningBotCard;
}

/**
 * '날씨 정보 조회' 생성 함수 
 * @param {JSON} data 날씨 정보 조회 데이터
 */
 function makeWeatherCard(data, isHistory){
	var messageWeather = $('<div class="message"></div>');
	
	// wInfo
	if(data["listByTime"]) {
    var weatherToday = '';
    for(var i=0; i<data.listByTime.length; i++) {
       var todayTime = data.listByTime[i];
       weatherToday += '<li>'
          +'<span class="time">' + todayTime.time + '</span>'
          + '<div class="icon">'+ selectWeatherIcon(todayTime.symabol)+'</div>'
          +'<span class="tem">' + todayTime.temp +'°</span>'
       +'</li>';
    };

    lastMessage = '<div class="weather">'
    +'<div class="weather-header">'
       +'<div class="location">'
          +'<span class="icon">' + iconPlace + '</span>'
          +'<span class="address">'+ data.location + '</span>'
       +'</div>'
       +'<div class="source">'
          +'<span class="icon">'+ iconWarning +'</span>'
          +'<span class="address">출처</span>'
       +'</div>'
    +'</div>'

    +'<div class="weather-now">'
       +'<div class="icon">'
          + selectWeatherIcon(data.total.symbol)
          +'</div>'
          +'<h1 class="w-h1">' + data.total.temp_now + '<span class="sup">°C</span></h1>'
       + '<div class="high-low-rain">'
          + '<span class="hign-low">' + data.total.temp_min +'° / ' + data.total.temp_max +'°</span>'
          + '<span class="rain">강수확률 : ' + data.total.rain+'%</span>'
       +'</div>'
    +'</div>'

    +'<div class="weather-future">'
       +'<ul>'
          + weatherToday      
       +'</ul>'
    +'</div>'
    + '<div class="dust">'
       +'<div><span class="fine">미세먼지</span><span class="status-red">나쁨 49</span></div>'
       +'<div><span class="ultra">초미세먼지</span><span class="status-green">보통 20</span></div>'
    +'</div>'
 +'</div>';
 }

 else if(data["weatherList"]) {
    var weatherToday2 = '';
    for(var i=0; i<data.weatherList.length; i++) {
       var todayTime2 = data.weatherList[i];
       weatherToday2 += '<li>'
          +'<span class="time">' + todayTime2.fcstTime + '시</span>'
          + '<div class="icon">'+ selectWeatherIcon2(todayTime2.sky, todayTime2.pty)+'</div>'
          +'<span class="tem">' + todayTime2.t1h+'°</span>'
       +'</li>';
    };


    var lastMessage = $('<div class="weather">'
    +'<div class="weather-header">'
       +'<div class="location">'
          +'<span class="icon">' + iconPlace + '</span>'
          +'<span class="address">'+ data.local1 + data.local2 + '</span>'
       +'</div>'
       +'<a class="source" href="'+ data.url +'" target="_blank">'
          +'<span class="icon">'+ iconWarning +'</span>'
          +'<span class="address">출처</span>'
       +'</a>'
    +'</div>'

    +'<div class="weather-now">'
       +'<div class="icon">'
          + selectWeatherIcon2(data.todaySky, null)
          +'</div>'
          +'<h1 class="w-h1">' + data.t1h + '<span class="sup">°C</span></h1>'
       + '<div class="high-low-rain">'
          + '<span class="hign-low">' + data.tmn +'° / ' + data.tmx +'°</span>'
          + '<span class="rain">강수확률 : ' + data.todayPop +'%</span>'
       +'</div>'
    +'</div>'

    +'<div class="weather-future">'
       +'<ul>'
          + weatherToday2      
       +'</ul>'
    +'</div>'
    + '<div class="dust">'
       +'<div><span class="fine">미세먼지</span>'+pm10Select(data)+'</div>'
       +'<div><span class="ultra">초미세먼지</span>'+pm25Select(data)+'</div>'
    +'</div>'
 +'</div>');
 }
 

 messageWeather.append(lastMessage);
return messageWeather;
    
}


/**
 * 'SMS발송 공통 카드 생성' 함수
 * @param {object} SMS 형 응답 데이터
 */
 function makeSmsSendCardNew(data) {
  var smsCard = $('<div class="message simple-text"></div>');
  var smsText = $('<p>SMS를 발송하시려면 아래 버튼을 눌러주세요!</p>');
  smsCard.append(smsText);
  if(checkChatHistory == false) {
    sendSMSPopupOpen(data);
  }

  var smsBtns = $('<div class="btns"></div>')
  var smsBtn = $('<button type="button" class="btn btn-emphasis">SMS 발송</button>');
  smsBtn.on('click', function() {
    sendSMSPopupOpen(data);
  })

  smsBtns.append(smsBtn);
  smsCard.append(smsBtns); 

  return smsCard;
}

/** 
 * 메일 연결
 * @param {string} receiverMail 수신자메일
 *        {string} mailServer 수신자 메일서버
**/
function connectEmail(message) {
    
  console.log('email : ' + JSON.stringify(message))
  window.open(message.items, "_blank", "top=10, left=10, width=1100, height=800, status=no, menubar=no, toolbar=no, resizable=no");
  var message = $('<div class="message caas-chat-response-message-back-color caas-chat-response-message-font-color"></div>');
  var messageBasic = $('<div class="basic"></div>');
  message.append(messageBasic);
  
  var contents = $('<div class="message-content" style="white-space: pre-line">메일 발송을 위한 팝업을 안내합니다.</div>');
  messageBasic.append(contents)
  
  return message;

}


function makeHelpCard() {
  searchActive2 = true;
  var helpWarper = $('<div class="message spring-board"></div>');
    var help1 = $('<ul class="three"></ul>');

    var btn1 =  $('<li class="send-message" data-message="주요 업무">'
    + '<span class="file-icon">'
    +     '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
    +     '<path fill-rule="evenodd" clip-rule="evenodd" d="M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12ZM12 9C12.5523 9 13 8.55228 13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8C11 8.55228 11.4477 9 12 9ZM12 10.5C11.5858 10.5 11.25 10.8358 11.25 11.25V15.75C11.25 16.1642 11.5858 16.5 12 16.5C12.4142 16.5 12.75 16.1642 12.75 15.75V11.25C12.75 10.8358 12.4142 10.5 12 10.5Z" fill="#6B6B6B"/>'
    +     '</svg>'
    +   '</span>'
    +   '<p>주요 업무</p>'
    + '</li>');
    btn1.on('click', function() {
      var dataMessage = $(this).data('message');
      chatui.sendMessage(dataMessage);
    });
    help1.append(btn1);

    var btn2 = $('<li class="send-message" data-message="PC/Mobile, Cloud, 시스템">'
      +   '<span class="file-icon">'
      +     '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +       '<path fill-rule="evenodd" clip-rule="evenodd" d="M5 5C5 3.34315 6.34315 2 8 2H16C17.6569 2 19 3.34315 19 5V19C19 20.6569 17.6569 22 16 22H8C6.34315 22 5 20.6569 5 19V5ZM11.0004 4.19971C10.669 4.19971 10.4004 4.46834 10.4004 4.79971C10.4004 5.13108 10.669 5.39971 11.0004 5.39971H13.0004C13.3318 5.39971 13.6004 5.13108 13.6004 4.79971C13.6004 4.46834 13.3318 4.19971 13.0004 4.19971H11.0004ZM13.0005 18.5C13.0005 19.0523 12.5528 19.5 12.0005 19.5C11.4482 19.5 11.0005 19.0523 11.0005 18.5C11.0005 17.9477 11.4482 17.5 12.0005 17.5C12.5528 17.5 13.0005 17.9477 13.0005 18.5Z" fill="#6B6B6B"/>'
      +      '</svg>'
      +   '</span>'
      +   '<p>PC/Mobile,<br />Cloud, 시스템</p>'
      + '</li>');
    btn2.on('click', function() {
      var dataMessage = $(this).data('message');
      appendQueryText(dataMessage);
      chatui.sendEventMessage('it_cloud');
    });
    help1.append(btn2);

    var btn3 = $('<li class="send-message" data-message="시스템 담당자 검색">'
      +   '<span class="file-icon">'
      +     '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +     '<path fill-rule="evenodd" clip-rule="evenodd" d="M7 20.9781V21C7 21.5523 6.55228 22 6 22H3C2.44772 22 2 21.5523 2 21V13C2 12.4477 2.44772 12 3 12H6C6.55228 12 7 12.4477 7 13V13.155C8.23756 12.5171 9.65573 12.2677 11.0502 12.4669L11.6175 12.548C11.9203 12.5912 12.2258 12.6129 12.5316 12.6129H13.8209C14.8589 12.6129 15.7004 13.4544 15.7004 14.4924C15.7004 14.5495 15.6979 14.606 15.6929 14.6618L19.3964 13.1187C20.3086 12.7386 21.3593 13.1295 21.8012 14.0134C22.215 14.8409 21.9652 15.8464 21.2124 16.3842L16.5389 19.7224C15.3955 20.5391 14.0255 20.9781 12.6204 20.9781H7ZM7 14.5462V19.7781H12.6204C13.7754 19.7781 14.9016 19.4172 15.8414 18.7459L20.5149 15.4077C20.7872 15.2132 20.8776 14.8494 20.7279 14.55C20.568 14.2303 20.1879 14.0889 19.8579 14.2264L15.7642 15.9321C15.2533 16.145 14.7151 16.2821 14.1667 16.3402C14.0546 16.361 13.939 16.3719 13.8209 16.3719H9.98243C9.65105 16.3719 9.38243 16.1033 9.38243 15.7719C9.38243 15.4406 9.65105 15.1719 9.98243 15.1719H13.565C13.7046 15.1719 13.8439 15.1655 13.9825 15.1526C14.2798 15.0801 14.5004 14.812 14.5004 14.4924C14.5004 14.1172 14.1962 13.8129 13.8209 13.8129H12.5316C12.169 13.8129 11.8068 13.7872 11.4478 13.7359L10.8805 13.6549C9.52429 13.4611 8.13596 13.7847 7 14.5462Z" fill="#6B6B6B"/>'
      +     '<path fill-rule="evenodd" clip-rule="evenodd" d="M11.4623 2C11.0146 2 10.6243 2.30471 10.5157 2.73905L10.3806 3.27973C10.3331 3.46944 10.1913 3.62044 10.0107 3.6953C9.83005 3.77015 9.62453 3.76296 9.45686 3.66236L8.97786 3.37496C8.59395 3.14461 8.10253 3.20511 7.78595 3.52169L7.02351 4.28413C6.70693 4.60071 6.64644 5.09212 6.87678 5.47603L7.16192 5.95127C7.26303 6.11978 7.27009 6.32638 7.19462 6.50783C7.11937 6.68879 6.96798 6.83081 6.77785 6.87835L6.23905 7.01305C5.80471 7.12163 5.5 7.51189 5.5 7.95961V9.03786C5.5 9.48557 5.80471 9.87583 6.23905 9.98441L6.77015 10.1172C6.96225 10.1652 7.11504 10.309 7.19071 10.4919C7.26625 10.6746 7.259 10.8823 7.1573 11.0518L6.98616 11.3371C7.15034 11.5135 7.25003 11.7457 7.25003 12V12.155C8.54948 11.5171 10.0386 11.2677 11.5028 11.4669L12.0984 11.548C12.4164 11.5912 12.7371 11.6129 13.0583 11.6129H14.412C15.4393 11.6129 16.2833 12.3605 16.3769 13.3155L16.9765 12.7159C17.2931 12.3993 17.3536 11.9079 17.1233 11.524L16.8441 11.0587C16.7418 10.8882 16.7346 10.6791 16.8108 10.4953C16.8869 10.3115 17.0405 10.1671 17.2335 10.1188L17.7609 9.98695C18.1953 9.87837 18.5 9.48811 18.5 9.0404V7.96215C18.5 7.51443 18.1953 7.12417 17.7609 7.01559L17.2281 6.88238C17.0368 6.83456 16.8846 6.6916 16.8089 6.50952C16.7331 6.32709 16.7402 6.11942 16.8419 5.95002L17.1252 5.4778C17.3555 5.09389 17.2951 4.60248 16.9785 4.2859L16.216 3.52346C15.8995 3.20688 15.408 3.14638 15.0241 3.37673L14.5477 3.66257C14.3797 3.76338 14.1737 3.77056 13.9927 3.69553C13.8117 3.6205 13.6697 3.46922 13.6221 3.27915L13.4871 2.73905C13.3785 2.30471 12.9883 2 12.5406 2H11.4623ZM14.6043 8.50456C14.6043 9.94152 13.4394 11.1064 12.0025 11.1064C10.5655 11.1064 9.40063 9.94152 9.40063 8.50456C9.40063 7.0676 10.5655 5.90272 12.0025 5.90272C13.4394 5.90272 14.6043 7.0676 14.6043 8.50456ZM13.8238 8.50456C13.8238 9.51043 13.0083 10.3258 12.0025 10.3258C10.9966 10.3258 10.1812 9.51043 10.1812 8.50456C10.1812 7.49869 10.9966 6.68327 12.0025 6.68327C13.0083 6.68327 13.8238 7.49869 13.8238 8.50456Z" fill="#6B6B6B"/>'
      +     '</svg>'
      +   '</span>'
      +   '<p>시스템 담당자<br />검색</p>'
      + '</li>');

    btn3.on('click', function() {
      searchActiveFalse();
      searchActiveSystem();
      searchActive2 = true;
      setTimeout(function() {
        searchActive2 = false;
      }, 500)
    });
    help1.append(btn3);
    helpWarper.append(help1);

    var help2 = $('<ul class="three"></ul>');
    var btn4 = $('<li class="send-message" data-message="Daily 및 이벤트 알림">'
      +   '<span class="file-icon">'
      +     '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +     '<path d="M12.0004 2C12.3318 2 12.6004 2.26863 12.6004 2.6V4.02533C16.1849 4.33023 18.9992 7.3364 18.9992 10.9999V12.9007C18.9992 14.0391 19.2722 15.1609 19.7952 16.1721L19.8817 16.3394C20.3914 17.3248 19.6762 18.4999 18.5669 18.4999H5.43153C4.3222 18.4999 3.60702 17.3248 4.11667 16.3394L4.20325 16.1721C4.72626 15.1609 4.99921 14.0391 4.99921 12.9007V10.9999C4.99921 7.3356 7.81471 4.32891 11.4004 4.02513V2.6C11.4004 2.26863 11.669 2 12.0004 2Z" fill="#2C2C2C"/>'
      +     '<path d="M11.9995 21.9999C10.513 21.9999 9.27904 20.9187 9.04102 19.4999H14.9581C14.72 20.9187 13.486 21.9999 11.9995 21.9999Z" fill="#2C2C2C"/>'
      +     '</svg>'
      +   '</span>'
      +   '<p>Daily 및<br />이벤트 알림</p>'
      + '</li>'
    );
    btn4.on('click', function() {
    var dataMessage = $(this).data('message');
    chatui.sendMessage(dataMessage);
    });
    help2.append(btn4);

     
    var btn5 = $('<li class="send-message" data-message="일정 및 회의실">'
      +   '<span class="file-icon">'
      +     '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +     '<path fill-rule="evenodd" clip-rule="evenodd" d="M21 10H3V19C3 20.6569 4.34315 22 6 22H18C19.6569 22 21 20.6569 21 19V10ZM17.4 14.5999L15.893 14.5999C15.5617 14.5999 15.293 14.3313 15.293 13.9999C15.293 13.6685 15.5617 13.3999 15.893 13.3999L17.4 13.3999C17.7314 13.3999 18 13.6685 18 13.9999C18 14.3313 17.7314 14.5999 17.4 14.5999ZM12.8791 14.5999L11.1209 14.5999C10.7896 14.5999 10.5209 14.3313 10.5209 13.9999C10.5209 13.6685 10.7896 13.3999 11.1209 13.3999L12.8791 13.3999C13.2104 13.3999 13.4791 13.6685 13.4791 13.9999C13.4791 14.3313 13.2104 14.5999 12.8791 14.5999ZM6.6 14.5999L8.10698 14.5999C8.43835 14.5999 8.70698 14.3313 8.70698 13.9999C8.70698 13.6685 8.43835 13.3999 8.10698 13.3999L6.6 13.3999C6.26863 13.3999 6 13.6685 6 13.9999C6 14.3313 6.26863 14.5999 6.6 14.5999ZM11.1209 17.5999L12.8791 17.5999C13.2104 17.5999 13.4791 17.3313 13.4791 16.9999C13.4791 16.6685 13.2104 16.3999 12.8791 16.3999L11.1209 16.3999C10.7896 16.3999 10.5209 16.6685 10.5209 16.9999C10.5209 17.3313 10.7896 17.5999 11.1209 17.5999ZM8.10698 17.5999L6.6 17.5999C6.26863 17.5999 6 17.3313 6 16.9999C6 16.6685 6.26863 16.3999 6.6 16.3999L8.10698 16.3999C8.43835 16.3999 8.70698 16.6685 8.70698 16.9999C8.70698 17.3313 8.43835 17.5999 8.10698 17.5999Z" fill="#6B6B6B"/>'
      +     '<path fill-rule="evenodd" clip-rule="evenodd" d="M7.39999 2.6C7.39999 2.26863 7.66862 2 7.99999 2C8.33137 2 8.59999 2.26863 8.59999 2.6V4H15.4V2.6C15.4 2.26863 15.6686 2 16 2C16.3314 2 16.6 2.26863 16.6 2.6V4H18C19.6569 4 21 5.34315 21 7V9H3V7C3 5.34315 4.34315 4 6 4H7.39999V2.6Z" fill="#6B6B6B"/>'
      +     '</svg>'
      +   '</span>'
      +   '<p>일정 및<br />회의실</p>'
      + '</li>');
    btn5.on('click', function() {
      var dataMessage = $(this).data('message');
      chatui.sendMessage(dataMessage);
    });
    help2.append(btn5);

    var btn6 = $('<li class="send-message" data-message="케미 메뉴 안내">'
      +   '<span class="file-icon">'
      +    '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +     '<path fill-rule="evenodd" clip-rule="evenodd" d="M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12ZM10.6004 9.53969C10.6004 8.81698 11.2097 8.2 12.0004 8.2C12.791 8.2 13.4004 8.81698 13.4004 9.53969C13.4004 10.0078 13.1487 10.4274 12.753 10.6695C12.4603 10.8487 12.1349 11.0876 11.8773 11.3922C11.6171 11.6996 11.4004 12.1059 11.4004 12.6C11.4004 12.9314 11.669 13.2 12.0004 13.2C12.3318 13.2 12.6004 12.9314 12.6004 12.6C12.6004 12.4752 12.6526 12.3337 12.7934 12.1673C12.9366 11.9979 13.1442 11.837 13.3794 11.6931C14.1064 11.2482 14.6004 10.4541 14.6004 9.53969C14.6004 8.11987 13.4189 7 12.0004 7C10.5819 7 9.40039 8.11987 9.40039 9.53969C9.40039 9.87106 9.66902 10.1397 10.0004 10.1397C10.3318 10.1397 10.6004 9.87106 10.6004 9.53969ZM12.0004 16.4999C12.5527 16.4999 13.0004 16.0522 13.0004 15.4999C13.0004 14.9476 12.5527 14.4999 12.0004 14.4999C11.4481 14.4999 11.0004 14.9476 11.0004 15.4999C11.0004 16.0522 11.4481 16.4999 12.0004 16.4999Z" fill="#6B6B6B"/>'
      +     '</svg>'
      +   '</span>'
      +   '<p>케미<br />메뉴 안내</p>'
      + '</li>');
    btn6.on('click', function() {
      var dataMessage = $(this).data('message');
      chatui.sendMessage(dataMessage);
    });
    help2.append(btn6);    
    helpWarper.append(help2);

    var help3 = $('<ul class="three"></ul>');
    var btn7 = $('<li class="send-message" data-message="임직원 그룹사 검색">'
      +   '<span class="file-icon">'
      +     '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +        '<path fill-rule="evenodd" clip-rule="evenodd" d="M5 5C5 3.34315 6.34315 2 8 2H18C19.6569 2 21 3.34315 21 5V19C21 20.6569 19.6569 22 18 22H8C6.34315 22 5 20.6569 5 19V16.9998H3.6C3.26863 16.9998 3 16.7312 3 16.3998C3 16.0684 3.26863 15.7998 3.6 15.7998H5V8.2H3.6C3.26863 8.2 3 7.93137 3 7.6C3 7.26863 3.26863 7 3.6 7H5V5ZM15 9.5C15 10.6046 14.1046 11.5 13 11.5C11.8954 11.5 11 10.6046 11 9.5C11 8.39543 11.8954 7.5 13 7.5C14.1046 7.5 15 8.39543 15 9.5ZM13.8 9.5C13.8 9.94183 13.4418 10.3 13 10.3C12.5582 10.3 12.2 9.94183 12.2 9.5C12.2 9.05817 12.5582 8.7 13 8.7C13.4418 8.7 13.8 9.05817 13.8 9.5ZM9 15.6C9 13.6118 10.6118 12 12.6 12H13.4C15.3882 12 17 13.6118 17 15.6V15.7C17 16.0314 16.7314 16.3 16.4 16.3C16.0686 16.3 15.8 16.0314 15.8 15.7V15.6C15.8 14.2745 14.7255 13.2 13.4 13.2H12.6C11.2745 13.2 10.2 14.2745 10.2 15.6V15.7C10.2 16.0314 9.93137 16.3 9.6 16.3C9.26863 16.3 9 16.0314 9 15.7V15.6Z" fill="#6B6B6B"/>'
      +     '</svg>'
      +   '</span>'
      +   '<p>임직원 그룹사<br />검색</p>'
      + '</li>');
    btn7.on('click', function() {
      searchActiveFalse();
      searchActiveEmployee();
      searchActive2 = true;
      setTimeout(function() {
        searchActive2 = false;
      }, 500);
    });
    help3.append(btn7);

    var btn8 = $('<li class="send-message" data-message="장소/용어 검색">'
      +   '<span class="file-icon">'
      +   '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +     '<path fill-rule="evenodd" clip-rule="evenodd" d="M16.0711 16.9199C14.5792 18.2157 12.6312 19 10.5 19C5.80558 19 2 15.1944 2 10.5C2 5.80558 5.80558 2 10.5 2C15.1944 2 19 5.80558 19 10.5C19 12.6313 18.2156 14.5794 16.9197 16.0714L21.824 20.9757C22.0583 21.21 22.0583 21.5899 21.824 21.8242C21.5897 22.0586 21.2098 22.0586 20.9755 21.8242L16.0711 16.9199Z" fill="#6B6B6B"/>'
      +  '</svg>'
      +   '</span>'
      +   '<p>장소/용어<br />검색</p>'
      + '</li>');
    btn8.on('click', function() {
      var dataMessage = $(this).data('message');
      chatui.sendMessage(dataMessage);
    });
    help3.append(btn8);    
    
    var btn9 = $('<li class="send-message" data-message="AI 검색">'
      +   '<span class="file-icon">'
      +   '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +'<path fill-rule="evenodd" clip-rule="evenodd" d="M7.15994 20.5521C7.0716 20.9065 6.73934 21.1287 6.41781 21.0485C6.09628 20.9684 5.90724 20.6161 5.99558 20.2618L7.28976 15.0712L3.60071 15.0712C3.26895 15.0712 3 14.8025 3 14.4712C3 14.1398 3.26895 13.8712 3.60071 13.8712H7.58895L8.78573 9.07117L4.60071 9.07117C4.26895 9.07117 4 8.80254 4 8.47117C4 8.1398 4.26895 7.87117 4.60071 7.87117L9.08492 7.87117L10.4209 2.51274C10.5093 2.15843 10.8415 1.93619 11.1631 2.01636C11.4846 2.09653 11.6736 2.44874 11.5853 2.80305L10.3217 7.87117L16.2493 7.87117L17.5853 2.51274C17.6736 2.15843 18.0059 1.93619 18.3274 2.01636C18.649 2.09653 18.838 2.44874 18.7497 2.80305L17.486 7.87117L21.2203 7.87117C21.5521 7.87117 21.821 8.1398 21.821 8.47117C21.821 8.80254 21.5521 9.07117 21.2203 9.07117L17.1868 9.07117L15.9901 13.8712L20.2203 13.8712C20.5521 13.8712 20.821 14.1398 20.821 14.4712C20.821 14.8025 20.5521 15.0712 20.2203 15.0712L15.6909 15.0712L14.3243 20.5521C14.236 20.9065 13.9037 21.1287 13.5822 21.0485C13.2606 20.9684 13.0716 20.6161 13.16 20.2618L14.4541 15.0712L8.5265 15.0712L7.15994 20.5521ZM8.82569 13.8712H14.7533L15.9501 9.07117L10.0225 9.07117L8.82569 13.8712Z" fill="#6B6B6B"/>'
      +'</svg>'
      +   '</span>'
      +   '<p>AI 검색</p>'
      + '</li>');
    btn9.on('click', function() {
      searchActiveFalse();
      searchActiveMrc(); 
      searchActive2 = true;
      setTimeout(function() {
        searchActive2 = false;
      }, 500)  
    })
     
    help3.append(btn9);  
    helpWarper.append(help3);

    var help4 = $('<ul class="three"></ul>');
    var btn10 = $('<li class="send-message" data-message="표준문서검색">'
      +   '<span class="file-icon">'
      +     '<svg width="24" height="24" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +        '<path d="M11.9242 9.02426C12.1585 8.78995 12.1585 8.41005 11.9242 8.17574C11.6899 7.94142 11.31 7.94142 11.0756 8.17574L7.1254 12.126L4.92409 9.92543C4.68974 9.69116 4.30984 9.69122 4.07556 9.92558C3.84129 10.1599 3.84136 10.5398 4.07571 10.7741L6.70129 13.3988C6.93562 13.633 7.31546 13.633 7.54974 13.3987L11.9242 9.02426Z" fill="#2C2C2C"/>'
      +        '<path fill-rule="evenodd" clip-rule="evenodd" d="M4 1.5C4 0.671573 4.67157 0 5.5 0H10.5C11.3284 0 12 0.671573 12 1.5H13C13.0647 1.5 13.129 1.50205 13.1927 1.50609L13.2 1.50656C14.7636 1.60948 16 2.91035 16 4.5V17C16 18.6569 14.6569 20 13 20H3C1.34315 20 0 18.6569 0 17V4.5C0 2.9467 1.1805 1.66912 2.69327 1.51549C2.72867 1.51189 2.76425 1.50891 2.8 1.50656C2.8661 1.50221 2.93279 1.5 3 1.5H4ZM5.5 1.2H10.5C10.6657 1.2 10.8 1.33431 10.8 1.5V2.5C10.8 2.66569 10.6657 2.8 10.5 2.8H5.5C5.33431 2.8 5.2 2.66569 5.2 2.5V1.5C5.2 1.33431 5.33431 1.2 5.5 1.2ZM4.01205 2.69105C4.01243 2.69403 4.01282 2.69702 4.01322 2.7H3C2.93787 2.7 2.87647 2.70315 2.81596 2.70929L2.80811 2.71011C1.90422 2.80589 1.2 3.57071 1.2 4.5V17C1.2 17.9941 2.00589 18.8 3 18.8H13C13.9941 18.8 14.8 17.9941 14.8 17V4.5C14.8 3.63015 14.183 2.90441 13.3628 2.73657C13.3067 2.7251 13.2497 2.71623 13.1919 2.71011C13.1288 2.70343 13.0648 2.7 13 2.7H11.9868C11.889 3.43387 11.2606 4 10.5 4H5.5C4.73629 4 4.10589 3.42926 4.01205 2.69105Z" fill="#2C2C2C"/>'
      +     '</svg>'
      +   '</span>'
      +   '<p>표준문서<br />검색</p>'
      + '</li>');
    btn10.on('click', function() {
      searchActiveFalse();
      searchActiveStandard();
      searchActive2 = true;
      setTimeout(function() {
        searchActive2 = false;
      }, 500);
    });
    help4.append(btn10);
    helpWarper.append(help4);

    return helpWarper;
};


function changeMrcRateOpen(id) {
  $('#mrc-id-' + id).find('.rate-select').addClass('show');
}

function showMrcDetail(id) {
  if($('#mrc-id-' + id).hasClass('closed-mrc')) {
    $('#mrc-id-' + id).removeClass('closed-mrc');
  } else {
    $('#mrc-id-' + id).addClass('closed-mrc');
  }
  
}

function changeMrcRate(number, id) {
  var requestParam = {
    query: {
			"event": "feedback_event"
		},
		payload: {
			"feedback": number,
      "session_id": id
		}
  }
  sendChatApi(requestParam, null, function(payload) {
    $('#mrc-id-' + id).find('.rate').remove();
    if(number == 1) {
      $('#mrc-id-' + id).find('.rate-please').append('<span class="rate">' + iconZero + "전혀 달라요." + '</span>');
    } else if(number == 3) {
      $('#mrc-id-' + id).find('.rate-please').append('<span class="rate">' + iconOne + "정확해요!" + '</span>');
    } else if(number == 2) {
      $('#mrc-id-' + id).find('.rate-please').append('<span class="rate">' + iconTwo + "애매해요." + '</span>');
    }
    $('#mrc-id-' + id).find('.rate-select').removeClass('show');
  });
  //chatui.sendEventMessage("feedback_event", {"session_id":id, "feedback":number});
 
}

function escapeRegExp(string) {
  return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
}

function boldString(str, substr) {
  str = str.replace(/\u00a0/g, " ").trim();
  substr = substr.replace(/\u00a0/g, " ").trim();
  
  var strRegExp = new RegExp(escapeRegExp(substr), "ig");
  var result = str.replace(strRegExp, function($1) {
    return "<b>" + $1 + "</b>";
  });

  return result;
}

function makeMrcListCard(data) {
  var mrcResultUl = $('<ul></ul>');
  var isMobile = Mobile();
    if (data.items && data.items.length > 0) {
        for (let i = 0; i < data.items.length; i++) {
            var item = data.items[i];
            var mrcResultLi = '<li class="list-box closed-mrc" id="mrc-id-' + item.sessionId + '">';
            if (i > 3) {
                mrcResultLi = '<li class="list-box closed-mrc disp-none" id="mrc-id-' + item.sessionId + '">';
            };
            mrcResultLi += '<h1 onclick="showMrcDetail(' + item.sessionId + ')">' + item.filename + '</h1>';
            mrcResultLi += '<p class="category-date" onclick="showMrcDetail(' + item.sessionId + ')"><span class="cabinet-name">' + item.cabinetName + '</span>' + ' · ' + item.date + '</p>';
            mrcResultLi += '<span class="arrow" onclick="showMrcDetail(' + item.sessionId + ')"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">';
            mrcResultLi += '<path fill-rule="evenodd" clip-rule="evenodd" d="M7.60177 10.3805C7.8291 10.5825 8.17167 10.5825 8.399 10.3805L13.7346 5.63769C13.8998 5.49092 14.1526 5.50579 14.2994 5.67091C14.4461 5.83602 14.4312 6.08885 14.2661 6.23562L8.9305 10.9784C8.40005 11.4499 7.60072 11.4499 7.07028 10.9784L1.73464 6.23562C1.56953 6.08885 1.55466 5.83602 1.70142 5.67091C1.84819 5.50579 2.10102 5.49092 2.26613 5.63769L7.60177 10.3805Z" fill="#A5A5A5"/>';
            mrcResultLi += '</svg></span>';
            mrcResultLi += '<div class="mrc-rate" onclick="changeMrcRateOpen(' + item.sessionId + ')">';
            mrcResultLi += '<span class="rate-please">';
            mrcResultLi += '<span class="rate">' + iconRate + "평가하기" + '</span>';
            // + (item.rate === null ? '<span class="rate">' + iconRate + "평가하기" + '</span>' : '')
            // + (item.rate === 0 ? '<span class="rate">' + iconZero + "전혀 달라요." + '</span>' : '')
            // + (item.rate === 1 ? '<span class="rate">' + iconOne + "정확해요!" + '</span>' : '')
            // + (item.rate === 2 ? '<span class="rate">' + iconTwo + "애매해요." + '</span>' : '')
            mrcResultLi += '<span class="rate-tooltip">찾으시던 내용이 맞나요?</span></span>';
            mrcResultLi += '</div>';
            mrcResultLi += '<div class="rate-select">';
            mrcResultLi += '<ul>';
            mrcResultLi += '<li><span class="rate-one" onclick="changeMrcRate(3,' + item.sessionId + ')">' + iconOne + '정확해요!</span></li>';
            mrcResultLi += '<li><span class="rate-two" onclick="changeMrcRate(2,' + item.sessionId + ')">' + iconTwo + '애매해요.</span></li>';
            mrcResultLi += '<li><span class="rate-zero" onclick="changeMrcRate(1,' + item.sessionId + ')">' + iconZero + '전혀 달라요.</span></li>';
            mrcResultLi += '</ul>';
            mrcResultLi += '</div>';
            mrcResultLi += '<div class="mrc-more">';

            var contents = boldString(item.content, item.sentence);


            mrcResultLi += '<div class="mrc-contents">' + contents + '</div>';
            if (!isMobile) {
                mrcResultLi += '<div class="mrc-btns">';
                mrcResultLi += '<a href="' + item.property_url + '"' + ' class="btn btn-text btn-mrc-info" target="_blank">문서 정보 조회 ';
                mrcResultLi += '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">';
                mrcResultLi += '<path d="M9.53353 2.06797C9.53353 1.84705 9.71261 1.66797 9.93353 1.66797H12.9335C13.7067 1.66797 14.3335 2.29477 14.3335 3.06797V6.06797C14.3335 6.28888 14.1544 6.46797 13.9335 6.46797C13.7126 6.46797 13.5335 6.28888 13.5335 6.06797V3.06797C13.5335 3.05676 13.5332 3.04562 13.5326 3.03457L7.94977 8.61741C7.79356 8.77362 7.54029 8.77362 7.38408 8.61741C7.22787 8.4612 7.22787 8.20794 7.38408 8.05173L12.9669 2.46888C12.9559 2.46828 12.9447 2.46797 12.9335 2.46797H9.93353C9.71261 2.46797 9.53353 2.28888 9.53353 2.06797Z" fill="#2C2C2C"/>';
                mrcResultLi += '<path d="M3.66699 3.13464C3.00425 3.13464 2.46699 3.67189 2.46699 4.33464V12.3346C2.46699 12.9974 3.00425 13.5346 3.66699 13.5346H11.667C12.3297 13.5346 12.867 12.9974 12.867 12.3346V9.00124C12.867 8.78032 13.0461 8.60124 13.267 8.60124C13.4879 8.60124 13.667 8.78032 13.667 9.00124V12.3346C13.667 13.4392 12.7716 14.3346 11.667 14.3346H3.66699C2.56242 14.3346 1.66699 13.4392 1.66699 12.3346V4.33464C1.66699 3.23007 2.56242 2.33464 3.66699 2.33464H7.00032C7.22124 2.33464 7.40032 2.51372 7.40032 2.73464C7.40032 2.95555 7.22124 3.13464 7.00032 3.13464H3.66699Z" fill="#2C2C2C"/>';
                mrcResultLi += '</svg>';
                mrcResultLi += '</a>';
                mrcResultLi += '<a href="' + item.file_url + '"' + ' class="btn btn-emphasis btn-mrc-link" target="_blank">문서 바로가기 ';
                mrcResultLi += '<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">';
                mrcResultLi += '<path d="M10.0335 2.06797C10.0335 1.84705 10.2126 1.66797 10.4335 1.66797H13.4335C14.2067 1.66797 14.8335 2.29477 14.8335 3.06797V6.06797C14.8335 6.28888 14.6544 6.46797 14.4335 6.46797C14.2126 6.46797 14.0335 6.28888 14.0335 6.06797V3.06797C14.0335 3.05676 14.0332 3.04562 14.0326 3.03457L8.44977 8.61741C8.29356 8.77362 8.04029 8.77362 7.88408 8.61741C7.72787 8.4612 7.72787 8.20794 7.88408 8.05173L13.4669 2.46888C13.4559 2.46828 13.4447 2.46797 13.4335 2.46797H10.4335C10.2126 2.46797 10.0335 2.28888 10.0335 2.06797Z" fill="#E0205C"/>';
                mrcResultLi += '<path d="M4.16699 3.13464C3.50425 3.13464 2.96699 3.67189 2.96699 4.33464V12.3346C2.96699 12.9974 3.50425 13.5346 4.16699 13.5346H12.167C12.8297 13.5346 13.367 12.9974 13.367 12.3346V9.00124C13.367 8.78032 13.5461 8.60124 13.767 8.60124C13.9879 8.60124 14.167 8.78032 14.167 9.00124V12.3346C14.167 13.4392 13.2716 14.3346 12.167 14.3346H4.16699C3.06242 14.3346 2.16699 13.4392 2.16699 12.3346V4.33464C2.16699 3.23007 3.06242 2.33464 4.16699 2.33464H7.50032C7.72124 2.33464 7.90032 2.51372 7.90032 2.73464C7.90032 2.95555 7.72124 3.13464 7.50032 3.13464H4.16699Z" fill="#E0205C"/>';
                mrcResultLi += '</svg>';
                mrcResultLi += '</a>';
                mrcResultLi += '</div>';
            }
            mrcResultLi += '</div>';
            mrcResultLi += '</li>';

            mrcResultLi = $(mrcResultLi);
            mrcResultUl.append(mrcResultLi);
        }
    }



    var mrcCard = $('<div class="mrc-list"></div>');
    var mrcHeader = $('<div class="list-header-title">' + listHeaderIcon + 'AI 문서 검색결과</div>');
    mrcCard.append(mrcHeader);
    mrcCard.append(mrcResultUl);

    var seeMore = $('<div class="see-more">'
        + '<svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
        + '<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
        + '</svg>더보기'
        + '</div>');

    if (data.items.length > 4) {
        mrcCard.append(seeMore);
    }
    var mrcMessage = $('<div class="message"></div>');
    mrcMessage.append(mrcCard);
    return mrcMessage;
}

function makeLawDutyHoursCard(data) {
  var messsageResult = $('<div class="custom-message"></div>');
  var itemFirst = data.items[0]['잔여기본근로'];
  if(itemFirst === 'NaN') {
    itemFirst = 0;
  };
  var itemSecond = data.items[0]['잔여법정근로'];
  if(itemSecond === 'NaN') {
    itemSecond = 0;
  }
  var messageFirst = $('<div class="message simple-text"><p><b>근무 시간 현황</b>을 안내해 드릴게요.</p></div>');
  messsageResult.append(messageFirst);
  var messageSecond = $('<div class="message item">'
  +'<h1>근무 시간 현황 (기본근로 기준)</h1>'
  +'<div class="item-box">'
  +'<ul>'
  +'<li><span class="label">기본근로</span><span class="data text-right">96 시간</span></li>'
  +'<li><span class="label">누적근로</span><span class="data text-right">'+ (96 - itemFirst )+' 시간</span></li>'
  +'<li class="bold"><span class="label">잔여</span><span class="data text-right">' + itemFirst + ' 시간</span></li>'
  +'</ul>'
  +'</div>'
  +'<p>※ 휴일을 제외한 누적근로 시간입니다.</p>'
  + '</div>');
  messsageResult.append(messageSecond);

  var messageThird = $('<div class="message item">'
  +'<h1>근무 시간 현황 (법정근로 기준)</h1>'
  +'<div class="item-box">'
  +'<ul>'
  +'<li><span class="label">최대근로</span><span class="data text-right">230 시간</span></li>'
  +'<li><span class="label">누적근로</span><span class="data text-right">'+ (230 - itemSecond )+' 시간</span></li>'
  +'<li class="bold"><span class="label">잔여</span><span class="data text-right">' + itemSecond + ' 시간</span></li>'
  +'</ul>'
  +'</div>'
  +'<p>※ 휴일을 포함한 누적근로 시간입니다.</p>'
  + '</div>');
  messsageResult.append(messageThird);

  return messsageResult;
}

function makeUseHolidayCard(data) {
  var messsageResult = $('<div class="custom-message"></div>');
  var itemFirst = data.items[0]['전체'];
  var itemSecond = data.items[0]['사용'];
  var itemThird = data.items[0]['미사용'];
  var messageFirst = $('<div class="message simple-text"><p><b>휴가 사용 현황</b>을 안내해 드릴게요.</p></div>');
  messsageResult.append(messageFirst);
  var messageSecond = $('<div class="message item">'
  +'<h1>휴가 사용 현황</h1>'
  +'<div class="item-box">'
  +'<ul>'
  +'<li><span class="label">전체</span><span class="data text-right">'+itemFirst+' 일</span></li>'
  +'<li><span class="label">사용</span><span class="data text-right">'+ itemSecond +' 일</span></li>'
  +'<li class="bold"><span class="label">미사용</span><span class="data text-right">' + itemThird +' 일</span></li>'
  +'</ul>'
  +'</div>'
  +'<p>휴가사용은 승인건을 기준으로 하며, 미래일자 승인건을 포함합니다.<br /><br />'

  +'근속 연차, 개근 연차만 해당합니다.<br />'
  +'(하계휴가와 보상휴가는 대상 제외)</p>'
  + '</div>');
  messsageResult.append(messageSecond);

  
  return messsageResult;
}


function makeTeamHolydayCard(data) {
  var messageResult = $('<div class="custom-message"></div>');
  var items = data.items;
  var itemLength = data.items.length;
  
  if(itemLength == 0) {
    var firstMessage = $('<div class="message simple-text"><p>오늘 우리 팀 내 휴가자는 <b>0</b>명입니다.</p><h6>※ '+moment().format('YYYY년 MM월 DD일') +'기준</h6></div>');
    messageResult.append(firstMessage);
  } else {
    var firstMessage = $('<div class="message simple-text"><p>오늘 우리 팀 내 휴가자는 총<b> '+ itemLength+'</b>명입니다.<br />아래의 휴가자 목록을 확인해 주세요.</p><h6>※ '+moment().format('YYYY년 MM월 DD일') +'기준</h6></div>')
    messageResult.append(firstMessage);
    var holydayList = $('<div class="message profile-list holyday"></div>');

    var listHeader = $('<div class="list-header-title">'
    + listHeaderIcon + '<span>우리 팀 <b>휴가</b> 사용자 목록</span>'
    +'</div>');
    holydayList.append(listHeader);

    var holydayUl = $('<ul></ul>');


    items.map((item, i) => {
      var holydayLi = $('<li class="list-box"></li>');
      if(i > 3) {
        holydayLi = $('<li class="list-box disp-none"></li>');
      }
      var textBox = $('<div class="text-box">'
      +'<div class="name">'
        + '<h1>' + item.empNmae + ' ' + '<span class="tag">' + item.type + '</span></h1>'
        + '<p>' + iconCalendar +'<span>'+ item.period +'</span></p>'
      +'</div">'
      +'</div>');
      holydayLi.append(textBox);
      holydayUl.append(holydayLi);
    });

    holydayList.append(holydayUl);

    if(itemLength > 4 ){
			var seeMore = $('<div class="see-more"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
      + '</svg>더보기</div>');
			
			seeMore.on('click', function() {
				$(this).parents('.profile-list').find('li').removeClass('disp-none');
        $(this).remove();
        descendScroll();
      });			

      holydayList.append(seeMore);
    }

    messageResult.append(holydayList);
  }
  

  return messageResult;


}


function makeFlexTimeCard(data) {
  var messageResult = $('<div class="custom-message"></div>');
  var items = data.items;
  var itemLength = data.items.length;

  if(itemLength == 0) {
    var firstMessage = $('<div class="message simple-text"><p>오늘 우리 팀 내 FlexTime 사용자는 <b>0</b>명입니다.</p><h6>※ '+moment().format('YYYY년 MM월 DD일') +'기준</h6></div>');
    messageResult.append(firstMessage);
  } else {
    var firstMessage = $('<div class="message simple-text"><p>오늘 우리 팀 내 FlexTime 사용자는 총 <b>'+itemLength+'</b>명입니다.<br />아래의 사용자 목록을 확인해 주세요.</p><h6>※ '+moment().format('YYYY년 MM월 DD일') +'기준</h6></div>');
    messageResult.append(firstMessage);
    var holydayList = $('<div class="message profile-list holyday"></div>');

    var listHeader = $('<div class="list-header-title">'
    + listHeaderIcon + '<span>오늘의 <b>Flextime</b> 사용자</span>'
    +'</div>');
    holydayList.append(listHeader);

    var holydayUl = $('<ul></ul>');


    items.map((item, i) => {
      var holydayLi = $('<li class="list-box"></li>');
      if(i > 3) {
        holydayLi = $('<li class="list-box disp-none"></li>');
      }
      var textBox = $('<div class="text-box">'
      +'<div class="name">'
        + '<h1>' + item.empNmae + '</h1>'
        + '<p>' + iconTime +'<span>'+ item.period +'</span></p>'
      +'</div">'
      +'</div>');
      holydayLi.append(textBox);
      holydayUl.append(holydayLi);
    });

    holydayList.append(holydayUl);

    if(itemLength > 4 ){
			var seeMore = $('<div class="see-more"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
      + '</svg>더보기</div>');
			
			seeMore.on('click', function() {
				$(this).parents('.profile-list').find('li').removeClass('disp-none');
        $(this).remove();
        descendScroll();
      });			

      holydayList.append(seeMore);
    }

    messageResult.append(holydayList);
  }
  

  return messageResult;


}


function makeEcmFavorieCard(data) {
  var items = data.items;
  console.log(data);
  var messageResult = $('<div class="custom-message"></div>');
  var firstMessage = $('<div class="message simple-text"><p>금일 ECM 업데이트 내역을 안내해 드릴게요.</p></div>');
  messageResult.append(firstMessage);

  var ecmListBox = $('<div class="message text-list ecm-list"></div>')
  var ecmListHeader = $('<div class="list-header-title">'+ listHeaderIcon + '<span>업데이트 목록</span></div>');
  ecmListBox.append(ecmListHeader);

  var ecmListUl = $('<ul></ul>');
  if(items.length == 0) {
    var ecmListLi = $('<li class="list-box no-result">업데이트 내역이 없습니다.</li>');
    ecmListUl.append(ecmListLi);
  }
  items.map((item, i) => {
    var ecmListLi = $('<li class="list-box"></li>');
    if(i > 3) {
      ecmListLi = $('<li class="list-box disp-none"></li>');
    }
    ecmListLi.on('click', function() {
      window.open(item.url, "_blank");
    })
    var ecmFileTitle = $('<h1>'+ item.fileNmae +'</h1>');
    ecmListLi.append(ecmFileTitle);
    var ecmCategory = $('<p class="modifier">'+ item.category +'</p>');
    ecmListLi.append(ecmCategory);
    var ecmUpdater = $('<p class="modifier">(수정자ID : ' + item.modifier +')</p>');
    ecmListLi.append(ecmUpdater); 
    var linkArrow = $('<span class="arrow">' + '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
    +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.3815 7.60177C10.5835 7.8291 10.5835 8.17167 10.3815 8.399L5.63867 13.7346C5.4919 13.8998 5.50677 14.1526 5.67188 14.2994C5.837 14.4461 6.08983 14.4312 6.23659 14.2661L10.9794 8.9305C11.4509 8.40005 11.4509 7.60072 10.9794 7.07028L6.23659 1.73464C6.08983 1.56953 5.837 1.55466 5.67188 1.70142C5.50677 1.84819 5.4919 2.10102 5.63867 2.26613L10.3815 7.60177Z" fill="#A5A5A5"/>'
    +'</svg>'
     + '</span>');
    ecmListLi.append(linkArrow);
    ecmListUl.append(ecmListLi);
  });

  ecmListBox.append(ecmListUl);

  if(items.length > 4) {
    var seeMore = $('<div class="see-more"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
      +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
      + '</svg>더보기</div>');
			
			
			seeMore.on('click', function() {
				$(this).parents('.ecm-list').find('li').removeClass('disp-none');
        $(this).remove();
        descendScroll();
      });			

      ecmListBox.append(seeMore);
  }

  messageResult.append(ecmListBox);

  return messageResult;
  
}


function makeNoticeCard(data) {
  var items = data.items;
 
  var messageResult = $('<div class="custom-message"></div>');
  var firstMessage = $('<div class="message simple-text"><p>최신 공지사항을 안내해 드릴게요.</p></div>');
  messageResult.append(firstMessage);

  var noticeListBox = $('<div class="message text-list notice-list"></div>')
  var noticeListHeader = $('<div class="list-header-title">'+ listHeaderIcon + '<span>전사 공지사항 목록</span></div>');
  noticeListBox.append(noticeListHeader);

  var noticeListUl = $('<ul></ul>');
  if(items.length == 0) {
    var noticeListLi = $('<li class="list-box no-result">새로운 공지사항이 없습니다.</li>');
    noticeListUl.append(noticeListLi);
  }

  items.map((item, i) => {
    var noticeListLi = $('<li class="list-box"></li>');
    noticeListLi.on('click', function() {
      window.open(item.noticeurl, "_blank");
    })
    var noticeFileTitle = $('<h1>'+ item.title +'</h1>');
    noticeListLi.append(noticeFileTitle);

    var itemDate = item.date.split(' ')[0]
    itemDate = moment(itemDate).format('YYYY.MM.DD');
    var noticeUpdater = $('<p class="category-date"><span class="cabinet-name">' + item.category + '</span>' + ' · ' + itemDate + '</p>');
    noticeListLi.append(noticeUpdater); 
    var linkArrow = $('<span class="arrow">' + '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
    +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.3815 7.60177C10.5835 7.8291 10.5835 8.17167 10.3815 8.399L5.63867 13.7346C5.4919 13.8998 5.50677 14.1526 5.67188 14.2994C5.837 14.4461 6.08983 14.4312 6.23659 14.2661L10.9794 8.9305C11.4509 8.40005 11.4509 7.60072 10.9794 7.07028L6.23659 1.73464C6.08983 1.56953 5.837 1.55466 5.67188 1.70142C5.50677 1.84819 5.4919 2.10102 5.63867 2.26613L10.3815 7.60177Z" fill="#A5A5A5"/>'
    +'</svg>'
     + '</span>');
    noticeListLi.append(linkArrow);
    noticeListUl.append(noticeListLi);
  });

  noticeListBox.append(noticeListUl);


  var isMobile = Mobile();
  if(!isMobile) {
    var linkToNoticeBox = $('<div class="btns"></div>');
    var linkToNotice = $('<button type="button" class="btn btn-default">공지 게시판 바로가기</button>');
    linkToNotice.on('click', function() {
      window.open(data.url, "_blank");
    });
  }
  
  linkToNoticeBox.append(linkToNotice);
  noticeListBox.append(linkToNoticeBox);

  messageResult.append(noticeListBox);

  return messageResult;
}

function makeDefaultFallbackCard(data) {
  searchActive2 = true;
  var customMessage = $('<div class="custom-message"></div>');
  var firstMessage = $('<div class="message simple-text"><p>' + data.text +'</p></div>');

  customMessage.append(firstMessage);

  var isMobile = Mobile();

  var defaultQuickReply = $('<div class="custom-quick-reply"></div>');
  var btnList = $('<div class="btn-list"></div>');
  
  var btnLearningBot = $('<span class="btn-custom-reply btn-text">학습봇 모드</span>');
  btnLearningBot.on('click', function() {
    $('body').append('<div id="caas-chatbot-container"><iframe id="caas-chatbot-chat-iframe" name="caas-chatbot-chat-iframe" src="about:blank" allow="microphone; autoplay" allowusermedia="true" style="position: relative!important;height:100%!important;width: 100%!important;border: none!important;"></iframe></div>');

    if (!document.getElementById("caas-chatbot-chat-iframe").isLoaded) {
      document.getElementById("caas-chatbot-chat-iframe").isLoaded = true;
      openChatFrame();
    };
  });

  btnList.append(btnLearningBot);
  
  var gptBotBtn = $('<span class="btn-custom-reply btn-text">Chat GPT</span>');
  gptBotBtn.on('click', function() {
    searchActiveFalse();
    activeGptBot("");
  });
  btnList.append(gptBotBtn);

  if(!isMobile) {
    var gportalSearchBtn =$('<span class="btn-custom-reply btn-icon btn-text search-ep-total">'
    +            '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
    +             '<path fill-rule="evenodd" clip-rule="evenodd" d="M10.7137 11.2806C9.71915 12.1444 8.42048 12.6673 6.99967 12.6673C3.87006 12.6673 1.33301 10.1303 1.33301 7.00065C1.33301 3.87104 3.87006 1.33398 6.99967 1.33398C10.1293 1.33398 12.6663 3.87104 12.6663 7.00065C12.6663 8.42154 12.1434 9.72028 11.2794 10.7149L14.549 13.9845C14.7052 14.1407 14.7052 14.3939 14.549 14.5501C14.3928 14.7064 14.1395 14.7064 13.9833 14.5501L10.7137 11.2806ZM11.8663 7.00065C11.8663 9.68844 9.68746 11.8673 6.99967 11.8673C4.31189 11.8673 2.13301 9.68844 2.13301 7.00065C2.13301 4.31287 4.31189 2.13398 6.99967 2.13398C9.68746 2.13398 11.8663 4.31287 11.8663 7.00065Z" fill="#E0205C"/>'
    +            '</svg>'
    +           'EP 통합 검색</span>');
    gportalSearchBtn.on('click', function() {
      searchActiveFalse();
      searchActiveEpTotal();
      searchActive2 = true;
      setTimeout(function() {
        searchActive2 = false;
      }, 500)
  
    });
    btnList.append(gportalSearchBtn);
  }

  /*
  var placeBtn = $('<span class="btn-custom-reply btn-icon btn-text search-place">'
  +            '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +              '<path fill-rule="evenodd" clip-rule="evenodd" d="M10.3337 6.66732C10.3337 7.95598 9.28899 9.00065 8.00033 9.00065C6.71166 9.00065 5.66699 7.95598 5.66699 6.66732C5.66699 5.37865 6.71166 4.33398 8.00033 4.33398C9.28899 4.33398 10.3337 5.37865 10.3337 6.66732ZM9.53366 6.66732C9.53366 7.51415 8.84716 8.20065 8.00033 8.20065C7.15349 8.20065 6.46699 7.51415 6.46699 6.66732C6.46699 5.82048 7.15349 5.13398 8.00033 5.13398C8.84716 5.13398 9.53366 5.82048 9.53366 6.66732Z" fill="#E0205C"/>'
  +              '<path fill-rule="evenodd" clip-rule="evenodd" d="M11.7716 10.6673C11.1662 11.5688 9.65546 13.3358 8.74038 14.3858C8.34769 14.8364 7.65296 14.8364 7.26027 14.3858C6.34519 13.3358 4.8345 11.5688 4.22909 10.6673C3.33366 9.33399 2.66699 8.03224 2.66699 6.66733C2.66699 5.3024 3.18769 3.93748 4.22909 2.89608C6.31189 0.813285 9.68877 0.813285 11.7716 2.89608C12.813 3.93748 13.3337 5.3024 13.3337 6.66733C13.3337 8.03224 12.667 9.33399 11.7716 10.6673ZM4.79477 3.46177C6.56515 1.69139 9.4355 1.69139 11.2059 3.46177C12.0912 4.34711 12.5337 5.5059 12.5337 6.66733C12.5337 7.77868 11.9884 8.9095 11.1074 10.2213C10.5363 11.0717 9.06451 12.7962 8.13726 13.8602C8.06342 13.9449 7.93723 13.9449 7.86339 13.8602C6.93615 12.7962 5.46432 11.0717 4.89322 10.2213C4.01224 8.9095 3.46699 7.77868 3.46699 6.66733C3.46699 5.5059 3.90943 4.34711 4.79477 3.46177Z" fill="#E0205C"/>'
  +             '</svg>'
  +         '장소 검색</span>');
  placeBtn.on('click', function() {
    searchActiveFalse();
    searchActiveWhere(); 
    searchActive2 = true;
    setTimeout(function() {
      searchActive2 = false;
    }, 500)
 
  });
  btnList.append(placeBtn);
    */
  /*    
  var dictBtn = $('<span class="btn-custom-reply btn-icon btn-text search-dict">'
  +           '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +           '<circle cx="7.99967" cy="8.00065" r="6.06667" stroke="#E0205C" stroke-width="1.2"/>'
  +            '<path d="M11.4 8.00065C11.4 9.75155 10.9729 11.3076 10.3139 12.406C9.64775 13.5163 8.81101 14.0673 8 14.0673C7.18899 14.0673 6.35225 13.5163 5.68607 12.406C5.02706 11.3076 4.6 9.75155 4.6 8.00065C4.6 6.24975 5.02706 4.69366 5.68607 3.5953C6.35225 2.48501 7.18899 1.93398 8 1.93398C8.81101 1.93398 9.64775 2.48501 10.3139 3.5953C10.9729 4.69366 11.4 6.24975 11.4 8.00065Z" stroke="#E0205C" stroke-width="1.2"/>'
  +            '<rect x="7.59961" y="2" width="0.8" height="12" fill="#E0205C"/>'
  +            '<rect x="2" y="8.40039" width="0.8" height="12" transform="rotate(-90 2 8.40039)" fill="#E0205C"/>'
  +            '<rect x="2.66699" y="5.33398" width="0.8" height="10.6667" transform="rotate(-90 2.66699 5.33398)" fill="#E0205C"/>'
  +            '<rect x="2.66699" y="11.334" width="0.8" height="10.6667" transform="rotate(-90 2.66699 11.334)" fill="#E0205C"/>'
  +            '</svg>'
  +          '용어 검색</span>');
  dictBtn.on('click', function() {
    searchActiveFalse();
    searchActiveDict();
    searchActive2 = true;
    setTimeout(function() {
      searchActive2 = false;
    }, 500)
 
  });
  btnList.append(dictBtn);
  */
  
  var searchSystemBtn = $('<span class="btn-custom-reply btn-icon btn-text search-system">'
  +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +'<path d="M10.8837 4.05322C10.7822 4.15268 10.4111 4.64773 10.8807 5.11789C11.3509 5.5875 11.8459 5.21639 11.9454 5.11485C12.0449 5.01328 13.5376 3.52467 13.5376 3.52467C13.7352 3.32732 14.0658 3.3729 14.2003 3.61607C15.002 5.0651 14.7537 6.89305 13.5593 8.0882C12.6582 8.98861 11.3442 9.33879 10.1358 9.10652C9.89479 9.0602 9.63997 9.11984 9.46582 9.29407L9.4471 9.31279C9.1409 9.61916 5.17412 13.5881 4.70768 14.0545C4.03418 14.728 2.88148 15.0002 1.93997 14.0587L2.50484 13.4938C2.81952 13.8084 3.11943 13.8828 3.36816 13.8653C3.64007 13.8462 3.92237 13.71 4.14279 13.4896C4.6136 13.0188 8.65215 8.97809 8.88985 8.74026L8.90093 8.72918C9.29263 8.33739 9.83029 8.2343 10.2866 8.32201C11.2545 8.50805 12.2945 8.22261 12.9944 7.52329C13.8096 6.70742 14.0643 5.5206 13.7118 4.47933L13.3431 4.84713C12.9542 5.23524 12.5616 5.62737 12.5161 5.67387C12.3914 5.80119 12.1161 6.01688 11.738 6.10748C11.2974 6.21307 10.7644 6.13112 10.3158 5.68278C9.86747 5.23414 9.78552 4.70124 9.89111 4.26058C9.98171 3.88248 10.1974 3.60723 10.3247 3.48252C10.3712 3.43697 10.7634 3.04436 11.1515 2.65547L11.5193 2.28681C10.478 1.93429 9.29117 2.18898 8.4753 3.00417C7.77599 3.70411 7.49054 4.74411 7.67658 5.712C7.76429 6.1683 7.6612 6.70596 7.26941 7.09766L7.25833 7.10874C7.0205 7.34644 2.97978 11.385 2.50898 11.8558C2.28855 12.0762 2.15244 12.3585 2.13327 12.6304C2.11574 12.8792 2.19015 13.1791 2.50484 13.4938L1.93997 14.0587C0.998463 13.1172 1.27058 11.9644 1.94409 11.2909C2.41075 10.8242 6.38325 6.85387 6.68624 6.55105L6.70452 6.53277C6.87875 6.35862 6.93839 6.1038 6.89207 5.86279C6.6598 4.65436 7.00998 3.34035 7.91039 2.4393C9.10554 1.24492 10.9335 0.99658 12.3825 1.79827C12.6257 1.93281 12.6713 2.26335 12.4739 2.46096C12.4739 2.46096 10.9853 3.95373 10.8837 4.05322Z" fill="#E0205C"/>'
  +'</svg>'
  +'시스템 담당자 검색</span>'
  );
  searchSystemBtn.on('click', function() {
    searchActiveFalse();
    searchActiveSystem();
    searchActive2 = true;
    setTimeout(function() {
      searchActive2 = false;
    }, 500)
  });
  btnList.append(searchSystemBtn);
  
  var searchEmployeeBtn = $('<span class="btn-custom-reply btn-icon btn-text search-employee">'
  +            '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +            '<path fill-rule="evenodd" clip-rule="evenodd" d="M5.66628 6.2C6.32902 6.2 6.86628 5.66274 6.86628 5C6.86628 4.33726 6.32902 3.8 5.66628 3.8C5.00353 3.8 4.46628 4.33726 4.46628 5C4.46628 5.66274 5.00353 6.2 5.66628 6.2ZM5.66628 7C6.77084 7 7.66628 6.10457 7.66628 5C7.66628 3.89543 6.77084 3 5.66628 3C4.56171 3 3.66628 3.89543 3.66628 5C3.66628 6.10457 4.56171 7 5.66628 7Z" fill="#E0205C"/>'
  +            '<path fill-rule="evenodd" clip-rule="evenodd" d="M1.33301 11.8667C1.33301 9.62074 3.15372 7.80003 5.39967 7.80003H5.933C8.17896 7.80003 9.99967 9.62074 9.99967 11.8667V12.6C9.99967 12.8209 9.82059 13 9.59967 13C9.37876 13 9.19967 12.8209 9.19967 12.6V11.8667C9.19967 10.0626 7.73714 8.60003 5.933 8.60003H5.39967C3.59554 8.60003 2.13301 10.0626 2.13301 11.8667V12.6C2.13301 12.8209 1.95392 13 1.73301 13C1.51209 13 1.33301 12.8209 1.33301 12.6V11.8667Z" fill="#E0205C"/>'
  +            '<path fill-rule="evenodd" clip-rule="evenodd" d="M10.6663 6.86667C11.1449 6.86667 11.5329 6.47865 11.5329 6C11.5329 5.52135 11.1449 5.13333 10.6663 5.13333C10.1876 5.13333 9.79961 5.52135 9.79961 6C9.79961 6.47865 10.1876 6.86667 10.6663 6.86667ZM10.6663 7.66667C11.5868 7.66667 12.3329 6.92047 12.3329 6C12.3329 5.07953 11.5868 4.33333 10.6663 4.33333C9.7458 4.33333 8.99961 5.07953 8.99961 6C8.99961 6.92047 9.7458 7.66667 10.6663 7.66667Z" fill="#E0205C"/>'
  +            '<path fill-rule="evenodd" clip-rule="evenodd" d="M9.86621 8.8667C9.86621 8.64579 10.0453 8.4667 10.2662 8.4667H10.9329C12.9948 8.4667 14.6663 10.1382 14.6663 12.2V12.6C14.6663 12.8209 14.4872 13 14.2663 13C14.0454 13 13.8663 12.8209 13.8663 12.6V12.2C13.8663 10.58 12.553 9.2667 10.9329 9.2667H10.2662C10.0453 9.2667 9.86621 9.08761 9.86621 8.8667Z" fill="#E0205C"/>'
  +            '</svg>'
  +         '전자/그룹사 임직원 검색</span>');
  searchEmployeeBtn.on('click', function(){
    searchActiveFalse();
    searchActiveEmployee();
    searchActive2 = true;
    setTimeout(function() {
      searchActive2 = false;
    }, 500)
 
  });
  btnList.append(searchEmployeeBtn);
  /*
  var searchAiBtn = $('<span class="btn-custom-reply btn-icon btn-text search-ai">'
  +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +'<path d="M5.33366 8.93402C5.33366 8.7131 5.51274 8.53402 5.73366 8.53402H10.267C10.4879 8.53402 10.667 8.7131 10.667 8.93402C10.667 9.15493 10.4879 9.33402 10.267 9.33402H5.73366C5.51274 9.33402 5.33366 9.15493 5.33366 8.93402Z" fill="#E0205C"/>'
  +'<path d="M5.73366 10.534C5.51274 10.534 5.33366 10.7131 5.33366 10.934C5.33366 11.1549 5.51274 11.334 5.73366 11.334H8.93366C9.15457 11.334 9.33366 11.1549 9.33366 10.934C9.33366 10.7131 9.15457 10.534 8.93366 10.534H5.73366Z" fill="#E0205C"/>'
  +'<path fill-rule="evenodd" clip-rule="evenodd" d="M2.66699 3.33398C2.66699 2.22941 3.56242 1.33398 4.66699 1.33398H8.50523C9.03566 1.33398 9.54437 1.5447 9.91944 1.91977L12.7479 4.7482C13.1229 5.12327 13.3337 5.63198 13.3337 6.16241V12.6673C13.3337 13.7719 12.4382 14.6673 11.3337 14.6673H4.66699C3.56242 14.6673 2.66699 13.7719 2.66699 12.6673V3.33398ZM11.3337 13.8673H4.66699C4.00425 13.8673 3.46699 13.3301 3.46699 12.6673V3.33398C3.46699 2.67124 4.00425 2.13398 4.66699 2.13398H8.50523C8.53706 2.13398 8.56876 2.13525 8.60026 2.13775V4.66732C8.60026 5.44052 9.22706 6.06732 10.0003 6.06732H12.5299C12.5324 6.09884 12.5337 6.13056 12.5337 6.16241V12.6673C12.5337 13.3301 11.9964 13.8673 11.3337 13.8673ZM12.1356 5.26732L9.40026 2.53196V4.66732C9.40026 4.99869 9.66889 5.26732 10.0003 5.26732H12.1356Z" fill="#E0205C"/>'
  +'</svg>'
  +'AI 검색</span>');
  searchAiBtn.on('click', function() {
    searchActiveFalse();
    searchActiveMrc(); 
    searchActive2 = true;
    setTimeout(function() {
      searchActive2 = false;
    }, 500)
 
  });
  btnList.append(searchAiBtn);
  */
  /*
  var searchScheduleBtn = $('<span class="btn-custom-reply btn-icon btn-text search-schedule">'
  +'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
  +'<path d="M17.4 14.5999L15.893 14.5999C15.5617 14.5999 15.293 14.3313 15.293 13.9999C15.293 13.6685 15.5617 13.3999 15.893 13.3999L17.4 13.3999C17.7314 13.3999 18 13.6685 18 13.9999C18 14.3313 17.7314 14.5999 17.4 14.5999Z" fill="#E0205C"/>'
  +'<path d="M12.8791 14.5999L11.1209 14.5999C10.7896 14.5999 10.5209 14.3313 10.5209 13.9999C10.5209 13.6685 10.7896 13.3999 11.1209 13.3999L12.8791 13.3999C13.2104 13.3999 13.4791 13.6685 13.4791 13.9999C13.4791 14.3313 13.2104 14.5999 12.8791 14.5999Z" fill="#E0205C"/>'
  +'<path d="M8.10698 14.5999L6.6 14.5999C6.26863 14.5999 6 14.3313 6 13.9999C6 13.6685 6.26863 13.3999 6.6 13.3999L8.10698 13.3999C8.43835 13.3999 8.70698 13.6685 8.70698 13.9999C8.70698 14.3313 8.43835 14.5999 8.10698 14.5999Z" fill="#E0205C"/>'
  +'<path d="M11.1209 17.5999L12.8791 17.5999C13.2104 17.5999 13.4791 17.3313 13.4791 16.9999C13.4791 16.6685 13.2104 16.3999 12.8791 16.3999L11.1209 16.3999C10.7896 16.3999 10.5209 16.6685 10.5209 16.9999C10.5209 17.3313 10.7896 17.5999 11.1209 17.5999Z" fill="#E0205C"/>'
  +'<path d="M6.6 17.5999L8.10698 17.5999C8.43835 17.5999 8.70698 17.3313 8.70698 16.9999C8.70698 16.6685 8.43835 16.3999 8.10698 16.3999L6.6 16.3999C6.26863 16.3999 6 16.6685 6 16.9999C6 17.3313 6.26863 17.5999 6.6 17.5999Z" fill="#E0205C"/>'
  +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.5999 2.6C8.5999 2.26863 8.33127 2 7.9999 2C7.66853 2 7.3999 2.26863 7.3999 2.6V4H6C4.34315 4 3 5.34315 3 7V19C3 20.6569 4.34315 22 6 22H18C19.6569 22 21 20.6569 21 19V7C21 5.34315 19.6569 4 18 4H16.5999V2.6C16.5999 2.26863 16.3313 2 15.9999 2C15.6685 2 15.3999 2.26863 15.3999 2.6V4H8.5999L8.5999 2.6ZM18 5.2H6C5.00589 5.2 4.2 6.00589 4.2 7V9L19.8 9V7C19.8 6.00589 18.9941 5.2 18 5.2ZM4.2 19V10.2L19.8 10.2V19C19.8 19.9941 18.9941 20.8 18 20.8H6C5.00589 20.8 4.2 19.9941 4.2 19Z" fill="#E0205C"/>'
  +'</svg>'
  +'일정 검색</span>'
  );
  searchScheduleBtn.on('click', function() {
    searchActiveFalse();
    searchActiveSchedule(); 
    searchActive2 = true;
    setTimeout(function() {
      searchActive2 = false;
    }, 500)
 
  });
  btnList.append(searchScheduleBtn);
  */
  
  /*
  if(!isMobile) {
    var searchEcmBtn =$('<span class="btn-custom-reply btn-icon btn-text search-ecm">'
    +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
    + '<path fill-rule="evenodd" clip-rule="evenodd" d="M6.18572 3.46602H3.33301C2.67027 3.46602 2.13301 4.00327 2.13301 4.66602V11.3327C2.13301 11.9954 2.67027 12.5327 3.33301 12.5327H12.6663C13.3291 12.5327 13.8663 11.9954 13.8663 11.3327V6.33268C13.8663 5.66994 13.3291 5.13268 12.6663 5.13268H8.4803C7.93349 5.13268 7.41633 4.88412 7.07474 4.45713L6.34189 3.54108C6.30394 3.49363 6.24647 3.46602 6.18572 3.46602ZM6.18572 2.66602C6.4895 2.66602 6.77681 2.80411 6.96659 3.04132L7.69943 3.95738C7.8892 4.19459 8.17652 4.33268 8.4803 4.33268H12.6663C13.7709 4.33268 14.6663 5.22811 14.6663 6.33268V11.3327C14.6663 12.4373 13.7709 13.3327 12.6663 13.3327H3.33301C2.22844 13.3327 1.33301 12.4373 1.33301 11.3327V4.66602C1.33301 3.56145 2.22844 2.66602 3.33301 2.66602H6.18572Z" fill="#E0205C"/>'
    +'</svg>'
    +'ECM 문서 검색</span>');  
    searchEcmBtn.on('click', function() {
      searchActiveFalse();
      searchActiveEcm();
      searchActive2 = true;
      setTimeout(function() {
        searchActive2 = false;
      }, 500)
      
    });
    btnList.append(searchEcmBtn);

    var standardBtn = $('<span class="btn-custom-reply btn-icon btn-text search-standard">'
    +'<svg width="16" height="16" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">'
    + '<path d="M11.9242 9.02426C12.1585 8.78995 12.1585 8.41005 11.9242 8.17574C11.6899 7.94142 11.31 7.94142 11.0756 8.17574L7.1254 12.126L4.92409 9.92543C4.68974 9.69116 4.30984 9.69122 4.07556 9.92558C3.84129 10.1599 3.84136 10.5398 4.07571 10.7741L6.70129 13.3988C6.93562 13.633 7.31546 13.633 7.54974 13.3987L11.9242 9.02426Z" fill="#E0205C"/>'
    +'<path fill-rule="evenodd" clip-rule="evenodd" d="M4 1.5C4 0.671573 4.67157 0 5.5 0H10.5C11.3284 0 12 0.671573 12 1.5H13C13.0647 1.5 13.129 1.50205 13.1927 1.50609L13.2 1.50656C14.7636 1.60948 16 2.91035 16 4.5V17C16 18.6569 14.6569 20 13 20H3C1.34315 20 0 18.6569 0 17V4.5C0 2.9467 1.1805 1.66912 2.69327 1.51549C2.72867 1.51189 2.76425 1.50891 2.8 1.50656C2.8661 1.50221 2.93279 1.5 3 1.5H4ZM5.5 1.2H10.5C10.6657 1.2 10.8 1.33431 10.8 1.5V2.5C10.8 2.66569 10.6657 2.8 10.5 2.8H5.5C5.33431 2.8 5.2 2.66569 5.2 2.5V1.5C5.2 1.33431 5.33431 1.2 5.5 1.2ZM4.01205 2.69105C4.01243 2.69403 4.01282 2.69702 4.01322 2.7H3C2.93787 2.7 2.87647 2.70315 2.81596 2.70929L2.80811 2.71011C1.90422 2.80589 1.2 3.57071 1.2 4.5V17C1.2 17.9941 2.00589 18.8 3 18.8H13C13.9941 18.8 14.8 17.9941 14.8 17V4.5C14.8 3.63015 14.183 2.90441 13.3628 2.73657C13.3067 2.7251 13.2497 2.71623 13.1919 2.71011C13.1288 2.70343 13.0648 2.7 13 2.7H11.9868C11.889 3.43387 11.2606 4 10.5 4H5.5C4.73629 4 4.10589 3.42926 4.01205 2.69105Z" fill="#E0205C"/>'
    +'</svg>'
    +'표준 문서 검색</span>');
    standardBtn.on('click', function() {
      searchActiveFalse();
      searchActiveStandard();
      searchActive2 = true;
      setTimeout(function() {
        searchActive2 = false;
      }, 500)
      
    });
    btnList.append(standardBtn);
  }
  */
  
  defaultQuickReply.append(btnList);
  customMessage.append(defaultQuickReply);

  return customMessage;
 
}

/**
 * '리스트 카드(표준문서검색) 생성' 함수
 * @param {list} items 리스트형 응답 데이터
 */
 function makeListStandardCard(data, isHistory){
	var listCon = $('<div class="message"></div>');
	
	
	var listWrap = $('<div class="text-list standard-list"></div>');
	listWrap.attr("data-sessionId", data.chatSessionId.split("sessions/")[1]);
	listCon.append(listWrap);

  var listHeader = $('<div class="list-header-title">' + listHeaderIcon + '<b>' + data.searchData + '</b> 표준 문서 검색 결과</div>')
  listWrap.append(listHeader);
	
	var listUl = $('<ul></ul>');
	listWrap.append(listUl);

    var searchData = data.searchData;
	
	var moreItemList = [];
	if (data.items instanceof Array && data.items.length > 0) {
		data.items.forEach(function(item,index) {
			if( index < 4 ){
				makeListStandardItem(listUl, item, searchData);
			} else {
				moreItemList.push(item);
			}
		});

		if(data.totalCnt > 4 ){
			var seeMore = $('<div class="see-more">더 찾아보기</div>');
// 			var seeMore = $('<div class="see-more"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
//       +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
    //   + '</svg>표준 더 찾아보기</div>');
			listWrap.append(seeMore);
			
			seeMore.on('click', function() {
			    var searchStandardUrl = 'http://standard-doc.lgchem.com/xmms/webroot/search/searchMain.do?kwd='+searchData;
			    window.open(searchStandardUrl, "standardDocSearch", "width=1024,height=550,resizable=1,scrollbars=1");
				});			
		}
  } else {
    var noResult = $('<li class="list-box no-result">검색결과가 없습니다.</li>');
    listUl.append(noResult);
  }

	return listCon;
}

/**
 * '리스트(표준문서검색) 아이템 항목 생성' 함수
 * @param {object} item 형 응답 데이터
 */
function makeListStandardItem(listUl, item, searchData){
	var listLi = $('<li class="list-box"></li>');
	listUl.append(listLi);

  var dictNm = item.doc_title.replace(searchData, '<b>'+searchData+'</b>');
	
	var title = $('<h1>' + dictNm + '</h1>');
	listLi.append(title);
	
	if (item.hasOwnProperty('doc_area')) {
		var area = $('<p class="area">업무영역(위치): ' + item.doc_area + '('+ item.doc_path +')</p>');
		listLi.append(area);
	}

	if (item.hasOwnProperty('doc_url')) {

        var url = $('<p><a href="#">[문서 바로가기>>]</a></p>');
        url.on('click', function() {
            window.open(item.doc_url, "standardDocSearch", "width=1024,height=550,resizable=1,scrollbars=1");
        });
        listLi.append(url);
	}
}

// ** 커스텀 음답 메시지 생성 함수 **
chatui.createCustomResponseMessage = function(response, isHistory) {
  console.log("chatui.createCustomResponseMessage()", response);
  
  try {
    var customPayload = JSON.parse(response.response);

    var messageCard = null;
   
    
    if (customPayload['template'] && customPayload.template.outputs instanceof Array && customPayload.template.outputs.length > 0) {
      var messages = customPayload.template.outputs;
     
        if(messages[0].type.indexOf('welcome') > -1 || messages[0].type == 'userInfo') {
          messageCard = $('<div class="loading"></div>');
        }

        messages.forEach(function(message){
        if (message.type == 'text') { // 메시지타입_기본형
          messageCard = makeText(message.data.text);
        } else if (message.type == 'list' ) { // 메시지타입_리스트형 
          var titleBoldYn = 'N';
          if (message.data.hasOwnProperty('bold')) {
            titleBoldYn = message.data.bold;
          }
          messageCard = makeListCard(message.data.items, titleBoldYn);
        } else if (message.type == 'dict') { // 메시지타입_리스트형_용어갬색
          messageCard = makeListDictCard(message.data);
        } else if(message.type == 'employee') { // 메시지타입_임직원검색(단일)
          messageCard = makeEmployeeCard(message.data.items[0]);
        } else if (message.type == 'meetingRoom') { // 메시지타입_회의실취소
          messageCard = makeMeetingRoomCard(message.data);							
        } else if(message.type == 'weather') { // 메시지타입_날짜조회
          if (message.data.hasOwnProperty('weatherList')) {
            messageCard = makeWeatherCard(message.data);
          }
          
        } else if(message.type == 'anniversary'){ // 메시지타입_기념일 
          messageCard = makeAnniversaryCard(message.data.items);
        } else if(message.type == 'sms') { // sms발송
          messageCard  = makeSmsSendCard(message.data);
        } else if(message.type == 'smsNew') { // sms발송(새로운 타입)
            messageCard  = makeSmsSendCardNew(message.data);
        } else if(message.type == 'email') { // 메일 발송
            if (isHistory != true ) {
                messageCard = connectEmail(message.data);
            }
        } else if(message.type == 'mrcList') {
          messageCard = makeMrcListCard(message.data);
        } else if(message.type == 'lawDutyHours') {
          messageCard = makeLawDutyHoursCard(message.data);
        } else if(message.type == 'useHoliday') {
          messageCard = makeUseHolidayCard(message.data);
        } else if(message.type == 'teamHoliday') {
          messageCard = makeTeamHolydayCard(message.data);
        } else if(message.type == 'flextime') {
          messageCard = makeFlexTimeCard(message.data);
        } else if(message.type == 'helpCard') {
          messageCard = makeHelpCard();
        } else if(message.type == 'ecmFavorite') {
          messageCard = makeEcmFavorieCard(message.data);
        } else if(message.type == 'notice') {
          messageCard = makeNoticeCard(message.data);
        } else if(message.type == 'defaultFallback') {
          messageCard = makeDefaultFallbackCard(message.data);
        } else if(message.type == 'learningBotMode') {
          messageCard = makeLearningBotModeCard(message.data);
        } else if(message.type == 'gptBotMode') {
          messageCard = makeGptBotModeCard(message.data);
        } else if(message.type == 'standard') {
          messageCard = makeListStandardCard(message.data);
        } else if(message.type == 'rpaPopUp') { // RPA 팝업 안내
		    if (isHistory != true ) {
		        messageCard = makeRpaPopup(message.data);
		    }
		} else if(message.type == 'rpaList') {
		    messageCard = makeRpaProcessList(message.data);
		} else if(message.type == 'rpaSelect') {
		    messageCard = selectRpaProcess(message.data);
		} else if(message.type == 'rpaKillList') {
		    messageCard = makeRpaProcessKillList(message.data);
		} else if(message.type == 'rpaParam') {
	        messageCard = makeRpaParamMessageCard(message.data);
	    } else if(message.type == 'videoEquip') {
	        messageCard = makeVideoEquipChngCard(message.data);
    	}
    	// LG전자 엘지니.... 
        else if(message.type == 'scheduleReg') { // 메시지타입_일정등록 : LG전자
          messageCard = makeScheduleRegCard(message.data);
        }    	
        else if (message.type == 'schedule') { // 메시지타입_일정조회_공통
          if (message.data.hasOwnProperty('items')) {
            messageCard = makeScheduleCard(message.data);
            // messageCard = makeScheduleAlarmCard(message.data); //        [퍼블 수정 및 추가] - 일정 알람
          }
          if(message.data.btnName) {
            var scheduleBtns = $('<div class="custom-quick-reply"></div>');
            var weekScheduleBtn = $('<span class="btn-custom-reply">' + message.data.btnName + '</span>');
            weekScheduleBtn.on('click', function() {
              var url = gPortalWeekScheduleUrl.replace("%query%", message.data.userId);
              window.open(url, "_blank");
            });

            scheduleBtns.append(weekScheduleBtn);
            messageCard.append(scheduleBtns);
          }
          
        }
        else if(message.type == 'employeeList') { // 메시지타입_임직원검색(동명이인)
          messageCard = makeEmployeeListCard(message.data);
        } else if (message.type == 'system') { // 메시지타입_시스템 업무 담당자 검색
          messageCard = makeSystemCardFirst(message.data.items);
        }        
        else if(message.type == 'budgetInput') {                    // 예산조회 입력
          console.log('잔여예산조회...');
          messageCard = makeBudgetInputCard(message.data); // [퍼블 수정 및 추가]
    	}
        else if(message.type == 'searchBudgetResult') {                    // 예산조회 결과
          messageCard = budgetResult(message.data); // [퍼블 수정 및 추가]
    	}
        else if(message.type == 'budgetResultError') {                    // 예산조회 실패
          messageCard = budgetResultError(message.data); 
    	}
        else if(message.type == 'anotherBudgetInput') {                    // 타계정 부서예산조회
          messageCard = makeCardGBMS(message.data); 
    	}
        else if(message.type == 'anotherApmsInput') {                    // 타계정 광고판촉비조회
          messageCard = makeCardAPMS(message.data); 
    	}
        else if(message.type == 'anotherOrderInputStep1') {                    // 타계정 주문 입력
          messageCard = makeCardAnotherAccountOrder(message.data); 
    	}
        else {
          console.log(message.type);
        }
      });
    }

    if(customPayload['template'] && customPayload.template.quickReplies instanceof Array && customPayload.template.quickReplies.length > 0) {
      var quickReply = $('<div class="custom-quick-reply"></div>');
      for(var j = 0; j<customPayload.template.quickReplies.length; j++) {
        var quickBtn = customPayload.template.quickReplies[j];
        if(quickBtn.type == "callIntent") {
          var buttonParams = JSON.stringify(quickBtn.parameters);
          var callIntentBtn = $(`<span class="btn-custom-reply call-intent" data-message="` + quickBtn.label + `" data-intent="`+ quickBtn.value + `" data-parameters='`+ buttonParams + `'>` + quickBtn.label + `</span>`);
           
          callIntentBtn.on('click', function() {
            var callEvent = $(this).data('intent');
            if($(this).data('parameters')) {
              var intentParams = {};
              var parameters = $(this).data('parameters');
              parameters.forEach(function(e) {
                intentParams[e.toParamName] = e.value
              });
              var callMessage = $(this).text();
              intentParams["text"] = callMessage;
              chatui.sendEventMessage(callEvent, intentParams);
            } else {
              var callMessage = $(this).text();
             chatui.sendEventMessage(callEvent, {"text": callMessage});
            }
          });
          quickReply.append(callIntentBtn);
        } else if(quickBtn.type == "categroySelect") {
          var categorySelectBtn = $('<span class="btn-custom-reply category-select" data-category="' + quickBtn.value + '">' + quickBtn.label +'</span>');
          categorySelectBtn.on('click', function() {
            selectedCategory = $(this).data('category');
            chatui.sendEventMessage("add_new_message_step_2");
          });
          quickReply.append(categorySelectBtn);
        }else {
          var simpleBtn = $('<span class="send-message" data-message="'+ button.value +'">' + button.label + '</span>');
          simpleBtn.on('click', function() {
            var mText = $(this).data('message');
            chatui.sendMessage(mText);
          });
          quickReply.append(simpleBtn);
          
        }
      }
  
   
      messageCard.append(quickReply); 
    }
    
  } catch (e) {
    console.error(e);
  }

  return messageCard;
}

function dateToStr(date) {
  var week = new Array('일', '월', '화', '수', '목', '금', '토');

  var localTime = date.toLocaleTimeString();

  var year = date.getFullYear();
  var month = date.getMonth()+1;
  var day = date.getDate();
  var dayName = week[date.getDay()];

  return year+'년 '+month+'월 '+day+'일 '+dayName+'요일';
}


chatui.onReceiveChatHistory = function(chatEvent) {
  console.log("chatui.onReceiveChatHistory()", chatEvent);
  checkChatHistory = true;
  setTimeout(function() {
    checkChatHistory = false;
    $('.chat-message.left').each(function() {
      var messageLength = $(this).find('.message').length;
      if(messageLength == 0) {
        $(this).remove();
      }
    });
  }, 500);
}


//메인 로딩
$(document).ready(function() {
  // Logo 제거
  $(".bot-profile").remove();

  // 페이지 로딩 표시
  var skeleton = '<div class="chatbot-skeleton"><div class="s-header"></div>'
  +'<div class="s-body"><div class="s-left" id="left-01"><div class="profile"></div><div class="chat chat-01"></div><div class="chat" id="chat-02"></div></div>'
  + '<div class="s-right" id="right-01"><div class="chat chat-03"></div></div><div class="s-left" id="left-02"><div class="profile"></div><div class="chat chat-04"></div><div class="chat" id="chat-05"></div></div>'
  + '<div class="s-right" id="right-02"><div class="chat chat-06"></div></div></div>'
  + '<div class="s-footer"><div class="s-input"></div></div></div>';

  $('body').append(skeleton);
 
 
  var left01 = document.getElementById('left-01');
  var chat02 = document.getElementById('chat-02');
  var right01 = document.getElementById('right-01');
  var left02 = document.getElementById('left-02');
  var chat05 = document.getElementById('chat-05');
  var right02 = document.getElementById('right-02');
   
  function appearSkeleteon() {   
    left01.classList.add('appear');
    setTimeout(function() {
        chat02.classList.add('appear');
    }, 500);
    setTimeout(function() {
        right01.classList.add('appear');
    }, 1000);
    setTimeout(function() {
        left02.classList.add('appear');
    }, 1500);
    setTimeout(function() {
        chat05.classList.add('appear');
    }, 2000);
    setTimeout(function() {
        right02.classList.add('appear');
    }, 2500)
  }

  function disappearSkeleton() {
    left01.classList.add('disappear');
    chat02.classList.add('disappear');
    right01.classList.add('disappear');
    left02.classList.add('disappear');
    chat05.classList.add('disappear');
    right02.classList.add('disappear');
  }
 
  function removeClassSkeleton() {
    left01.classList.remove('appear', 'disappear');
    chat02.classList.remove('appear', 'disappear');
    right01.classList.remove('appear', 'disappear');
    left02.classList.remove('appear', 'disappear');
    chat05.classList.remove('appear', 'disappear');
    right02.classList.remove('appear', 'disappear');
  }
 
  function skeletonRepeat(){
    appearSkeleteon();
    setTimeout(function() {
      disappearSkeleton();
    }, 4000);
    setTimeout(function() {
      removeClassSkeleton();
    }, 4500)

    setTimeout(skeletonRepeat, 5000);
  }

  skeletonRepeat();
});
 

// Messenger 미 설치일 경우 콜백함수 처리 js파일
/********************************************************** protocolcheck.js *************************************************************************************/

(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.protocolCheck = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
	function _registerEvent(target, eventType, cb) {
	    if (target.addEventListener) {
	        target.addEventListener(eventType, cb);
	        return {
	            remove: function () {
	                target.removeEventListener(eventType, cb);
	            }
	        };
	    } else {
	        target.attachEvent(eventType, cb);
	        return {
	            remove: function () {
	                target.detachEvent(eventType, cb);
	            }
	        };
	    }
	}

	function _createHiddenIframe(target, uri) {
	    var iframe = document.createElement("iframe");
	    iframe.src = uri;
	    iframe.id = "hiddenIframe";
	    iframe.style.display = "none";
	    target.appendChild(iframe);

	    return iframe;
	}

	function openUriWithHiddenFrame(uri, failCb, successCb) {

	    var timeout = setTimeout(function () {
	        failCb();
	        handler.remove();
	    }, 1000);

	    var iframe = document.querySelector("#hiddenIframe");
	    if (!iframe) {
	        iframe = _createHiddenIframe(document.body, "about:blank");
	    }

	    var handler = _registerEvent(window, "blur", onBlur);

	    function onBlur() {
	        clearTimeout(timeout);
	        handler.remove();
	        successCb();
	    }

	    iframe.contentWindow.location.href = uri;
	}

	function openUriWithTimeoutHack(uri, failCb, successCb) {
	    
	    var timeout = setTimeout(function () {
	        failCb();
	        handler.remove();
	    }, 1000);

	    //handle page running in an iframe (blur must be registered with top level window)
	    var target = window;
	    while (target != target.parent) {
	        target = target.parent;
	    }

	    var handler = _registerEvent(target, "blur", onBlur);

	    function onBlur() {
	        clearTimeout(timeout);
	        handler.remove();
	        successCb();
	    }

	    window.location = uri;
	}

	function openUriUsingFirefox(uri, failCb, successCb) {
	    var iframe = document.querySelector("#hiddenIframe");

	    if (!iframe) {
	        iframe = _createHiddenIframe(document.body, "about:blank");
	    }

	    try {
	        iframe.contentWindow.location.href = uri;
	        successCb();
	    } catch (e) {
	        if (e.name == "NS_ERROR_UNKNOWN_PROTOCOL") {
	            failCb();
	        }
	    }
	}

	function openUriUsingIEInOlderWindows(uri, failCb, successCb) {
	    if (getInternetExplorerVersion() === 10) {
	        openUriUsingIE10InWindows7(uri, failCb, successCb);
	    } else if (getInternetExplorerVersion() === 9 || getInternetExplorerVersion() === 11) {
	        openUriWithHiddenFrame(uri, failCb, successCb);
	    } else {
	        openUriInNewWindowHack(uri, failCb, successCb);
	    }
	}

	function openUriUsingIE10InWindows7(uri, failCb, successCb) {
	    var timeout = setTimeout(failCb, 1000);
	    window.addEventListener("blur", function () {
	        clearTimeout(timeout);
	        successCb();
	    });

	    var iframe = document.querySelector("#hiddenIframe");
	    if (!iframe) {
	        iframe = _createHiddenIframe(document.body, "about:blank");
	    }
	    try {
	        iframe.contentWindow.location.href = uri;
	    } catch (e) {
	        failCb();
	        clearTimeout(timeout);
	    }
	}

	function openUriInNewWindowHack(uri, failCb, successCb) {
	    var myWindow = window.open('', '', 'width=0,height=0');

	    myWindow.document.write("<iframe src='" + uri + "'></iframe>");

	    setTimeout(function () {
	        try {
	            myWindow.location.href;
	            myWindow.setTimeout("window.close()", 1000);
	            successCb();
	        } catch (e) {
	            myWindow.close();
	            failCb();
	        }
	    }, 1000);
	}

	function openUriWithMsLaunchUri(uri, failCb, successCb) {
	    navigator.msLaunchUri(uri,
	        successCb,
	        failCb
	    );
	}

	function checkBrowser() {
	    var isOpera = !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;
	    var ua = navigator.userAgent.toLowerCase();
	    return {
	        isOpera   : isOpera,
	        isFirefox : typeof InstallTrigger !== 'undefined',
	        isSafari  : (~ua.indexOf('safari') && !~ua.indexOf('chrome')) || Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0,
	        isIOS     : /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream,
	        isChrome  : !!window.chrome && !isOpera,
	        isIE      : /*@cc_on!@*/false || !!document.documentMode // At least IE6
	    }
	}

	function getInternetExplorerVersion() {
	    var rv = -1;
	    if (navigator.appName === "Microsoft Internet Explorer") {
	        var ua = navigator.userAgent;
	        var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
	        if (re.exec(ua) != null)
	            rv = parseFloat(RegExp.$1);
	    }
	    else if (navigator.appName === "Netscape") {
	        var ua = navigator.userAgent;
	        var re = new RegExp("Trident/.*rv:([0-9]{1,}[\.0-9]{0,})");
	        if (re.exec(ua) != null) {
	            rv = parseFloat(RegExp.$1);
	        }
	    }
	    return rv;
	}

	module.exports = function(uri, failCb, successCb, unsupportedCb) {
	    function failCallback() {
	        failCb && failCb();
	    }

	    function successCallback() {
	        successCb && successCb();
	    }

	    if (navigator.msLaunchUri) { //for IE and Edge in Win 8 and Win 10
	        openUriWithMsLaunchUri(uri, failCb, successCb);
	    } else {
	        var browser = checkBrowser();

	        if (browser.isFirefox) {
	            openUriUsingFirefox(uri, failCallback, successCallback);
	        } else if (browser.isChrome || browser.isIOS) {
	            openUriWithTimeoutHack(uri, failCallback, successCallback);
	        } else if (browser.isIE) {
	            openUriUsingIEInOlderWindows(uri, failCallback, successCallback);
	        } else if (browser.isSafari) {
	            openUriWithHiddenFrame(uri, failCallback, successCallback);
	        } else {
	            unsupportedCb();
	            //not supported, implement please
	        }
	    }
	}

	},{}]},{},[1])(1)
	});


////////// custom-protocol-check.min.js
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("customProtocolCheck",[],n):"object"==typeof exports?exports.customProtocolCheck=n():e.customProtocolCheck=n()}(window,(function(){return function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){e.exports=t(1)},function(e,n){var t,o={getUserAgent:function(){return window.navigator.userAgent},userAgentContains:function(e){return e=e.toLowerCase(),this.getUserAgent().toLowerCase().indexOf(e)>-1},isOSX:function(){return this.userAgentContains("Macintosh")},isFirefox:function(){return this.userAgentContains("firefox")},isInternetExplorer:function(){return this.userAgentContains("trident")},isIE:function(){var e=this.getUserAgent().toLowerCase();return e.indexOf("msie")>0||e.indexOf("trident/")>0},isEdge:function(){return this.getUserAgent().toLowerCase().indexOf("edge")>0},isChrome:function(){var e=window.chrome,n=window.navigator,t=n.vendor,o=void 0!==window.opr,r=n.userAgent.indexOf("Edge")>-1,i=n.userAgent.match("CriOS");return null!=e&&"Google Inc."===t&&!1===o&&!1===r||i},isOpera:function(){return this.userAgentContains(" OPR/")}},r=function(e,n,t){return e.addEventListener?(e.addEventListener(n,t),{remove:function(){e.removeEventListener(n,t)}}):(e.attachEvent(n,t),{remove:function(){e.detachEvent(n,t)}})},i=function(e,n){var t=document.createElement("iframe");return t.src=n,t.id="hiddenIframe",t.style.display="none",e.appendChild(t),t},u=function(e,n,o){var u=setTimeout((function(){n(),a.remove()}),t),c=document.querySelector("#hiddenIframe");c||(c=i(document.body,"about:blank")),onBlur=function(){clearTimeout(u),a.remove(),o()};var a=r(window,"blur",onBlur);c.contentWindow.location.href=e},c=function(e,n,o){for(var i=setTimeout((function(){n(),c.remove()}),t),u=window;u.parent&&u!=u.parent;)u=u.parent;onBlur=function(){clearTimeout(i),c.remove(),o()};var c=r(u,"blur",onBlur);window.location=e},a=function(e,n,t){var o=document.querySelector("#hiddenIframe");o||(o=i(document.body,"about:blank"));try{o.contentWindow.location.href=e,t()}catch(e){"NS_ERROR_UNKNOWN_PROTOCOL"==e.name&&n()}},f=function(e,n,t){navigator.msLaunchUri(e,t,n)},s=function(){var e,n=window.navigator.userAgent,t=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(t[1])?(e=/\brv[ :]+(\d+)/g.exec(n)||[],parseFloat(e[1])||""):"Chrome"===t[1]&&null!=(e=n.match(/\b(OPR|Edge)\/(\d+)/))?parseFloat(e[2]):(t=t[2]?[t[1],t[2]]:[window.navigator.appName,window.navigator.appVersion,"-?"],null!=(e=n.match(/version\/(\d+)/i))&&t.splice(1,1,e[1]),parseFloat(t[1]))};e.exports=function(e,n,i){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3,l=arguments.length>4?arguments[4]:void 0,m=function(){n&&n()},v=function(){i&&i()},p=function(){l&&l()},g=function(){o.isFirefox()?s()>=64?u(e,m,v):a(e,m,v):o.isChrome()?c(e,m,v):o.isOSX()?u(e,m,v):p()};if(d&&(t=d),o.isEdge()||o.isIE())f(e,n,i);else if(document.hasFocus())g();else var h=r(window,"focus",(function(){h.remove(),g()}))}}])}));


// ============================================================
// G-Mobile(WMO) 챗봇 연동 설정
// ============================================================
$(document).ready(function() {
  /**
   * G-Mobile 챗봇 초기 설정
   */
  if (chatui.getSetting("isWmo")) {
      // webmo.bundle.js 로딩 (webmo.bundle.js에서 $.ajax를 변경하기 때문에 원본 백업하고 webmo.bundle.js 로딩 후 복원한다.)
      $.ajaxOrigin = $.ajax;
      $.getScript("https://g.lgchem.com/cdn/js/webmo.bundle.js", function(data, textStatus,jqxhr) {
          // webmo.bundle.js에서 변경한 $.ajax 복원
          $.ajax = $.ajaxOrigin;

          // window.open()을 _emsWebUtil.openWebDialogSimple()으로 변경
          window.open_org = window.open;
          window.open = function(url, windowName, windowFeatures) {
              if (_emsWebUtil) {
                  // 리턴받을게 없는 웹창 '상단 no Title' 띄우기
                  _emsWebUtil.openWebDialogSimpleNoTitle(url);
                  return null;
              } else {
                  return window.open_org(url, windowName, windowFeatures);
              }
          }
      });

      // 폴라리스 뷰어 연동
      $.getScript("https://storage.googleapis.com/singlex-chatbot-front/_common/lgchem/EMSUtil.js");
      $.getScript("https://storage.googleapis.com/singlex-chatbot-front/_common/lgchem/pluginFileManager.js");

      // device APIs are available
      function onDeviceReady() {
          // 뒤로가기 버튼 이벤트 처리
          $(document).unbind(".backbutton");
          $(document).bind(".backbutton", function() {
              // 현재창 닫기 (Web view 닫기)
              _emsUIAction.closeMultiWebView();
          });
          $(document).on('click', ".backbutton", function() {
            // 현재창 닫기 (Web view 닫기)
            _emsUIAction.closeMultiWebView();
        });
      }

      // Wait for device API libraries to load
      document.addEventListener("deviceready", onDeviceReady, true);
  }
});

/**
* [G-Mobile] <A href="..." target="...">를 변경한다.
*/
function replaceAnchorForWmo() {
  // <A href="..." target="_blank">를 Javascript window.open()으로 변경한다.
  $(".chat-message a[target='_blank']:not([data-href])").each(function() {
      //console.log("replaceAnchorHref() >> " + $(this).text());
      $(this).attr("data-href", $(this).attr("href"))
          .attr("href", "#")
          .click(function(e) {
              e.preventDefault();
              window.open($(this).data("href"), "_blank");
          });
  });
  // <A href="..." target="_polaris">를 _emsUtil.showAttachmentPolaris()으로 변경한다.
  $(".chat-message a[target='_polaris']:not([data-href])").each(function() {
      //console.log("replaceAnchorHref() >> " + $(this).text());
      $(this).attr("data-href", $(this).attr("href"))
          .attr("href", "#")
          .click(function(e) {
              e.preventDefault();

              if (typeof(_emsUtil) == "undefined") {
                  alert("EMSUtil 로딩 실패.\n새로고침 후 다시 시도해주세요.");
                  return;
              }

              if (!navigator.pluginFileManager) {
                  alert("pluginFileManager 로딩 실패.\n새로고침 후 다시 시도해주세요.");
                  return;
              }

              var fileUrl = $(this).data("href");
              var fileType = $(this).data("type");
              var fileName = $(this).data("filename") || decodeURIComponent(fileUrl.substring(fileUrl.lastIndexOf('/') + 1));
              var parts = window.location.href.split("/");
              var downloadUrl = parts[0] + "//" + parts[2] + "/" + chatui.getSetting("chatbotId") + "/download/" + encodeURIComponent(fileName) + "?url=" + encodeURIComponent(fileUrl);

              if (fileType == "MRC") {
                  downloadUrl += "&token=" + encodeURIComponent(chatui.getSetting("apiToken"));
              }

              try {
                  _emsUtil.showAttachmentPolaris(downloadUrl, fileName);
              } catch (e) {
                  alert("ERROR: " + e.message);
              }
          });
  });
}

// ============================================================
// LGE) 엘지니 / 트랜잭션봇 설정
// ============================================================

// 잔여예산 message
function makeBudgetInputCard(data) {
    var budgetInputCard = $('<div class="message simple-text"></div>');
    var budgetInputText = $('<p>소속 팀 잔여 예산을 조회하려면 아래 버튼을 눌러주세요.</p>');
    budgetInputCard.append(budgetInputText);
    var regBtnWrap = $('<div class="btn"></div>');
    var regBtn = $('<button type="button" class="btn btn-emphasis add-budget">잔여 예산 조회</button>');

    regBtn.on('click', function() {
        addBudgetPopupOpen(data);
    });

    regBtnWrap.append(regBtn);
    budgetInputCard.append(regBtnWrap);
    
    if(checkChatHistory == false) {
        addBudgetPopupOpen(data);
    }

    return budgetInputCard;
}

// 잔여예산 popup
var gAccountList = null;
function addBudgetPopupOpen(data) {
    
    if(data.account != null) {
        gAccountList = data.account;
    }
    var accountList = gAccountList;                 // expense type에 맞는 계정목록.
    console.log('accountList length : '+accountList.length);

    let accTypeList = [];                                   // expense type에 맞는 계정유형목록
    accountList.filter((origin, index) => {
        if(!accTypeList.find((_retData, _retIndex) => origin.group === _retData.group && index !== _retIndex)) accTypeList.push(origin);
    }); 
            
    console.log('typeList length : '+accTypeList.length);
    
    var accountTypeText = '예산 유형을 선택해 주세요.';
    
    /* #########[ popup_wrap_start ]######### */
    var pulginDim = $('<div class="plugin-dim show"></div>');
    var addBudget = $('<div class="plugins" id="addBudget"></div>');

    /* #########[ popup_header ]######### */
    var addBudgetHeader = $('<div class="plugin-header"><h1>잔여 예산 조회</h1></div>');
    var addBudgetClose = $('<span class="close-plugin">'
        +'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
        + '<path d="M5.74478 4.75483C5.47141 4.48146 5.0282 4.48146 4.75483 4.75483C4.48146 5.0282 4.48146 5.47141 4.75483 5.74478L13.01 13.9999L4.75506 22.2548C4.48169 22.5282 4.48169 22.9714 4.75506 23.2448C5.02843 23.5181 5.47164 23.5181 5.74501 23.2448L13.9999 14.9899L22.2548 23.2448C22.5282 23.5181 22.9714 23.5181 23.2448 23.2448C23.5181 22.9714 23.5181 22.5282 23.2448 22.2548L14.9899 13.9999L23.245 5.74478C23.5184 5.47141 23.5184 5.0282 23.245 4.75483C22.9716 4.48146 22.5284 4.48146 22.2551 4.75483L13.9999 13.01L5.74478 4.75483Z" fill="#2C2C2C"/>'
        +'</svg>          '
        +'</span>');
    addBudgetClose.on('click', function() {
        addBudgetPopupClose();
    })
    addBudgetHeader.append(addBudgetClose);
    addBudget.append(addBudgetHeader);

    function addBudgetPopupClose() {
        $('#addBudget').removeClass('show');
        $('.plugin-dim').removeClass('show');
        setTimeout(function() {
            $('.plugin-dim').remove();
            $('#addBudget').remove();
        }, 300);
    }

    /* #########[ popup_content_wrap_start ]######### */
    var addBudgetContents = $('<div class="plugin-contents"></div>');
    var addBudgetForm = $('<form class="form-budget"></form>');
    
    /* #########[ popup_content ]######### */
    /* ###[ 예산 유형 ]###  */
    var budgetDropdownBox = $('<div class="dropdown-box dropdown-budget"><label>예산 유형<b>*</b></label></div>');
    var budgetDropdown = $('<button type="button" class="accountType btn btn-dropdown default"><span>'+accountTypeText+'</span></button>');
    var budgetDropdownArrow = $('<i class="icons">'
        + '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
        + '<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39823 5.61757C8.1709 5.4155 7.82833 5.4155 7.601 5.61757L2.26536 10.3604C2.10025 10.5071 1.84742 10.4923 1.70065 10.3271C1.55388 10.162 1.56875 9.9092 1.73387 9.76243L7.0695 5.01964C7.59995 4.54814 8.39928 4.54814 8.92972 5.01964L14.2654 9.76243C14.4305 9.9092 14.4453 10.162 14.2986 10.3271C14.1518 10.4923 13.899 10.5071 13.7339 10.3604L8.39823 5.61757Z" fill="#2C2C2C"/>'
        + '</svg>'
        +'</i>');
    addBudgetForm.append(budgetDropdownBox);
    budgetDropdownBox.append(budgetDropdown);
    budgetDropdown.append(budgetDropdownArrow);

    // 예산 유형 툴팁
    var budgetTooltip = $('<div class="budget-tooltip">먼저 예산 유형을 선택해 주세요.</div>');
    budgetDropdownBox.append(budgetTooltip);

    // 예산 유형 드롭다운메뉴 & 리스트
            
    var budgetDropdownListWrap = $('<ul class="dropdown-menu" id="list-type"></ul>');
    
    let budgetDropdownList = '';
    for(var i=0; i<accTypeList.length; i++) {
        var accType = accTypeList[i];
        
        budgetDropdownList += '<li class="dropdown-item"><a href="javascript:void(0)">'+accType.group+'</a></li>';
        //console.log('type > ', accType);
    }

    budgetDropdownListWrap.append(budgetDropdownList);
    budgetDropdownBox.append(budgetDropdownListWrap);

    /*  ###[ 계정 정보 ]###  */
    var userInfoDropdownBox = $('<div class="dropdown-box dropdown-userInfo"><label>계정 정보<b>*</b></label></div>');
    var userInfoDropdown = $('<button type="button" class="btn btn-dropdown default" id="btn-account"><span>계정 정보를 선택해 주세요.</span></button>');
    var userInfoDropdownArrow = $('<i class="icons">'
        + '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
        + '<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39823 5.61757C8.1709 5.4155 7.82833 5.4155 7.601 5.61757L2.26536 10.3604C2.10025 10.5071 1.84742 10.4923 1.70065 10.3271C1.55388 10.162 1.56875 9.9092 1.73387 9.76243L7.0695 5.01964C7.59995 4.54814 8.39928 4.54814 8.92972 5.01964L14.2654 9.76243C14.4305 9.9092 14.4453 10.162 14.2986 10.3271C14.1518 10.4923 13.899 10.5071 13.7339 10.3604L8.39823 5.61757Z" fill="#2C2C2C"/>'
        + '</svg>'
        +'</i>');
    addBudgetForm.append(userInfoDropdownBox);
    userInfoDropdownBox.append(userInfoDropdown);
    userInfoDropdown.append(userInfoDropdownArrow);

    // 계정 정보 드롭다운메뉴 & 리스트
    var userInfoDropdownListWrap = $('<ul class="dropdown-menu" id="list-account"></ul>');
    let userInfoDropdownList = $(
        '<li class="dropdown-item"><a href="javascript:void(0)">userInfo01</a></li>'
        + '<li class="dropdown-item"><a href="javascript:void(0)">userInfo02</a></li>'
        + '<li class="dropdown-item"><a href="javascript:void(0)">userInfo03</a></li>'
        + '<li class="dropdown-item"><a href="javascript:void(0)">userInfo04</a></li>'
    );
    //userInfoDropdownListWrap.append(userInfoDropdownList);
    userInfoDropdownBox.append(userInfoDropdownListWrap);

    /*  ###[ etc ]###  */
    // 코멘트
    var addBudgetComent = $('<p class="small coment-b">※ 현재 시간 기준으로 조회합니다.</p>');
    
    var formAddHiddenText = $(
        '<input type="hidden" id="accountType" value=""/>'    
        +'<input type="hidden" id="accountCode" value=""/>'    
        +'<input type="hidden" id="accountName" value=""/>'    
    );
    addBudgetForm.append(formAddHiddenText);
    addBudgetForm.append(addBudgetComent);

    // 조회버튼
    var addBudgetSubmit = $('<button type="button" class="btn btn-plugin btn-apply btn-disabled" id="btn-budget">조회</button>');
    addBudgetForm.append(addBudgetSubmit);
    addBudgetSubmit.on('click', function() {
        addBudgetPopupClose();
        
        var accountCd = $('#accountCode').val();
        var accountNm = $('#accountName').val();
        var accountType = $('#accountType').val();
        console.log('data.userId >>> '+data.userId);
        
        var param = {
            "deptId": data.deptId, 
            "userId": data.userId, 
            "expenseType": data.expenseType,  
            "accountType": accountType, 
            "accountCode": accountCd, 
            "accountName": accountNm 
        }
        
        chatui.sendEventMessage("searchBudgetResult", param);
    });


    /* #########[ popup_content_wrap_end ]######### */
    addBudgetContents.append(addBudgetForm);
    addBudget.append(addBudgetContents);
    
    /* #########[ popup_wrap_end ]######### */
    $('.test-panel').append(pulginDim);
    $('.test-panel').append(addBudget);
    $('.plugin-dim').css('display', 'block');
    $('#addBudget').css('display', 'block');

    setTimeout(function() {
        $('.plugin-dim').addClass('show');
        $('#addBudget').addClass('show');
    }, 100);

    /*  #########[ dropdown ]#########  */
    
    function reloadPopup() {
        $('.budget-tooltip').fadeOut(1);
        $('.dropdown-budget .btn-dropdown').removeClass('accent');
        
        dropdownBtnEvent($('.btn-dropdown'));
    }    
    
    $('.btn-dropdown').on('click', function() {
        if ($(this).parents('.dropdown-box').hasClass('dropdown-userInfo')) {
            if ($('.dropdown-budget .btn-dropdown').hasClass('select')) {
                dropdownBtnEvent(this);
            } else {
                $('.budget-tooltip').fadeIn();
                $('.dropdown-budget .btn-dropdown').addClass('accent');
            }
        } else {
            $('.budget-tooltip').fadeOut(1);
            $('.dropdown-budget .btn-dropdown').removeClass('accent');
            dropdownBtnEvent(this);
        }
    });

    $('#list-type a').on('click', function() {
        console.log('menu....');
        dropdownMenuEvent(this);
        if ($('.dropdown-budget .btn-dropdown').hasClass('select') && $('.dropdown-userInfo .btn-dropdown').hasClass('select')) {
            $('#btn-budget').removeClass('btn-disabled');
        }
    });

    function dropdownMenuEvent(target) {
        const dropmenu = $(target).parents('.dropdown-box').find('.dropdown-menu');
        const dropBtn = $(target).parents('.dropdown-box').find('.btn-dropdown');
        let targetText = $(target).text();
        
        //console.log('select : '+targetText);
        //console.log('seelct code : '+$(target).parents('.dropdown-item').find('span').text());
        
        if(dropBtn.hasClass('accountType')) {
            $('#list-account').empty();
            $('#accountType').val(targetText);
            $('#btn-account').html('<span>계정 정보를 선택해 주세요.</span>');
            
            for(var i=0; i<accountList.length; i++) {
                var account = accountList[i];
                if(account.group == targetText) {
                    $('#list-account').append('<li class="dropdown-item"><span style="display:none;">'+account.code+'</span><a href="javascript:void(0)">'+account.name+'</a></li>');
                }
            }
            
            $('#list-account a').on('click', function() {
                console.log('account menu....');
                dropdownMenuEvent(this);
                if ($('.dropdown-budget .btn-dropdown').hasClass('select') && $('.dropdown-userInfo .btn-dropdown').hasClass('select')) {
                    $('#btn-budget').removeClass('btn-disabled');
                }
            });   
            
        }
        else{
            var targetCode = $(target).parents('.dropdown-item').find('span').text();
            $('#accountCode').val(targetCode);
            $('#accountName').val(targetText);
        }
        
        dropBtn.removeClass('default active').addClass('select').find('span').text(targetText);
        dropmenu.stop().slideUp().removeClass('show');
    }

    function dropdownBtnEvent(target) {
        if ($(target).hasClass('active')) {
            $(target).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
        }
        else {
            $('.btn-dropdown').not($(this)).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
            $(target).addClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideDown().css('display','flex').addClass('show');
        }
    }
}

// 예산 조회 결과 메세지
function budgetResult(data) {
    var budgetResultMessage = $('<div class="custom-message"></div>');
    var budgetMessageResult = $('<div class="message"></div>');
    var budgetMessageResultWarp = $('<div class="budget-wrap"></div>');
    var budgetMessageResultHeader = $(
        '<div class="budget-header">'
        + '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
        + '<path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6" fill="#898989"></path>'
        + '</svg>'
        + '<h2>잔여 예산 현황</h2>'
        + '</div>'
    );
    budgetMessageResultWarp.append(budgetMessageResultHeader);
    var budgetMessageResultContent = $(
        '<div class="budget-content">'
        + '<div class="budget-content-header">'
        + '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
        + '<path fill="#898989" d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>'
        + '<path fill="#898989" d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"></path>'
        + '</svg>'
        + '<h3>'+data.deptName+'</h3>'
        + '</div>'
        + '<ul class="budget-list-wrap">'
        + '<li>'
        + '<h4>예산 유형</h4>'
        + '<div class="budget-type"><span>'+data.accountType+'</span></div>'
        + '</li>'
        + '<li>'
        + '<h4>계정 정보</h4>'
        + '<div class="budget-user"><span>'+data.accountItem[0].ACCOUNT_NAME+'</span></div>'
        + '</li>'
        + '<li>'
        + '<h4>기준 일시</h4>'
        + '<div class="budget-date"><span>'+data.budgetDate+'</span><span>'+data.budgetTime+'</span></div>'
        + '</li>'
        + '<li>'
        + '<h4>예산 잔액</h4>'
        + '<div class="budget-remain"><span>'+getAmountComma(data.accountItem[0].BALANCE)+'</span>원</div>'
        + '</li>'
        + '</ul>'
        + '<div class="btn">'
        + '<button type="button" class="btn btn-default move_n-erp">N-ERP Portal'
        + '<svg width="20" height="20" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">'
        + '<path d="M18.0964 6.50024L24.097 6.50066C24.6493 6.5007 25.0969 6.9484 25.0969 7.50066L25.0969 13.5002" stroke="#333333" stroke-linecap="round"></path><path d="M16.3394 14.9355L24.5962 7.00098" stroke="#333333" stroke-linecap="round"></path><path d="M14 8H9C7.89543 8 7 8.89543 7 10V23C7 24.1046 7.89543 25 9 25H22C23.1046 25 24 24.1046 24 23V18" stroke="#333333" stroke-linecap="round"></path>'
        + '</svg>'
        + '</button>'
        + '</div>'
        + '</div>'
    );
    budgetMessageResultWarp.append(budgetMessageResultContent);
    budgetMessageResult.append(budgetMessageResultWarp);
    budgetResultMessage.append(budgetMessageResult);
    
    $('.move_n-erp').on('click', function() {
        window.open('#none', '_blank');
    });
    
    return budgetResultMessage;
}

// 예산 조회 결과 에러 메세지
function budgetResultError(data) {
    
    var budgetResultMessage = $('<div class="custom-message"></div>');
    var budgetMessageResult = $('<div class="message"></div>');
    var budgetResultErrorWrap = $('<div class="message simple-text"></div>');
    
    var budgetResultErrorMessage = $(
         '<p>시스템 오류로 인해 조회되지 않았어요. 아래 버튼을 눌러 잔여 예산을 다시 조회해 보세요.</p>'
    );
    
    var budgetResultReloadBtn = $(
        '<div class="btn">'
        + '<button type="button" class="btn btn-default reload-budget">다시 조회하기</button>'
        + '</div>'
    );
    //appendChatbotText2(budgetResultErrorMessage);
    
    budgetResultReloadBtn.on('click', function() {
        console.log('aaaaa');
        addBudgetPopupOpen(data);

        ////////////     
        reloadSearchBudget(data);
        ////////////            
        
    });
    
    budgetResultErrorWrap.append(budgetResultErrorMessage);
    budgetResultErrorWrap.append(budgetResultReloadBtn);
    
    budgetMessageResult.append(budgetResultErrorWrap);
    budgetResultMessage.append(budgetMessageResult);
            
    return budgetResultMessage;
}

function reloadSearchBudget(data) {
    $('.budget-tooltip').fadeOut(1);
    $('.dropdown-budget .btn-dropdown').removeClass('accent');
    
    //console.log('list-type : '+$('#list-type > li').length);
    
    var listType = $('#list-type > li');
    for(var i=0; i<listType.length; i++) {
        
        var atag = $(listType[i]).find('a');
        
        if(atag.text() == data.accountType) {
            
            atag.trigger('click');
        }
    }
    
    //console.log('list-account : '+$('#list-account > li').length);
    
    var listAccount = $('#list-account > li');
    for(var i=0; i<listAccount.length; i++) {
        
        var nameTag = $(listAccount[i]).find('a');
        var codeTag = $(listAccount[i]).find('span');
        
        if(codeTag.text() == data.accountItem[0].ACCOUNT_CODE) {
            nameTag.trigger('click');
        }
    }
}

function getAmountComma(price) {
    return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

// 일정알람 메세지
function makeScheduleAlarmCard(data) {
    var scheduleAlarmCard = $('<div class="message"></div>');
    var scheduleAlarmWrap = $('<div class="schedule-alarm-wrap"></div>');
    scheduleAlarmCard.append(scheduleAlarmWrap);

    var scheduleAlarmHeader = $('<div class="schedule-alarm-header"></div>');
    var alarmIcon = $(
        '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
            +'<path fill="#2C2C2C" d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"></path>'
        +'</svg>'
    );
    var scheduleAlarmTitle = $('<h2>일정 15분 전입니다</h2>');
    scheduleAlarmHeader.append(alarmIcon);
    scheduleAlarmHeader.append(scheduleAlarmTitle);
    scheduleAlarmWrap.append(scheduleAlarmHeader);
    var scheduleAlarmContent = $('<div class="schedule-alarm-content"></div>');
    var scheduleAlarmContentText = $(
        '<div class="schedule-alarm-content-header">'
            +'<h3>일정 제목이 두 줄 이상일 경우 줄바꿈 처리하여 표기합니다.</h3>'
        +'</div>'
    );

    scheduleAlarmContent.append(scheduleAlarmContentText);
    var scheduleAlarmList = $('<ul class="schedule-alarm-list-wrap"></ul>');
    var scheduleAlarmTimeBox = $('<li class="time-box"><h4>시간 :</h4></li>');
    var scheduleAlarmTimeStartTime = $('<span>14:00</span>');
    var scheduleAlarmTimeEndTime = $('<span>15:00</span>');
    scheduleAlarmTimeBox.append(scheduleAlarmTimeStartTime);
    scheduleAlarmTimeBox.append(scheduleAlarmTimeEndTime);
    scheduleAlarmList.append(scheduleAlarmTimeBox);
    var scheduleAlarmPlace = $(
        '<li class="place-box">'
            +'<h4>장소 :</h4>'
            +'<span>'
                +'장소명이 들어갑니다.'
            +'</span>'
        +'</li>'
    );
    scheduleAlarmList.append(scheduleAlarmPlace);
    scheduleAlarmContent.append(scheduleAlarmList);
    scheduleAlarmWrap.append(scheduleAlarmContent);

    return scheduleAlarmCard;
};



// 일정등록 팝업 - 퍼블 작업용 샘플
function addSchedulePopupOpenRenew(data) {
    /*
var data = {
    "title": "일정 실패 테스트.",
    "allDayCheck": "Y",
    "startDate": "2024.05.03",
    "startTime": "",
    "endDate": "2024.05.03",
    "endTime": "",
    "attend": "",
    "placeName": "재택근무",
    "videoMeeting": "N",
    "privateSchedule": "N",
    "checkAttendance": "N",
    "attnedsName": "",
    "userId": "sangmin2.lee",
    "empNo": "245030",
    "chatSessionId": "24da3a88-f123-4eb4-8d2a-991e5ecf7552"
}*/

    console.log('addSchedulePopupOpenRenew > ', data); 
    var videoMeeting = 'N';
    var privateSchedule = (data.privateSchedule=='Y')? data.privateSchedule:'N';
    var checkAttendance = (data.checkAttendance=='Y')? data.checkAttendance:'N';

    /* #########[ popup_wrap_start ]######### */
    var pulginDim = $('<div class="plugin-dim show"></div>');
    var addScheduleBox = $('<div class="plugins" id="addSchedule"></div>');

    /* #########[ popup_header ]######### */
    var addScheduleHeader = $('<div class="plugin-header"><h1>일정 등록</h1></div>');
    var addShceduleClose = $(
        '<span class="close-plugin">'
            +'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
                +'<path d="M5.74478 4.75483C5.47141 4.48146 5.0282 4.48146 4.75483 4.75483C4.48146 5.0282 4.48146 5.47141 4.75483 5.74478L13.01 13.9999L4.75506 22.2548C4.48169 22.5282 4.48169 22.9714 4.75506 23.2448C5.02843 23.5181 5.47164 23.5181 5.74501 23.2448L13.9999 14.9899L22.2548 23.2448C22.5282 23.5181 22.9714 23.5181 23.2448 23.2448C23.5181 22.9714 23.5181 22.5282 23.2448 22.2548L14.9899 13.9999L23.245 5.74478C23.5184 5.47141 23.5184 5.0282 23.245 4.75483C22.9716 4.48146 22.5284 4.48146 22.2551 4.75483L13.9999 13.01L5.74478 4.75483Z" fill="#2C2C2C"/>'
            +'</svg>'
        +'</span>'
    );
    addShceduleClose.on('click', function() {
        addSchedulePopupClose();
    });
    addScheduleHeader.append(addShceduleClose);
    addScheduleBox.append(addScheduleHeader);

    /* #########[ popup_content_wrap_start ]######### */
    var addScheduleContents = $('<div class="plugin-contents"></div>');
    var addScheduleForm = $('<form data-sessionId="'+ data.chatSessionId.split("sessions/")[1] +'"' + 'data-userId="'+data.userId+'" class="form-schedule"></form>');
    
    /* #########[ popup_content ]######### */
    /* ###[ 제목 ]### */
    var titleInputBox = $('<div class="input-box"><label>제목<b>*</b></label></div>');   
    var titleInput = $('<input type="text" placeholder="제목을 입력해주세요." name="sch_title" id="sch_title" max-length="50" value="'+ (data.title? data.title:'') +'"/>');
    titleInput.on('keyup', function(e) {
        scheduleTitle = e.target.value;
        checkScheduleRequire();
    });
    titleInputBox.append(titleInput);    
    addScheduleForm.append(titleInputBox);
    
    /* ###[ 일시 ]### */
    var placeholderToday = moment().format('YYYY.MM.DD');
    var placeholderNowTime = '';
    if(moment().minute()<30) {
        placeholderNowTime = moment().minute(30).second(0);
    } else {
        placeholderNowTime= moment().add(1, 'hours').minute(0).second(0);
    }
   
    var placeholderNowTimeHourMinutes = moment(placeholderNowTime).format('HH:mm');
    var placeholderNowPlus30 = moment(placeholderNowTime).add(30, 'minutes').format('HH:mm');
  
    var timeInputBox = $('<div class="input-box"><label>일시<b>*</b></label></div>');
    var allDayBox = $('<div class="on-off-box"></div>');
    var allDayUl = $('<ul></ul>');
    var allDayLi = $('<li></li>');
    var allDayText = $('<span class="a-text">종일일정</span>');
    allDayLi.append(allDayText);
    var allDaySwitch = $(
        '<label class="switch">'
            +'<input type="checkbox" id="allDay" '+(data.allDayCheck=='Y'? 'checked':'')+' />'            // '+(data.allDayCheck=='Y'? 'checked':'')+'
            +'<span class="slider round"></span>'
        +'</label>'
    );
    allDayCheck = (data.allDayCheck=='Y')? data.allDayCheck:'N'; 
    allDaySwitch.on('click', function() {
        if($(this).find('#allDay').is(':checked')) {
            allDayCheck = 'Y';
            $('.schedule-input-wrap').find('.time-selector').css('display', 'none');
            $('.schedule-input-wrap').find('.input-schedule-date').addClass('all-day');
            //$('#start-time').val('0000');
            //$('#end-time').val('2400');
            //$('.time-input').val('');
        } else {
            allDayCheck = 'N';
            $('.schedule-input-wrap').find('.time-selector').css('display', 'unset');
            $('.schedule-input-wrap').find('.input-schedule-date').removeClass('all-day');
            $('#start-time').val(placeholderNowTimeHourMinutes);
            $('#end-time').val(placeholderNowPlus30);
        }
    });
    
    allDayLi.append(allDaySwitch);
    allDayUl.append(allDayLi);
    allDayBox.append(allDayUl);
    timeInputBox.append(allDayBox);
  
    var dateTimeWrap = $('<div class="schedule-wrap"></div>');
    var dateTimeStartBox = $('<div class="schedule-input-wrap schedule-date-wrap" id="start-date-box"></div>');
    var dateStartInput = $('<input type="text" placeholder="'+placeholderToday+'" value="'+(data.startDate? data.startDate:placeholderToday)+'" id="start-date" class="input-schedule-date startdate" onclick="datepicker.open(this)" />');
    dateTimeStartBox.append(dateStartInput);
    var timeStartSelect = $(
        '<div class="time-selector">'
            +'<input type="text" placeholder="'+placeholderNowTimeHourMinutes+'" value="'+(data.startTime? data.startTime:placeholderNowTimeHourMinutes)+'" id="start-time" class="time-input start-time" onclick="setTimePicker(this)"/>'
            +'<div class="time-options"></div>'
        +'</div>'
    );
   
    dateTimeStartBox.append(timeStartSelect);
    dateTimeWrap.append(dateTimeStartBox);
    var dateTimeEndBox = $('<div class="schedule-input-wrap schedule-date-wrap" id="end-date-box"></div>');
    var dateEndInput = $('<input type="text" placeholder="'+placeholderToday+'"  value="'+(data.endDate? data.endDate:placeholderToday)+'" id="end-date" class="input-schedule-date enddate" onclick="datepicker.open(this)" />');
    dateTimeEndBox.append(dateEndInput);
    var timeEndBox = $(
        '<div class="time-selector">'
            +'<input type="text" placeholder="'+placeholderNowPlus30+'" value="'+(data.endTime? data.endTime:placeholderNowPlus30)+'" id="end-time" class="time-input end-time" onclick="setTimePicker(this)"/>'
            +'<div class="time-options"></div>'
        +'</div>'
    );
    
    dateTimeEndBox.append(timeEndBox);
    dateTimeWrap.append(dateTimeEndBox);
    timeInputBox.append(dateTimeWrap);
    addScheduleForm.append(timeInputBox);

    /* ###[ 장소 ]### */
    var placeInputBox = $('<div class="input-box add-schedule-place"><label>장소</label></div>');
    var placeSelectBox = $('<div class="place-select"></div>');
    var placedSelected = $('<div class="selected-place"></div>');
    placeSelectBox.append(placedSelected);
    var placeTooltip = $('<div class="place-tooltip">설정된 일시에 예약 가능한 회의실을 불러올 수 있어요.</div>');
    placeSelectBox.append(placeTooltip);
  
    //var startDate = moment(dateStartInput.val()).format('YYYYMMDD') + (placeholderNowTimeHourMinutes ? placeholderNowTimeHourMinutes.split(':').join('') : '0000');
    var startDate = moment($('#start-date').val()).format('YYYYMMDD') + (placeholderNowTimeHourMinutes ? placeholderNowTimeHourMinutes.split(':').join('') : '0000');
    if (!startDate || startDate == 'Invalid date') {
        startDate = moment().format('YYYYMMDD') + '0000';
    };
    //var endDate = moment(dateEndInput.val()).format('YYYYMMDD') + (placeholderNowPlus30 ? placeholderNowPlus30.split(':').join('') : '2400');
    var endDate = moment($('#end-date').val()).format('YYYYMMDD') + (placeholderNowPlus30 ? placeholderNowPlus30.split(':').join('') : '2400');
    if (!endDate || endDate == 'Invalid date') {
        endDate = moment().format('YYYYMMDD') + '2400';
    };
    var userId = data.userId;
    var empNo = data.empNo;    // "999991"; //
    
    var placeInput = $('<input type="text" placeholder="회의실 선택 또는 장소를 입력해 주세요." id="schedule-place" />');
    var placeList = $('<div class="place-list"></div>');
    var placeByText = $('<div class="place-text"><p class="texted"></p><p class="small">입력한 이 위치 사용하기</p></div>');
    var placeValue = '';
    placeList.append(placeByText);

    placeInput.on('keyup', function() {
        placeValue = $(this).val();
        if (placeValue.length > 0) {
            $('.place-text').addClass('show');
            $('.place-text .texted').text(placeValue); 
        } else {
            $('.place-text').removeClass('show');
            $('.place-text .texted').text(''); 
        }
    });
  
    // [입력한 이 위치에 사용하기] 클릭
    placeByText.on('click', function() {
        var placeInfo = $(
            '<div class="place-info">'
                + placeValue
                + '<button type="button" class="btn btn-delete">' 
                    + '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
                        + '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
                    + '</svg>'
                + '</button>'
                + '<input type="hidden" value="'+ placeValue +'" class="place-name"/>'
            +'</div>'
        );
  
        placedSelected.empty();
        placeInput.val('');
        $('.place-text').removeClass('show');
        $('.place-text .texted').text(''); 
        placedSelected.append(placeInfo);
        
        // [퍼블 수정 및 추가]
        var targetHeight = $('.selected-place').height();
        $('.place-select').removeClass('focus');
        console.log(targetHeight);

        $('.place-list').removeClass('show');
        // $('.place-list').css('top', '82px');
        $('.place-list').css('top', Math.floor(targetHeight + 6) + 'px'); // [퍼블 수정 및 추가] - 높이 값 재배치
        $('#schedule-place').attr('placeholder', '');

        schedulePlaceWidth();
    });
   
    var plcaeListTitle = $('<span>예약 가능한 회의실 목록</span>');
    placeList.append(plcaeListTitle);
    
    var placeUl = $('<ul></ul>');
    placeInput.on('focus', function() {
        
        // [퍼블 수정 및 추가] - place-select 스타일 변경
        $('.place-select').addClass('focus');
            
        $('.place-list').addClass('show');
        placeUl.empty();

        //startDate =  moment(dateStartInput.val()).format('YYYYMMDD');
        startDate =  moment($('#start-date').val()).format('YYYYMMDD');
        startTime = ($('#start-time').val() ? $('#start-time').val().split(':').join('') : '0000');
        //endDate = moment(dateEndInput.val()).format('YYYYMMDD');
        endDate = moment($('#end-date').val()).format('YYYYMMDD');
        endTime = ($('#end-time').val() ? $('#end-time').val().split(':').join('') : '2400');
        
        //startDate = '20221124'; 
        //endDate = '20221125';
        if(startDate && endDate) {
          var requestParam = {
            query: {
              "event": "avaliableFacilityListEvent"
            },
            payload: {
                searchStartDt:startDate,
                searchStartTime:startTime,
                searchEndDt:endDate, 
                searchEndTime:endTime, 
                loginUserId:"999991"
            }
          };
          
          sendChatApi(requestParam, null, function(payload){
            //console.log('payload > ', payload);
            var result = JSON.parse(payload.queryResult.messages[1].response);
            console.log('result', result);
            meetingRoomList = result.result;
    
            if(meetingRoomList.length == 0) {
              var placeLi = $('<li class="no-res">예약가능한 회의실이 없습니다.</li>');
              placeUl.append(placeLi);
              placeList.append(placeUl);
            } else {
              meetingRoomList.map(meetingRoom => {
                
                var placeLi = $(
                    '<li>'
                        +'<p>'+ meetingRoom.facilityName // + '(회의실 이름)' 
                        +'</p>'
                        +'<p class="small">'
                        + $('#start-time').val() +' ~ '+ $('#end-time').val() +' · ' + meetingRoom.categoryFullName
                        +'</p>'
                    +'</li>'
                );
                
                // 예약 가능한 회의실 목록 리스트 클릭
                placeLi.on('click', function() {
                    var placeInfo = $(
                        '<div class="place-info">'
                            + meetingRoom.facilityName + '&nbsp;&nbsp;'  + meetingRoom.categoryFullName
                            + '<button type="button" class="btn btn-delete">' 
                                + '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
                                    + '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
                                + '</svg>'
                            + '</button>'
                          + '<input type="hidden" value="'+ meetingRoom.facilityName +'" class="facility-name"/>'
                          + '<input type="hidden" value="'+ meetingRoom.facilityId +'" class="facility-id"/>'
                        +'</div>'
                    );
                    placedSelected.empty();
                    placedSelected.append(placeInfo);
                    
                    // [퍼블 수정 및 추가]
                    var targetHeight = $('.selected-place').height();
                    $('.place-select').removeClass('focus');
                    console.log(targetHeight);
    
                    $('.place-list').removeClass('show');
                    // $('.place-list').css('top', '82px');
                    $('.place-list').css('top', Math.floor(targetHeight + 6) + 'px'); // [퍼블 수정 및 추가] - 높이 값 재배치
                    $('#schedule-place').attr('placeholder', '');
                    schedulePlaceWidth();
                });
      
                placeUl.append(placeLi);
              });
              placeList.append(placeUl);
            }
    
      
          });
          
        }
        ///////
    });
  
    placeSelectBox.append(placeInput);
    placeSelectBox.append(placeList);
    placeInputBox.append(placeSelectBox);
    addScheduleForm.append(placeInputBox);
  
    // 지정된 장소 삭제 버튼 클릭
    $(document).on('click', '.place-info .btn-delete', function(){
        $(this).closest(".place-info").remove();
        $('#schedule-place').attr('placeholder', '장소를 입력해 주세요.');
        // $('.place-list').css('top', '82px');
        $('.place-list').css('top', ''); // [퍼블 수정 및 추가] - 높이 값 제거
        schedulePlaceWidth();
    });

    // place-select 제외 클릭
    $(document).on('click', function(e) {
        if ($('.place-select').has(e.target).length === 0) {
            $('.place-list').removeClass('show');
            
            // [퍼블 수정 및 추가] - place-select 스타일 변경
            $('.place-select').removeClass('focus');
        }
    });

    $(window).resize(function() {
        schedulePlaceWidth();
    });

    // 장소 입력 input width 변경
    function schedulePlaceWidth() {
        let placeSelectWidth = $('.place-select').width();
        let selectedPlaceWidth = $('.selected-place').width();
        let schedulePlaceWidth = placeSelectWidth - selectedPlaceWidth;
        $('#schedule-place').css('width', schedulePlaceWidth + "px");
        if ($('#schedule-place').width() === 0) {
            $('#schedule-place').attr('style', '');
        };
    };

    /* ###[ 참석자 ]### */
    var memberInputBox = $('<div class="input-box"><label>참석자</label></div></div>');
    var memberList = $('<div class="schedule-join-member"></div>');
    
    var selectedMembers = $('<div class="selected-members fold"></div>');
    memberList.append(selectedMembers);
    var autocompleteMember = $('<div class="autocomplete-member"><ul id="ui-id-2" tabindex="0" class="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front" style="display: none;"></ul></div>');
    memberList.append(autocompleteMember);
    var memberInput = $('<input type="text" placeholder="직원명을 입력해 주세요" id="attendees" class="search-input" />');
    setAutocompleteJoinMember(memberInput);
    memberList.append(memberInput);
    memberInputBox.append(memberList);
    addScheduleForm.append(memberInputBox);
    
    // [퍼블 수정 및 추가] - 포커스 이벤트
    memberList.find('.search-input').focus(function() {
        memberList.addClass('focus');
    }).blur(function() {
        memberList.removeClass('focus');
    });
    
    // [퍼블 수정 및 추가] - 참석인 선택 유무에 따라 input 스타일 변경
    $(document).on('click', '.schedule-join-member .btn-delete', function() {
        if ($('.member-info').length > 0) {
            memberInput.addClass('select');
        } else {
            memberInput.removeClass('select');
        }
    })
    $(document).on('click', '.schedule-join-member .ui-menu-item', function() {
        if ($('.member-info').length > 0) {
            memberInput.addClass('select');
        } else {
            memberInput.removeClass('select');
        }
    })
    
    /* ###[ 기타 옵션 ]### */
    var otherOptionsBox = $('<div class="input-box"><p>기타 옵션</p></div>');
    var otherOptions = $('<div class="on-off-box"></div>');
    var otherOptionsUl = $('<ul></ul>');

    // 비공개 일정
    var privateLi = $('<li><span class="a-text">비공개 일정</span></li>');
    var privateSwitch = $(
        '<label class="switch">'
            +'<input type="checkbox" id="privateSchedule" value="Y" name="private" '+(data.privateSchedule=='Y'? 'checked':'')+'/>'
            +'<span class="slider round"></span>'
        +'</label>'
    );
    privateSwitch.on('click', function() {
        if($(this).find('#privateSchedule').is(':checked')) {
            privateSchedule = 'Y';
        } else {
            privateSchedule = 'N';
        }   
    });
    privateLi.append(privateSwitch);
    otherOptionsUl.append(privateLi);

    // 참여 여부 확인
    var checkAttendanceLi = $('<li><span class="a-text">참여 여부 확인</span></li>');
    var checkAttendanceSwitch = $(
        '<label class="switch">'
            +'<input type="checkbox" id="checkAttendance" '+(data.checkAttendance=='Y'? 'checked':'')+'/>'
            +'<span class="slider round"></span>'
        +'</label>'
    );
    checkAttendanceSwitch.on('click', function() {
        if($(this).find('#checkAttendance').is(':checked')) {
            checkAttendance = 'Y';
        } else {
            checkAttendance = 'N';
        } 
    });
    checkAttendanceLi.append(checkAttendanceSwitch);
    otherOptionsUl.append(checkAttendanceLi);
    otherOptions.append(otherOptionsUl);
    otherOptionsBox.append(otherOptions);
    addScheduleForm.append(otherOptionsBox);
  

    /* ###[ etc ]### */
    // 반복일정 등 상세 일정 등록_gportal
    var detailSubmitLink = $(
        '<p class="detail-submit">'
            +'<a href="http://gportal.lgchem.com/lightpack/planner/calendar/init.do#">반복일정 등의 상세 일정 등록은 여기를 클릭해 주세요.</a>'
        +'</p>'
    );
    //addScheduleForm.append(detailSubmitLink);

    // 저장 버튼
    var addScheduleSubmit = $('<button type="button" class="btn btn-plugin btn-apply btn-disabled" id="btn-schedule">저장</button>');
    addScheduleForm.append(addScheduleSubmit);
    addScheduleSubmit.on('click', function() {
        if(scheduleSaveLoading) return;
        scheduleSaveLoading = true;
        $(this).addClass('btn-loading');
        var attends = '';
        var idInputs = $(this).parents(".form-schedule").find('.person-empNo');
        for(var k=0; k < idInputs.length; k++) {
            if(k == idInputs.length-1) {
                attends += $(idInputs[k]).val()
            } else {
                attends += $(idInputs[k]).val() + ','
            }
        };
  
        var attnedsName = '';
        var nameInputs = $(this).parents(".form-schedule").find('.person-name');
        for(var k=0; k < nameInputs.length; k++) {
            if(k == nameInputs.length-1) {
                attnedsName += $(nameInputs[k]).val()
            } else {
                attnedsName += $(nameInputs[k]).val() + ','
            }
        };
  
        var webxIds = '';
        var emailInputs = $(this).parents(".form-schedule").find('.person-email');
        for(var k=0; k < emailInputs.length; k++) {
            if(k == emailInputs.length-1) {
                webxIds += $(emailInputs[k]).val()
            } else {
                webxIds += $(emailInputs[k]).val() + ','
            }
        };
    
        var chatSessionId = chatui.getSessionId();
        
        var schedule = {
            title : scheduleTitle,
            allDayCheck : allDayCheck,
            startDate : $('#start-date').val(),
            startTime : $('#start-time').val(),
            endDate: $('#end-date').val(),
            endTime: $('#end-time').val(),
            attend: attends,
            location: $('.facility-name').val(),
            facilityId: $('.facility-id').val(),
            placeName: placeValue,
            videoMeeting: videoMeeting,
            privateSchedule : privateSchedule,
            checkAttendance : checkAttendance,
            attnedsName: attnedsName, 
            userId:userId, 
            empNo:empNo, 
            chatSessionId:chatSessionId
        }
    
        var startDate = $('#start-date').val().split('.').join('');
        if ($('#start-time').val()) {
            startDate += $('#start-time').val().split(':').join('')
        }
        var endDate = $('#end-date').val().split('.').join('');
        if ($('#end-time').val()) {
            endDate +=  $('#end-time').val().split(':').join('');
        }
    
        var requestParam = {
            query: {
                "event": "scheduleRegEvent"
            },
            payload: {
                userId:userId,
                empNo:empNo, 
                title : scheduleTitle,
                wholeDay : allDayCheck,
                startDate :startDate,
                endDate:endDate,
                place: ($('.place-name').val() == 'undefined' || $('.place-name').val() == null)? '':$('.place-name').val(),
                facilityId: $('.facility-id').val(),
                videoMeeting: videoMeeting,
                publicYn : privateSchedule,
                webexYn : data.webexYn,
                shareList: attends,
                webexShareList: webxIds,
                isAttendance: checkAttendance
            }
        };
      
        console.log('save - schedule > ', schedule);
        console.log('save - requestParam > ', requestParam);
        if ($('#btn-schedule').hasClass('btn-disabled')) {
            return;
        } else {
            
            ///
            
            sendChatApi(requestParam, userId, function(payload) {
                scheduleSaveLoading = false;
                $('#btn-schedule').removeClass('btn-loading');
  
                console.log('일정 등록 : ', payload);
                var savedInfo = '';
                var regSuccessYn = '';
                if (payload && payload.queryResult && payload.queryResult.messages.length > 1 && payload.queryResult.messages[1].response) {
                    var savedResponse = JSON.parse(payload.queryResult.messages[1].response);
                    console.log(savedResponse["successYn"]);
                    if (savedResponse["successYn"] == 'N') {
                        if(savedResponse["errorMessage"] == 'duplicate') {           // 이미 에약된 회의실인 경우. 
                            showHtmlSmallDialog(payload.queryResult.messages[0].message);
                            return;
                        }
                        else{
                            console.log('errorMessage : '+savedResponse["errorMessage"]);
                            regSuccessYn = 'N';
                        }
                    } else {
                        regSuccessYn = 'Y';
                        if (savedResponse.template && savedResponse.template.outputs.length > 0 && savedResponse.template.outputs[0] && savedResponse.template.outputs[0].resultItem) {
                            savedInfo = savedResponse.template.outputs[0].resultItem;
                        }
                    }
                    
                }
        
                addSchedulePopupClose();

                if(regSuccessYn == 'N') {
                    
                    var scheduleResult = '<div class="message simple-text">'
                                + '<p>일정 등록에 실패했습니다. 다시 시도해 주세요.</p>'
                                + '<div class="btn">'
                                + '<button type="button" class="btn btn-default reload-schedule">일정 재등록</button>'
                                + '</div>'
                        +'</div>';
                    appendChatbotText(scheduleResult);
    
                    $('.reload-schedule').on('click', function() {
                        //addSchedulePopupOpen(data);
                        addSchedulePopupOpenRenew(schedule);
                    });
    
                }   
                else{
                
                    console.log('일정 등록 완료 : ', savedInfo);
                    
                    var isMobile = Mobile();
                    var scheduleResult = 
                    '<div class="message schedule-wrap">'
                        +'<div class="s-header"><span class="s-date">'+ iconCalendar +'<h1><b>새로운 일정</b>이 등록되었어요</h1></span></div>'
                        +'<ul class="schedule-list s-list">'
                            +'<li class="added-schedule">'
                                +'<div class="detail-box">'
                                    +'<div class="time">'
                                        +'<h3>'+ (schedule.allDayCheck == 'Y' ? "종일" : schedule.startTime) + '</h3>'
                                        +'<h5>'+ (schedule.allDayCheck == 'Y' ? "" : schedule.endTime) + '</h5>'
                                    +'</div>'
                                    +'<div class="s-detail">'
                                        + '<h2>' + (schedule.privateSchedule == 'Y' ? iconPrivate : '') + (schedule.videoMeeting == 'Y' ? iconVideoMeeting : '') + schedule.title +'</h2>'
                                        
                                        + '<p class="date-box">' + iconCalendar + schedule.startDate +' - ' + schedule.endDate + '</p>'
                                        + (schedule.location ? '<p class="place-box">' + iconPlaceSmall + schedule.location + '</p>' : '')
                                        + (schedule.placeName ? '<p class="place-box">' + iconPlaceSmall + schedule.placeName + '</p>' : '')
                                        + (schedule.attnedsName ? '<p class="people-box">' + iconPeople + '<strong class="people-list">' + schedule.attnedsName + '</strong></p>' : '')
                                
                                    + '</div>'
                                +'</div>'
                                + (savedInfo.meetingNo ? '<div class="webx-info">'
                                    + '<p><span class="webx-label">미팅번호</span><span class="webx-desc">'+ savedInfo.meetingNo +'</span></p>'
                                    + '<p><span class="webx-label">비밀번호</span><span class="webx-desc">'+ savedInfo.meetingPw +'</span></p>'
                                    + '<p><span class="webx-label">호스트키</span><span class="webx-desc">'+ savedInfo.meetingHost +'</span></p>'
                                    + (!isMobile ? '<a class="btn-default" href="'+ savedInfo.meetingUrl +'" target="_blank"><span class="btns-desc">웹엑스 바로가기</span>'+ iconNewWindow +'</a>':'')
                                + '</div>' : '')
                            +'</li>'
                        +'</ul">'
                    +'</div>'
                    appendChatbotText(scheduleResult);
    
                    // [퍼블 수정 및 추가] - 사원 split
                    function peopleSplit() {
                        let peopleItemData;
                        let peopleList = schedule.attnedsName;
                            console.log(peopleList);
                        peopleList = peopleList.split(",");
                            console.log(peopleList);
                        $('strong.people-list').empty();
                        for (let i = 0; i < peopleList.length; i++ ) {
                            peopleItemData = $('<span>' + peopleList[i] + '</span>');
                            console.log(peopleItemData);
                            $('strong.people-list').append(peopleItemData);
                        }
                    
                        let peoplesNum;
                        let peoplesCount;
                        $('.people-list > span').each(function(index, item) {
                            peoplesNum = index - 1;
                            if (index > 1) {
                                if ($(this).parents('.people-list').find('b').length) {
                                    $(this).parents('.people-list').find('b span').text(peoplesNum)
                                } else {
                                    peoplesCount = $('<b>외 <span>' + peoplesNum + '</span>명</b>');
                                    $('.people-list').append(peoplesCount);
                                };
                                $(this).remove();
                            };
                        });
                    }; peopleSplit()
    
                    // [퍼블 수정 및 추가] - 같은날짜 제거
                    function dateCompare() {
                        if (schedule.startDate == schedule.endDate) {
                            $('.date-box').empty();
                            $('.date-box').append(iconCalendar + schedule.startDate);
                        };
                    }; dateCompare();

                }
            });
            
            ///// 
        };
    });
  
    /* #########[ popup_content_wrap_end ]######### */
    addScheduleContents.append(addScheduleForm);
    addScheduleBox.append(addScheduleContents);

    /* #########[ popup_wrap_end ]######### */
    $('.test-panel').append(pulginDim);
    $('.test-panel').append(addScheduleBox);
    $('.plugin-dim').css('display', 'block');
    $('#addSchedule').css('display', 'block');
  
    setTimeout(function() {
        $('.plugin-dim').addClass('show');
        $('#addSchedule').addClass('show');
        
    }, 100);
  
    /*  #########[ datepicker ]#########  */
    var datepicker = $('<div class="datepicker-chem"></div>');
    $('.schedule-input-wrap').append(datepicker);
    
    // 재등록시 이벤트 실행. start
    if(data.title) {
        scheduleTitle = $('#sch_title').val();
        checkScheduleRequire();
    }
    if(data.allDayCheck=='Y') {
        $('.schedule-input-wrap').find('.time-selector').css('display', 'none');
        $('.schedule-input-wrap').find('.input-schedule-date').addClass('all-day');
        $('.time-input').val('');
    }
    
    if(data.placeName) {
        var placeInfo = $(
            '<div class="place-info">'
                + data.placeName
                + '<button type="button" class="btn btn-delete">' 
                    + '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
                        + '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
                    + '</svg>'
                + '</button>'
                + '<input type="hidden" value="'+ data.placeName +'" class="place-name"/>'
            +'</div>'
        );
    
        $('.selected-place').append(placeInfo);
        
        $('#schedule-place').attr('placeholder', '');
        schedulePlaceWidth();        
    }    
    
    if(data.location) {
        var placeInfo = $(
            '<div class="place-info">'
                + data.location + '&nbsp;&nbsp;'  // + meetingRoom.categoryFullName
                + '<button type="button" class="btn btn-delete">' 
                    + '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
                        + '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
                    + '</svg>'
                + '</button>'
              + '<input type="hidden" value="'+ data.location +'" class="facility-name"/>'
              + '<input type="hidden" value="'+ data.facilityId +'" class="facility-id"/>'
            +'</div>'
        );

        $('.selected-place').append(placeInfo);
        $('#schedule-place').attr('placeholder', '');
        schedulePlaceWidth();
    }
    
    if(data.attnedsName) {
        //var $memList = $('#attendees').closest(".form-schedule").find(".schedule-join-member").find(".selected-members");
          var htmlStr;

          var peopleList = data.attnedsName.split(",");
          var empNoList = data.attend.split(",");
          //$('#attendees').val('').focus();

            for(var i=0; i<peopleList.length; i++) {
               htmlStr = '<div class="member-info">'
                  + peopleList[i]
                  + '<button type="button" class="btn btn-delete">' 
                    +  '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
                    +  '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
                    +  '</svg>'
                  + '</button>'
                  +'<div class="auto-detail-tooltip"></div>'
                  + '<input type="hidden" value="" class="person-mobile"/>'
                  + '<input type="hidden" value="" class="person-email"/>'
                  + '<input type="hidden" value="'+peopleList[i]+'" class="person-name"/>'
                  + '<input type="hidden" value="" class="person-userId"/>'
                  + '<input type="hidden" value="'+empNoList[i]+'" class="person-empNo"/>'
                  +'</div>';
                  
                $('.selected-members').append(htmlStr);    
            }
          
          $('#attendees').attr('placeholder', '');
        
    }
    // 재등록시 이벤트 실행. end
        
    
};

// 스케줄 셋팅 테스트
function makeScheduleItemSample(scheduleList, scheduleBody){
    var scheduleItem = $('<li class="schedule-item schedule-notwholeTime"></li>');
    scheduleList.append(scheduleItem);
    var scheduleItemTime = $('<div class="time"><h3>17:00</h3><h5>17:30</h5></div>');
    scheduleItem.append(scheduleItemTime);
    var scheduleItemDetail = $('<div class="s-detail"></div>');
    scheduleItem.append(scheduleItemDetail);
    var scheduleItemTitle = $('<h2 class="schedule-todo"><span>테스트01(일정제목)</span></h2>');
    scheduleItemDetail.append(scheduleItemTitle);
    var scheduleItemPlaceWrap = $(
        '<p>'
            +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
                +'<path fill-rule="evenodd" clip-rule="evenodd" d="M10.3334 6.66683C10.3334 7.95549 9.28875 9.00016 8.00008 9.00016C6.71142 9.00016 5.66675 7.95549 5.66675 6.66683C5.66675 5.37817 6.71142 4.3335 8.00008 4.3335C9.28875 4.3335 10.3334 5.37817 10.3334 6.66683ZM9.53341 6.66683C9.53341 7.51367 8.84692 8.20016 8.00008 8.20016C7.15324 8.20016 6.46675 7.51367 6.46675 6.66683C6.46675 5.81999 7.15324 5.1335 8.00008 5.1335C8.84692 5.1335 9.53341 5.81999 9.53341 6.66683Z" fill="#898989"></path>'
                +'<path fill-rule="evenodd" clip-rule="evenodd" d="M11.7713 10.6668C11.1659 11.5683 9.65522 13.3353 8.74013 14.3853C8.34745 14.8359 7.65271 14.8359 7.26003 14.3853C6.34495 13.3353 4.83426 11.5683 4.22885 10.6668C3.33341 9.3335 2.66675 8.03175 2.66675 6.66684C2.66675 5.30192 3.18744 3.93699 4.22885 2.89559C6.31164 0.812797 9.68852 0.812797 11.7713 2.89559C12.8127 3.93699 13.3334 5.30192 13.3334 6.66684C13.3334 8.03175 12.6667 9.3335 11.7713 10.6668ZM4.79453 3.46128C6.56491 1.6909 9.43526 1.6909 11.2056 3.46128C12.091 4.34663 12.5334 5.50541 12.5334 6.66684C12.5334 7.77819 11.9882 8.90901 11.1072 10.2208C10.5361 11.0712 9.06426 12.7957 8.13702 13.8597C8.06318 13.9445 7.93698 13.9445 7.86314 13.8597C6.9359 12.7957 5.46407 11.0712 4.89298 10.2208C4.012 8.90901 3.46675 7.77819 3.46675 6.66684C3.46675 5.50541 3.90918 4.34663 4.79453 3.46128Z" fill="#898989"></path>'
            +'</svg>'
        +'</p>'
    );
    scheduleItemDetail.append(scheduleItemPlaceWrap);
    var scheduleItemPlaceItem = $('<span>테스트01(일정장소)</span>');
    scheduleItemPlaceWrap.append(scheduleItemPlaceItem);

    // 참여 확인 버튼
    var attendGroup = $('<div class="attend-check"></div>');
    scheduleItemDetail.append(attendGroup);
    var attendBtn = $(
        '<button class="attend-button">'
            +'<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="check"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.9121 3.18797C11.0293 3.30512 11.0293 3.49507 10.9121 3.61223L5.56814 8.95622C5.15814 9.36622 4.49342 9.36628 4.08335 8.95635L1.08791 5.96196C0.970727 5.84482 0.970694 5.65487 1.08783 5.53769C1.20497 5.42052 1.39492 5.42048 1.51209 5.53762L4.50754 8.53201C4.68328 8.70769 4.96816 8.70767 5.14388 8.53196L10.4879 3.18797C10.605 3.07081 10.795 3.07081 10.9121 3.18797Z" fill="#6B6B6B"/></svg>'
            +'<span class="attend-text">' + '미정' +'</span>'
            +'<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="down-arrow"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.70133 7.78633C5.87183 7.93789 6.12876 7.93789 6.29925 7.78633L10.301 4.22924C10.4248 4.11917 10.6144 4.13032 10.7245 4.25416C10.8346 4.37799 10.8234 4.56761 10.6996 4.67769L6.69787 8.23478C6.30004 8.58841 5.70054 8.58841 5.30271 8.23478L1.30098 4.67769C1.17715 4.56761 1.16599 4.37799 1.27607 4.25416C1.38614 4.13032 1.57576 4.11917 1.6996 4.22924L5.70133 7.78633Z" fill="#6B6B6B"/></svg>'
        +'</button>'
    );
    attendBtn.on('click', function(event) {
        event.stopPropagation();
        attendChangeOpen();
    });
    attendGroup.append(attendBtn);
    
    // 일정 삭제 버튼
    var scheduleItemDelet = $(
        '<button type="button" class="s-delete" onclick="event.cancelBubble=true;">'
            +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
                +'<path d="M6.66668 5.93343C6.8876 5.93343 7.06668 6.11252 7.06668 6.33343V11.3334C7.06668 11.5543 6.8876 11.7334 6.66668 11.7334C6.44577 11.7334 6.26668 11.5543 6.26668 11.3334L6.26668 6.33343C6.26668 6.11252 6.44577 5.93343 6.66668 5.93343Z" fill="#A5A5A5"></path>'
                +'<path d="M9.73335 6.33343C9.73335 6.11252 9.55426 5.93343 9.33335 5.93343C9.11244 5.93343 8.93335 6.11252 8.93335 6.33343V11.3334C8.93335 11.5543 9.11244 11.7334 9.33335 11.7334C9.55426 11.7334 9.73335 11.5543 9.73335 11.3334L9.73335 6.33343Z" fill="#A5A5A5"></path>'
                +'<path fill-rule="evenodd" clip-rule="evenodd" d="M5.66675 2.3335C5.66675 1.78121 6.11446 1.3335 6.66675 1.3335H9.33341C9.8857 1.3335 10.3334 1.78121 10.3334 2.3335V3.2002L12.9334 3.20019C13.1543 3.20019 13.3334 3.37928 13.3334 3.60019C13.3334 3.82111 13.1543 4.00019 12.9334 4.00019H12.6667V12.5335C12.6667 13.6381 11.7713 14.5335 10.6667 14.5335H5.33341C4.22885 14.5335 3.33341 13.6381 3.33341 12.5335V4.0002H3.06675C2.84583 4.0002 2.66675 3.82111 2.66675 3.6002C2.66675 3.37928 2.84583 3.2002 3.06675 3.2002H5.66675V2.3335ZM6.66675 2.1335H9.33341C9.44387 2.1335 9.53341 2.22304 9.53341 2.3335V3.20016H6.46675V2.3335C6.46675 2.22304 6.55629 2.1335 6.66675 2.1335ZM4.13341 4.0002H11.8667V12.5335C11.8667 13.1963 11.3295 13.7335 10.6667 13.7335H5.33341C4.67067 13.7335 4.13341 13.1963 4.13341 12.5335V4.0002Z" fill="#A5A5A5"></path>'
            +'</svg>'
        +'</button>'
    );
    scheduleItem.append(scheduleItemDelet);
    
    scheduleItemDelet.click(function(){
        $(this).parents('li').addClass('cancel-line');
        $(this).parents('li').find('.attend-button').attr('disabled', true);
        $(this).remove();
        setTimeout(function() {
            showSmallDialog('일정 및 회의실이 삭제되었습니다.');
        }, 500);
    });

    // 참석여부 보기(테스트용)
    var attednCheck = $('<div class="schedule-list-header attend"></div>');
    scheduleBody.append(attednCheck);
    var scheduleListHeaderLabel = $('<span class="a-text">참석여부 보기</span>');
    attednCheck.append(scheduleListHeaderLabel);
    var scheduleListHeaderSwitch = $('<label class="switch"></label>');
    attednCheck.append(scheduleListHeaderSwitch);
    var switchCheckbox = $('<input type="checkbox" cname="attendView" class="check-attendView" />');
    scheduleListHeaderSwitch.append(switchCheckbox);
    scheduleListHeaderSwitch.append($('<span class="slider round"></span>'));
    scheduleListHeaderSwitch.on('click', function() {
        var $scheduleWrap = $(this).closest(".schedule-wrap");
        $(this).find(".check-attendView").prop("checked", !$(this).find(".check-attendView").prop("checked"));
        if ($(this).find(".check-attendView").prop("checked") == true) {
            $scheduleWrap.find(".attend-check").addClass("show");
        } else {
            $scheduleWrap.find(".attend-check").removeClass("show");
        }
    });
    
}


// 일정 등록 실패
function scheduleResultError(data) {
    console.log('scheduleResultError : ', data);
    var scheduleResultMessage = $('<div class="custom-message"></div>');
    var scheduleMessageResult = $('<div class="message"></div>');
    var scheduleResultErrorWrap = $('<div class="message simple-text"></div>');
    
    var scheduleResultErrorMessage = $(
         '<p>일정 등록에 실패했습니다. 다시 시도해 주세요.</p>'
    );
    var scheduleResultReloadBtn = $(
        '<div class="btn">'
        + '<button type="button" class="btn btn-default reload-schedule">일정 재등록</button>'
        + '</div>'
    );
    scheduleResultReloadBtn.on('click', function() {
        addSchedulePopupOpen(data);
        // addSchedulePopupOpenRenew(data);
    });
    
    scheduleResultErrorWrap.append(scheduleResultErrorMessage);
    scheduleResultErrorWrap.append(scheduleResultReloadBtn);
    
    scheduleMessageResult.append(scheduleResultErrorWrap);
    //scheduleResultMessage.append(scheduleMessageResult);
    
            
    return scheduleMessageResult;
}


// 시스템 업무 접속 카드 생성
function makeSystemCardMoveCard(item) {
    var systemCardMove = $('<div class="message simple-text"></div>');
    var SystemCardMoveText = $('<p>시스템에 접속하시려면 아래 버튼을 클릭해 주세요.</p>');
    systemCardMove.append(SystemCardMoveText);
    var moveBtnWrap = $('<div class="btn"></div>');
    var moveBtn = $(
        '<button type="button" class="btn btn-default move_link" data-outlink="'+item.sysUrl+'">'
            + item.sysName + '&nbsp;' +iconNewWindow
        +'</button>'
    );
    
    moveBtn.on('click', function() {
        var outlink = $(this).data('outlink');
        window.open(outlink, '_blank');
    });    
    moveBtnWrap.append(moveBtn);
    systemCardMove.append(moveBtnWrap);
    return systemCardMove;
}

function showHtmlSmallDialog(msg) {
  $('.test-panel').append('<div class="small-dialog"></div>');
  $('.small-dialog').html(msg);
  $('.small-dialog').addClass('show');
  setTimeout(function() {
    $('.small-dialog').removeClass('show');
  }, 2000);

  setTimeout(function() {
    $('.small-dialog').remove();
  }, 5000);
}

// 시스템 담당자 조회 : 시스템 클릭시 
function appendChatbotText3(firstMsg, message, customQuick) {
  var chatMessage = $('<div class="chat-message left"></div>');
  var profile = $('<div class="profile"><img class="img-circle" src="'+imgBaseUrl+'/images/chem-profile.png"></div>');
  chatMessage.append(profile);
  chatMessage.append(firstMsg);
  chatMessage.append(message);
  chatMessage.append(customQuick);
  var date = $('<span class="message-date">' + moment().format("a h:mm") + '</span>');
  chatMessage.append(date);

  $('#divScroll').append(chatMessage);
  
  //descendScroll();
  setTimeout(function() {
    $('.btn-system').on('click', function() {
      var systemSelect = $(this).data('system');
  
      appendQueryText(systemSelect);
      var item = systemItems.find((o) => { return o["sysName"] === systemSelect })      
      
      var systemCardTop = makeSystemCardMoveCard(item); // [퍼블 수정 및 추가] - 시스템 접속 card 추가
      
      var systemCard = makeSystemCard(item);
      var customQuick = $('<div class="custom-quick-reply"></div>');
      systemItems.map(sysItem => {
        if(systemSelect != sysItem.sysName) {
          var sysbtn2 = $('<span class="btn-custom-reply btn-system" data-system="' + sysItem.sysName + '">' + sysItem.sysName +'</span>'); 
          customQuick.append(sysbtn2);
        }
      });

      $(this).parent().remove();

    appendChatbotText3(systemCardTop, systemCard, customQuick); // [퍼블 수정 및 추가] - 시스템 접속 card 포함하여 생성
    });
  
  }, 100);
  
}


// 240530 [퍼블 추가]
// 드롭다운 외 클릭 닫힘
$(document).on('click', function(e) {
    if (!$(e.target).hasClass('btn-dropdown')) {
        if ($('.dropdown-menu').hasClass('show')) {
            $('.btn-dropdown').removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
        }
    }
})

// 240530 [퍼블 추가]_start
/* ##### [ 아이콘 추가 ] ##### */
var iconBell = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6" fill="#898989"></path>'
+'</svg>';
var iconRoundCheck = '<svg width="16" height="16" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill="#2C2C2C" fill-rule="evenodd" clip-rule="evenodd" d="M7.00004 12.8663C10.2401 12.8663 12.8667 10.2397 12.8667 6.99967C12.8667 3.7596 10.2401 1.13301 7.00004 1.13301C3.75997 1.13301 1.13337 3.7596 1.13337 6.99967C1.13337 10.2397 3.75997 12.8663 7.00004 12.8663ZM7.00004 13.6663C10.6819 13.6663 13.6667 10.6816 13.6667 6.99967C13.6667 3.31778 10.6819 0.333008 7.00004 0.333008C3.31814 0.333008 0.333374 3.31778 0.333374 6.99967C0.333374 10.6816 3.31814 13.6663 7.00004 13.6663Z" />'
+'<path fill="#2C2C2C" fill-rule="evenodd" clip-rule="evenodd" d="M9.95025 5.3835C10.1065 5.53971 10.1065 5.79297 9.95025 5.94918L6.61692 9.28252C6.46073 9.43871 6.2075 9.43873 6.05128 9.28257L4.05058 7.28257C3.89434 7.12638 3.8943 6.87312 4.05048 6.71688C4.20666 6.56064 4.45993 6.5606 4.61617 6.71678L6.33403 8.43404L9.38457 5.3835C9.54078 5.22729 9.79404 5.22729 9.95025 5.3835Z" />'
+'</svg>';
var listHeaderIcon2 = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill="#2C2C2C" d="M1.99992 4.00033C2.36811 4.00033 2.66659 3.70185 2.66659 3.33366C2.66659 2.96547 2.36811 2.66699 1.99992 2.66699C1.63173 2.66699 1.33325 2.96547 1.33325 3.33366C1.33325 3.70185 1.63173 4.00033 1.99992 4.00033Z" />'
+'<path fill="#2C2C2C" d="M1.99992 8.66699C2.36811 8.66699 2.66659 8.36852 2.66659 8.00033C2.66659 7.63214 2.36811 7.33366 1.99992 7.33366C1.63173 7.33366 1.33325 7.63214 1.33325 8.00033C1.33325 8.36852 1.63173 8.66699 1.99992 8.66699Z" />'
+'<path fill="#2C2C2C" d="M2.66659 12.667C2.66659 13.0352 2.36811 13.3337 1.99992 13.3337C1.63173 13.3337 1.33325 13.0352 1.33325 12.667C1.33325 12.2988 1.63173 12.0003 1.99992 12.0003C2.36811 12.0003 2.66659 12.2988 2.66659 12.667Z" />'
+'<path fill="#2C2C2C" d="M4.39992 7.60026C4.179 7.60026 3.99992 7.77935 3.99992 8.00026C3.99992 8.22117 4.179 8.40026 4.39992 8.40026H14.2666C14.4875 8.40026 14.6666 8.22117 14.6666 8.00026C14.6666 7.77935 14.4875 7.60026 14.2666 7.60026H4.39992Z" />'
+'<path fill="#2C2C2C" d="M3.99992 3.33359C3.99992 3.11268 4.179 2.93359 4.39992 2.93359H14.2666C14.4875 2.93359 14.6666 3.11268 14.6666 3.33359C14.6666 3.55451 14.4875 3.73359 14.2666 3.73359H4.39992C4.179 3.73359 3.99992 3.55451 3.99992 3.33359Z" />'
+'<path fill="#2C2C2C" d="M4.39992 12.2669C4.179 12.2669 3.99992 12.446 3.99992 12.6669C3.99992 12.8878 4.179 13.0669 4.39992 13.0669H14.2666C14.4875 13.0669 14.6666 12.8878 14.6666 12.6669C14.6666 12.446 14.4875 12.2669 14.2666 12.2669H4.39992Z" />'
+'</svg>';
var plusIconRed = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill="#E0205C" d="M7.60059 14.2663C7.60059 14.4873 7.77967 14.6663 8.00059 14.6663C8.2215 14.6663 8.40059 14.4873 8.40059 14.2663V8.39961H14.2673C14.4882 8.39961 14.6673 8.22052 14.6673 7.99961C14.6673 7.7787 14.4882 7.59961 14.2673 7.59961H8.40059V1.73301C8.40059 1.51209 8.2215 1.33301 8.00059 1.33301C7.77967 1.33301 7.60059 1.51209 7.60059 1.73301V7.59961H1.73398C1.51307 7.59961 1.33398 7.7787 1.33398 7.99961C1.33398 8.22052 1.51307 8.39961 1.73398 8.39961H7.60059V14.2663Z"/>'
+'</svg>';
var plusIcon = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill="#6B6B6B" d="M11.3999 21.4C11.3999 21.7314 11.6685 22 11.9999 22C12.3313 22 12.5999 21.7314 12.5999 21.4V12.5999H21.4C21.7314 12.5999 22 12.3313 22 11.9999C22 11.6685 21.7314 11.3999 21.4 11.3999H12.5999V2.6C12.5999 2.26863 12.3313 2 11.9999 2C11.6685 2 11.3999 2.26863 11.3999 2.6V11.3999H2.6C2.26863 11.3999 2 11.6685 2 11.9999C2 12.3313 2.26863 12.5999 2.6 12.5999H11.3999V21.4Z"/>'
+'</svg>';
var minusIcon = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill="#6B6B6B" fill-rule="evenodd" clip-rule="evenodd" d="M2 12.0004C2 11.669 2.26863 11.4004 2.6 11.4004L21.4 11.4004C21.7314 11.4004 22 11.669 22 12.0004C22 12.3318 21.7314 12.6004 21.4 12.6004L2.6 12.6004C2.26863 12.6004 2 12.3318 2 12.0004Z"/>'
+'</svg>';
var trashIcon = '<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill="#A5A5A5" d="M7.49993 6.67493C7.74845 6.67493 7.94993 6.8764 7.94993 7.12493V12.7499C7.94993 12.9985 7.74846 13.1999 7.49993 13.1999C7.2514 13.1999 7.04993 12.9985 7.04993 12.7499L7.04993 7.12493C7.04993 6.8764 7.2514 6.67493 7.49993 6.67493Z"/>'
+'<path fill="#A5A5A5" d="M10.9499 7.12493C10.9499 6.8764 10.7485 6.67493 10.4999 6.67493C10.2514 6.67493 10.0499 6.8764 10.0499 7.12493V12.7499C10.0499 12.9985 10.2514 13.1999 10.4999 13.1999C10.7485 13.1999 10.9499 12.9985 10.9499 12.7499L10.9499 7.12493Z"/>'
+'<path fill="#A5A5A5" fill-rule="evenodd" clip-rule="evenodd" d="M6.375 2.625C6.375 2.00368 6.87868 1.5 7.5 1.5H10.5C11.1213 1.5 11.625 2.00368 11.625 2.625V3.60004L14.55 3.60004C14.7985 3.60004 15 3.80151 15 4.05004C15 4.29856 14.7985 4.50004 14.55 4.50004H14.25V14.1C14.25 15.3427 13.2426 16.35 12 16.35H6C4.75736 16.35 3.75 15.3427 3.75 14.1V4.50004H3.45C3.20147 4.50004 3 4.29856 3 4.05004C3 3.80151 3.20147 3.60004 3.45 3.60004H6.375V2.625ZM7.5 2.4H10.5C10.6243 2.4 10.725 2.50074 10.725 2.625V3.6H7.275V2.625C7.275 2.50074 7.37574 2.4 7.5 2.4ZM4.65 4.50004H13.35V14.1C13.35 14.8456 12.7456 15.45 12 15.45H6C5.25442 15.45 4.65 14.8456 4.65 14.1V4.50004Z"/>'
+'</svg>';
var popBackBtn = '<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">'
+'<path fill="#2C2C2C" fill-rule="evenodd" clip-rule="evenodd" d="M10.9987 13.3026C10.6451 13.7004 10.6451 14.2999 10.9987 14.6978L19.2986 24.0351C19.5554 24.3241 19.5294 24.7665 19.2405 25.0234C18.9515 25.2802 18.5091 25.2542 18.2522 24.9652L9.95234 15.6279C9.12721 14.6996 9.12721 13.3008 9.95234 12.3725L18.2522 3.03513C18.5091 2.74618 18.9515 2.72016 19.2405 2.977C19.5294 3.23384 19.5554 3.67629 19.2986 3.96524L10.9987 13.3026Z"/>'
+'</svg>';
// 240530 [퍼블 추가]_end


/* ########### 타계정 추가 ########### */
/* ##### [ 타계정 주문_메인 메세지 카드 ] ##### */
function makeAnotherAccountOrderCard() {
    
    var html = $('.chat-message.left').last().find('.message').remove();
    //console.log('html : '+html);
    
    var anotherAccountOrderResultMessage = $(
        '<div class="message simple-text">'
            +'<p>'
                +'<b>타계정 주문</b>에 대해 알려드릴게요.<br><br>'
                +'타계정 주문을 선물, 증정 등의 목적으로 사용할 경우 사전에 비용을 확보해야 하며, 사전 비용 확보는 부서예산(GBMS) 또는 광고 판촉비(APMS) 품의로 진행합니다.<br><br>'
                +'* 주문 입력 전에 부서 예산 또는 광고판촉비를 조회해 보세요.'
            +'</p>'
        +'</div>'
    );
    var anotherAccountOrderBtnWrap = $('<div class="btn"></div>');
    var guideBtn = $('<button type="button" class="btn btn-emphasis btn-big">타계정 주문 절차 및 가이드</button>');
    var gbmsBtn = $('<button type="button" class="btn btn-emphasis btn-big">부서 예산(GBMS) 조회</button>');
    var apmsBtn = $('<button type="button" class="btn btn-emphasis btn-big">광고판촉비(APMS) 조회</button>');
    var orderInputBtn = $('<button type="button" class="btn btn-emphasis btn-big">타계정 주문 입력</button>');
    var orderListViewBtn = $('<button type="button" class="btn btn-emphasis btn-big">타계정 주문 현황 조회</button>');
    anotherAccountOrderBtnWrap.append(guideBtn);
    anotherAccountOrderBtnWrap.append(gbmsBtn);
    anotherAccountOrderBtnWrap.append(apmsBtn);
    anotherAccountOrderBtnWrap.append(orderInputBtn);
    anotherAccountOrderBtnWrap.append(orderListViewBtn);
    anotherAccountOrderResultMessage.append(anotherAccountOrderBtnWrap);

    guideBtn.on('click', function() {
        console.log('타계정 주문 절차 및 가이드 클릭');
    })
    gbmsBtn.on('click', function() { // console.log('부서 예산(GBMS) 조회 클릭');
        //$('.chat-message.left').last().append(makeCardGBMS());
        //gbmsPopupOpen();
        chatui.sendMessage("부서예산(GBMS) 조회");
    })
    apmsBtn.on('click', function() { // console.log('광고판촉비(APMS) 조회 클릭');
        //$('.chat-message.left').last().append(makeCardAPMS());
        //apmsPopupOpen();
        chatui.sendMessage("광고판촉비(APMS) 조회");        
    })
    orderInputBtn.on('click', function() { // console.log('타계정 주문 입력 클릭');
        //$('.chat-message.left').last().append(makeCardAnotherAccountOrder()); // 조회
        //anotherAccountPopupOpen();
        chatui.sendMessage("타계정 주문 입력");   
    })
    orderListViewBtn.on('click', function() { // console.log('타계정 주문 현황 조회 클릭');
        $('.chat-message.left').last().append(makeCardAALV());
        anotherAccountListViewPopupOpen();
    })
    $('.chat-message.left').last().find('.profile').after(anotherAccountOrderResultMessage);

}

/* ##### [ 타계정 팝업 ] ##### */
// [ 타계정 주문 입력 팝업 ]
var anotherAccountOrderForm;
function anotherAccountPopupOpen(orderdata) {
    /* #########[ popup_wrap_start ]######### */
    var pulginDim = $('<div class="plugin-dim show"></div>');
    var addPlugin = $('<div class="plugins another-account-order" id="another-account-order"></div>');

    /* #########[ popup_header ]######### */
    var pluginHeader = $('<div class="plugin-header"><h1>타계정 주문 입력 ('+ '1' + '/' + '8' +')</h1></div>');
    var pluginClose = $('<span class="close-plugin">' + iconPopupClose + '</span>');
    pluginClose.on('click', function() {
        thisPluginClose();
    })
    pluginHeader.append(pluginClose);
    addPlugin.append(pluginHeader);
    function thisPluginClose() {
        $('#another-account-order').removeClass('show');
        $('.plugin-dim').removeClass('show');
        setTimeout(function() {
            $('.plugin-dim').remove();
            $('#another-account-order').remove();
        }, 300);
    }

    /* #########[ popup_content_wrap ]######### */
    var pluginContents = $('<div class="plugin-contents"></div>');
    var anotherForm = anotherAccountOrderFirst(orderdata);
    pluginContents.append(anotherForm);
    //pluginContents.append(anotherAccountOrderForm);
    addPlugin.append(pluginContents);

    /* #########[ popup_wrap_end ]######### */
    $('.test-panel').append(pulginDim);
    $('.test-panel').append(addPlugin);
    $('.plugin-dim').css('display', 'block');
    $('#another-account-order').css('display', 'block');
    setTimeout(function() {
        $('.plugin-dim').addClass('show');
        $('#another-account-order').addClass('show');
    }, 100);
}

// 타계정 주문 입력 팝업 컨텐츠 1
function anotherAccountOrderFirst(orderdata) {
    console.log('orderdata : ', orderdata);
    //console.log('anotherAccountOrderForm : ', anotherAccountOrderForm);
    var selSelfYn = (orderdata.selfYN == null)? 'YES':orderdata.selfYN;
    var selDeputyEmpno = (orderdata.deputyEmpNo == null)? '':orderdata.deputyEmpNo;
    var selDeputyUsername = (orderdata.deputyUserName == null)? '':orderdata.deputyUserName;

    var pluginHeader = $('.plugin-header');
    pluginHeader.find('h1').text('타계정 주문 입력 ('+ '1' + '/' + '8' +')');
    pluginHeader.find('.backBtn').remove();
    setTimeout(function() {
        $('.plugin-contents').css('overflow-y', 'unset');
    },1);

    /* #########[ popup_content_wrap_start ]######### */
    var pluginForm = $('<form class="form-first"></form>');
    
    /* #########[ popup_content ]######### */
    /* ###[ 타계정 주문 발행인 확인 ]### */
    var inputBoxRadio = $('<div class="input-box"><label>타계정 주문을 발행하는 사람이 본인인가요?<b>*</b></label>');
    var requireAlert = $('<small class="require-alert show">*팀원 대신 대리 주문 입력이 가능합니다.</small>');
    inputBoxRadio.append(requireAlert);
    var radioContentList = ['YES','NO'];
    var radioWrap = $('<div class="radio-wrap"></div>');
    radioContentList.forEach(function(radioContentList, index) {
        radioWrap.append($(
            '<label class="input-radio">'
                +radioContentList
                +'<input type="radio" name="another-selfYN" id="" value="' + radioContentList + '" />'
                +'<span class="radiomark"></span>'
            +'</label>'
        ));
        //if (index == 0) {
        if( radioContentList == selSelfYn) {
            radioWrap.find('input').attr('checked', true);
        }
    });
    inputBoxRadio.append(radioWrap);
    pluginForm.append(inputBoxRadio);

    /* ###[ 대리 주문자 ]### */
    var dropdownBox = $('<div class="dropdown-box dropdown-another" style="display: none;"><label>대리 주문자</label></div>');
    var dropdownInput = $(
        '<div class="input-form btn-dropdownn searchIcon">'
            +'<input placeholder="대리 주문자를 입력해주세요." type="text" value="" />'
        +'</div>'
    );
    dropdownBox.append(dropdownInput);
    pluginForm.append(dropdownBox);
    
    var teamMemberList = orderdata.teamMemberList;
    // 조회 구분 메뉴 & 리스트(아이템)
    var testData = [
        {'user':'홍길동','class':'책임','lg':'LG01','manager':'담당01','team':'Team01','part':'part01','group':'조01'},
        {'user':'김길동','class':'선임','lg':'LG02','manager':'담당02','team':'Team02','part':'part02','group':'조02'},
        {'user':'이길동','class':'책임','lg':'LG03','manager':'담당03','team':'Team03','part':'part03','group':'조03'},
        {'user':'박길동','class':'선임','lg':'LG04','manager':'담당04','team':'Team04','part':'part04','group':'조04'},
        {'user':'최길동','class':'책임','lg':'LG05','manager':'담당05','team':'Team05','part':'part05','group':'조05'},
        {'user':'정길동','class':'선임','lg':'LG06','manager':'담당06','team':'Team06','part':'part06','group':'조06'},
        {'user':'테스트','class':'책임','lg':'LG07','manager':'담당07','team':'Team07','part':'part07','group':'조07'},
        {'user':'이름',  'class':'선임','lg':'LG08','manager':'담당08','team':'Team08','part':'part08','group':'조08'},
        {'user':'이름이름','class':'책임','lg':'LG09','manager':'담당09','team':'Team09','part':'part09','group':'조09'},
        {'user':'홍길동','class':'선임','lg':'LG10','manager':'담당10','team':'Team10','part':'part10','group':'조10'},
    ];
    var dropdownMenuListWrap = $('<ul class="dropdown-menu top twoLines"></ul>');
    let dropdownListItem = '';
    /*for ( var i = 0; i < testData.length; i++ ) {
        var data = testData[i];
        dropdownListItem += (
            '<li class="dropdown-item">'
                +'<a href="javascript:void(0)">'
                    +'<p>'+data.user+' '+data.class+'</p>'
                    +'<span>'+data.lg+'/'+data.manager+'/'+data.team+'/'+data.part+'/'+data.group+'</span>'
                +'</a>'
            +'</li>'
        );
    };*/
    
    for ( var i = 0; i < teamMemberList.length; i++ ) {
        var member = teamMemberList[i];
        var selected = '';
        if(member.empNo == selDeputyEmpno) {
            selected = 'selected';
        }
        dropdownListItem += (
            '<li class="dropdown-item">'
                +'<a href="javascript:void(0)" class="'+selected+'">'
                    +'<p>'+member.empName+' '+''+'</p>'
                    +'<span>'+'LG'+'/'+member.deptName+'</span>'
                +'</a>'
                +'<span class="member-empNo" style="display:none;">'+member.empNo+'</span>'
                +'<span class="member-deptCd" style="display:none;">'+member.deptCd+'</span>'
            +'</li>'
        );
    };
    
    dropdownMenuListWrap.append(dropdownListItem);
    dropdownBox.append(dropdownMenuListWrap);

    /*  ###[ etc ]### */
    // 다음버튼
    var nextBtn = $('<div class="btn"><button type="button" class="btn btn-emphasis btn-big">다음</button></div>');
    pluginForm.append(nextBtn);
    pluginForm.children('.btn').find('button').on('click', function() {
        
        var selfYN = $('[name="another-selfYN"]:checked').val();
        var deputyEmpNo = $('.deputy-EmpNo').val();
        var deputyUserName = $('.deputy-UserName').val();
        
        console.log('selfYN : '+selfYN);
        
        orderdata.step = 2;
        orderdata.selfYN = selfYN;
        orderdata.deputyEmpNo = deputyEmpNo;
        orderdata.deputyUserName = deputyUserName;
        
        if( selfYN == 'NO') {
            orderdata.orderEmpNo =  deputyEmpNo;         // 대리 주문
        }
        else{
            orderdata.orderEmpNo =  orderdata.empNo;                // 본인. 
        }

        pluginForm.removeClass('show');
        pluginForm.remove();
        var anotherForm = anotherAccountOrderSecond(orderdata);
        $('.plugin-contents').append(anotherForm);
        //$('.plugin-contents').append(anotherAccountOrderForm);
    })
    
    // 라디오 버튼 이벤트
    var eventTarget = $('.dropdown-another');
    setTimeout(function() {
        eventTarget.css('display','none');
    },1);
    inputBoxRadio.find('input').on('click', function(e) {
        if (e.target.value == 'NO') {
            dropdownBox.stop().slideDown();
        } else {
            dropdownBox.stop().slideUp();
        }
    });
    
    // dropdown_input
    dropdownInput.on('click', function() {
        dropdownBtnEvent(this);
    });
    dropdownMenuListWrap.find('li a').on('click', function() {
        dropdownMenuInputEvent(this);
    });
    function dropdownBtnEvent(target) {
        if ($(target).hasClass('active')) {
        } else {
            $(target).addClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideDown().css('display','flex').addClass('show');
        }
    }
    function dropdownMenuInputEvent(target) {
        let mainText = $(target).find('p').text();
        let subText = $(target).find('span').text();
        let memEmpNo = $(target).parents('.dropdown-item').find('.member-empNo').text();

        console.log('memEmpNo > '+memEmpNo);
        const dropmenu = $(target).parents('.dropdown-box').find('.dropdown-menu');
        var dataText = $(
            '<div class="data-wrap">'
                +'<p>' + mainText + '</p>'
                +'<span>' + subText + '</span>'
                + '<input type="hidden" value="'+ memEmpNo +'" class="deputy-EmpNo"/>'
                + '<input type="hidden" value="'+ mainText+'" class="deputy-UserName"/>'
            +'</div>'
        );
        dropdownInput.append(dataText);
        dataText.on('click', function() {
            dropdownInput.find('input').css('display','block').val('').focus();
            $(this).remove();
        });
        dropdownInput.removeClass('active').addClass('select').find('input').css('display', 'none');
        let inputHeight = Math.ceil(dropdownInput.height());
        inputHeight = inputHeight + 14;
        dropmenu.css('bottom', inputHeight+'px');
        dropmenu.stop().slideUp().removeClass('show');
        setTimeout(function() {
            dropmenu.attr('style','');
        },1000);
    }
    
    // 설정된 값이 있으면. 
    if(selSelfYn == 'NO') {
        inputBoxRadio.find('input').trigger('click');
        
        console.log('length : '+dropdownMenuListWrap.find('li a').length);
        
        console.log('select : '+dropdownMenuListWrap.find('li').find('.selected'));
        
        var selectedDeputyUser = dropdownMenuListWrap.find('li').find('.selected');
        if(selectedDeputyUser) {
            selectedDeputyUser.trigger('click');
        }
    }
    
    /* #########[ popup_content_form_end ]######### */
    anotherAccountOrderForm = pluginForm;
    return pluginForm;
}

// 타계정 주문 입력 팝업 컨텐츠 2
function anotherAccountOrderSecond(orderdata) {
    console.log('orderdata : ', orderdata);    
    //console.log('anotherAccountOrderForm2 : ', anotherAccountOrderForm);
    var selOrderType = (orderdata.orderType == null)? '':orderdata.orderType;
    var selReasonCode = (orderdata.reasonCode == null)? '':orderdata.reasonCode;
    var selReasonName = (orderdata.reasonName == null)? '':orderdata.reasonName;
    
    
    $('.plugin-contents').css('overflow-y', 'auto');
    var pluginHeader = $('.plugin-header');
    var backBtn = $('<button type="button" class="backBtn">' + popBackBtn + '</button>');
    pluginHeader.find('h1').text('타계정 주문 입력 ('+ '2' + '/' + '8' +')');
    pluginHeader.find('.backBtn').remove();
    pluginHeader.prepend(backBtn);
    
    $('.plugin-contents').focus();
    /* #########[ popup_content_form_start ]######### */
    var pluginForm = $('<form class="form-second"></form>');

    /* #########[ popup_content ]######### */
    /* ###[ 주문 목적 ]### */
    var orderInputBox = $('<div class="input-box add-order"><label>주문 목적</label></div>');
    var orderSelectBox = $('<div class="order-select searchIcon"></div>');
    var orderSelected = $('<div class="selected-order"></div>');
    orderSelectBox.append(orderSelected);
    var orderTooltip = $('<div class="order-tooltip">타계정 주문 목적 목록을 조회합니다.</div>');
    orderSelectBox.append(orderTooltip);
  
    var orderInput = $('<input type="text" placeholder="주문 목적을 선택해 주세요." id="schedule-order"/>');
    var orderList = $('<div class="order-list"></div>');
    var orderByText = $('<div class="order-text"><p class="texted"></p><p class="small">입력한 이 위치 사용하기</p></div>');
    var orderValue = '';
    orderList.append(orderByText);

    orderInput.on('keyup', function() {
        orderValue = $(this).val();
        if (orderValue.length > 0) {
            $('.order-text').addClass('show');
            $('.order-text .texted').text(orderValue); 
        } else {
            $('.order-text').removeClass('show');
            $('.order-text .texted').text(''); 
        }
    });
  
    // [입력한 이 위치에 사용하기] 클릭
    /*orderByText.on('click', function() {
        var orderInfo = $(
            '<div class="order-info">'
                + orderValue
                + '<button type="button" class="btn btn-delete">' 
                    + '<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">'
                        + '<path d="M2.46233 2.03709C2.34517 1.91993 2.15522 1.91993 2.03806 2.03709C1.92091 2.15424 1.92091 2.34419 2.03806 2.46135L5.57598 5.99927L2.03816 9.53709C1.921 9.65424 1.921 9.84419 2.03816 9.96135C2.15532 10.0785 2.34527 10.0785 2.46242 9.96135L6.00024 6.42353L9.53806 9.96135C9.65522 10.0785 9.84517 10.0785 9.96233 9.96135C10.0795 9.84419 10.0795 9.65424 9.96233 9.53709L6.42451 5.99927L9.96243 2.46135C10.0796 2.34419 10.0796 2.15424 9.96243 2.03709C9.84527 1.91993 9.65532 1.91993 9.53816 2.03709L6.00024 5.575L2.46233 2.03709Z" fill="#6B6B6B"/>'
                    + '</svg>'
                + '</button>'
                + '<input type="hidden" value="'+ orderValue +'" class="order-name"/>'
            +'</div>'
        );
  
        orderSelected.empty();
        orderInput.val('');
        $('.order-text').removeClass('show');
        $('.order-text .texted').text(''); 
        orderSelected.append(orderInfo);
        
        // [퍼블 수정 및 추가]
        var targetHeight = $('.selected-order').height();
        $('.order-select').removeClass('focus');
        console.log(targetHeight);

        $('.order-list').removeClass('show');
        // $('.order-list').css('top', '82px');
        $('.order-list').css('top', Math.floor(targetHeight + 6) + 'px'); // [퍼블 수정 및 추가] - 높이 값 재배치
        $('#schedule-order').attr('placeholder', '');

        scheduleorderWidth();
    });
   */
   
    var orderListTitle = $('<span>주문 목적 목록</span>');
    orderList.append(orderListTitle);
    
    var orderUl = $('<ul></ul>');
    
    ///////
/*    var orderLi = $(
        '<li class="selected">'
            +'<p>'+ orderdata.reasonName // + '()' 
            +'</p>'
            +'<p class="small">'
            + '['+ orderdata.orderType +'] '+ orderdata.reasonCode
            +'</p>'
        +'</li>'
    );
    
    // 예약 가능한 회의실 목록 리스트 클릭
    orderUl.append(orderLi);
    orderList.append(orderUl);
*/    
    ///////
    
    orderInput.on('click', function() {
    //orderSelectBox.on('click', function() {
        // [퍼블 수정 및 추가] - order-select 스타일 변경
        $('.order-select').addClass('focus');
            
        $('.order-list').addClass('show');
        orderUl.empty();


        var requestParam = {
            query: {
              "event": "orderTypeInquiryEvent"
            },
            payload: {
            }
          };

          sendChatApi(requestParam, null, function(payload){
            //console.log('payload > ', payload);
            var result = JSON.parse(payload.queryResult.messages[0].response);
            console.log('result', result);
            orderTypeList = result.resultList;
    
            if(orderTypeList.length == 0) {
              var orderLi = $('<li class="no-res">주문 목적 목록이 없습니다.</li>');
              orderUl.append(orderLi);
              orderList.append(orderUl);
            } else {
              orderTypeList.map(orderType => {
                  
                var orderLi = $(
                    '<li>'
                        +'<p>'+ orderType.reasonName // + '()' 
                        +'</p>'
                        +'<p class="small">'
                        + '['+ orderType.orderType +'] '+ orderType.reasonCode
                        +'</p>'
                    +'</li>'
                );
                
                // 예약 가능한 회의실 목록 리스트 클릭
                orderLi.on('click', function() {
                    
                    var orderInfo = $(
                        '<div class="data-wrap">'
                            +'<p>' + orderType.reasonName + '</p>'
                            +'<span>' + '['+orderType.orderType+'] '+ orderType.reasonCode + '</span>'
                          + '<input type="hidden" value="'+ orderType.orderType +'" class="order-type"/>'
                          + '<input type="hidden" value="'+ orderType.reasonCode +'" class="reason-code"/>'
                          + '<input type="hidden" value="'+ orderType.reasonName +'" class="reason-name"/>'
                        +'</div>'
                    );
                    orderSelected.empty();
                    orderSelected.append(orderInfo);
                    
                    //orderInput.val(orderInfo.html());
                    
                    // [퍼블 수정 및 추가]
                    var targetHeight = $('.selected-order').height();
                    $('.order-select').removeClass('focus');
                    console.log(targetHeight);
            
                    $('.order-list').removeClass('show');
                    // $('.order-list').css('top', '82px');
                    $('.order-list').css('top', Math.floor(targetHeight + 6) + 'px'); // [퍼블 수정 및 추가] - 높이 값 재배치
                    $('#schedule-order').attr('placeholder', '');
                    scheduleorderWidth();
                    
                    nextBtn.find('button').attr('disabled', false);

                });

                if(selReasonCode == orderType.reasonCode) {
                    if(orderdata.action == 'back') {
                        orderLi.trigger('click');       
                        orderdata.action = '';
                    }
                }
                orderUl.append(orderLi);
              });
              orderList.append(orderUl);
            }
   
          });
          
        ///////
    });

    orderSelectBox.append(orderInput);
    orderSelectBox.append(orderList);
    orderInputBox.append(orderSelectBox);
    pluginForm.append(orderInputBox);

    orderSelected.on('click', function() {
        orderInput.trigger('click');
    });
    
    $(document).on('click', '.order-info .btn-delete', function(){
        $(this).closest(".order-info").remove();
        $('#schedule-order').attr('placeholder', '장소를 입력해 주세요.');
        // $('.order-list').css('top', '82px');
        $('.order-list').css('top', ''); // [퍼블 수정 및 추가] - 높이 값 제거
        scheduleorderWidth();
    });

    // order-select 제외 클릭
    $(document).on('click', function(e) {
        if ($('.order-select').has(e.target).length === 0) {
            $('.order-list').removeClass('show');
            
            // [퍼블 수정 및 추가] - order-select 스타일 변경
            $('.order-select').removeClass('focus');
        }
    });

    $(window).resize(function() {
        scheduleorderWidth();
    });

    // 장소 입력 input width 변경
    function scheduleorderWidth() {
        let orderSelectWidth = $('.order-select').width();
        let selectedorderWidth = $('.selected-order').width();
        let scheduleorderWidth = orderSelectWidth - selectedorderWidth;
        $('#schedule-order').css('width', scheduleorderWidth + "px");
        if ($('#schedule-order').width() === 0) {
            $('#schedule-order').attr('style', '');
        };
    };

    var spareHtml = $('<p style="height:100px;"></p>');
    pluginForm.append(spareHtml);
    
    /*  ###[ etc ]### */
    // 다음버튼
    var nextBtn = $('<div class="btn"><button type="button" class="btn btn-emphasis btn-big" disabled>다음</button></div>')
    pluginForm.append(nextBtn);
    pluginForm.children('.btn').find('button').on('click', function() {
        
        var orderTypeVal = $('.order-type').val();
        var reasonCodeVal = $('.reason-code').val();
        var reasonNameVal = $('.reason-name').val();

        orderdata.step = 3;        
        orderdata.orderType = orderTypeVal;
        orderdata.reasonCode = reasonCodeVal;
        orderdata.reasonName = reasonNameVal;
        
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderThird(orderdata);
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    
    // back버튼
    pluginHeader.find('.backBtn').off('click').on('click', function() {
        
        orderdata.step = 1;
        orderdata.action = 'back';

        delete orderdata.orderType;
        delete orderdata.reasonCode;
        delete orderdata.reasonName;

        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderFirst(orderdata);
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    
    if (orderdata.orderType != null) {
        //orderLi.trigger('click');
        orderInput.trigger('click');
    }

    /* #########[ popup_content_form_end ]######### */
    anotherAccountOrderForm = pluginForm;
    return pluginForm;
}

// 타계정 주문 입력 팝업 컨텐츠 3 (달력 미진행)
function anotherAccountOrderThird(orderdata) {
    console.log('orderdata : ', orderdata);

    var placeholderToday = moment().format('YYYY.MM.DD');

    var selReceiverName = (orderdata.receiverName == null)? '':orderdata.receiverName;
    var selAddress1 = (orderdata.address1 == null)? '':orderdata.address1;
    var selAddress2 = (orderdata.address2 == null)? '':orderdata.address2;
    var selReceiverPhoneNo = (orderdata.receiverPhoneNo == null)? '':orderdata.receiverPhoneNo;
    var selRedidenceType = (orderdata.redidenceType == null)? '':orderdata.redidenceType;
    var selDonationCode = (orderdata.donationCode == null)? '':orderdata.donationCode;
    var selDonationName = (orderdata.donationName == null)? '':orderdata.donationName;
    var selDonationDate = (orderdata.donationDate == null)? placeholderToday:orderdata.donationDate;

    $('.plugin-contents').css('overflow-y', 'auto');
    var pluginHeader = $('.plugin-header');
    var backBtn = $('<button type="button" class="backBtn">' + popBackBtn + '</button>');
    pluginHeader.find('h1').text('타계정 주문 입력 ('+ '3' + '/' + '8' +')');
    pluginHeader.find('.backBtn').remove();
    pluginHeader.prepend(backBtn);
    
    /* #########[ popup_content_form_start ]######### */
    var pluginForm = $('<form class="form-third"></form>');
    
    /* #########[ popup_content ]######### */
    /* ###[ 주의 사항 ]### */
    var inputBoxText = $('<div class="input-box top-note"><label>배송지(수령지) 정보를 입력해 주세요.<b>*</b></label></div>');
    pluginForm.append(inputBoxText);

    /* ###[ 받는 사람 ]### */
    var inputBoxText = $('<div class="input-box"><label>받는 사람<b>*</b></label></div>');
    var inputTextContent = $('<div class="input-form"><input type="text" placeholder="내용을 입력해 주세요." max-length="50" id="receiver_name" value="'+selReceiverName+'"/></div>');
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /* ###[ 우편 번호 ]### */
    var inputBoxText = $('<div class="input-box"><label>우편 번호<b>*</b></label></div>');
    var inputTextContent = $(
        '<div class="input-form post-form">'
            +'<input class="searchIcon" type="text" placeholder="도로명/ 건물명/ 번지" max-length="50" id="address1" value="'+selAddress1+'"/>'
            +'<input type="text" placeholder="상세 주소를 입력해 주세요." max-length="50" id="address2" value="'+selAddress2+'" />'
        +'</div>'
    );
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /* ###[ 전화 번호 ]### */
    var inputBoxText = $('<div class="input-box"><label>전화 번호<b>*</b></label></div>');
    var inputTextContent = $('<div class="input-form"><input type="text" placeholder="전화 번호를 ‘-’ 없이 입력해 주세요." max-length="50" id="receiver_phone_no" value="'+selReceiverPhoneNo+'" /></div>');
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /* ###[ 주거 형태 ]### */
    var dropdownBox = $('<div class="dropdown-box dropdown-housing"><label>주거 형태<b>*</b></label></div>');
    var dropdownMainBtn = $('<button type="button" class="btn btn-dropdown default"><span>옵션을 선택해 주세요.</span></button>');
    var dropdownArrow = $(
        '<i class="icons">'
            +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
                +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39823 5.61757C8.1709 5.4155 7.82833 5.4155 7.601 5.61757L2.26536 10.3604C2.10025 10.5071 1.84742 10.4923 1.70065 10.3271C1.55388 10.162 1.56875 9.9092 1.73387 9.76243L7.0695 5.01964C7.59995 4.54814 8.39928 4.54814 8.92972 5.01964L14.2654 9.76243C14.4305 9.9092 14.4453 10.162 14.2986 10.3271C14.1518 10.4923 13.899 10.5071 13.7339 10.3604L8.39823 5.61757Z" fill="#2C2C2C"/>'
            +'</svg>'
        +'</i>'
    );
    dropdownBox.append(dropdownMainBtn);
    dropdownMainBtn.append(dropdownArrow);
    
    var redidenceTypeList = [{"redidenceCode":"01", "redidenceName":"Apartment with elevator"}
                            ,{"redidenceCode":"02", "redidenceName":"Apartment without elevator"}
                            ,{"redidenceCode":"03", "redidenceName":"Single House"}
                            ,{"redidenceCode":"04", "redidenceName":"Multiplex House"}
                            ,{"redidenceCode":"E1", "redidenceName":"인터넷"}
                            ,{"redidenceCode":"E2", "redidenceName":"인터넷, 유무선공유기"}
                            ,{"redidenceCode":"E3", "redidenceName":"인터넷, 유무선공유기, 무선동글"}
                            ,{"redidenceCode":"E4", "redidenceName":"인터넷, 무선동글"}
                            ,{"redidenceCode":"E5", "redidenceName":"인터넷 설치 안됨"}
                            ,{"redidenceCode":"E6", "redidenceName":"해당사항 없음_DEfault value"} ];
    
    var dropdownMenuListWrap = $('<ul class="dropdown-menu top"></ul>');
    var redidenceTypeListText = '';    
    redidenceTypeList.forEach(function(redidenceType, index) {
        var selected = '';
        if(redidenceType.redidenceCode == selRedidenceType) {
            selected = 'selected';
        }

        redidenceTypeListText += '<li class="dropdown-item"><a href="javascript:void(0)" class="'+selected+'">'+redidenceType.redidenceName+'</a><span class="redidence_type" style="display:none;">'+redidenceType.redidenceCode+'</span></li>';
    });        
    let dropdownListItem = $(redidenceTypeListText);
    
    dropdownMenuListWrap.append(dropdownListItem);
    dropdownBox.append(dropdownMenuListWrap);
    
    dropdownBox.append('<input type="hidden" value="" id="redidence_type"/>');
    
    if(orderdata.reasonCode != 'R&D') { 
        pluginForm.append(dropdownBox);
    }

    /* ###[ 기부처 ]### */
    var inputBoxText = $('<div class="input-box add-order"><label>기부처<b>*</b></label></div>');
    var inputTextContent = $('<div class="input-form order-select searchIcon"></div>');
    var donationSelected = $('<div class="selected-order"></div>');
    var inputBox = $('<input type="text" placeholder="기부처를 선택하세요." max-length="50" id="donation-input" readonly/>');
    
    var donationListCont = $('<div class="order-list"></div>');

    var donationListTitle = $('<span>기부처 목록</span>');
    donationListCont.append(donationListTitle);

    inputBox.append('<input type="text" value="" id="donation-code"/>');
    
    inputTextContent.append(donationSelected);
    inputTextContent.append(inputBox);
    inputTextContent.append(donationListCont);
    
    var orderUl = $('<ul></ul>');

    inputBox.on('click', function() {
    //orderSelectBox.on('click', function() {
        // [퍼블 수정 및 추가] - order-select 스타일 변경
        $('.order-select').addClass('focus');
            
        $('.order-list').addClass('show');
        //donationList.addClass('show');
        orderUl.empty();
        
        var requestParam = {
            query: {
              "event": "donationCompanyInquiryEvent"
            },
            payload: {
              donatinName : '',
            }
          };

          sendChatApi(requestParam, null, function(payload){
            //console.log('payload > ', payload);
            var result = JSON.parse(payload.queryResult.messages[0].response);
            console.log('result', result);
            donationCompanyList = result.resultList;
            
            if(donationCompanyList.length == 0) {
              var orderLi = $('<li class="no-res">조건에 맞는 기부처가 없습니다.</li>');
              orderUl.append(orderLi);
              donationListCont.append(orderUl);
            } else {
              donationCompanyList.map(donationCompany => {
                  
                var orderLi = $(
                    '<li>'
                        +'<p>'+ donationCompany.donationName // + '()' 
                        +'</p>'
                        //+'<p class="small">'
                        //+ '['+ orderType.orderType +'] '+ orderType.reasonCode
                        //+'</p>'
                    +'</li>'
                );
                
                // 예약 가능한 회의실 목록 리스트 클릭
                orderLi.on('click', function() {
                    
                    var donationInfo = $(
                        '<div class="data-wrap">'
                            +'<p>' + donationCompany.donationName + '</p>'
                            //+'<span>' + '['+orderType.orderType+'] '+ orderType.reasonCode + '</span>'
                          + '<input type="hidden" value="'+ donationCompany.donationCode +'" id="donation-code"/>'
                          + '<input type="hidden" value="'+ donationCompany.donationName +'" id="donation-name"/>'
                        +'</div>'
                    );
                    
                    inputBox.empty();
                    donationSelected.empty();
                    donationSelected.append(donationInfo);
                    
                    //orderInput.val(orderInfo.html());
                    
                    // [퍼블 수정 및 추가]
                    var targetHeight = $('.selected-order').height();
                    $('.order-select').removeClass('focus');
                    console.log(targetHeight);
            
                    $('.order-list').removeClass('show');
                    // $('.order-list').css('top', '82px');
                    $('.order-list').css('top', Math.floor(targetHeight + 6) + 'px'); // [퍼블 수정 및 추가] - 높이 값 재배치
                    $('#donation-input').attr('placeholder', '');
                    scheduleorderWidth();
                    
                    //nextBtn.find('button').attr('disabled', false);

                    nextBtnEvent($(this));

                });

                if(selDonationCode == donationCompany.donationCode) {
                    //if(orderdata.action == 'back') {
                        orderLi.trigger('click');       
                        orderdata.action = '';
                    //}
                }

                orderUl.append(orderLi);
              });
              donationListCont.append(orderUl);
            }
            
          });
        
        //////        
    });
    
    donationSelected.on('click', function() {
        inputBox.trigger('click');
    });
    
    inputBoxText.append(inputTextContent);
    if(orderdata.reasonCode == 'DON' || orderdata.reasonCode == 'DON_2') { 
        pluginForm.append(inputBoxText);
    }
    
// 장소 입력 input width 변경
    function scheduleorderWidth() {
        let orderSelectWidth = $('.order-select').width();
        let selectedorderWidth = $('.selected-order').width();
        let scheduleorderWidth = orderSelectWidth - selectedorderWidth;
        $('#donation-input').css('width', scheduleorderWidth + "px");
        if ($('#donation-input').width() === 0) {
            $('#donation-input').attr('style', '');
        };
    };
    
    /* ###[ 기부 일자 ]### */
    var inputTimeBox = $('<div class="input-box"><label>기부 일자<b>*</b></label></div>');
    var dateTimeWrap = $('<div class="schedule-wrap"></div>');
    var dateTimeStartBox = $('<div class="schedule-input-wrap schedule-date-wrap"></div>');
    var dateStartInput = $('<input type="text" class="input-schedule-date" placeholder="YYYY.MM.DD" onclick="datepicker.open(this)" />');
    dateTimeStartBox.append(dateStartInput);
    
    /*  #########[ datepicker ]#########  */
    var datepicker = $('<div class="datepicker-chem"></div>');
    dateTimeStartBox.append(datepicker);
    
    dateTimeWrap.append(dateTimeStartBox);
    inputTimeBox.append(dateTimeWrap);
    
    if(orderdata.reasonCode == 'DON' || orderdata.reasonCode == 'DON_2') { 
        pluginForm.append(inputTimeBox);
        dateStartInput.val(selDonationDate);
    }

    /*  ###[ etc ]### */
    // 다음버튼
    var nextBtn = $('<div class="btn"><button type="button" class="btn btn-emphasis btn-big" disabled>다음</button></div>');
    pluginForm.append(nextBtn);
    pluginForm.children('.btn').find('button').on('click', function() {
        
        var receiver_name = $('#receiver_name').val();
        var address1 = $('#address1').val();
        var address2 = $('#address2').val();
        var receiver_phone_no = $('#receiver_phone_no').val();
        var redidence_type = $('#redidence_type').val();
        var donation_data = dateStartInput.val();
        
        var donation_code = $('#donation-code').val();
        var donation_name = $('#donation-name').val();

        orderdata.step = 4;        
        orderdata.receiverName = receiver_name;
        orderdata.address1 = address1;
        orderdata.address2 = address2;
        orderdata.receiverPhoneNo = receiver_phone_no;
        orderdata.redidenceType = redidence_type;
        orderdata.donationDate = donation_data;
        
        orderdata.donationCode = donation_code;
        orderdata.donationName = donation_name;
        
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderFourth(orderdata);
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    var inputVal = false;
    function nextBtnEvent(target) {
        var inputObj = pluginForm.find('input').not('#donation-input');

         //console.log('length : '+inputObj.length);
        for ( let i = 0; i <= (inputObj.length)-1; i++ ) {
            
            //console.log('val : '+$(inputObj[i]).val());
            if ($(inputObj[i]).val()) {
                inputVal = true;
                if (inputVal && pluginForm.find('.btn-dropdown').hasClass('select')) {
                    nextBtn.find('button').attr('disabled', false);
                }
                else if (inputVal && pluginForm.find('.btn-dropdown').hasClass('select') == false) {        // 연구개발.
                    nextBtn.find('button').attr('disabled', false);
                }
                else if (inputVal == false || pluginForm.find('.btn-dropdown').hasClass('select') == false) {
                    nextBtn.find('button').attr('disabled', true);
                }
            } else {
                nextBtn.find('button').attr('disabled', true);
                inputVal = false;
                return;
            };
        };
    };

    // input
    pluginForm.find('input').on('keyup', function(e) {
        hblInput = e.target.value;
        nextBtnEvent($(this));
    });
    
    // back버튼
    pluginHeader.find('.backBtn').off('click').on('click', function() {
        
        orderdata.step = 2; 
        orderdata.action = 'back';
        
        delete orderdata.receiverName;
        delete orderdata.address1;
        delete orderdata.address2;
        delete orderdata.receiverPhoneNo;
        delete orderdata.redidenceType;
        delete orderdata.donationDate;
        
        delete orderdata.donationCode;
        delete orderdata.donationName;
        
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderSecond(orderdata);
        $('.plugin-contents').append(anotherAccountOrderForm);
    });

    // dropdown
    dropdownMainBtn.on('click', function() {
        dropdownBtnEvent(this);
        nextBtnEvent($(this));
    });
    dropdownListItem.find('a').on('click', function() {
        dropdownMenuEvent(this);
        nextBtnEvent($(this));
    });
    function dropdownBtnEvent(target) {
        if ($(target).hasClass('active')) {
            $(target).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
        }
        else {
            $('.btn-dropdown').not($(this)).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
            $(target).addClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideDown().css('display','flex').addClass('show');
        }
    }
    function dropdownMenuEvent(target) {
        const dropmenu = $(target).parents('.dropdown-box').find('.dropdown-menu');
        const dropBtn = $(target).parents('.dropdown-box').find('.btn-dropdown');
        //const $(target).parents('.dropdown-box').find('#redidence_type');
        let targetText = $(target).text();
        let redidence_type = $(target).parents('.dropdown-item').find('.redidence_type').text();
        console.log(''+targetText+' : '+redidence_type);
        dropBtn.removeClass('default active').addClass('select').find('span').text(targetText);
        $(target).parents('.dropdown-box').find('#redidence_type').val(redidence_type);
        dropmenu.stop().slideUp().removeClass('show');
    }

    if(selRedidenceType != '') {
        var selectedRedidenceType = dropdownMenuListWrap.find('li').find('.selected');
        
        selectedRedidenceType.trigger('click');
    }
    
    if (selDonationCode != '') {
        //orderLi.trigger('click');
        inputBox.trigger('click');
    }
    
    /* #########[ popup_content_form_end ]######### */
    anotherAccountOrderForm = pluginForm;
    return pluginForm;
}

// 타계정 주문 입력 팝업 컨텐츠 4
function anotherAccountOrderFourth(orderdata) {
    console.log('orderdata : ', orderdata);
    
    userId = chatui.getSetting("userId"); 
    var selApmsYN = (orderdata.apmsYN == null)? 'YES':orderdata.apmsYN;
    var selApmsNo = (orderdata.apmsNo == null)? '':orderdata.apmsNo;
    
    console.log('selApmsYN : '+selApmsYN);
    
    $('.plugin-contents').css('overflow-y', 'auto');
    var pluginHeader = $('.plugin-header');
    var backBtn = $('<button type="button" class="backBtn">' + popBackBtn + '</button>');
    pluginHeader.find('h1').text('타계정 주문 입력 ('+ '4' + '/' + '8' +')');
    pluginHeader.find('.backBtn').remove();
    pluginHeader.prepend(backBtn);
    
    /* #########[ popup_content_form_start ]######### */
    var pluginForm = $('<form class="form-fourth"></form>');

    /* #########[ popup_content ]######### */
    /* ###[ 사용 예산이 광고판촉비(APMS)인가요? ]### */
    var inputBoxRadio = $('<div class="input-box"><label>사용 예산이 광고판촉비(APMS)인가요?<b>*</b></label>');
    var radioContentList = ['YES','NO'];
    var radioWrap = $('<div class="radio-wrap"></div>');
    radioContentList.forEach(function(radioContentList, index) {
        radioWrap.append($(
            '<label class="input-radio">'
                +radioContentList
                +'<input type="radio" name="budget-apmsYN" value="' + radioContentList + '" />'
                +'<span class="radiomark"></span>'
            +'</label>'
        ));
        if (radioContentList == selApmsYN) {
            radioWrap.find('input').attr('checked', true);
        }
    });
    inputBoxRadio.append(radioWrap);
    pluginForm.append(inputBoxRadio);

    /* ###[ 광고판촉비(APMS) 품의 번호 ]### */
    var inputBoxText = $('<div class="input-box"><label>광고판촉비(APMS) 품의 번호<b>*</b></label></div>');
    var inputTextContent = $(
        '<div class="input-form">'
            +'<input class="searchIcon" type="text" placeholder="내용을 입력해 주세요." max-length="50" id="apms-no" value="'+selApmsNo+'"/>'
        +'</div>'
    );
    var titleNote = $('<small class="note">※ 사전에 확보한 APMS 품의 번호를  입력하세요.</small>');
    inputBoxText.append(titleNote);
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);
    
    /*  ###[ etc ]### */
    // 다음버튼
    var nextBtn = $('<div class="btn"><button type="button" class="btn btn-emphasis btn-big" disabled>다음</button></div>');
    pluginForm.append(nextBtn);
    pluginForm.children('.btn').find('button').on('click', function() {
        
        var apmsYN = $('[name="budget-apmsYN"]:checked').val();        
        var apmsNo = $('#apms-no').val();
        
        orderdata.step = 5; 
        orderdata.apmsYN = apmsYN;
        orderdata.apmsNo = apmsNo;

        if(apmsYN == 'YES' && apmsNo != '') {
            
            var reviewParam = {
                    userId:userId,
                    //empNo:empNo, 
                    apms_no : apmsNo
            }
    
            var requestParam = {
                query: {
                    "event": "anotherApmsQueryEvent"
                },
                payload: {
                    userId:userId,
                    //empNo:empNo, 
                    apmsNo : apmsNo
                }
            };        
            
            console.log('requestParam > ', requestParam);
            
            sendChatApi(requestParam, userId, function(payload) {
                console.log('타계정 광고판촉비(APMS) 조회 결과 : ', payload);
                
                var apmsList = '';
                var regSuccessYn = '';
                var errorMessage = '';
                if (payload && payload.queryResult && payload.queryResult.messages.length > 0 && payload.queryResult.messages[0].response) {
                    var apmsResponse = JSON.parse(payload.queryResult.messages[0].response);
                    console.log(apmsResponse["successYn"]);
                    
                    if (apmsResponse["successYn"] == 'N') {
                        console.log('errorMessage : '+apmsResponse["errorMessage"]);
                        regSuccessYn = 'N';
                        errorMessage = apmsResponse["errorMessage"];               // 에러메시지.
                    } else {
                        regSuccessYn = 'Y';
                        if (apmsResponse.template && apmsResponse.template.outputs.length > 0 && apmsResponse.template.outputs[0] && apmsResponse.template.outputs[0].resultItem) {
                            
                            apmsList = apmsResponse.template.outputs[0].resultItem;
                        }
                    }
                    
                }
                else {
                    regSuccessYn = 'N';
                }
                
                if(regSuccessYn == 'N') {
                    
                    console.log('광고판촉비 조회 실패 : '+errorMessage);
                    
                    setTimeout(function() {
                        showSmallDialog('광고판촉비 조회시 에러가 발생했습니다.'); // [퍼블 수정 및 추가] - 텍스트 수정
                    }, 500);
                }   
                else{
                
                    console.log('광고판촉비 조회 완료 : ', apmsList);

                    if(apmsList.length == 1) {                // 광고판촉비 조회 단건
                        let apmsInfo = apmsList[0];
                        
                        orderdata.apms_no = apmsInfo.apms_no;
                        orderdata.au_code = apmsInfo.au_code;
                        orderdata.au_name = apmsInfo.au_name;
                        orderdata.department_code = apmsInfo.department_code;
                        orderdata.department_name = apmsInfo.department_name;
                        orderdata.account_code = apmsInfo.account_code;
                        orderdata.account_name = apmsInfo.account_name;
                        orderdata.activity_code = apmsInfo.activity_code;
                        orderdata.activity_id = apmsInfo.activity_id;
                        orderdata.activity_name = apmsInfo.activity_name;
                        orderdata.activity_amount = apmsInfo.activity_amount;
                        orderdata.activity_rate = apmsInfo.activity_rate;
                        
                        pluginForm.removeClass('show');
                        pluginForm.remove();
                        anotherAccountOrderFifth(orderdata);
                        $('.plugin-contents').append(anotherAccountOrderForm);
                        
                    }
                    //else if(apmsInfo.length > 1) {            // 예산 조회 다건
                    //    
                    //}
                    else{
                        console.log('광고판촉비 조회 : 0건.');
                        
                        setTimeout(function() {
                            showSmallDialog('광고판촉비 조회 내역이 없습니다.'); // [퍼블 수정 및 추가] - 텍스트 수정
                        }, 500);
                    }
                    
                    
                }            
            });
            
        }
        else{
            pluginForm.removeClass('show');
            pluginForm.remove();
            anotherAccountOrderFifth(orderdata);
            $('.plugin-contents').append(anotherAccountOrderForm);
        }
    });
    
    // back버튼
    pluginHeader.find('.backBtn').off('click').on('click', function() {

        orderdata.step = 3; 
        orderdata.action = 'back';

        delete orderdata.apmsYN;
        delete orderdata.apmsNo;

        delete orderdata.apms_no;
        delete orderdata.au_code;
        delete orderdata.au_name;
        delete orderdata.department_code;
        delete orderdata.department_name;
        delete orderdata.account_code;
        delete orderdata.account_name;
        delete orderdata.activity_code;
        delete orderdata.activity_id;
        delete orderdata.activity_name;
        delete orderdata.activity_amount;
        delete orderdata.activity_rate;

        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderThird(orderdata);
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    
    // 라디오 버튼 이벤트
    inputBoxRadio.find('input').on('click', function(e) {
        inputTextContent.find('input').val('');
        if (e.target.value == 'YES') {
            inputBoxText.stop().slideDown();
            nextBtn.find('button').attr('disabled', true);
        } else if (e.target.value == 'NO') {
            inputBoxText.stop().slideUp();
            nextBtn.find('button').attr('disabled', false);
        }
    });

    // input
    pluginForm.find('input').on('keyup', function(e) {
        hblInput = e.target.value;
        if (hblInput) {
            nextBtn.find('button').attr('disabled', false);
        } else {
            nextBtn.find('button').attr('disabled', true);
        }
    });
    
    if(orderdata.action == 'back') {
        if(selApmsYN == 'NO') {
            inputBoxRadio.find('input').trigger('click');
        }
        if(selApmsYN == 'YES' && $('#apms-no').val() != '') {
            console.log('5555');
            nextBtn.find('button').attr('disabled', false);
        }
    }    
    /* #########[ popup_content_form_end ]######### */
    anotherAccountOrderForm = pluginForm;
    return pluginForm;
}

// 타계정 주문 입력 팝업 컨텐츠 5
function anotherAccountOrderFifth(orderdata) {
    console.log('orderdata : ', orderdata);
    
    $('.plugin-contents').css('overflow-y', 'auto');
    var pluginHeader = $('.plugin-header');
    var backBtn = $('<button type="button" class="backBtn">' + popBackBtn + '</button>');
    pluginHeader.find('h1').text('타계정 주문 입력 ('+ '5' + '/' + '8' +')');
    pluginHeader.find('.backBtn').remove();
    pluginHeader.prepend(backBtn);

    /* #########[ popup_content_form_start ]######### */
    var pluginForm = $('<form class="form-fifth"></form>');

    /* #########[ popup_content ]######### */
    /* ###[ 예산/비용의 계정 정보를 입력해 주세요. ]### */
    var inputBoxText = $('<div class="input-box top-note"><label>예산/비용의 계정 정보를 입력해 주세요.<b>*</b></label></div>');
    var titleNote = $('<small class="note">※ 사용 예산이 광고판촉비(APMS)일 경우, 계정 정보가 자동 입력됩니다.</small>');
    inputBoxText.append(titleNote);
    pluginForm.append(inputBoxText);

    /* ###[ Cost AU ] 샘플 ]### */
    var inputBoxText = $('<div class="input-box"><label>Cost AU<b>*</b></label></div>');
    // <div class="input-form">에 addValue 클래스 추가 시, 스타일 변경됨(제거할 경우 원복)
    var inputTextContent = $(
        '<div class="input-form addValue">'
            +'<input class="searchIcon" type="text" placeholder="Cost AU를 입력해 주세요." max-length="50" value="계정 정보 자동입력" disabled />'
        +'</div>');
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /* ###[ 비용 처리 부서 ]### */
    var inputBoxText = $('<div class="input-box"><label>비용 처리 부서<b>*</b></label></div>');
    // <div class="input-form">에 addValue 클래스 추가 시, 스타일 변경됨(제거할 경우 원복)
    var inputTextContent = $(
        '<div class="input-form addValue">'
            +'<input class="searchIcon" type="text" placeholder="비용 처리 부서를 입력해 주세요." max-length="50"  value="계정 정보 자동입력" disabled />'
        +'</div>');
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /* ###[ 비용 처리 계정 ]### */
    var inputBoxText = $('<div class="input-box"><label>비용 처리 계정<b>*</b></label></div>');
    // <div class="input-form">에 addValue 클래스 추가 시, 스타일 변경됨(제거할 경우 원복)
    var inputTextContent = $(
        '<div class="input-form addValue">'
            +'<input class="searchIcon" type="text" placeholder="비용 처리 계정을 입력해 주세요." max-length="50"  value="계정 정보 자동입력" disabled />'
        +'</div>');
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /* ###[ Project Code ]### */
    var inputBoxText = $('<div class="input-box"><label>Project Code</label></div>');
    var inputTextContent = $('<div class="input-form"><input class="searchIcon" type="text" placeholder="Project Code를 입력해 주세요." max-length="50" /></div>');
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /* ###[ Activity Code ]### */
    var inputBoxText = $('<div class="input-box"><label>Activity Code<b>*</b></label></div>');
    // <div class="input-form">에 addValue 클래스 추가 시, 스타일 변경됨(제거할 경우 원복)
    var inputTextContent = $(
        '<div class="input-form addValue">'
            +'<input class="searchIcon" type="text" placeholder="Activity Code를 입력해 주세요." max-length="50"  value="계정 정보 자동입력" disabled />'
        +'</div>');
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /* ###[ Activity Name ]### */
    var inputBoxText = $('<div class="input-box"><label>Activity Name<b>*</b></label></div>');
    var inputTextContent = $('<div class="input-form"><input type="text" placeholder="Activity Name을 입력해 주세요." max-length="50" /></div>');
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /* ###[ Major Category ]### */
    var dropdownBox = $('<div class="dropdown-box dropdown-majorCategory"><label>Major Category<b>*</b></label></div>');
    var dropdownMainBtn = $('<button type="button" class="btn btn-dropdown default"><span>옵션을 선택해 주세요.</span></button>');
    var dropdownArrow = $(
        '<i class="icons">'
            +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
                +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39823 5.61757C8.1709 5.4155 7.82833 5.4155 7.601 5.61757L2.26536 10.3604C2.10025 10.5071 1.84742 10.4923 1.70065 10.3271C1.55388 10.162 1.56875 9.9092 1.73387 9.76243L7.0695 5.01964C7.59995 4.54814 8.39928 4.54814 8.92972 5.01964L14.2654 9.76243C14.4305 9.9092 14.4453 10.162 14.2986 10.3271C14.1518 10.4923 13.899 10.5071 13.7339 10.3604L8.39823 5.61757Z" fill="#2C2C2C"/>'
            +'</svg>'
        +'</i>'
    );
    pluginForm.append(dropdownBox);
    dropdownBox.append(dropdownMainBtn);
    dropdownMainBtn.append(dropdownArrow);

    // Major Category 메뉴 & 리스트(아이템)
    var dropdownMenuListWrap = $('<ul class="dropdown-menu top"></ul>');
    let dropdownListItem = $(
        '<li class="dropdown-item"><a href="javascript:void(0)">OFC_EQUIP</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">TOOLS</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">MACHINERY</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">BUIDINGS</a></li>'
    );
    dropdownMenuListWrap.append(dropdownListItem);
    dropdownBox.append(dropdownMenuListWrap);

    /* ###[ Minor Category ]### */
    var inputBoxText = $('<div class="input-box"><label>Minor Category<b>*</b></label></div>');
    var inputTextContent = $('<div class="input-form"><input class="searchIcon" type="text" placeholder="Minor Category를 입력해 주세요." max-length="50" /></div>');
    inputBoxText.append(inputTextContent);
    pluginForm.append(inputBoxText);

    /*  ###[ etc ]### */
    // 다음버튼
    var nextBtn = $('<div class="btn"><button type="button" class="btn btn-emphasis btn-big" disabled>다음</button></div>');
    pluginForm.append(nextBtn);
    pluginForm.children('.btn').find('button').on('click', function() {
        orderdata.step = 6; 
        
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderSixth(orderdata);
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    var inputVal = false;
    function nextBtnEvent(target) {
        var inputObj = pluginForm.find('input');
        for ( let i = 0; i <= (inputObj.length)-1; i++ ) {
            if ($(inputObj[i]).val()) {
                inputVal = true;
                if (inputVal && pluginForm.find('.btn-dropdown').hasClass('select')) {
                    nextBtn.find('button').attr('disabled', false);
                }
                else if (inputVal == false || pluginForm.find('.btn-dropdown').hasClass('select') == false) {
                    nextBtn.find('button').attr('disabled', true);
                }
            } else {
                nextBtn.find('button').attr('disabled', true);
                inputVal = false;
                return;
            };
        };
    };

    // input
    pluginForm.find('input').on('keyup', function(e) {
        hblInput = e.target.value;
        nextBtnEvent($(this));
    });
    
    // back버튼
    pluginHeader.find('.backBtn').off('click').on('click', function() {
        orderdata.step = 4; 
        orderdata.action = 'back';
        
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderFourth(orderdata);
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    
    // dropdown
    dropdownMainBtn.on('click', function() {
        dropdownBtnEvent(this);
        nextBtnEvent($(this));
    });
    dropdownListItem.find('a').on('click', function() {
        dropdownMenuEvent(this);
        nextBtnEvent($(this));
    });
    function dropdownBtnEvent(target) {
        if ($(target).hasClass('active')) {
            $(target).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
        }
        else {
            $('.btn-dropdown').not($(this)).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
            $(target).addClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideDown().css('display','flex').addClass('show');
        }
    };
    function dropdownMenuEvent(target) {
        const dropmenu = $(target).parents('.dropdown-box').find('.dropdown-menu');
        const dropBtn = $(target).parents('.dropdown-box').find('.btn-dropdown');
        let targetText = $(target).text();
        dropBtn.removeClass('default active').addClass('select').find('span').text(targetText);
        dropmenu.stop().slideUp().removeClass('show');
    };
    
    /* #########[ popup_content_form_end ]######### */
    anotherAccountOrderForm = pluginForm;
    return pluginForm;
}

// 타계정 주문 입력 팝업 컨텐츠 6
function anotherAccountOrderSixth() {
    $('.plugin-contents').css('overflow-y', 'auto');
    var pluginHeader = $('.plugin-header');
    var backBtn = $('<button type="button" class="backBtn">' + popBackBtn + '</button>');
    pluginHeader.find('h1').text('타계정 주문 입력 ('+ '6' + '/' + '8' +')');
    pluginHeader.find('.backBtn').remove();
    pluginHeader.prepend(backBtn);
    
    /* #########[ popup_content_form_start ]######### */
    var pluginForm = $('<form class="form-sixth"></form>');
    
    /* #########[ popup_content ]######### */
    /* ###[ 주문 모델 ]### */
    var inputBoxText = $('<div class="input-box"><label>주문 모델<b>*</b></label></div>');
    var titleNote = $('<small class="note">※ 광고판촉비(APMS) 품의 번호 입력 시, 모델 및 수량이 자동 입력됩니다.</small>');
    inputBoxText.append(titleNote);
    var stepperWrap = $('<ul class="stepper-wrap"></ul>');
    var stepperList = $(
        '<li>'
            +'<div class="steppe-box">'
                +'<div class="input-form">'
                    +'<textarea class="searchIcon" placeholder="모델을 입력해 주세요." rows="1" style="height: auto;">'
                    +''
                    +'</textarea>'
                +'</div>'
                +'<div class="stepper">'
                    +'<button class="minus" type="button" disabled>' + minusIcon + '</button>'
                    +'<span class="count">1</span>'
                    +'<button class="plus" type="button">' + plusIcon + '</button>'
                +'</div>'
            +'</div>'
            +'<div class="stepper-del-Btn"><button type="button">' + trashIcon + '</button></div>'
        +'</li>'
    );
    stepperWrap.append(stepperList);
    inputBoxText.append(stepperWrap);

    /* ###[ 모델 추가 ]### */
    var addModelBtn = $(
        '<div class="btn btn-quick-reply btn-addModel">'
            +'<button type="button" class="btn-quick-reply btn-basic">'+ plusIconRed + '모델 추가</button>'
        +'</div>'
    );
    inputBoxText.append(addModelBtn);
    pluginForm.append(inputBoxText);
    
    /*  ###[ etc ]### */
    // 다음버튼
    var nextBtn = $('<div class="btn"><button type="button" class="btn btn-emphasis btn-big" disabled>다음</button></div>');
    pluginForm.append(nextBtn);
    pluginForm.children('.btn').find('button').on('click', function() {
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderSeventh();
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    var textareaVal = false;
    function nextBtnEvent(target) {
        var textareaObj = pluginForm.find('textarea');
        for ( let i = 0; i <= (textareaObj.length)-1; i++ ) {
            if ($(textareaObj[i]).val()) {
                textareaVal = true;
                if (textareaVal) {
                    nextBtn.find('button').attr('disabled', false);
                }
                else if (textareaVal == false) {
                    nextBtn.find('button').attr('disabled', true);
                }
            } else {
                nextBtn.find('button').attr('disabled', true);
                textareaVal = false;
                return;
            };
        };
    };

    // textarea
    pluginForm.find('input').on('keyup', function(e) {
        hblInput = e.target.value;
        nextBtnEvent($(this));
    });
    
    // back버튼
    pluginHeader.find('.backBtn').off('click').on('click', function() {
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderFifth();
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    
    // btn-addModel 이벤트(리스트 추가)
    $(document).on('click', '.btn-addModel > button', function() {
        var steppeList = $(
            '<li>'
                +'<div class="steppe-box">'
                    +'<div class="input-form">'
                        +'<textarea class="searchIcon" placeholder="모델을 입력해 주세요." rows="1" style="height: auto;"></textarea>'
                    +'</div>'
                    +'<div class="stepper">'
                        +'<button class="minus" type="button" disabled>' + minusIcon + '</button>'
                        +'<span class="count">1</span>'
                        +'<button class="plus" type="button">' + plusIcon +'</button>'
                    +'</div>'
                +'</div>'
                +'<div class="stepper-del-Btn"><button type="button">' + trashIcon + '</button></div>'
            +'</li>'
        );
        $('.stepper-wrap').append(steppeList);
        nextBtnEvent($(this));
    });

    // stepper-del-Btn 이벤트
    $(document).on('click', '.stepper-del-Btn > button', function() {
        const target = $(this).parents('li');
        let listCount = $(this).parents('.stepper-wrap').find('li').length;
        if (listCount > 1) {
            target.remove();
        } else if (listCount <= 1) {
            target.find('.count').text(1);
            target.find('textarea').val('');
            target.find('button.minus').attr('disabled', true);
        }
        nextBtnEvent($(this));
    });

    // - 버튼 클릭
    $(document).on('click', 'button.minus', function() {
        const target = $(this).parents('.stepper').find('.count');
        let count = target.text();
        count = Number(count);
        count--;
        if (count <= 1) {
            target.text(count);
            $(this).parents('.stepper').find('button.minus').attr('disabled', true);
        } else {
            target.text(count);
            $(this).parents('.stepper').find('button.minus').attr('disabled', false);
        }
    });

    // + 버튼 클릭
    $(document).on('click', 'button.plus', function() {
        const target = $(this).parents('.stepper').find('.count');
        let count = target.text();
        count = Number(count);
        count++
        $(this).parents('.stepper').find('button.minus').attr('disabled', false);
        if (count >= 100) {
            console.log('100넘음');
            target.text(count);
        } else {
            target.text(count);
        }
    });

    function stepperCount() {
        let stepperCount = $('.stepper').find('.count');
        if (stepperCount.text() >= 1) {
            $(this).parents('.stepper').find('button.minus').attr('disabled', false);
        } else {
            $(this).parents('.stepper').find('button.minus').attr('disabled', true);
        }
    }stepperCount();
    
    // 텍스트 에어리어 디폴트 높이 조정
    function textAreaAutoSizeDefult() {
        var target = $('.steppe-box').find('textarea');
        target.css('height', 'auto');
        target.css('height', $('.steppe-box').find('textarea').prop('scrollHeight') + 'px');
    }
    setTimeout(function() {
        textAreaAutoSizeDefult();
        nextBtnEvent($(this));
    },1);
    $(document).on('input', '.steppe-box textarea', function() {
        textAreaAutoSizeDefult();
        nextBtnEvent($(this));
    });
    
    /* #########[ popup_content_form_end ]######### */
    anotherAccountOrderForm = pluginForm;
    return pluginForm;
}

// 타계정 주문 입력 팝업 컨텐츠 7
function anotherAccountOrderSeventh() {
    $('.plugin-contents').css('overflow-y', 'auto');
    var pluginHeader = $('.plugin-header');
    var backBtn = $('<button type="button" class="backBtn">' + popBackBtn + '</button>');
    pluginHeader.find('h1').text('타계정 주문 입력 ('+ '7' + '/' + '8' +')');
    pluginHeader.find('.backBtn').remove();
    pluginHeader.prepend(backBtn);

    /* #########[ popup_content_form_start ]######### */
    var pluginForm = $('<form class="form-seventh"></form>');
    
    /* #########[ popup_content ]######### */
    /* ###[ 배송 유형 ]### */
    var inputBoxRadio = $('<div class="input-box"><label>배송 유형<b>*</b></label>');
    var radioContentList = ['배송 및 설치','택배'];
    var radioWrap = $('<div class="radio-wrap"></div>');
    radioContentList.forEach(function(radioContentList, index) {
        radioWrap.append($(
            '<label class="input-radio">'
                +radioContentList
                +'<input type="radio" name="another-select" value="' + radioContentList + '" />'
                +'<span class="radiomark"></span>'
            +'</label>'
        ));
        if (index == 0) {
            radioWrap.find('input').attr('checked', true);
        }
    });
    inputBoxRadio.append(radioWrap);
    pluginForm.append(inputBoxRadio);

    /* ###[ 설치 유형 ]### */
    var dropdownBox = $('<div class="dropdown-box dropdown-install"><label>설치 유형<b>*</b></label></div>');
    var dropdownMainBtn = $('<button type="button" class="btn btn-dropdown default"><span>옵션을 선택해 주세요.</span></button>');
    var dropdownArrow = $(
        '<i class="icons">'
            +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
                +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39823 5.61757C8.1709 5.4155 7.82833 5.4155 7.601 5.61757L2.26536 10.3604C2.10025 10.5071 1.84742 10.4923 1.70065 10.3271C1.55388 10.162 1.56875 9.9092 1.73387 9.76243L7.0695 5.01964C7.59995 4.54814 8.39928 4.54814 8.92972 5.01964L14.2654 9.76243C14.4305 9.9092 14.4453 10.162 14.2986 10.3271C14.1518 10.4923 13.899 10.5071 13.7339 10.3604L8.39823 5.61757Z" fill="#2C2C2C"/>'
            +'</svg>'
        +'</i>'
    );
    pluginForm.append(dropdownBox);
    dropdownBox.append(dropdownMainBtn);
    dropdownMainBtn.append(dropdownArrow);
    var dropdownMenuListWrap = $('<ul class="dropdown-menu"></ul>');
    let dropdownListItem = $(
        '<li class="dropdown-item"><a href="javascript:void(0)">[X3] 매장진열(벽걸이형)</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">[X] 매장진열</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">[A] 일반설치</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">[C] 단순배달</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">[E] 벽걸이형</a></li>'
    );
    dropdownMenuListWrap.append(dropdownListItem);
    dropdownBox.append(dropdownMenuListWrap);

    /* ###[ 도착 날짜 ]### */
    var inputTimeBox = $('<div class="input-box"><label>도착 날짜<b>*</b></label></div>');
    var dateTimeWrap = $('<div class="schedule-wrap"></div>');
    var dateTimeStartBox = $('<div class="schedule-input-wrap schedule-date-wrap"></div>');
    var dateStartInput = $('<input type="text" class="input-schedule-date" placeholder="YYYY.MM.DD" onclick="datepicker.open(this)" />');
    dateTimeStartBox.append(dateStartInput);

    /*  #########[ datepicker ]#########  */
    var datepicker = $('<div class="datepicker-chem"></div>');
    dateTimeStartBox.append(datepicker);
    
    dateTimeWrap.append(dateTimeStartBox);
    inputTimeBox.append(dateTimeWrap);
    var titleNote = $('<small class="note">※ 선택한 날짜는 설치가 불가합니다. 선택한 날짜와 가장 가까운 날짜를 알려드립니다.</small>');
    inputTimeBox.append(titleNote);

    /* ###[ 가까운 날짜 ]### */
    var addDateBtn = $(
        '<div class="btn btn-quick-reply">'
            +'<button type="button" class="btn-quick-reply btn-basic">' + '2024.06.25' + '</button>'
        +'</div>'
    );
    inputTimeBox.append(addDateBtn);
    addDateBtn.find('button').on('click', function() {
        var btnText = $(this).text();
        dateStartInput.val(btnText);
        nextBtnEvent($(this));
    });
    pluginForm.append(inputTimeBox);
    
    var placeholderToday = moment().format('YYYY.MM.DD');
    dateStartInput.val(placeholderToday);
    
    /*  ###[ etc ]### */
    // 다음버튼
    var nextBtn = $('<div class="btn"><button type="button" class="btn btn-emphasis btn-big" disabled>다음</button></div>');
    pluginForm.append(nextBtn);
    pluginForm.children('.btn').find('button').on('click', function() {
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderEighth();
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    function nextBtnEvent(target) {
        if (radioWrap.find('input[type="radio"]:checked').val() == '배송 및 설치') {
            if (dateStartInput.val() && pluginForm.find('.btn-dropdown').hasClass('select')) {
                nextBtn.find('button').attr('disabled', false);
            }
            else if (dateStartInput.val() == false || pluginForm.find('.btn-dropdown').hasClass('select') == false) {
                nextBtn.find('button').attr('disabled', true);
            }
        } else if (radioWrap.find('input[type="radio"]:checked').val() == '택배') {
            if (dateStartInput.val()) {
                nextBtn.find('button').attr('disabled', false);
            }
            else {
                nextBtn.find('button').attr('disabled', true);
            }
        }
    };

    // input
    pluginForm.find('input').on('keyup', function(e) {
        hblInput = e.target.value;
        nextBtnEvent($(this));
    });
    
    // back버튼
    pluginHeader.find('.backBtn').off('click').on('click', function() {
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderSixth();
        $('.plugin-contents').append(anotherAccountOrderForm);
    });

    // dropdown
    dropdownMainBtn.on('click', function() {
        dropdownBtnEvent(this);
        nextBtnEvent($(this));
    });
    dropdownListItem.find('a').on('click', function() {
        dropdownMenuEvent(this);
        nextBtnEvent($(this));
    });
    function dropdownBtnEvent(target) {
        if ($(target).hasClass('active')) {
            $(target).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
        }
        else {
            $('.btn-dropdown').not($(this)).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
            $(target).addClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideDown().css('display','flex').addClass('show');
        }
    };
    function dropdownMenuEvent(target) {
        const dropmenu = $(target).parents('.dropdown-box').find('.dropdown-menu');
        const dropBtn = $(target).parents('.dropdown-box').find('.btn-dropdown');
        let targetText = $(target).text();
        dropBtn.removeClass('default active').addClass('select').find('span').text(targetText);
        dropmenu.stop().slideUp().removeClass('show');
    };
    
    // 라디오 버튼 이벤트
    inputBoxRadio.find('input').on('click', function(e) {
        if (e.target.value == '배송 및 설치') {
            dropdownBox.stop().slideDown();
        } else if (e.target.value == '택배') {
            dropdownBox.stop().slideUp();
        }
        nextBtnEvent($(this));
    });

    /* #########[ popup_content_form_end ]######### */
    anotherAccountOrderForm = pluginForm;
    return pluginForm;
}

// 타계정 주문 입력 팝업 컨텐츠 8
function anotherAccountOrderEighth() {
    $('.plugin-contents').css('overflow-y', 'auto');
    var pluginHeader = $('.plugin-header');
    var backBtn = $('<button type="button" class="backBtn">' + popBackBtn + '</button>');
    pluginHeader.find('h1').text('타계정 주문 입력 ('+ '8' + '/' + '8' +')');
    pluginHeader.find('.backBtn').remove();
    pluginHeader.prepend(backBtn);
    
    /* #########[ popup_content_form_start ]######### */
    var pluginForm = $('<form class="form-eighth"></form>');

    /* #########[ popup_content ]######### */
    /* ###[ 승인 요청 ]### */
    var inputBoxText = $('<div class="input-box"><label>승인 요청<b>*</b></label></div>');
    var titleNote = $('<small class="note">※ 타의 경우 고자 하는 비용 부서의 부서장 승인이 필요합니다. 승인 요청에 필요한 문구를 입력해 주세요.</small>');
    inputBoxText.append(titleNote);
    var textareaContent = $('<div class="input-form"><textarea placeholder="내용을 입력해주세요."></textarea></div>');
    inputBoxText.append(textareaContent);
    pluginForm.append(inputBoxText);
    textareaContent.on('keyup', function(e) {
        hblInput = e.target.value;
        if (textareaContent.find('textarea').val()) {
            submitBtn.removeClass('btn-disabled');
            submitBtn.attr('disabled', false);
        }
    });
    
    /*  ###[ etc ]### */
    // 타계정 주문 버튼
    var submitBtn = $('<button disabled type="button" class="btn btn-plugin btn-apply btn-disabled" id="btn-anotheAccountOrder">타계정 주문</button>');
    pluginForm.append(submitBtn);
    submitBtn.on('click', function() {
        $('#another-account-order').removeClass('show');
        $('.plugin-dim').removeClass('show');
        setTimeout(function() {
            $('.plugin-dim').remove();
            $('#another-account-order').remove();
        }, 300);
        $('.chat-message.left').last().append(anotherAccountResult()); // 결과 메세지 (임시 확인용)
    });
    
    // back버튼
    pluginHeader.find('.backBtn').off('click').on('click', function() {
        pluginForm.removeClass('show');
        pluginForm.remove();
        anotherAccountOrderSeventh();
        $('.plugin-contents').append(anotherAccountOrderForm);
    });
    
    /* #########[ popup_content_form_end ]######### */
    anotherAccountOrderForm = pluginForm;
    return pluginForm;
}

// [ 부서 예산 팝업 ]
function gbmsPopupOpen(data) {
    
    console.log('data : ', data);
    var userId = data.userId;
    var empNo = data.empNo;    // "999991"; // 
    
    var costAuCode = (data.reAuCode != null && data.reAuCode != '')? data.reAuCode:"45130711";
    var costAuName = (data.reAuName != null && data.reAuName != '')? data.reAuName:"부품매출원가)_내수(렌탈 자가관리)";
    var costDeptCode = (data.reDeptCode != null && data.reDeptCode != '')? data.reDeptCode:"54545511";
    var costDeptName = (data.reDeptName != null && data.reDeptName != '')? data.reDeptName:"Enterprise AI팀";
    var expMonth = data.expMonth;                  // '06'
    
    console.log('Cost AU : ['+costAuCode+'] '+costAuName);
    console.log('비용처리부서 : ['+costDeptCode+'] '+costDeptName);
    console.log('조회 월 : '+expMonth);
    /* #########[ popup_wrap_start ]######### */
    var pulginDim = $('<div class="plugin-dim show"></div>');
    var addPlugin = $('<div class="plugins" id="gbmsPopup"></div>');

    /* #########[ popup_header ]######### */
    var pluginHeader = $('<div class="plugin-header"><h1>부서 예산(GBMS) 조회</h1></div>');
    var pluginClose = $('<span class="close-plugin">' + iconPopupClose + '</span>');
    pluginClose.on('click', function() {
        thisPluginClose();
    })
    pluginHeader.append(pluginClose);
    addPlugin.append(pluginHeader);
    function thisPluginClose() {
        $('#gbmsPopup').removeClass('show');
        $('.plugin-dim').removeClass('show');
        setTimeout(function() {
            $('.plugin-dim').remove();
            $('#gbmsPopup').remove();
        }, 300);
    }

    /* #########[ popup_content_wrap_start ]######### */
    var pluginContents = $('<div class="plugin-contents"></div>');
    var pluginForm = $('<form class="form-gbms"></form>');
    
    /* #########[ popup_content ]######### */
    /* ###[ Cost AU ]### */
    var inputBoxTextCostAU = $('<div class="input-box"><label>Cost AU<b>*</b></label></div>');
    var inputTextContentCostAU = $(
        '<div class="input-form">'
            +'<input class="searchIcon" type="text" placeholder="Cost AU를 입력해 주세요." name="" id="" max-length="50" />'
              + '<input type="hidden" value="'+costAuCode+'" id="costAu-code"/>'
              + '<input type="hidden" value="'+costAuName+'" id="costAu-name"/>'
        +'</div>'
    );
    
    inputTextContentCostAU.find('input[type=text]').val('['+costAuCode+'] '+costAuName);
    inputBoxTextCostAU.append(inputTextContentCostAU);
    pluginForm.append(inputBoxTextCostAU);
    inputTextContentCostAU.on('keyup', function(e) {
        hblInput = e.target.value;
        btnValueCheck();
        
        // 테스트용. 
        var orgInputAttr = hblInput.split('[');
        var inputArr = orgInputAttr[1].split('] ');
        $(this).find('input[id=costAu-code]').val(inputArr[0]);
        $(this).find('input[id=costAu-name]').val(inputArr[1]);
    });

    /* ###[ 비용 처리 부서 ]### */
    var inputBoxTextCP = $('<div class="input-box"><label>비용 처리 부서<b>*</b></label></div>');
    var inputTextContentCP = $(
        '<div class="input-form">'
            +'<input class="searchIcon" type="text" placeholder="비용 처리 부서를 입력해 주세요." name="" id="" max-length="50" />'
              + '<input type="hidden" value="" id="costDept-code"/>'
              + '<input type="hidden" value="" id="costDept-name"/>'
        +'</div>'
    );
    
    inputTextContentCP.find('input[type=text]').val('['+costDeptCode+'] '+costDeptName);
    inputTextContentCP.find('input[id=costDept-code]').val(costDeptCode);
    inputTextContentCP.find('input[id=costDept-name]').val(costDeptName);
    inputBoxTextCP.append(inputTextContentCP);
    pluginForm.append(inputBoxTextCP);
    inputTextContentCP.on('keyup', function(e) {
        hblInput = e.target.value;
        btnValueCheck();
        
        // 테스트용. 
        var orgInputAttr = hblInput.split('[');
        var inputArr = orgInputAttr[1].split('] ');
        $(this).find('input[id=costDept-code]').val(inputArr[0]);
        $(this).find('input[id=costDept-name]').val(inputArr[1]);
    });

    /* ###[ 조회 월 ]### */
    var dropdownBox = $('<div class="dropdown-box"><label>조회 월<b>*</b></label></div>');
    var dropdownMainBtn = $('<button type="button" class="btn btn-dropdown default"><span>옵션을 선택해 주세요.</span></button>');
    var dropdownArrow = $(
        '<i class="icons">'
            +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
                +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39823 5.61757C8.1709 5.4155 7.82833 5.4155 7.601 5.61757L2.26536 10.3604C2.10025 10.5071 1.84742 10.4923 1.70065 10.3271C1.55388 10.162 1.56875 9.9092 1.73387 9.76243L7.0695 5.01964C7.59995 4.54814 8.39928 4.54814 8.92972 5.01964L14.2654 9.76243C14.4305 9.9092 14.4453 10.162 14.2986 10.3271C14.1518 10.4923 13.899 10.5071 13.7339 10.3604L8.39823 5.61757Z" fill="#2C2C2C"/>'
            +'</svg>'
        +'</i>'
    );
    pluginForm.append(dropdownBox);
    dropdownBox.append(dropdownMainBtn);
    dropdownMainBtn.append(dropdownArrow);
    
    // 조회 월 메뉴 & 리스트(아이템)
    var dropdownMenuListWrap = $('<ul class="dropdown-menu top"></ul>');
    for (let i = 1; i <= 12; i++) {
        let s = i;
        if(i < 10)  s = '0'+i;
        let dropdownListItem = $('<li class="dropdown-item"><a href="javascript:void(0)" value="'+s+'">' + i + '월' + '</a></li>');
        dropdownMenuListWrap.append(dropdownListItem);
    }
    dropdownBox.append(dropdownMenuListWrap);
    
    var selMonth = expMonth;
    
    /*  ###[ etc ]### */
    // 조회버튼
    var submitBtn = $('<button disabled type="button" class="btn btn-plugin btn-apply btn-disabled" id="btn-gbms">조회</button>');
    pluginForm.append(submitBtn);
    submitBtn.on('click', function() {
        
        //$('.chat-message.left').last().append(gbmsResult()); // 결과 메세지 (임시 확인용)
        
        var reviewParam = {
                userId:userId,
                //empNo:empNo, 
                reAuCode : $('#costAu-code').val(), 
                reAuName : $('#costAu-name').val(),
                reDeptCode : $('#costDept-code').val(),
                reDeptName : $('#costDept-name').val(),
                expMonth : selMonth
        }
        
        //console.log('reAuName : '+$('#costAu-name').val());

        var requestParam = {
            query: {
                "event": "anotherBudgetQueryEvent"
            },
            payload: {
                userId:userId,
                //empNo:empNo, 
                costAuCode : $('#costAu-code').val(),
                costAuName : $('#costAu-name').val(),
                costDeptCode : $('#costDept-code').val(),
                costDeptName : $('#costDept-name').val(),
                expMonth : selMonth
            }
        };        
        
        console.log('requestParam > ', requestParam);
        
        sendChatApi(requestParam, userId, function(payload) {
            console.log('타계정 예산(GBMS) 조회 결과 : ', payload);
            
            var budgetInfo = '';
            var regSuccessYn = '';
            var errorMessage = '';
            if (payload && payload.queryResult && payload.queryResult.messages.length > 0 && payload.queryResult.messages[0].response) {
                var budgetResponse = JSON.parse(payload.queryResult.messages[0].response);
                console.log(budgetResponse["successYn"]);
                
                if (budgetResponse["successYn"] == 'N') {
                    console.log('errorMessage : '+budgetResponse["errorMessage"]);
                    regSuccessYn = 'N';
                    errorMessage = budgetResponse["errorMessage"];               // 에러메시지.
                } else {
                    regSuccessYn = 'Y';
                    if (budgetResponse.template && budgetResponse.template.outputs.length > 0 && budgetResponse.template.outputs[0] && budgetResponse.template.outputs[0].resultItem) {
                        
                        budgetInfo = budgetResponse.template.outputs[0].resultItem;
                    }
                }
                
            }
            
            thisPluginClose();
            
            if(regSuccessYn == 'N') {
                
                console.log('부서 예산 조회 실패 : ');
                
                var anotherGbmsResult = '<div class="message simple-text">'
                                 +'<p>'
                                    +'시스템 오류로 인해 조회되지 않았어요.<br><br>'
                                    +'아래 버튼을 눌러 부서 예산을 다시 조회해 보세요.'
                                 +'</p>'
                                +'<div class="btn">'
                                    +'<button type="button" class="btn btn-default btn-big reload-budget">다시 조회하기</button>'
                                +'</div>'
                                + '</div>'; 
                                
                appendChatbotText(anotherGbmsResult);
                
                $('.reload-budget').on('click', function() {
                    gbmsPopupOpen(reviewParam);
                });
                
            }   
            else{
            
                console.log('부서 예산 조회 완료 : ', budgetInfo);
                
                var msgGbmsResult = '<div class="message simple-text">'
                                 +'<p>'
                                    +'<b>부서 예산(GBMS)</b>을 확인해 주세요. '
                                 +'</p>'
                                + '</div>'; 
                
                var anotherGbmsResult = '';
                if(budgetInfo.length == 1) {                // 예산 조회 단건
                    var anotherGbmsResult = msgGbmsResult + gbmsResultSingle(budgetInfo);
                }
                else if(budgetInfo.length > 1) {            // 예산 조회 다건
                    
                }
                else{
                    console.log('부서 예산 조회 : 0건.');
                }
                
                appendChatbotText(anotherGbmsResult);
            }            
        });
    });

    /* #########[ popup_content_wrap_end ]######### */
    pluginContents.append(pluginForm);
    addPlugin.append(pluginContents);

    /* #########[ popup_wrap_end ]######### */
    $('.test-panel').append(pulginDim);
    $('.test-panel').append(addPlugin);
    $('.plugin-dim').css('display', 'block');
    $('#gbmsPopup').css('display', 'block');
    setTimeout(function() {
        $('.plugin-dim').addClass('show');
        $('#gbmsPopup').addClass('show');
    }, 100);

    /* #########[ 기타 ]######### */
    // dropdown
    $('.btn-dropdown').on('click', function() {
        dropdownBtnEvent(this);
    });
    $('.dropdown-menu a').on('click', function() {
        dropdownMenuEvent(this);
        btnValueCheck();
    });
    function dropdownBtnEvent(target) {
        if ($(target).hasClass('active')) {
            $(target).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
        }
        else {
            $('.btn-dropdown').not($(this)).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
            $(target).addClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideDown().css('display','flex').addClass('show');
        }
    }
    function dropdownMenuEvent(target) {
        const dropmenu = $(target).parents('.dropdown-box').find('.dropdown-menu');
        const dropBtn = $(target).parents('.dropdown-box').find('.btn-dropdown');
        let targetText = $(target).text();
        dropBtn.removeClass('default active').addClass('select').find('span').text(targetText);
        dropmenu.stop().slideUp().removeClass('show');
        
        selMonth = $(target).attr('value');
    }
    
    // dropdown_등록되어있는 값이 있을경우 해당 값 선택
    dropdownMenuListWrap.find('li').each(function() {
        if ($(this).text() == Number(expMonth)+'월') {
            $(this).find('a').trigger('click');
            return;
        }
    });
    
    // 조회버튼 활성화 체크
    function btnValueCheck() {
        function btnActive() {submitBtn.removeClass('btn-disabled');submitBtn.attr('disabled', false);}
        function btnDisabled() {submitBtn.addClass('btn-disabled');submitBtn.attr('disabled', true);}

        if (inputTextContentCostAU.find('input').val() && inputTextContentCP.find('input').val() && $('.btn-dropdown').hasClass('select')) {
            btnActive()
        } else {
            btnDisabled()
        }
    }
    btnValueCheck();
};

// [ 광고판촉비 팝업 ]
function apmsPopupOpen(data) {
    
    console.log('data : ', data);
    var userId = data.userId;
    
    var apms_no = (data.apms_no != null && data.apms_no != '')? data.apms_no:"EKHQ-MKT-20231127-0087";
    /* #########[ popup_wrap_start ]######### */
    var pulginDim = $('<div class="plugin-dim show"></div>');
    var addPlugin = $('<div class="plugins" id="apmsPopup"></div>');

    /* #########[ popup_header ]######### */
    var pluginHeader = $('<div class="plugin-header"><h1>광고 판촉비(APMS) 조회</h1></div>');
    var pluginClose = $('<span class="close-plugin">' + iconPopupClose + '</span>');
    pluginClose.on('click', function() {
        thisPluginClose();
    })
    pluginHeader.append(pluginClose);
    addPlugin.append(pluginHeader);
    function thisPluginClose() {
        $('#apmsPopup').removeClass('show');
        $('.plugin-dim').removeClass('show');
        setTimeout(function() {
            $('.plugin-dim').remove();
            $('#apmsPopup').remove();
        }, 300);
    }

    /* #########[ popup_content_wrap_start ]######### */
    var pluginContents = $('<div class="plugin-contents"></div>');
    var pluginForm = $('<form class="form-apms"></form>');
    
    /* #########[ popup_content ]######### */
    /* ###[ 광고 판촉비(APMS) 폼의 번호 ]### */
    var inputBoxTextAPMS = $('<div class="input-box"><label>광고 판촉비(APMS) 품의 번호<b>*</b></label></div>');

    var titleNote = $('<small class="note">※ 사전에 확보한 APMS 품의 번호를 입력 하세요.</small>');
    inputBoxTextAPMS.append(titleNote);

    var inputBoxTextAPMSNum = $(
        '<div class="input-form">'
            +'<input class="" type="text" placeholder="내용을 입력해 주세요." name="" id="apms-no" max-length="50" />'
        +'</div>'
    );
    inputBoxTextAPMSNum.find('input').val(apms_no);
    inputBoxTextAPMS.append(inputBoxTextAPMSNum);
    pluginForm.append(inputBoxTextAPMS);
    inputBoxTextAPMSNum.on('keyup', function(e) {
        hblInput = e.target.value;
        btnValueCheck();
    });

    /*  ###[ etc ]### */
    // 조회버튼
    var submitBtn = $('<button disabled type="button" class="btn btn-plugin btn-apply btn-disabled" id="btn-apms">조회</button>');
    pluginForm.append(submitBtn);
    submitBtn.on('click', function() {
        //thisPluginClose();
        //$('.chat-message.left').last().append(apmsResult()); // 결과 메세지 (임시 확인용)
        var reviewParam = {
                userId:userId,
                //empNo:empNo, 
                apms_no : $('#apms-no').val()
        }

        var requestParam = {
            query: {
                "event": "anotherApmsQueryEvent"
            },
            payload: {
                userId:userId,
                //empNo:empNo, 
                apmsNo : $('#apms-no').val()
            }
        };        
        
        console.log('requestParam > ', requestParam);
        
        sendChatApi(requestParam, userId, function(payload) {
            console.log('타계정 광고판촉비(APMS) 조회 결과 : ', payload);
            
            var apmsInfo = '';
            var regSuccessYn = '';
            var errorMessage = '';
            if (payload && payload.queryResult && payload.queryResult.messages.length > 0 && payload.queryResult.messages[0].response) {
                var apmsResponse = JSON.parse(payload.queryResult.messages[0].response);
                console.log(apmsResponse["successYn"]);
                
                if (apmsResponse["successYn"] == 'N') {
                    console.log('errorMessage : '+apmsResponse["errorMessage"]);
                    regSuccessYn = 'N';
                    errorMessage = apmsResponse["errorMessage"];               // 에러메시지.
                } else {
                    regSuccessYn = 'Y';
                    if (apmsResponse.template && apmsResponse.template.outputs.length > 0 && apmsResponse.template.outputs[0] && apmsResponse.template.outputs[0].resultItem) {
                        
                        apmsInfo = apmsResponse.template.outputs[0].resultItem;
                    }
                }
                
            }
            else {
                regSuccessYn = 'N';
            }
            
            thisPluginClose();
            
            if(regSuccessYn == 'N') {
                
                console.log('광고판촉비 조회 실패 : ');
                
                var anotherApmsResult = '<div class="message simple-text">'
                                 +'<p>'
                                    +'시스템 오류로 인해 조회되지 않았어요.<br><br>'
                                    +'아래 버튼을 눌러 광고판촉비를 다시 조회해 보세요.'
                                 +'</p>'
                                +'<div class="btn">'
                                    +'<button type="button" class="btn btn-default btn-big reload-apms">다시 조회하기</button>'
                                +'</div>'
                                + '</div>'; 
                                
                appendChatbotText(anotherApmsResult);
                
                $('.reload-apms').on('click', function() {
                    apmsPopupOpen(reviewParam);
                });
                
            }   
            else{
            
                console.log('광고판촉비 조회 완료 : ', apmsInfo);
                
                var msgApmsResult = '<div class="message simple-text">'
                                 +'<p>'
                                    +'<b>광고판촉비(APMS)</b>를 확인해 보세요. '
                                 +'</p>'
                                + '</div>'; 
                
                var anotherApmsResult = '';
                if(apmsInfo.length == 1) {                // 광고판촉비 조회 단건
                    var anotherApmsResult = msgApmsResult + apmsResult(apmsInfo);
                }
                //else if(apmsInfo.length > 1) {            // 예산 조회 다건
                //    
                //}
                else{
                    console.log('광고판촉비 조회 : 0건.');
                }
                
                appendChatbotText(anotherApmsResult);
            }            
        });
        
    });

    /* #########[ popup_content_wrap_end ]######### */
    pluginContents.append(pluginForm);
    addPlugin.append(pluginContents);

    /* #########[ popup_wrap_end ]######### */
    $('.test-panel').append(pulginDim);
    $('.test-panel').append(addPlugin);
    $('.plugin-dim').css('display', 'block');
    $('#apmsPopup').css('display', 'block');
    setTimeout(function() {
        $('.plugin-dim').addClass('show');
        $('#apmsPopup').addClass('show');
    }, 100);

    /* #########[ 기타 ]######### */
    // 조회버튼 활성화 체크
    function btnValueCheck() {
        function btnActive() {submitBtn.removeClass('btn-disabled');submitBtn.attr('disabled', false);}
        function btnDisabled() {submitBtn.addClass('btn-disabled');submitBtn.attr('disabled', true);}

        if (inputBoxTextAPMSNum.find('input').val()) {
            btnActive();
        } else {
            btnDisabled();
        };
    };
    btnValueCheck();
};

// [ 타계정 주문 현황 조회 팝업 ]
function anotherAccountListViewPopupOpen() {
    /* #########[ popup_wrap_start ]######### */
    var pulginDim = $('<div class="plugin-dim show"></div>');
    var addPlugin = $('<div class="plugins" id="aalvPopup"></div>');

    /* #########[ popup_header ]######### */
    var pluginHeader = $('<div class="plugin-header"><h1>타계정 주문 현황 조회</h1></div>');
    var pluginClose = $('<span class="close-plugin">' + iconPopupClose + '</span>');
    pluginClose.on('click', function() {
        thisPluginClose();
    })
    pluginHeader.append(pluginClose);
    addPlugin.append(pluginHeader);
    function thisPluginClose() {
        $('#aalvPopup').removeClass('show');
        $('.plugin-dim').removeClass('show');
        setTimeout(function() {
            $('.plugin-dim').remove();
            $('#aalvPopup').remove();
        }, 300);
    }

    /* #########[ popup_content_wrap_start ]######### */
    var pluginContents = $('<div class="plugin-contents"></div>');
    var pluginForm = $('<form class="form-aalv"></form>');
    
    /* #########[ popup_content ]######### */
    var mainNote = $('<small class="note">※ 오늘 기준 3개월 이내 주문건만 조회 가능합니다.</small>');
    pluginForm.append(mainNote);
        
    /* ###[ 조회 구분 ]### */
    var dropdownBox = $('<div class="dropdown-box dropdown-aalv"><label>조회 구분</label></div>');
    var dropdownMainBtn = $('<button type="button" class="btn btn-dropdown default"><span>옵션을 선택해 주세요.</span></button>');
    var dropdownArrow = $(
        '<i class="icons">'
            +'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">'
                +'<path fill-rule="evenodd" clip-rule="evenodd" d="M8.39823 5.61757C8.1709 5.4155 7.82833 5.4155 7.601 5.61757L2.26536 10.3604C2.10025 10.5071 1.84742 10.4923 1.70065 10.3271C1.55388 10.162 1.56875 9.9092 1.73387 9.76243L7.0695 5.01964C7.59995 4.54814 8.39928 4.54814 8.92972 5.01964L14.2654 9.76243C14.4305 9.9092 14.4453 10.162 14.2986 10.3271C14.1518 10.4923 13.899 10.5071 13.7339 10.3604L8.39823 5.61757Z" fill="#2C2C2C"/>'
            +'</svg>'
        +'</i>'
    );
    pluginForm.append(dropdownBox);
    dropdownBox.append(dropdownMainBtn);
    dropdownMainBtn.append(dropdownArrow);
    
    // 조회 구분 메뉴 & 리스트(아이템)
    var dropdownMenuListWrap = $('<ul class="dropdown-menu"></ul>');
    let dropdownListItem = $(
        '<li class="dropdown-item"><a href="javascript:void(0)">' + '나의 주문 건 조회' + '</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">' + '부서 내 주문 건 조회' + '</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">' + '주문 번호로 조회' + '</a></li>'
        +'<li class="dropdown-item"><a href="javascript:void(0)">' + '품의 번호로 조회' + '</a></li>'
    );
    dropdownMenuListWrap.append(dropdownListItem);
    dropdownBox.append(dropdownMenuListWrap);

    /* ###[ 주문 번호 / 품의 번호 ]### */
    var inputBoxTextOrder = $('<div class="input-box p-bot-20vh"><label>조회 번호 / 품의 번호</label></div>');

    var titleNote = $('<small class="note">※ 주문 번호 / 품의 번호로 조회 시 필수 입력 사항입니다.</small>');
    inputBoxTextOrder.append(titleNote);

    var inputTextContentOrderNum = $(
        '<div class="input-form">'
            +'<input class="searchIcon" type="text" placeholder="주문 번호를 입력해 주세요." name="" id="" max-length="50" />'
        +'</div>'
    );
    inputTextContentOrderNum.find('input').val('551127217');
    inputBoxTextOrder.append(inputTextContentOrderNum);
    pluginForm.append(inputBoxTextOrder);
    inputTextContentOrderNum.on('keyup', function(e) {
        hblInput = e.target.value;
        btnValueCheck();
    });

    /*  ###[ etc ]### */
    // 조회버튼
    var submitBtn = $('<button disabled type="button" class="btn btn-plugin btn-apply btn-disabled" id="btn-aalv">조회</button>');
    pluginForm.append(submitBtn);
    submitBtn.on('click', function() {
        thisPluginClose();
        $('.chat-message.left').last().append(aalvResult()); // 결과 메세지 (임시 확인용)
    });

    /* #########[ popup_content_wrap_end ]######### */
    pluginContents.append(pluginForm);
    addPlugin.append(pluginContents);

    /* #########[ popup_wrap_end ]######### */
    $('.test-panel').append(pulginDim);
    $('.test-panel').append(addPlugin);
    $('.plugin-dim').css('display', 'block');
    $('#aalvPopup').css('display', 'block');
    setTimeout(function() {
        $('.plugin-dim').addClass('show');
        $('#aalvPopup').addClass('show');
    }, 100);

    /* #########[ 기타 ]######### */
    // dropdown
    $('.btn-dropdown').on('click', function() {
        dropdownBtnEvent(this);
    });
    $('.dropdown-menu a').on('click', function() {
        dropdownMenuEvent(this);
        orderObjNumCheck(this);
        btnValueCheck();
    });
    function dropdownBtnEvent(target) {
        if ($(target).hasClass('active')) {
            $(target).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
        }
        else {
            $('.btn-dropdown').not($(this)).removeClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideUp().removeClass('show');
            $(target).addClass('active').parents('.dropdown-box').find('.dropdown-menu').stop().slideDown().css('display','flex').addClass('show');
        }
    }
    function dropdownMenuEvent(target) {
        const dropmenu = $(target).parents('.dropdown-box').find('.dropdown-menu');
        const dropBtn = $(target).parents('.dropdown-box').find('.btn-dropdown');
        let targetText = $(target).text();
        dropBtn.removeClass('default active').addClass('select').find('span').text(targetText);
        dropmenu.stop().slideUp().removeClass('show');
    }
    
    // dropdown_등록되어있는 값이 있을경우 해당 값 선택
    dropdownMenuListWrap.find('li').each(function() {
        if ($(this).text() == '') {
            $(this).find('a').trigger('click');
            return;
        }
    });

    function orderObjNumCheck(target) {
        const dropBtn = $(target).parents('.dropdown-box').find('.btn-dropdown');
        if ($(target).text() == '주문 번호로 조회' || $(target).text() == '품의 번호로 조회') {
            dropBtn.addClass('target');
        } else {
            dropBtn.removeClass('target');
        }
    }
    
    // 조회버튼 활성화 체크
    function btnValueCheck() {
        function btnActive() {submitBtn.removeClass('btn-disabled');submitBtn.attr('disabled', false);}
        function btnDisabled() {submitBtn.addClass('btn-disabled');submitBtn.attr('disabled', true);}

        if ($('.btn-dropdown').hasClass('select')) {
            if ($('.btn-dropdown').hasClass('target')) {
                if (inputTextContentOrderNum.find('input').val()) {
                    btnActive();
                } else {
                    btnDisabled();
                }
            } else {
                btnActive();
            }
        } else {
            btnDisabled();
        }
    }
    btnValueCheck();
};

/* ##### [ 타계정 조회 메세지 ] ##### */
// 부서 예산 조회 메세지
function makeCardGBMS(data) {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var messageTextWrap = $('<div class="message simple-text"></div>');
    var messageTextContent = $(
         '<p>'
            +'부서 예산(GBMS)을 조회하려면 아래 버튼을 눌러주세요.'
         +'</p>'
    );
    var loadBtn = $(
        '<div class="btn">'
            +'<button type="button" class="btn btn-emphasis btn-big">부서 예산(GBMS) 조회</button>'
        +'</div>'
    );
    loadBtn.on('click', function() {
        gbmsPopupOpen(data);
    });
    messageTextWrap.append(messageTextContent);
    messageTextWrap.append(loadBtn);
    
    if(checkChatHistory == false) {
        gbmsPopupOpen(data);
    }
    //messageBox.append(messageTextWrap);
    //messageWrap.append(messageBox);
    //return messageWrap; 
    return messageTextWrap;
}

// 광고판촉비 조회 메세지
function makeCardAPMS(data) {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var messageTextWrap = $('<div class="message simple-text"></div>');
    var messageTextContent = $(
         '<p>'
            +'광고판촉비(APMS)를 조회하려면 아래 버튼을 눌러주세요.'
         +'</p>'
    );
    var loadBtn = $(
        '<div class="btn">'
            +'<button type="button" class="btn btn-emphasis btn-big">광고판촉비(APMS) 조회</button>'
        +'</div>'
    );
    loadBtn.on('click', function() {
        apmsPopupOpen(data);
    });
    messageTextWrap.append(messageTextContent);
    messageTextWrap.append(loadBtn);
    
    if(checkChatHistory == false) {
        apmsPopupOpen(data);
    }
    
    //messageBox.append(messageTextWrap);
    //messageWrap.append(messageBox);
    //return messageWrap; 
    return messageTextWrap;
}

// 타계정 주문 입력 조회 메세지
function makeCardAnotherAccountOrder(orderdata) {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var messageTextWrap = $('<div class="message simple-text"></div>');
    var messageTextContent = $(
         '<p>'
            +'타계정 주문을 진행하려면 아래 버튼을 눌러주세요.'
         +'</p>'
    );
    var loadBtn = $(
        '<div class="btn">'
            +'<button type="button" class="btn btn-emphasis btn-big">타계정 주문 입력</button>'
        +'</div>'
    );
    loadBtn.on('click', function() {
        orderdata.step = 1;
        anotherAccountPopupOpen(orderdata);
    });
    messageTextWrap.append(messageTextContent);
    messageTextWrap.append(loadBtn);
    
    if(checkChatHistory == false) {
        anotherAccountPopupOpen(orderdata);
    }
    
    //messageBox.append(messageTextWrap);
    //messageWrap.append(messageBox);
    //return messageWrap;
    return messageTextWrap;
}

// 타계정 주문 현황 조회 메세지
function makeCardAALV() {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var messageTextWrap = $('<div class="message simple-text"></div>');
    var messageTextContent = $(
         '<p>'
            +'타계정 주문 현황을 조회하려면 아래 버튼을 눌러주세요.'
         +'</p>'
    );
    var loadBtn = $(
        '<div class="btn">'
            +'<button type="button" class="btn btn-emphasis btn-big">타계정 주문 현황 조회</button>'
        +'</div>'
    );
    loadBtn.on('click', function() {
        anotherAccountListViewPopupOpen();
    });
    messageTextWrap.append(messageTextContent);
    messageTextWrap.append(loadBtn);
    messageBox.append(messageTextWrap);
    messageWrap.append(messageBox);
    return messageWrap; 
}

/* ##### [ 타계정 오류 메세지 ] ##### */
// 부서 예산 오류 메세지
function gbmsResultError(data) {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var messageTextWrap = $('<div class="message simple-text"></div>');
    var messageTextContent = $(
         '<p>'
            +'시스템 오류로 인해 조회되지 않았어요.<br><br>'
            +'아래 버튼을 눌러 부서 예산을 다시 조회해 보세요.'
         +'</p>'
    );
    var reloadBtn = $(
        '<div class="btn">'
            +'<button type="button" class="btn btn-default btn-big">다시 조회하기</button>'
        +'</div>'
    );
    reloadBtn.on('click', function() {
        gbmsPopupOpen(data);
    });
    messageTextWrap.append(messageTextContent);
    messageTextWrap.append(reloadBtn);
    messageBox.append(messageTextWrap);
    //messageWrap.append(messageBox);
    
    return messageBox.html();
    //return messageWrap;
}

// 광고판촉비 오류 메세지
function apmsResultError() {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var messageTextWrap = $('<div class="message simple-text"></div>');
    var messageTextContent = $(
         '<p>'
            +'시스템 오류로 인해 조회되지 않았어요.<br><br>'
            +'아래 버튼을 눌러 광고판촉비를 다시 조회해 보세요.'
         +'</p>'
    );
    var reloadBtn = $(
        '<div class="btn">'
            +'<button type="button" class="btn btn-default btn-big">다시 조회하기</button>'
        +'</div>'
    );
    reloadBtn.on('click', function() {
        apmsPopupOpen();
    });
    messageTextWrap.append(messageTextContent);
    messageTextWrap.append(reloadBtn);
    messageBox.append(messageTextWrap);
    messageWrap.append(messageBox);
    return messageWrap;
}

// 타계정 주문 입력 오류 메세지
function anotherAccountOrderResultError() {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var messageTextWrap = $('<div class="message simple-text"></div>');
    var messageTextContent = $(
         '<p>'
            +'시스템 오류로 인해 주문 되지 않았어요.<br><br>'
            +'아래 버튼을 눌러 타계정 주문을 완료해 보세요.'
         +'</p>'
    );
    var reloadBtn = $(
        '<div class="btn">'
            +'<button type="button" class="btn btn-default btn-big">주문 완료하기</button>'
        +'</div>'
    );
    reloadBtn.on('click', function() {
        anotherAccountPopupOpen();
    });
    messageTextWrap.append(messageTextContent);
    messageTextWrap.append(reloadBtn);
    messageBox.append(messageTextWrap);
    messageWrap.append(messageBox);
    return messageWrap;
}

// 타계정 주문 현황 조회 오류 메세지
function aalvResultError() {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var messageTextWrap = $('<div class="message simple-text"></div>');
    var messageTextContent = $(
         '<p>'
            +'시스템 오류로 인해 조회되지 않았어요.<br><br>'
            +'아래 버튼을 눌러 타계정 주문 현황을 다시 조회해 보세요.'
         +'</p>'
    );
    var reloadBtn = $(
        '<div class="btn">'
            +'<button type="button" class="btn btn-default btn-big">다시 조회하기</button>'
        +'</div>'
    );
    reloadBtn.on('click', function() {
        anotherAccountListViewPopupOpen();
    });
    messageTextWrap.append(messageTextContent);
    messageTextWrap.append(reloadBtn);
    messageBox.append(messageTextWrap);
    messageWrap.append(messageBox);
    return messageWrap;
}

/* ##### [ 타계정 결과 메세지 ] ##### */
// 부서 예산 결과 메세지
function gbmsResultSingle(budgetInfo) {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var contentWarp = $('<div class="content-wrap"></div>');
    var contentHeader = $('<div class="content-wrap-header">' + iconBell +'<h2>잔여 예산 현황</h2></div>');
    contentWarp.append(contentHeader);
    
    var budget = budgetInfo[0];
    var contentBox = $(
        '<div class="content-box">'
            +'<div class="content-box-header">'
                +iconRoundCheck
                +'<h3>' + budget.deptName + '</h3>'
            +'</div>'
            +'<ul class="content-list-wrap">'
                +'<li>'
                    +'<h4>조회 월</h4>'
                    +'<div class="content-list-val text"><span>' + budget.expMonth+'월' + '</span></div>'
                +'</li>'
                +'<li>'
                    +'<h4>기준 일시</h4>'
                    +'<div class="content-list-val date">'
                        +'<span>' + budget.expDate + '</span>'
                        +'<span>' + budget.expTime + '</span>'
                    +'</div>'
                +'</li>'
                +'<li>'
                    +'<h4>예산 잔액</h4>'
                    +'<div class="content-list-val amount"><span>' + formatAmount(budget.budgetAmt) + '</span>원</div>'
                +'</li>'
            +'</ul>'
        +'</div>'
    );
    contentWarp.append(contentBox);
    messageBox.append(contentWarp);
    messageWrap.append(messageBox);
    
    return messageWrap.html();
}

// 광고 판촉비 결과 메세지
function apmsResult(apmsInfo) {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var contentWarp = $('<div class="content-wrap"></div>');
    var contentHeader = $('<div class="content-wrap-header">' + iconBell +'<h2>광고판촉비</h2></div>');
    contentWarp.append(contentHeader);
    
    var apms = apmsInfo[0];
    var contentBox = $(
        '<div class="content-box">'
            +'<ul class="content-list-wrap">'
                +'<li>'
                    +'<h4>품의 번호</h4>'
                    +'<div class="content-list-val text"><span>' + apms.apms_no + '</span></div>'
                +'</li>'
                +'<li>'
                    +'<h4>광고판촉비</h4>'
                    +'<div class="content-list-val amount"><span>' + formatAmount(apms.activity_amount) + '</span>원</div>'
                +'</li>'
            +'</ul>'
        +'</div>'
    );
    contentWarp.append(contentBox);
    messageBox.append(contentWarp);
    messageWrap.append(messageBox);
    return messageWrap.html();
}

// 타계정 주문 입력 결과 메세지
function anotherAccountResult() {
    var messageWrap = $('<div class="custom-message"></div>');
    var messageBox = $('<div class="message"></div>');
    var contentWarp = $('<div class="content-wrap"></div>');
    var contentHeader = $('<div class="content-wrap-header">' + iconBell +'<h2>타계정 주문 완료</h2></div>');
    contentWarp.append(contentHeader);
    
    var contentBox = $(
        '<div class="content-box">'
            +'<ul class="content-list-wrap">'
                +'<li>'
                    +'<h4>주문 번호</h4>'
                    +'<div class="content-list-val text"><span>' + '5205522155DD' + '</span></div>'
                +'</li>'
                +'<li>'
                    +'<h4>품의 번호</h4>'
                    +'<div class="content-list-val text"><span>' + 'QQ5224615' + '</span></div>'
                +'</li>'
            +'</ul>'
        +'</div>'
    );

    var contentBtn = $(
        '<div class="btn">'
            +'<button type="button" class="btn btn-default btn-big">타계정 주문 현황 조회</button>'
        +'</div>'
    )
    contentBtn.on('click', function() {
        $('.chat-message.left').last().append(makeCardAALV()); // 타계정 주문 현황 조회 메세지가 출력 되어야함(임시코드)
        anotherAccountListViewPopupOpen();
    });
    contentBox.append(contentBtn);

    contentWarp.append(contentBox);
    messageBox.append(contentWarp);
    messageWrap.append(messageBox);
    return messageWrap;
}

// 타계정 주문 현황 결과 메세지
function aalvResult() {
    var messageWrap = $('<div class="message content-list-message"></div>');
    var messageHeader = $('<div class="content-list-header">' + listHeaderIcon2 + '<p class="list-header-title">타계정 주문 내역</p></div>');
    messageWrap.append(messageHeader);

    // 테스트용 데이터
    var testData = [
        { 'orderStat':'주문완료', 'orderNo':'5205522155DD', 'bmp':'생산 중', 'user':'홍길동', 'userClass':'책임' },
        { 'orderStat':'접수중', 'orderNo':'0000000000CC', 'bmp':'입고', 'user':'홍길동', 'userClass':'선임' },
        { 'orderStat':'접수완료', 'orderNo':'1111111111BB', 'bmp':'완료', 'user':'홍길동', 'userClass':'책임' },
        { 'orderStat':'배송중', 'orderNo':'3333333333AA', 'bmp':'출고', 'user':'홍길동', 'userClass':'선임' },
        { 'orderStat':'주문완료', 'orderNo':'5205522155DD', 'bmp':'생산 중', 'user':'홍길동', 'userClass':'책임' },
        { 'orderStat':'접수중', 'orderNo':'0000000000CC', 'bmp':'입고', 'user':'홍길동', 'userClass':'선임' },
        { 'orderStat':'접수완료', 'orderNo':'1111111111BB', 'bmp':'완료', 'user':'홍길동', 'userClass':'책임' },
        { 'orderStat':'배송중', 'orderNo':'3333333333AA', 'bmp':'출고', 'user':'홍길동', 'userClass':'선임' }
    ]

    var contentListWrap = $('<ul class="noLink"></ul>');
    // if (리스트 instanceof Array && 리스트.length > 0) {
        testData.forEach( function ( testData, index ) {
            var display = (index >= 4)? "none":"block";

            var oderStatus;
            if ( testData.orderStat == '주문완료' ) { oderStatus = '<span class="status-item orderCL">' + testData.orderStat + '</span>' }
            else if ( testData.orderStat == '접수중' ) { oderStatus = '<span class="status-item receipt">' + testData.orderStat + '</span>' }
            else if ( testData.orderStat == '접수완료' ) { oderStatus = '<span class="status-item applicationCL">' + testData.orderStat + '</span>' }
            else if ( testData.orderStat == '배송중' ) { oderStatus = '<span class="status-item delivery">' + testData.orderStat + '</span>' }

            var contentList = $(
                '<li class="list-box" style="display:' + display + '">'
                    +'<div class="list-title order-status">'
                        +'<div class="order-status-box">' + oderStatus +'</div>'
                        +'<h3>' + testData.orderNo + '</h3>'
                    +'</div>'
                    +'<ul class="list-info">'
                        +'<li>'
                            +'<h4>BMP</h4>'
                            +'<span class="list-info-value text">' + testData.bmp + '</span>'
                        +'</li>'
                        +'<li>'
                            +'<h4>주문자</h4>'
                            +'<span class="list-info-value text">' + testData.user + ' ' + testData.userClass + '</span>'
                        +'</li>'
                    +'</ul>'
                +'</li>'
            );
            contentListWrap.append(contentList);
        });
    // }
    messageWrap.append(contentListWrap);

    // if (아이템.length > 4) {
    if (testData.length > 4) {
        var seeMoreBtn = $(
            '<div class="see-more">'
                +'<svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">'
                    +'<path d="M7.09998 13.7666C7.09998 13.9875 7.27906 14.1666 7.49998 14.1666C7.72089 14.1666 7.89998 13.9875 7.89998 13.7666V7.89985H13.7667C13.9876 7.89985 14.1667 7.72077 14.1667 7.49985C14.1667 7.27894 13.9876 7.09985 13.7667 7.09985H7.89998V1.23325C7.89998 1.01234 7.72089 0.833252 7.49998 0.833252C7.27906 0.833252 7.09998 1.01234 7.09998 1.23325V7.09985H1.23337C1.01246 7.09985 0.833374 7.27894 0.833374 7.49985C0.833374 7.72077 1.01246 7.89985 1.23337 7.89985H7.09998V13.7666Z" fill="#2C2C2C"/>'
                +'</svg>'
                +'더보기'
            +'</div>'
        );
        seeMoreBtn.click(function() {
            $(this).parents('.content-list-message').find(".list-box").css("display","block");
            $(this).css({"display":"none"});
        });
        messageWrap.append(seeMoreBtn);
    }
    return messageWrap;
}

function formatAmount(amt) {
    return amt.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')    
}